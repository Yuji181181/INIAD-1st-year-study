<!DOCTYPE html>

<html lang="ja" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>モデルからフォームを作成する &#8212; Django 5.1.6.dev20250122212402 ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=34bb78ad" />
    <link rel="stylesheet" type="text/css" href="../../_static/default.css?v=bf4d74af" />
    <script src="../../_static/documentation_options.js?v=d2885b0a"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=4755f45a"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="フォームアセット (Media クラス)" href="media.html" />
    <link rel="prev" title="フォームセット (Formset)" href="formsets.html" />



 
<script src="../../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Django 5.1.6.dev20250122212402 ドキュメント</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Table of contents" href="../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../genindex.html">Index</a>  |
        <a title="Module index" href="../../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="formsets.html" title="フォームセット (Formset)">previous</a>
     |
    <a href="../index.html" title="Django を使う" accesskey="U">up</a>
   |
    <a href="media.html" title="フォームアセット (&lt;code class=&#34;docutils literal notranslate&#34;&gt;&lt;span class=&#34;pre&#34;&gt;Media&lt;/span&gt;&lt;/code&gt; クラス)">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="topics-forms-modelforms">
            
  <section id="s-creating-forms-from-models">
<span id="creating-forms-from-models"></span><h1>モデルからフォームを作成する<a class="headerlink" href="#creating-forms-from-models" title="Link to this heading">¶</a></h1>
<section id="s-modelform">
<span id="modelform"></span><h2><code class="docutils literal notranslate"><span class="pre">ModelForm</span></code><a class="headerlink" href="#modelform" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="django.forms.ModelForm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ModelForm</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/forms/models.py#L565"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.forms.ModelForm" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<p>データベース中心のアプリケーションを作成している場合、Django モデルに密接にマップするフォームを使うことになるでしょう。例えば、<code class="docutils literal notranslate"><span class="pre">BlogComment</span></code> モデルを持っていて、閲覧者がコメントを送信できるフォームを作成したくなったとしましょう。この場合、すでにモデル内にフィールドが定義されているので、フォーム内にフィールドタイプを改めて定義するのは冗長でしょう。</p>
<p>このためDjango には、Django モデルから <code class="docutils literal notranslate"><span class="pre">Form</span></code> クラスを生成できるようなヘルパークラスを用意してあります。</p>
<p>例えば次のようにします:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Article</span>

<span class="go"># Create the form class.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">ArticleForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
<span class="gp">... </span>        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pub_date&quot;</span><span class="p">,</span> <span class="s2">&quot;headline&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;reporter&quot;</span><span class="p">]</span>
<span class="gp">...</span>

<span class="go"># Creating a form to add an article.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">form</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">()</span>

<span class="go"># Creating a form to change an existing article.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">article</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">form</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">article</span><span class="p">)</span>
</pre></div>
</div>
<section id="s-field-types">
<span id="field-types"></span><h3>フィールドの型<a class="headerlink" href="#field-types" title="Link to this heading">¶</a></h3>
<p>生成された <code class="docutils literal notranslate"><span class="pre">Form</span></code> クラスは、指定された全てのモデルフィールドに対して、<code class="docutils literal notranslate"><span class="pre">fields</span></code> 属性で指定された順番でフォームフィールドを有します。</p>
<p>各モデルフィールドは、対応するデフォルトのフォームフィールドを持ちます。例えば、モデル上の <code class="docutils literal notranslate"><span class="pre">CharField</span></code>  はフォーム上で <code class="docutils literal notranslate"><span class="pre">CharField</span></code> として表現されます。モデル <code class="docutils literal notranslate"><span class="pre">ManyToManyField</span></code> は <code class="docutils literal notranslate"><span class="pre">MultipleChoiceField</span></code> として表現されます。 以下は、各フィールドの対応表です:</p>
<table class="docutils">
<thead>
<tr class="row-odd"><th class="head"><p>モデルフィールド</p></th>
<th class="head"><p>フォームフィールド</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a></p></td>
<td><p>フォーム上では表示されません。</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.BigAutoField" title="django.db.models.BigAutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BigAutoField</span></code></a></p></td>
<td><p>フォーム上では表示されません。</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.BigIntegerField" title="django.db.models.BigIntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BigIntegerField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.IntegerField" title="django.forms.IntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntegerField</span></code></a> で <code class="docutils literal notranslate"><span class="pre">min_value</span></code> が -9223372036854775808 から <code class="docutils literal notranslate"><span class="pre">max_value</span></code> に 9223372036854775807 セットされます。</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.BinaryField" title="django.db.models.BinaryField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BinaryField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.Field.editable" title="django.db.models.Field.editable"><code class="xref py py-attr docutils literal notranslate"><span class="pre">editable</span></code></a> がモデルフィールド上で <code class="docutils literal notranslate"><span class="pre">True</span></code> にセットされていた場合、<a class="reference internal" href="../../ref/forms/fields.html#django.forms.CharField" title="django.forms.CharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">CharField</span></code></a> です。それ以外の場合フォーム内で描画されません。</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.BooleanField" title="django.db.models.BooleanField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BooleanField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.BooleanField" title="django.forms.BooleanField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BooleanField</span></code></a> です。<code class="docutils literal notranslate"><span class="pre">null=True</span></code> の場合は <a class="reference internal" href="../../ref/forms/fields.html#django.forms.NullBooleanField" title="django.forms.NullBooleanField"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullBooleanField</span></code></a> です。</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.CharField" title="django.db.models.CharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">CharField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.CharField" title="django.forms.CharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">CharField</span></code></a> で、<code class="docutils literal notranslate"><span class="pre">max_length</span></code> はモデルフィールドの <code class="docutils literal notranslate"><span class="pre">max_length</span></code> にセットされます。また <code class="docutils literal notranslate"><span class="pre">null=True</span></code> の場合 <a class="reference internal" href="../../ref/forms/fields.html#django.forms.CharField.empty_value" title="django.forms.CharField.empty_value"><code class="xref py py-attr docutils literal notranslate"><span class="pre">empty_value</span></code></a> が <code class="docutils literal notranslate"><span class="pre">None</span></code> にセットされます。</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.DateField" title="django.db.models.DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.DateField" title="django.forms.DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.DateTimeField" title="django.forms.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.DecimalField" title="django.db.models.DecimalField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DecimalField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.DecimalField" title="django.forms.DecimalField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DecimalField</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.DurationField" title="django.db.models.DurationField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DurationField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.DurationField" title="django.forms.DurationField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DurationField</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.EmailField" title="django.db.models.EmailField"><code class="xref py py-class docutils literal notranslate"><span class="pre">EmailField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.EmailField" title="django.forms.EmailField"><code class="xref py py-class docutils literal notranslate"><span class="pre">EmailField</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.FileField" title="django.db.models.FileField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.FileField" title="django.forms.FileField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FileField</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.FilePathField" title="django.db.models.FilePathField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilePathField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.FilePathField" title="django.forms.FilePathField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilePathField</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.FloatField" title="django.db.models.FloatField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FloatField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.FloatField" title="django.forms.FloatField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FloatField</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.ModelChoiceField" title="django.forms.ModelChoiceField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelChoiceField</span></code></a>
(see below)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.ImageField" title="django.db.models.ImageField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImageField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.ImageField" title="django.forms.ImageField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImageField</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.IntegerField" title="django.db.models.IntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntegerField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.IntegerField" title="django.forms.IntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntegerField</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">IPAddressField</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">IPAddressField</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.GenericIPAddressField" title="django.db.models.GenericIPAddressField"><code class="xref py py-class docutils literal notranslate"><span class="pre">GenericIPAddressField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.GenericIPAddressField" title="django.forms.GenericIPAddressField"><code class="xref py py-class docutils literal notranslate"><span class="pre">GenericIPAddressField</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.JSONField" title="django.db.models.JSONField"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.JSONField" title="django.forms.JSONField"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONField</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.ManyToManyField" title="django.db.models.ManyToManyField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManyToManyField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.ModelMultipleChoiceField" title="django.forms.ModelMultipleChoiceField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelMultipleChoiceField</span></code></a> (以下を参照)</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.PositiveBigIntegerField" title="django.db.models.PositiveBigIntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">PositiveBigIntegerField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.IntegerField" title="django.forms.IntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntegerField</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.PositiveIntegerField" title="django.db.models.PositiveIntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">PositiveIntegerField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.IntegerField" title="django.forms.IntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntegerField</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.PositiveSmallIntegerField" title="django.db.models.PositiveSmallIntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">PositiveSmallIntegerField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.IntegerField" title="django.forms.IntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntegerField</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.SlugField" title="django.db.models.SlugField"><code class="xref py py-class docutils literal notranslate"><span class="pre">SlugField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.SlugField" title="django.forms.SlugField"><code class="xref py py-class docutils literal notranslate"><span class="pre">SlugField</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.SmallAutoField" title="django.db.models.SmallAutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">SmallAutoField</span></code></a></p></td>
<td><p>フォーム上では表示されません。</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.SmallIntegerField" title="django.db.models.SmallIntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">SmallIntegerField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.IntegerField" title="django.forms.IntegerField"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntegerField</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.TextField" title="django.db.models.TextField"><code class="xref py py-class docutils literal notranslate"><span class="pre">TextField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.CharField" title="django.forms.CharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">CharField</span></code></a> で <code class="docutils literal notranslate"><span class="pre">widget=forms.Textarea</span></code> です。</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.TimeField" title="django.db.models.TimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.TimeField" title="django.forms.TimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeField</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.URLField" title="django.db.models.URLField"><code class="xref py py-class docutils literal notranslate"><span class="pre">URLField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.URLField" title="django.forms.URLField"><code class="xref py py-class docutils literal notranslate"><span class="pre">URLField</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.UUIDField" title="django.db.models.UUIDField"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUIDField</span></code></a></p></td>
<td><p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.UUIDField" title="django.forms.UUIDField"><code class="xref py py-class docutils literal notranslate"><span class="pre">UUIDField</span></code></a></p></td>
</tr>
</tbody>
</table>
<p>お気付きかもしれませんが、 <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> と <code class="docutils literal notranslate"><span class="pre">ManyToManyField</span></code> の 2 つのモデルフィールドは特殊なケースとなります:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> は <code class="docutils literal notranslate"><span class="pre">django.forms.ModelChoiceField</span></code> によって表現され、モデルの <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> を選択肢として持つ <code class="docutils literal notranslate"><span class="pre">ChoiceField</span></code> です。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ManyToManyField</span></code> は <code class="docutils literal notranslate"><span class="pre">django.forms.ModelMultipleChoiceField</span></code> によって表現され、モデルの <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> を選択肢として持つ <code class="docutils literal notranslate"><span class="pre">MultipleChoiceField</span></code> です。</p></li>
</ul>
<p>加えて、生成されたフォームフィールドはそれぞれ以下の通り属性がセットされます:</p>
<ul class="simple">
<li><p>モデルフィールドに <code class="docutils literal notranslate"><span class="pre">blank=True</span></code> が設定されている場合、フォームフィールド上で <code class="docutils literal notranslate"><span class="pre">required</span></code> が <code class="docutils literal notranslate"><span class="pre">False</span></code> にセットされます。それ以外の場合は <code class="docutils literal notranslate"><span class="pre">required=True</span></code> となります。</p></li>
<li><p>フォームフィールドの <code class="docutils literal notranslate"><span class="pre">label</span></code> はモデルフィールドの <code class="docutils literal notranslate"><span class="pre">verbose_name</span></code> の最初の文字を大文字にしたものがセットされます。</p></li>
<li><p>フォームフィールドの <code class="docutils literal notranslate"><span class="pre">help_text</span></code> はモデルフィールドの <code class="docutils literal notranslate"><span class="pre">help_text</span></code> がセットされます。</p></li>
<li><p>モデルフィールドに <code class="docutils literal notranslate"><span class="pre">choices</span></code> が設定されている場合、フォームフィールドの <code class="docutils literal notranslate"><span class="pre">widget</span></code> は <code class="docutils literal notranslate"><span class="pre">Select</span></code> にセットされ、選択肢にはモデルフィールドの <code class="docutils literal notranslate"><span class="pre">choices</span></code> が使われます。通常、選択肢には空欄の選択肢が追加され、デフォルトで選択されることになります。フィールドが required の場合、ユーザは選択肢を選ぶ必要があります。モデルフィールドに <code class="docutils literal notranslate"><span class="pre">blank=False</span></code> および明示的な <code class="docutils literal notranslate"><span class="pre">default</span></code> 値が設定されている場合、空欄の選択肢は表示されません (代わりに <code class="docutils literal notranslate"><span class="pre">default</span></code> 値が選択された状態で表示されます) 。</p></li>
</ul>
<p>与えられたモデルフィールドに対して使われるフォームフィールドをオーバーライドすることもできます。後述の <a class="reference internal" href="#overriding-the-default-fields">Overriding the default fields</a> を参照してください。</p>
</section>
<section id="s-a-full-example">
<span id="a-full-example"></span><h3>完全な具体例<a class="headerlink" href="#a-full-example" title="Link to this heading">¶</a></h3>
<p>以下のような一連のモデルを考えていきましょう:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelForm</span>

<span class="n">TITLE_CHOICES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;MR&quot;</span><span class="p">:</span> <span class="s2">&quot;Mr.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MRS&quot;</span><span class="p">:</span> <span class="s2">&quot;Mrs.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MS&quot;</span><span class="p">:</span> <span class="s2">&quot;Ms.&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">TITLE_CHOICES</span><span class="p">)</span>
    <span class="n">birth_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AuthorForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Author</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;birth_date&quot;</span><span class="p">]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BookForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;authors&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>これらのモデルでは、上記の <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> サブクラスはおおむね以下と同等と言えます (唯一の違いは <code class="docutils literal notranslate"><span class="pre">save()</span></code> メソッドで、これからすぐ説明します):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django</span><span class="w"> </span><span class="kn">import</span> <span class="n">forms</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AuthorForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">TITLE_CHOICES</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">birth_date</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BookForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="s-validation-on-a-modelform">
<span id="s-validation-on-modelform"></span><span id="validation-on-a-modelform"></span><span id="validation-on-modelform"></span><h3><code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> の検証 (バリデーション)<a class="headerlink" href="#validation-on-a-modelform" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> のバリデーションには、以下の 2 つのステップが存在します:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="../../ref/forms/validation.html"><span class="doc">フォームのバリデーションを実施する</span></a></p></li>
<li><p><a class="reference internal" href="../../ref/models/instances.html#validating-objects"><span class="std std-ref">モデルのインスタンスのバリデーションを実施する</span></a></p></li>
</ol>
<p>通常のフォームのバリデーションと同じように、モデルフォームのバリデーションは <a class="reference internal" href="../../ref/forms/api.html#django.forms.Form.is_valid" title="django.forms.Form.is_valid"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_valid()</span></code></a> が呼ばれたときや <a class="reference internal" href="../../ref/forms/api.html#django.forms.Form.errors" title="django.forms.Form.errors"><code class="xref py py-attr docutils literal notranslate"><span class="pre">errors</span></code></a> 属性にアクセスしたとき、暗黙的に実行されます。また、実際にはあまり使うメソッドではありませんが、明示的に <code class="docutils literal notranslate"><span class="pre">full_clean()</span></code> を呼んだときにもバリデーションが実行されます。</p>
<p><code class="docutils literal notranslate"><span class="pre">Model</span></code> バリデーション (<a class="reference internal" href="../../ref/models/instances.html#django.db.models.Model.full_clean" title="django.db.models.Model.full_clean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.full_clean()</span></code></a>) は、フォームバリデーションのステップ内でフォームの <code class="docutils literal notranslate"><span class="pre">clean()</span></code> メソッドが呼ばれたすぐ直後に実行されます。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>クリーニングのプロセスは、様々な方法で <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> コンストラクタに渡されたモデルのインスタンスを修正します。例えば、モデル上のあらゆる日付フィールドは、実際の date オブジェクトに変換されます。失敗したバリデーションは、一貫性のない状態でモデルインスタンスを元のままにしておくため、これを再利用するのはお勧めできません。</p>
</div>
<section id="s-overriding-the-clean-method">
<span id="s-overriding-modelform-clean-method"></span><span id="overriding-the-clean-method"></span><span id="overriding-modelform-clean-method"></span><h4><code class="docutils literal notranslate"><span class="pre">clean()</span></code> メソッドをオーバーライドする<a class="headerlink" href="#overriding-the-clean-method" title="Link to this heading">¶</a></h4>
<p>通常のフォームと同じ方法でモデルフォーム上の <code class="docutils literal notranslate"><span class="pre">clean()</span></code> メソッドをオーバーライドして、バリデーションの動作を追加できます。</p>
<p>モデルのオブジェクトに付属したモデルフォームのインスタンスは、<code class="docutils literal notranslate"><span class="pre">instance</span></code> 属性を持ち、メソッドが特定のモデルのインスタンスにアクセスできるようにします。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p><code class="docutils literal notranslate"><span class="pre">ModelForm.clean()</span></code> メソッドは、<a class="reference internal" href="../../ref/models/instances.html#validating-objects"><span class="std std-ref">モデルバリデーション</span></a> に、<code class="docutils literal notranslate"><span class="pre">unique</span></code>、<code class="docutils literal notranslate"><span class="pre">unique_together</span></code> または <code class="docutils literal notranslate"><span class="pre">unique_for_date|month|year</span></code> としてマークされたモデルフィールドの一意性を検証させます。</p>
<p><code class="docutils literal notranslate"><span class="pre">clean()</span></code> メソッドをオーバーライドして、なおかつこのバリデーションを維持したい場合、親クラスの <code class="docutils literal notranslate"><span class="pre">clean()</span></code> メソッドを呼ぶ必要があります。</p>
</div>
</section>
<section id="s-interaction-with-model-validation">
<span id="interaction-with-model-validation"></span><h4>モデルバリデーションとのやり取り<a class="headerlink" href="#interaction-with-model-validation" title="Link to this heading">¶</a></h4>
<p>バリデーションプロセスの一部として、<code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> フォーム上で対応するフィールドを持つモデルのそれぞれのフィールドの <code class="docutils literal notranslate"><span class="pre">clean()</span></code> メソッドを呼び出します。モデルフィールドを除外した場合、これらのフィールドに対してはバリデーションが実行されません。フィールドのクリーニングとバリデーションの詳しい働き方については、<a class="reference internal" href="../../ref/forms/validation.html"><span class="doc">フォームバリデーション</span></a> ドキュメントを参照してください。</p>
<p>モデルの <code class="docutils literal notranslate"><span class="pre">clean()</span></code> メソッドは一意性のチェックがされる前に呼び出されます。モデルの <code class="docutils literal notranslate"><span class="pre">clean()</span></code> フックのより詳しい情報については、<a class="reference internal" href="../../ref/models/instances.html#validating-objects"><span class="std std-ref">オブジェクトのバリデーションを行う</span></a> を参照してください。</p>
</section>
<section id="s-considerations-regarding-model-s-error-messages">
<span id="s-considerations-regarding-model-errormessages"></span><span id="considerations-regarding-model-s-error-messages"></span><span id="considerations-regarding-model-errormessages"></span><h4>モデルの <code class="docutils literal notranslate"><span class="pre">error_messages</span></code> についての注意<a class="headerlink" href="#considerations-regarding-model-s-error-messages" title="Link to this heading">¶</a></h4>
<p><a class="reference internal" href="../../ref/forms/fields.html#django.forms.Field.error_messages" title="django.forms.Field.error_messages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">フォームフィールド</span></code></a> や <a class="reference internal" href="#modelforms-overriding-default-fields"><span class="std std-ref">フォーム Meta</span></a> のレベルで定義されたエラーメッセージは、常に <a class="reference internal" href="../../ref/models/fields.html#django.db.models.Field.error_messages" title="django.db.models.Field.error_messages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">モデルフィールド</span></code></a> のレベルで定義されたエラーメッセージより優先されます。</p>
<p><a class="reference internal" href="../../ref/models/fields.html#django.db.models.Field.error_messages" title="django.db.models.Field.error_messages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">モデルフィールド</span></code></a> で定義されたエラーメッセージは、<a class="reference internal" href="../../ref/models/instances.html#validating-objects"><span class="std std-ref">モデルバリデーション</span></a> のステップの間に <code class="docutils literal notranslate"><span class="pre">ValidationError</span></code> が発生したときに、対応するエラーメッセージがフォームのレベルで定義されていない場合にのみ使用されます。</p>
<p><a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.NON_FIELD_ERRORS" title="django.core.exceptions.NON_FIELD_ERRORS"><code class="xref py py-data docutils literal notranslate"><span class="pre">NON_FIELD_ERRORS</span></code></a> キーを <code class="docutils literal notranslate"><span class="pre">Meta</span></code> クラス内の <code class="docutils literal notranslate"><span class="pre">error_messages</span></code> ディクショナリに追加することで、モデルバリデーションによって発生する <code class="docutils literal notranslate"><span class="pre">NON_FIELD_ERRORS</span></code> に対するエラーメッセージをオーバーライドできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.core.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">NON_FIELD_ERRORS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelForm</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ArticleForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">error_messages</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">NON_FIELD_ERRORS</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;unique_together&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%(model_name)s</span><span class="s2">&#39;s </span><span class="si">%(field_labels)s</span><span class="s2"> are not unique.&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="s-the-save-method">
<span id="s-topics-modelform-save"></span><span id="the-save-method"></span><span id="topics-modelform-save"></span><h3><code class="docutils literal notranslate"><span class="pre">save()</span></code> メソッド<a class="headerlink" href="#the-save-method" title="Link to this heading">¶</a></h3>
<p>全ての <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> は <code class="docutils literal notranslate"><span class="pre">save()</span></code> メソッドも持っています。このメソッドは、フォームに結びつけられたデータからデータベースオブジェクトを生成して保存します。<code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> のサブクラスはキーワード引数 <code class="docutils literal notranslate"><span class="pre">instance</span></code> として既存のモデルインスタンスを受け取ることができます; これが指定されると、<code class="docutils literal notranslate"><span class="pre">save()</span></code> はそのインスタンスを更新するようになります。 指定されない場合は、<code class="docutils literal notranslate"><span class="pre">save()</span></code> は指定されたモデルの新しいインスタンスを生成します:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Article</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArticleForm</span>

<span class="go"># Create a form instance from POST data.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

<span class="go"># Save a new Article object from the form&#39;s data.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_article</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="go"># Create a form to edit an existing Article, but use</span>
<span class="go"># POST data to populate the form.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>フォームが <a class="reference internal" href="#validation-on-modelform"><span class="std std-ref">バリデーションされていない</span></a> 場合、<code class="docutils literal notranslate"><span class="pre">save()</span></code> を呼び出すと、<code class="docutils literal notranslate"><span class="pre">form.errors</span></code> をチェックすることでこれを行います。フォーム内のデータが適正ではない場合は <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> が発生します -- 例えば、<code class="docutils literal notranslate"><span class="pre">form.errors</span></code> が <code class="docutils literal notranslate"><span class="pre">True</span></code> だと評価された場合です。</p>
<p>オプションのフィールドがフォームのデータに表示されない場合、結果のモデルインスタンスはモデルフィールドの <a class="reference internal" href="../../ref/models/fields.html#django.db.models.Field.default" title="django.db.models.Field.default"><code class="xref py py-attr docutils literal notranslate"><span class="pre">default</span></code></a> を使用します。この動作は、 <a class="reference internal" href="../../ref/forms/widgets.html#django.forms.CheckboxInput" title="django.forms.CheckboxInput"><code class="xref py py-class docutils literal notranslate"><span class="pre">CheckboxInput</span></code></a>, <a class="reference internal" href="../../ref/forms/widgets.html#django.forms.CheckboxSelectMultiple" title="django.forms.CheckboxSelectMultiple"><code class="xref py py-class docutils literal notranslate"><span class="pre">CheckboxSelectMultiple</span></code></a>, または <a class="reference internal" href="../../ref/forms/widgets.html#django.forms.SelectMultiple" title="django.forms.SelectMultiple"><code class="xref py py-class docutils literal notranslate"><span class="pre">SelectMultiple</span></code></a> (または <a class="reference internal" href="../../ref/forms/widgets.html#django.forms.Widget.value_omitted_from_data" title="django.forms.Widget.value_omitted_from_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">value_omitted_from_data()</span></code></a> メソッドが常に <code class="docutils literal notranslate"><span class="pre">False</span></code> を返すカスタムウィジェット) を使用するフィールドには適用されません。チェックされていないチェックボックスと、選択されていない <code class="docutils literal notranslate"><span class="pre">&lt;select</span> <span class="pre">multiple&gt;</span></code> は HTML フォーム送信のデータには表示されないからです。 API を設計していて、これらのウィジェットを使用するフィールドのデフォルトのフォールバック動作が必要な場合は、カスタムフォームフィールドまたはウィジェットを使用します。</p>
<p>この <code class="docutils literal notranslate"><span class="pre">save()</span></code> には、省略可能な <code class="docutils literal notranslate"><span class="pre">commit</span></code> キーワード引数があり、<code class="docutils literal notranslate"><span class="pre">True</span></code> ないし <code class="docutils literal notranslate"><span class="pre">False</span></code> を取ります。<code class="docutils literal notranslate"><span class="pre">save()</span></code> を <code class="docutils literal notranslate"><span class="pre">commit=False</span></code> で呼び出した場合、データベースにまだ保存されていないオブジェクトを返します。この場合、結果のモデルインスタンスで <code class="docutils literal notranslate"><span class="pre">save()</span></code> を呼び出すかどうかはあなた次第です。これは、保存前にオブジェクトで独自のプロセスを実行したい場合、もしくは特別な <a class="reference internal" href="../../ref/models/instances.html#ref-models-force-insert"><span class="std std-ref">モデル保存オプション</span></a> を使いたい場合に有用です。 <code class="docutils literal notranslate"><span class="pre">commit</span></code> はデフォルトでは <code class="docutils literal notranslate"><span class="pre">True</span></code> です。</p>
<p><code class="docutils literal notranslate"><span class="pre">commit=False</span></code> を使う際のもう 1 つの副作用は、モデルに他のモデルとの多対多の関係がある場合に見られます。フォームを save するときにモデルに多対多の関係があり <code class="docutils literal notranslate"><span class="pre">commit=False</span></code> を指定した場合、Django は多対多の関係に対してフォームのデータを即座に保存することができません。これは、インスタンスがデータベース上に存在するようになるまで、インスタンスに対して多対多のデータを保存することが不可能だからです。</p>
<p>この問題を扱うために、<code class="docutils literal notranslate"><span class="pre">commit=False</span></code> を使ったフォームを save するたびに、Django は <code class="docutils literal notranslate"><span class="pre">save_m2m()</span></code> メソッドをあなたの <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> サブクラスに追加します。フォームによって生成されたインスタンスを手動で save した後に、多対多のフォームデータを保存するには <code class="docutils literal notranslate"><span class="pre">save_m2m()</span></code> を実行します。例えば:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="go"># Create a form instance with POST data.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">AuthorForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

<span class="go"># Create, but don&#39;t save the new author instance.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_author</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="go"># Modify the author in some way.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_author</span><span class="o">.</span><span class="n">some_field</span> <span class="o">=</span> <span class="s2">&quot;some_value&quot;</span>

<span class="go"># Save the new instance.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="go"># Now, save the many-to-many data for the form.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">save_m2m</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save_m2m()</span></code> を呼び出す必要があるのは <code class="docutils literal notranslate"><span class="pre">save(commit=False)</span></code> を使ったときだけです。フォーム上で <code class="docutils literal notranslate"><span class="pre">save()</span></code> を使用すると、多対多のデータを含むすべてのデータが保存されます。 たとえば:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="go"># Create a form instance with POST data.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">Author</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">AuthorForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>

<span class="go"># Create and save the new author instance. There&#39;s no need to do anything else.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_author</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code> と <code class="docutils literal notranslate"><span class="pre">save_m2m()</span></code> メソッドのほかは、<code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> は <code class="docutils literal notranslate"><span class="pre">forms</span></code> のフォームとまったく同じ方法で動作します。例えば、<code class="docutils literal notranslate"><span class="pre">is_valid()</span></code> メソッドは妥当性をチェックするために使用される、<code class="docutils literal notranslate"><span class="pre">is_multipart()</span></code> メソッドはフォームがマルチパートのファイルアップロードを必要とするかどうかを (ゆえに <code class="docutils literal notranslate"><span class="pre">request.FILES</span></code> がフォームに渡される必要があるかどうかも) 決める、などです。詳しくは <a class="reference internal" href="../../ref/forms/api.html#binding-uploaded-files"><span class="std std-ref">アップロードされたファイルをフォームにバインドする</span></a> を参照してください。</p>
</section>
<section id="s-selecting-the-fields-to-use">
<span id="s-modelforms-selecting-fields"></span><span id="selecting-the-fields-to-use"></span><span id="modelforms-selecting-fields"></span><h3>使うフィールドを選択する<a class="headerlink" href="#selecting-the-fields-to-use" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">fields</span></code> 属性を使って、フォームで編集すべき全てのフィールドを明示的に指定することを強くお勧めします。そうしないと、フォームで予期せず特定のフィールドを設定できるようになり、セキュリティ上の問題が発生しやすくなります。特に新しいフィールドがモデルに追加されたときに起こりがちです。フォームのレンダリング方法によっては、Webページで問題が目に見えないことさえあります。</p>
<p>別のアプローチとしては、すべてのフィールドを自動的に含めるか、一部のフィールドだけを削除する方法があります。この基本的なアプローチは安全性がかなり低いことが知られており、主要なウェブサイトで深刻な悪用が行われています (<a class="reference external" href="https://github.blog/2012-03-04-public-key-security-vulnerability-and-mitigation/">GitHub</a> など)。</p>
<p>しかし、これらのセキュリティ上の懸念があなたに当てはまらないと保証できる場合には、2 つのショートカットが利用可能です:</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">fields</span></code> 属性に、特殊な値 <code class="docutils literal notranslate"><span class="pre">'__all__'</span></code> をセットして、モデル内の全てのフィールドが使われるように指定します。例えば:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelForm</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AuthorForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Author</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s2">&quot;__all__&quot;</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> の中の <code class="docutils literal notranslate"><span class="pre">Meta</span></code> クラスの <code class="docutils literal notranslate"><span class="pre">exclude</span></code> 属性に、フォームから除外されるフィールドのリストをセットします。</p>
<p>例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PartialAuthorForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Author</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Author</span></code> モデルは 3 つのフィールド <code class="docutils literal notranslate"><span class="pre">name</span></code>、<code class="docutils literal notranslate"><span class="pre">title</span></code>、<code class="docutils literal notranslate"><span class="pre">birth_date</span></code> を持っているため、これで <code class="docutils literal notranslate"><span class="pre">name</span></code> と <code class="docutils literal notranslate"><span class="pre">birth_date</span></code> がフォームに表示されることになります。</p>
</li>
</ol>
<p>このどちらかが使われた場合、フォーム内で表示されるフィールドの順番はモデル内でフィールドが定義された順番となり、<code class="docutils literal notranslate"><span class="pre">ManyToManyField</span></code> インスタンスは最後に表示されます。</p>
<p>加えて、Django は以下のルールも適用します: モデルフィールドで <code class="docutils literal notranslate"><span class="pre">editable=False</span></code> をセットした場合、<code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> を通じて生成された <em>全ての</em> フォームはそのフィールドを含みません。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>上記のロジックでフォームに含まれない全てのフィールドは、フォームの <code class="docutils literal notranslate"><span class="pre">save()</span></code> メソッドでセットされません。また、除外したフィールドを手動でフォームに追加し直した場合、モデルインスタンスから初期化されることはありません。</p>
<p>Django は不完全なモデルを保存しないようにするため、モデルの設定でフィールドを空にすることを許容しておらず、かつ除外されたフィールドに対するデフォルト値を指定しなかった場合、除外されたフィールドを含む <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> を <code class="docutils literal notranslate"><span class="pre">save()</span></code> しようとすると失敗します。この失敗を避けるには、除外する必須フィールドに初期値を指定してモデルをインスタンス化する必要があります:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Mr&quot;</span><span class="p">)</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">PartialAuthorForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
<span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>もしくは、<code class="docutils literal notranslate"><span class="pre">save(commit=False)</span></code> を使って手動で追加の必須フィールドをセットできます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">form</span> <span class="o">=</span> <span class="n">PartialAuthorForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
<span class="n">author</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">author</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mr&quot;</span>
<span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save(commit=False)</span></code> の使用について、詳しくは <a class="reference internal" href="#the-save-method">section on saving forms</a> を参照してください。</p>
</div>
</section>
<section id="s-overriding-the-default-fields">
<span id="s-modelforms-overriding-default-fields"></span><span id="overriding-the-default-fields"></span><span id="modelforms-overriding-default-fields"></span><h3>デフォルトのフィールドをオーバライドする<a class="headerlink" href="#overriding-the-default-fields" title="Link to this heading">¶</a></h3>
<p>前述の <a class="reference internal" href="#field-types">Field types</a> テーブルで説明したとおり、デフォルトのフィールドタイプは実用的なデフォルトです。モデルに <code class="docutils literal notranslate"><span class="pre">DateField</span></code> がある場合、フォーム内で <code class="docutils literal notranslate"><span class="pre">DateField</span></code> として表示したいことでしょう。しかし、<code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> では、与えられたモデルに足してフォームフィールドを変更する柔軟性があります。</p>
<p>フィールドに対して独自のウィジェットを指定するには、内部の <code class="docutils literal notranslate"><span class="pre">Meta</span></code> クラスの <code class="docutils literal notranslate"><span class="pre">widgets</span></code> を使用してください。これは、フィールド名としジェットのクラスやインスタンスをマッピングするディクショナリです。</p>
<p>例えば、<code class="docutils literal notranslate"><span class="pre">Authoer</span></code> の <code class="docutils literal notranslate"><span class="pre">name</span></code> 属性に対する <code class="docutils literal notranslate"><span class="pre">CharField</span></code> を、デフォルトの <code class="docutils literal notranslate"><span class="pre">&lt;input</span> <span class="pre">type=&quot;text&quot;&gt;</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">&lt;textarea&gt;</span></code> で表示したい場合、フィールドのウィジェットをオーバーライドします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelForm</span><span class="p">,</span> <span class="n">Textarea</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Author</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AuthorForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Author</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;birth_date&quot;</span><span class="p">]</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cols&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s2">&quot;rows&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}),</span>
        <span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">widgets</span></code> 辞書はウィジェットのインスタンス（例: <code class="docutils literal notranslate"><span class="pre">Textarea(...)</span></code> ）またはクラス（例: <code class="docutils literal notranslate"><span class="pre">Textarea</span></code>）を受け付けます。空でない <code class="docutils literal notranslate"><span class="pre">choices</span></code> 属性を持つモデルフィールドでは <code class="docutils literal notranslate"><span class="pre">widgets</span></code> 辞書は無視されることに注意してください。この場合、フォームフィールドをオーバーライドして別のウィジェットを使用する必要があります。</p>
<p>同様に、フィールドをさらにカスタマイズしたい場合、内部の <code class="docutils literal notranslate"><span class="pre">Meta</span></code> クラスの <code class="docutils literal notranslate"><span class="pre">labels</span></code>、<code class="docutils literal notranslate"><span class="pre">help_texts</span></code>、<code class="docutils literal notranslate"><span class="pre">error_messages</span></code> と言った属性を指定できます。</p>
<p>例えば、<code class="docutils literal notranslate"><span class="pre">name</span></code> フィールドに対する文字列に直面する全てのユーザの文章をカスタマイズしたい場合:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AuthorForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Author</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;birth_date&quot;</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Writer&quot;</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">help_texts</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Some useful help text.&quot;</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">error_messages</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;max_length&quot;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;This writer&#39;s name is too long.&quot;</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>また、 <code class="docutils literal notranslate"><span class="pre">field_classes</span></code> や <code class="docutils literal notranslate"><span class="pre">formfield_callback</span></code> を指定して、フォームがインスタンス化するフィールドのタイプをカスタマイズすることもできます。</p>
<p>例えば、<code class="docutils literal notranslate"><span class="pre">slug</span></code> フィールドに対して <code class="docutils literal notranslate"><span class="pre">MySlugFormField</span></code> を使いたい場合、以下のようにできます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelForm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Article</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ArticleForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pub_date&quot;</span><span class="p">,</span> <span class="s2">&quot;headline&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;reporter&quot;</span><span class="p">,</span> <span class="s2">&quot;slug&quot;</span><span class="p">]</span>
        <span class="n">field_classes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;slug&quot;</span><span class="p">:</span> <span class="n">MySlugFormField</span><span class="p">,</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>もしくは:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelForm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Article</span>


<span class="k">def</span><span class="w"> </span><span class="nf">formfield_for_dbfield</span><span class="p">(</span><span class="n">db_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">db_field</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;slug&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MySlugFormField</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">db_field</span><span class="o">.</span><span class="n">formfield</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ArticleForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pub_date&quot;</span><span class="p">,</span> <span class="s2">&quot;headline&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;reporter&quot;</span><span class="p">,</span> <span class="s2">&quot;slug&quot;</span><span class="p">]</span>
        <span class="n">formfield_callback</span> <span class="o">=</span> <span class="n">formfield_for_dbfield</span>
</pre></div>
</div>
<p>最後に、フィールドを完全に -- タイプ、バリデータ、必須かどうかなどを含めて -- コントロールしたい場合、通常の <code class="docutils literal notranslate"><span class="pre">Form</span></code> で行うのと同じようにフィールドを宣言的に指定することで実現できます。</p>
<p>フィールドのバリデータを指定したい場合、フィールドを宣言的に定義して <code class="docutils literal notranslate"><span class="pre">validators</span></code> パラメータを設定することで実現できます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">CharField</span><span class="p">,</span> <span class="n">ModelForm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Article</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ArticleForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="n">slug</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">validate_slug</span><span class="p">])</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pub_date&quot;</span><span class="p">,</span> <span class="s2">&quot;headline&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;reporter&quot;</span><span class="p">,</span> <span class="s2">&quot;slug&quot;</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>以下のように明示的にフォームフィールドをインスタンス化したとき、<code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> と 通常の <code class="docutils literal notranslate"><span class="pre">Form</span></code> が連動する方法を理解することが重要となります。</p>
<p><code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> は、特定のフィールドを自動的に生成できる通常の <code class="docutils literal notranslate"><span class="pre">Form</span></code> です。自動的に生成されるフィールドは、<code class="docutils literal notranslate"><span class="pre">Meta</span></code> クラスの内容とどのフィールドが宣言的に定義されているかに依存します。基本的に、<code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> は フォームから <strong>除外された</strong> フィールド、言い換えると宣言的に定義されなかったフィールド <strong>のみ</strong> を生成します。</p>
<p>宣言的に定義されたフィールドはそのままになります。したがって、<code class="docutils literal notranslate"><span class="pre">Meta</span></code> 属性に対するカスタマイズ、例えば <code class="docutils literal notranslate"><span class="pre">widgets</span></code>、<code class="docutils literal notranslate"><span class="pre">labels</span></code>、<code class="docutils literal notranslate"><span class="pre">help_texts</span></code>、<code class="docutils literal notranslate"><span class="pre">error_messages</span></code> は無視されます; これらは自動的に生成されたフィールドにのみ適用されます。</p>
<p>同様に、宣言的に定義されたフィールドは、対応するモデルから引き継がれた <code class="docutils literal notranslate"><span class="pre">max_length</span></code> や <code class="docutils literal notranslate"><span class="pre">required</span></code> のような属性を描画しません。モデル内で定義された動作を引き継ぎたい場合は、フォームフィールドを宣言する際に明示的に関連する属性をセットする必要があります。</p>
<p>例えば、<code class="docutils literal notranslate"><span class="pre">Article</span></code> モデルは以下のようになります:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Article</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">headline</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Use puns liberally&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</pre></div>
</div>
<p>そして、指定されたとおりに <code class="docutils literal notranslate"><span class="pre">blank</span></code> と <code class="docutils literal notranslate"><span class="pre">help_text</span></code> が維持されている一方で、<code class="docutils literal notranslate"><span class="pre">headline</span></code> に対して独自のバリデーションを実施するために、<code class="docutils literal notranslate"><span class="pre">ArticleForm</span></code> を以下のように定義します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ArticleForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="n">headline</span> <span class="o">=</span> <span class="n">MyFormField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Use puns liberally&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;headline&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>フォームフィールドのタイプを使用して、対応するモデルフィールドの内容を設定できることを確認する必要があります。 互換性がない場合、暗黙的な変換が行われないので、 &quot;ValueError&quot; を取得します。</p>
<p>フィールドとその属性について、詳しくは <a class="reference internal" href="../../ref/forms/fields.html"><span class="doc">フォームフィールドのドキュメンテーション</span></a> を参照してください。</p>
</div>
</section>
<section id="s-enabling-localization-of-fields">
<span id="enabling-localization-of-fields"></span><h3>フィールドのローカライズを有効にする<a class="headerlink" href="#enabling-localization-of-fields" title="Link to this heading">¶</a></h3>
<p>デフォルトでは、<code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> 内のフィールドはデータをローカライズしません。フィールドのデータをローカライズするには、<code class="docutils literal notranslate"><span class="pre">Meta</span></code> クラスの <code class="docutils literal notranslate"><span class="pre">localized_fields</span></code> 属性が使用できます。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Author</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorForm</span><span class="p">(</span><span class="n">ModelForm</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">model</span> <span class="o">=</span> <span class="n">Author</span>
<span class="gp">... </span>        <span class="n">localized_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;birth_date&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">localized_fields</span></code> が特殊な値 <code class="docutils literal notranslate"><span class="pre">'__all__'</span></code> にセットされた場合、全てのフィールドがローカライズされます。</p>
</section>
<section id="s-form-inheritance">
<span id="form-inheritance"></span><h3>フォームの継承<a class="headerlink" href="#form-inheritance" title="Link to this heading">¶</a></h3>
<p>基本的なフォームと同様に、 <code class="docutils literal notranslate"><span class="pre">ModelForms</span></code> を継承して拡張したり再利用したりすることができます。これは、モデルから派生した多くのフォームで使用するために、親クラスに追加フィールドや追加メソッドを宣言する必要がある場合に便利です。たとえば、以前の <code class="docutils literal notranslate"><span class="pre">ArticleForm</span></code> クラスを使います:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">EnhancedArticleForm</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="nf">clean_pub_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>これは <code class="docutils literal notranslate"><span class="pre">ArticleForm</span></code> と同じように動作するフォームを作成しますが、<code class="docutils literal notranslate"><span class="pre">pub_date</span></code> フィールドのバリデーションとクリーニングが追加されます。</p>
<p><code class="docutils literal notranslate"><span class="pre">Meta.fields</span></code> や <code class="docutils literal notranslate"><span class="pre">Meta.exclude</span></code> のリストを変更したい場合は、親の <code class="docutils literal notranslate"><span class="pre">Meta</span></code> インナークラスをサブクラス化することもできます:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">RestrictedArticleForm</span><span class="p">(</span><span class="n">EnhancedArticleForm</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">(</span><span class="n">ArticleForm</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>これは <code class="docutils literal notranslate"><span class="pre">EnhancedArticleForm</span></code> からの追加メソッドを追加し、1つのフィールドを削除するようにオリジナルの <code class="docutils literal notranslate"><span class="pre">ArticleForm.Meta</span></code> を修正します。</p>
<p>ただ、注意すべき点がいくつかあります。</p>
<ul>
<li><p>通常の Python の名前解決ルールが適用されます。内部クラス <code class="docutils literal notranslate"><span class="pre">Meta</span></code> を宣言している基底クラスが複数ある場合、最初のものだけが使用されます。つまり、子クラスの <code class="docutils literal notranslate"><span class="pre">Meta</span></code> が存在する場合はそれが使用され、そうでない場合は最初の親の <code class="docutils literal notranslate"><span class="pre">Meta</span></code> などが使用されます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Form</span></code> と <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> の両方から同時に継承することは可能ですが、必ず <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> が MRO (Method Resolution Order) の中で最初に現れるようにする必要があります。なぜなら、これらのクラスは異なるメタクラスに依存しており、一つのクラスは一つのメタクラスしか持つことができないからです。</p></li>
<li><p>親クラスから継承した <code class="docutils literal notranslate"><span class="pre">Field</span></code> を宣言的に削除するには、サブクラスで名前を <code class="docutils literal notranslate"><span class="pre">None</span></code> に設定します。</p>
<p>このテクニックを使用できるのは、親クラスによって宣言的に定義されたフィールドからオプトアウトする場合のみです。 <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> メタクラスがデフォルトフィールドを生成するのを防ぐことはできません。デフォルトのフィールドからオプトアウトするには、 <a class="reference internal" href="#modelforms-selecting-fields"><span class="std std-ref">使うフィールドを選択する</span></a> を参照してください。</p>
</li>
</ul>
</section>
<section id="s-providing-initial-values">
<span id="providing-initial-values"></span><h3>初期値を指定する<a class="headerlink" href="#providing-initial-values" title="Link to this heading">¶</a></h3>
<p>通常のフォームと同様に、フォームのインスタンスを作成する際に <code class="docutils literal notranslate"><span class="pre">initial</span></code> パラメータを指定することで、フォームの初期データを指定できます。この方法で指定された初期値は、フォームフィールドからの初期値と、アタッチされたモデルインスタンスからの値の両方を上書きします。たとえば、下記のようにします:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">article</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">article</span><span class="o">.</span><span class="n">headline</span>
<span class="go">&#39;My headline&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">form</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;headline&quot;</span><span class="p">:</span> <span class="s2">&quot;Initial headline&quot;</span><span class="p">},</span> <span class="n">instance</span><span class="o">=</span><span class="n">article</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;headline&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
<span class="go">&#39;Initial headline&#39;</span>
</pre></div>
</div>
</section>
<section id="s-modelform-factory-function">
<span id="s-modelforms-factory"></span><span id="modelform-factory-function"></span><span id="modelforms-factory"></span><h3>ModelForm factory 関数<a class="headerlink" href="#modelform-factory-function" title="Link to this heading">¶</a></h3>
<p>クラス定義ではなく、スタンドアロン関数 <a class="reference internal" href="../../ref/forms/models.html#django.forms.models.modelform_factory" title="django.forms.models.modelform_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">modelform_factory()</span></code></a> を使って、与えられたモデルからフォームを作成することもできます。あまりカスタマイズをしないなら、こちらの方が便利でしょう:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">modelform_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Book</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">BookForm</span> <span class="o">=</span> <span class="n">modelform_factory</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>これは既存のフォームを修正するためにも使用できます。たとえば、指定されたフィールドに使用するウィジェットを指定できます:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">Textarea</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Form</span> <span class="o">=</span> <span class="n">modelform_factory</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">BookForm</span><span class="p">,</span> <span class="n">widgets</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">Textarea</span><span class="p">()})</span>
</pre></div>
</div>
<p>含むフィールドは <code class="docutils literal notranslate"><span class="pre">fields</span></code> や <code class="docutils literal notranslate"><span class="pre">exclude</span></code> のキーワード引数、もしくは <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> 内部の <code class="docutils literal notranslate"><span class="pre">Meta</span></code> クラスの対応する属性を使って指定できます。<code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> <a class="reference internal" href="#modelforms-selecting-fields"><span class="std std-ref">使うフィールドを選択する</span></a> ドキュメントを参照してください。</p>
<p>... 特定のフィールドのローカライズを有効にすることもできます:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Form</span> <span class="o">=</span> <span class="n">modelform_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">AuthorForm</span><span class="p">,</span> <span class="n">localized_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;birth_date&quot;</span><span class="p">])</span>
</pre></div>
</div>
</section>
</section>
<section id="s-model-formsets">
<span id="s-id1"></span><span id="model-formsets"></span><span id="id1"></span><h2>モデルのフォームセット<a class="headerlink" href="#model-formsets" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="django.forms.models.BaseModelFormSet">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">models.</span></span><span class="sig-name descname"><span class="pre">BaseModelFormSet</span></span><a class="headerlink" href="#django.forms.models.BaseModelFormSet" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="formsets.html"><span class="doc">通常のフォームセット</span></a> のように、 Django は Django モデルでの作業をより便利にするために、いくつかの拡張 フォームセットクラスを提供しています。上の <code class="docutils literal notranslate"><span class="pre">Author</span></code> モデルを再利用してみましょう:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">modelformset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Author</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">fields</span></code> を使用すると、フォームセットが指定されたフィールドだけを使うように制限されます。または、除外するフィールドを指定する &quot;オプトアウト&quot; アプローチをとることもできます:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;birth_date&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>これは <code class="docutils literal notranslate"><span class="pre">Author</span></code> モデルに関連付けられたデータを扱うことができるフォームセットを作成します。通常のフォームセットと同じように動作します:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">formset</span><span class="p">)</span>
<span class="go">&lt;input type=&quot;hidden&quot; name=&quot;form-TOTAL_FORMS&quot; value=&quot;1&quot; id=&quot;id_form-TOTAL_FORMS&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-INITIAL_FORMS&quot; value=&quot;0&quot; id=&quot;id_form-INITIAL_FORMS&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-MIN_NUM_FORMS&quot; value=&quot;0&quot; id=&quot;id_form-MIN_NUM_FORMS&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-MAX_NUM_FORMS&quot; value=&quot;1000&quot; id=&quot;id_form-MAX_NUM_FORMS&quot;&gt;</span>
<span class="go">&lt;div&gt;&lt;label for=&quot;id_form-0-name&quot;&gt;Name:&lt;/label&gt;&lt;input id=&quot;id_form-0-name&quot; type=&quot;text&quot; name=&quot;form-0-name&quot; maxlength=&quot;100&quot;&gt;&lt;/div&gt;</span>
<span class="go">&lt;div&gt;&lt;label for=&quot;id_form-0-title&quot;&gt;Title:&lt;/label&gt;&lt;select name=&quot;form-0-title&quot; id=&quot;id_form-0-title&quot;&gt;</span>
<span class="go">&lt;option value=&quot;&quot; selected&gt;---------&lt;/option&gt;</span>
<span class="go">&lt;option value=&quot;MR&quot;&gt;Mr.&lt;/option&gt;</span>
<span class="go">&lt;option value=&quot;MRS&quot;&gt;Mrs.&lt;/option&gt;</span>
<span class="go">&lt;option value=&quot;MS&quot;&gt;Ms.&lt;/option&gt;</span>
<span class="go">&lt;/select&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-0-id&quot; id=&quot;id_form-0-id&quot;&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><a class="reference internal" href="../../ref/forms/models.html#django.forms.models.modelformset_factory" title="django.forms.models.modelformset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">modelformset_factory()</span></code></a> は <a class="reference internal" href="../../ref/forms/formsets.html#django.forms.formsets.formset_factory" title="django.forms.formsets.formset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">formset_factory()</span></code></a> を使ってフォームセットを生成します。つまり、モデルのフォームセットは基本フォームセットを拡張したもので、特定のモデルとどのように相互作用するかを知っています。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><a class="reference internal" href="../db/models.html#multi-table-inheritance"><span class="std std-ref">マルチテーブル継承</span></a> を使用している場合、フォームセットファクトリによって生成されたフォームは <code class="docutils literal notranslate"><span class="pre">id</span></code> フィールドの代わりに親リンクフィールド (デフォルトでは <code class="docutils literal notranslate"><span class="pre">&lt;parent_model_name&gt;_ptr</span></code>) を含みます。</p>
</div>
<section id="s-changing-the-queryset">
<span id="changing-the-queryset"></span><h3>クエリセットを変更する<a class="headerlink" href="#changing-the-queryset" title="Link to this heading">¶</a></h3>
<p>デフォルトでは、モデルからフォームセットを作成する場合、フォームセットはモデル内のすべてのオブジェクトを含むクエリセットを使用します (例 <code class="docutils literal notranslate"><span class="pre">Author.objects.all()</span></code>) 。 <code class="docutils literal notranslate"><span class="pre">queryset</span></code> 引数を使用することで、この動作をオーバーライドできます:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__startswith</span><span class="o">=</span><span class="s2">&quot;O&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>もしくは、<code class="docutils literal notranslate"><span class="pre">__init__</span></code> の中で <code class="docutils literal notranslate"><span class="pre">self.queryset</span></code> をセットするサブクラスを作成できます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModelFormSet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Author</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BaseAuthorFormSet</span><span class="p">(</span><span class="n">BaseModelFormSet</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__startswith</span><span class="o">=</span><span class="s2">&quot;O&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>そして、ファクトリ関数に <code class="docutils literal notranslate"><span class="pre">BaseAuthorFormSet</span></code> クラスを渡します:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Author</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">],</span> <span class="n">formset</span><span class="o">=</span><span class="n">BaseAuthorFormSet</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>既存のモデルのインスタンスを <em>一切</em> 含まないフォームセットを返したい場合は、空の QuerySet を指定します:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="s-changing-the-form">
<span id="changing-the-form"></span><h3>フォームを変更する<a class="headerlink" href="#changing-the-form" title="Link to this heading">¶</a></h3>
<p>デフォルトでは、 <code class="docutils literal notranslate"><span class="pre">modelformset_factory</span></code> を使うと、 <a class="reference internal" href="../../ref/forms/models.html#django.forms.models.modelform_factory" title="django.forms.models.modelform_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">modelform_factory()</span></code></a> を使ってモデルフォームが作成されます。多くの場合、カスタムモデルフォームを指定すると便利です。たとえば、カスタムバリデーションを持つカスタムモデルフォームを作成できます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AuthorForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Author</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clean_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># custom validation for the name field</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>次に、モデルフォームをファクトリ関数に渡します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">AuthorForm</span><span class="p">)</span>
</pre></div>
</div>
<p>必ずしもカスタムモデルフォームを定義する必要はありません。 <code class="docutils literal notranslate"><span class="pre">modelformset_factory</span></code> 関数には <code class="docutils literal notranslate"><span class="pre">modelform_factory</span></code> に渡されるいくつかの引数があります。以下で説明します。</p>
</section>
<section id="s-specifying-widgets-to-use-in-the-form-with-widgets">
<span id="specifying-widgets-to-use-in-the-form-with-widgets"></span><h3><code class="docutils literal notranslate"><span class="pre">widgets</span></code> を使って、フォームで使用するウィジェットを指定する<a class="headerlink" href="#specifying-widgets-to-use-in-the-form-with-widgets" title="Link to this heading">¶</a></h3>
<p>パラメータ <code class="docutils literal notranslate"><span class="pre">widgets</span></code> を使うことで、特定のフィールドに対して <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> のウィジェットクラスをカスタマイズするための値の辞書を指定できます。これは <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> の内部 <code class="docutils literal notranslate"><span class="pre">Meta</span></code> クラスの <code class="docutils literal notranslate"><span class="pre">widgets</span></code> 辞書と同じように動作します:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Author</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">widgets</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">Textarea</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cols&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s2">&quot;rows&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})},</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="s-enabling-localization-for-fields-with-localized-fields">
<span id="enabling-localization-for-fields-with-localized-fields"></span><h3><code class="docutils literal notranslate"><span class="pre">localized_fields</span></code> でフィールドのローカライズを有効にする<a class="headerlink" href="#enabling-localization-for-fields-with-localized-fields" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">localized_fields</span></code> パラメータを使って、フォームのフィールドのローカライズを有効にできます。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Author</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;birth_date&#39;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">localized_fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;birth_date&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">localized_fields</span></code> が特殊な値 <code class="docutils literal notranslate"><span class="pre">'__all__'</span></code> にセットされた場合、全てのフィールドがローカライズされます。</p>
</section>
<section id="s-id2">
<span id="id2"></span><h3>初期値を指定する<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<p>通常のフォームセットと同様に、 <a class="reference internal" href="../../ref/forms/models.html#django.forms.models.modelformset_factory" title="django.forms.models.modelformset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">modelformset_factory()</span></code></a> によって返されるモデルフォームセットクラスをインスタンス化する際に <code class="docutils literal notranslate"><span class="pre">initial</span></code> パラメータを指定することで、 <a class="reference internal" href="formsets.html#formsets-initial-data"><span class="std std-ref">初期データ</span></a> をフォームセット内のフォームに指定できます。しかし、モデルフォームセットでは、初期値は既存のモデルインスタンスにアタッチされていない余分なフォームにだけ適用されます。もし <code class="docutils literal notranslate"><span class="pre">initial</span></code> の長さが余分なフォームの数を超えた場合、余分な初期データは無視されます。初期データを持つ余分なフォームがユーザーによって変更されなかった場合、それらはバリデーションも保存もされません。</p>
</section>
<section id="s-saving-objects-in-the-formset">
<span id="s-id3"></span><span id="saving-objects-in-the-formset"></span><span id="id3"></span><h3>フォームセット内のオブジェクトを保存する<a class="headerlink" href="#saving-objects-in-the-formset" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> と同様に、データをモデルオブジェクトとして保存できます。これはフォームセットの <code class="docutils literal notranslate"><span class="pre">save()</span></code> メソッドで行います:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="go"># Create a formset instance with POST data.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>

<span class="go"># Assuming all is valid, save the data.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instances</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code> メソッドはデータベースに保存されたインスタンスを返します。指定したインスタンスのデータがバインドされたデータで変更されなかった場合、そのインスタンスはデータベースに保存されず、戻り値 (上記の例では <code class="docutils literal notranslate"><span class="pre">instances</span></code>) にも含まれません。</p>
<p>フォームにフィールドがない場合 (例えば除外されている場合など)、これらのフィールドは <code class="docutils literal notranslate"><span class="pre">save()</span></code> メソッドではセットされません。通常の <code class="docutils literal notranslate"><span class="pre">ModelForms</span></code> にも適用されるこの制限についての詳細は <a class="reference internal" href="#selecting-the-fields-to-use">Selecting the fields to use</a> を参照してください。</p>
<p>未保存のモデルインスタンスを返すには <code class="docutils literal notranslate"><span class="pre">commit=False</span></code> を渡します:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="go"># don&#39;t save to the database</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instances</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
<span class="gp">... </span>    <span class="c1"># do something with instance</span>
<span class="gp">... </span>    <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>これにより、データベースに保存する前にインスタンスにデータを付加できます。フォームセットに <code class="docutils literal notranslate"><span class="pre">ManyToManyField</span></code> が含まれている場合は、 <code class="docutils literal notranslate"><span class="pre">formset.save_m2m()</span></code> を呼び出して、多対多のリレーションシップが適切に保存されるようにする必要があります。</p>
<p><code class="docutils literal notranslate"><span class="pre">save()</span></code> を呼び出すと、モデルのフォームセットにはフォームセットの変更を表す3つの新しい属性が追加されます:</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.models.BaseModelFormSet.changed_objects">
<span class="sig-prename descclassname"><span class="pre">models.BaseModelFormSet.</span></span><span class="sig-name descname"><span class="pre">changed_objects</span></span><a class="headerlink" href="#django.forms.models.BaseModelFormSet.changed_objects" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.models.BaseModelFormSet.deleted_objects">
<span class="sig-prename descclassname"><span class="pre">models.BaseModelFormSet.</span></span><span class="sig-name descname"><span class="pre">deleted_objects</span></span><a class="headerlink" href="#django.forms.models.BaseModelFormSet.deleted_objects" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.models.BaseModelFormSet.new_objects">
<span class="sig-prename descclassname"><span class="pre">models.BaseModelFormSet.</span></span><span class="sig-name descname"><span class="pre">new_objects</span></span><a class="headerlink" href="#django.forms.models.BaseModelFormSet.new_objects" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="s-limiting-the-number-of-editable-objects">
<span id="s-model-formsets-max-num"></span><span id="limiting-the-number-of-editable-objects"></span><span id="model-formsets-max-num"></span><h3>編集可能なオブジェクトの数を制限する<a class="headerlink" href="#limiting-the-number-of-editable-objects" title="Link to this heading">¶</a></h3>
<p>通常のフォームセットと同様に、 <a class="reference internal" href="../../ref/forms/models.html#django.forms.models.modelformset_factory" title="django.forms.models.modelformset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">modelformset_factory()</span></code></a> の <code class="docutils literal notranslate"><span class="pre">max_num</span></code> と <code class="docutils literal notranslate"><span class="pre">extra</span></code> パラメータを使って、表示される追加のフォームの数を制限できます。</p>
<p><code class="docutils literal notranslate"><span class="pre">max_num</span></code> は既存のオブジェクトが表示されないようにするものではありません:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="go">&lt;QuerySet [&lt;Author: Charles Baudelaire&gt;, &lt;Author: Paul Verlaine&gt;, &lt;Author: Walt Whitman&gt;]&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">max_num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">formset</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()]</span>
<span class="go">[&#39;Charles Baudelaire&#39;, &#39;Paul Verlaine&#39;, &#39;Walt Whitman&#39;]</span>
</pre></div>
</div>
<p>また、 <code class="docutils literal notranslate"><span class="pre">extra=0</span></code> は新しいモデルインスタンスの作成を妨げるものではありません。 <a class="reference internal" href="formsets.html#understanding-the-managementform"><span class="std std-ref">JavaScriptでフォームを追加</span></a> したり、追加のPOSTデータを送信したりすることができます。この方法については <a class="reference internal" href="#model-formsets-edit-only"><span class="std std-ref">新しいオブジェクトの作成を防ぐ</span></a> を参照してください。</p>
<p>もし <code class="docutils literal notranslate"><span class="pre">max_num</span></code> の値が既存の関連オブジェクトの数よりも大きい場合、フォームの総数が <code class="docutils literal notranslate"><span class="pre">max_num</span></code> を超えない限り、最大 <code class="docutils literal notranslate"><span class="pre">extra</span></code> 個の空白のフォームがフォームセットに追加されます:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">max_num</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="n">formset</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">&lt;div&gt;&lt;label for=&quot;id_form-0-name&quot;&gt;Name:&lt;/label&gt;&lt;input id=&quot;id_form-0-name&quot; type=&quot;text&quot; name=&quot;form-0-name&quot; value=&quot;Charles Baudelaire&quot; maxlength=&quot;100&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-0-id&quot; value=&quot;1&quot; id=&quot;id_form-0-id&quot;&gt;&lt;/div&gt;</span>
<span class="go">&lt;div&gt;&lt;label for=&quot;id_form-1-name&quot;&gt;Name:&lt;/label&gt;&lt;input id=&quot;id_form-1-name&quot; type=&quot;text&quot; name=&quot;form-1-name&quot; value=&quot;Paul Verlaine&quot; maxlength=&quot;100&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-1-id&quot; value=&quot;3&quot; id=&quot;id_form-1-id&quot;&gt;&lt;/div&gt;</span>
<span class="go">&lt;div&gt;&lt;label for=&quot;id_form-2-name&quot;&gt;Name:&lt;/label&gt;&lt;input id=&quot;id_form-2-name&quot; type=&quot;text&quot; name=&quot;form-2-name&quot; value=&quot;Walt Whitman&quot; maxlength=&quot;100&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-2-id&quot; value=&quot;2&quot; id=&quot;id_form-2-id&quot;&gt;&lt;/div&gt;</span>
<span class="go">&lt;div&gt;&lt;label for=&quot;id_form-3-name&quot;&gt;Name:&lt;/label&gt;&lt;input id=&quot;id_form-3-name&quot; type=&quot;text&quot; name=&quot;form-3-name&quot; maxlength=&quot;100&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-3-id&quot; id=&quot;id_form-3-id&quot;&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">max_num</span></code> の値が <code class="docutils literal notranslate"><span class="pre">None</span></code> (デフォルト) だった場合、表示されるフォームの上限は大きな数になります (1000)。この数は、実際には制限がないと見なせるでしょう。</p>
</section>
<section id="s-preventing-new-objects-creation">
<span id="s-model-formsets-edit-only"></span><span id="preventing-new-objects-creation"></span><span id="model-formsets-edit-only"></span><h3>新しいオブジェクトの作成を防ぐ<a class="headerlink" href="#preventing-new-objects-creation" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">edit_only</span></code> パラメータを使用すると、新しいオブジェクトを作成しないようにすることができます:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Author</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">edit_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>ここでは、フォームセットは既存の <code class="docutils literal notranslate"><span class="pre">Author</span></code> インスタンスのみを編集します。他のオブジェクトは作成も編集もされません。</p>
</section>
<section id="s-using-a-model-formset-in-a-view">
<span id="using-a-model-formset-in-a-view"></span><h3>ビューでモデルフォームセットを使う<a class="headerlink" href="#using-a-model-formset-in-a-view" title="Link to this heading">¶</a></h3>
<p>モデルのフォームセットはフォームセットにとても似ています。例えば、<code class="docutils literal notranslate"><span class="pre">Author</span></code> モデルのインスタンスを編集するフォームセットを表示したいとしましょう:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">modelformset_factory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Author</span>


<span class="k">def</span><span class="w"> </span><span class="nf">manage_authors</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="c1"># do something.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;manage_authors.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;formset&quot;</span><span class="p">:</span> <span class="n">formset</span><span class="p">})</span>
</pre></div>
</div>
<p>見てのとおり、モデルフォームセットのビューロジックは、「通常の」フォームセットと大きく異なるものではありません。唯一の違いは、 <code class="docutils literal notranslate"><span class="pre">formset.save()</span></code> を呼び出してデータをデータベースに保存できることです。(これは上記の <a class="reference internal" href="#saving-objects-in-the-formset"><span class="std std-ref">フォームセット内のオブジェクトを保存する</span></a> で説明しています)。</p>
</section>
<section id="s-overriding-clean-on-a-modelformset">
<span id="s-model-formsets-overriding-clean"></span><span id="overriding-clean-on-a-modelformset"></span><span id="model-formsets-overriding-clean"></span><h3><code class="docutils literal notranslate"><span class="pre">ModelFormSet</span></code> の <code class="docutils literal notranslate"><span class="pre">clean()</span></code> をオーバーライドする<a class="headerlink" href="#overriding-clean-on-a-modelformset" title="Link to this heading">¶</a></h3>
<p>モデルフォームの <code class="docutils literal notranslate"><span class="pre">ModelForms</span></code> と同様に、デフォルトでは <code class="docutils literal notranslate"><span class="pre">ModelFormSet</span></code> の <code class="docutils literal notranslate"><span class="pre">clean()</span></code> メソッドは、フォームセット内のアイテムがモデルのユニーク制約 (<code class="docutils literal notranslate"><span class="pre">unique</span></code>, <code class="docutils literal notranslate"><span class="pre">unique_together</span></code> または <code class="docutils literal notranslate"><span class="pre">unique_for_date|month|year</span></code>) に違反していないことを検証します。 もし <code class="docutils literal notranslate"><span class="pre">ModelFormSet</span></code> の <code class="docutils literal notranslate"><span class="pre">clean()</span></code> メソッドをオーバーライドし、この検証を維持したい場合は、親クラスの <code class="docutils literal notranslate"><span class="pre">clean</span></code> メソッドを呼び出す必要があります:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModelFormSet</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyModelFormSet</span><span class="p">(</span><span class="n">BaseModelFormSet</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="c1"># example custom validation across forms in the formset</span>
        <span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forms</span><span class="p">:</span>
            <span class="c1"># your custom formset validation</span>
            <span class="o">...</span>
</pre></div>
</div>
<p>また、このステップに到達するまでに、各 <code class="docutils literal notranslate"><span class="pre">Form</span></code> に対して個別のモデルインスタンスが既に作成されていることに注意してください。 <code class="docutils literal notranslate"><span class="pre">form.cleaned_data</span></code> の値を変更するだけでは、保存された値に影響を与えることはできません。 <code class="docutils literal notranslate"><span class="pre">ModelFormSet.clean()</span></code> の値を変更したい場合は、 <code class="docutils literal notranslate"><span class="pre">form.instance</span></code> を変更する必要があります:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModelFormSet</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyModelFormSet</span><span class="p">(</span><span class="n">BaseModelFormSet</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forms</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            <span class="c1"># update the instance value.</span>
            <span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</pre></div>
</div>
</section>
<section id="s-using-a-custom-queryset">
<span id="using-a-custom-queryset"></span><h3>カスタムのクエリセットを使う<a class="headerlink" href="#using-a-custom-queryset" title="Link to this heading">¶</a></h3>
<p>前述のように、モデルのフォームセットで使われるデフォルトのクエリセットはオーバーライドできます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">modelformset_factory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Author</span>


<span class="k">def</span><span class="w"> </span><span class="nf">manage_authors</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">])</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__startswith</span><span class="o">=</span><span class="s2">&quot;O&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span>
            <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span>
            <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">,</span>
            <span class="n">queryset</span><span class="o">=</span><span class="n">queryset</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="c1"># Do something.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">queryset</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;manage_authors.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;formset&quot;</span><span class="p">:</span> <span class="n">formset</span><span class="p">})</span>
</pre></div>
</div>
<p>この例では <code class="docutils literal notranslate"><span class="pre">POST</span></code> と <code class="docutils literal notranslate"><span class="pre">GET</span></code> の両方で <code class="docutils literal notranslate"><span class="pre">queryset</span></code> 引数を渡していることに注意してください。</p>
</section>
<section id="s-using-the-formset-in-the-template">
<span id="using-the-formset-in-the-template"></span><h3>テンプレートでフォームセットを使う<a class="headerlink" href="#using-the-formset-in-the-template" title="Link to this heading">¶</a></h3>
<p>Django テンプレートでフォームセットをレンダリングするには 3 つの方法があります。</p>
<p>1つめは、フォームセットにほとんどの作業を任せる方法です:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">formset</span> <span class="cp">}}</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>2 つめは、フォームセットを手動でレンダリングして、フォーム自身に処理させる方法です:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">formset.management_form</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">form</span> <span class="k">in</span> <span class="nv">formset</span> <span class="cp">%}</span>
        <span class="cp">{{</span> <span class="nv">form</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>手動でフォームをレンダリングする場合は、必ず上記のように管理フォームをレンダリングしてください。 <a class="reference internal" href="formsets.html#understanding-the-managementform"><span class="std std-ref">管理フォームのドキュメント</span></a> を参照してください。</p>
<p>3 つめは、各フィールドを手動でレンダリングする方法です:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">formset.management_form</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">form</span> <span class="k">in</span> <span class="nv">formset</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="k">in</span> <span class="nv">form</span> <span class="cp">%}</span>
            <span class="cp">{{</span> <span class="nv">field.label_tag</span> <span class="cp">}}</span> <span class="cp">{{</span> <span class="nv">field</span> <span class="cp">}}</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>この3つめのメソッドを使用し、 <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">%}</span></code> ループでフィールドをイテレートしない場合、プライマリキーフィールドをレンダリングする必要があります。たとえば、モデルの <code class="docutils literal notranslate"><span class="pre">name</span></code> フィールドと <code class="docutils literal notranslate"><span class="pre">age</span></code> フィールドをレンダリングする場合、以下のようにします:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">formset.management_form</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">form</span> <span class="k">in</span> <span class="nv">formset</span> <span class="cp">%}</span>
        <span class="cp">{{</span> <span class="nv">form.id</span> <span class="cp">}}</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.name</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.age</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>明示的に <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">form.id</span> <span class="pre">}}</span></code> をレンダリングする必要があることに注意してください。これにより、<code class="docutils literal notranslate"><span class="pre">POST</span></code> の場合のモデルのフォームセットが正しく動作するようになります。(この例では <code class="docutils literal notranslate"><span class="pre">id</span></code> というプライマリキーを想定しています。もし <code class="docutils literal notranslate"><span class="pre">id</span></code> という名前ではない独自のプライマリキーを明示的に定義している場合は、それが確実にレンダリングされるようにしてください)。</p>
</section>
</section>
<section id="s-inline-formsets">
<span id="s-id4"></span><span id="inline-formsets"></span><span id="id4"></span><h2>インラインフォームセット<a class="headerlink" href="#inline-formsets" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="django.forms.models.BaseInlineFormSet">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">models.</span></span><span class="sig-name descname"><span class="pre">BaseInlineFormSet</span></span><a class="headerlink" href="#django.forms.models.BaseInlineFormSet" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<p>インラインフォームセットは、モデルフォームセット上の小さな抽象化レイヤーです。これを使うと、外部キーで関連するオブジェクトを操作することが簡単になります。以下の 2 つのモデルがあるとします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>特定の著者の本を編集できるフォームセットを作成したい場合、下記のように書くことができます:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">inlineformset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">BookFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mike Royko&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">BookFormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">BookFormSet</span></code> の <a class="reference internal" href="formsets.html#formset-prefix"><span class="std std-ref">prefix</span></a> は <code class="docutils literal notranslate"><span class="pre">'book_set'</span></code> (<code class="docutils literal notranslate"><span class="pre">&lt;model</span> <span class="pre">name&gt;_set</span></code>) です。ただし、 <code class="docutils literal notranslate"><span class="pre">Book</span></code> の <code class="docutils literal notranslate"><span class="pre">Author</span></code> への <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> に <a class="reference internal" href="../../ref/models/fields.html#django.db.models.ForeignKey.related_name" title="django.db.models.ForeignKey.related_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">related_name</span></code></a> がある場合、その名前が代わりに使用されます。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><a class="reference internal" href="../../ref/forms/models.html#django.forms.models.inlineformset_factory" title="django.forms.models.inlineformset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">inlineformset_factory()</span></code></a> は、 <a class="reference internal" href="../../ref/forms/models.html#django.forms.models.modelformset_factory" title="django.forms.models.modelformset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">modelformset_factory()</span></code></a> を使い、<code class="docutils literal notranslate"><span class="pre">can_delete=True</span></code> をセットします。</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<p><a class="reference internal" href="formsets.html#manually-rendered-can-delete-and-can-order"><span class="std std-ref">手動でレンダリングされた can_delete と can_order</span></a>.</p>
</div>
<section id="s-overriding-methods-on-an-inlineformset">
<span id="overriding-methods-on-an-inlineformset"></span><h3><code class="docutils literal notranslate"><span class="pre">InlineFormSet</span></code> のメソッドをオーバーライドする<a class="headerlink" href="#overriding-methods-on-an-inlineformset" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">InlineFormSet</span></code> のメソッドをオーバーライドするには、 <a class="reference internal" href="#django.forms.models.BaseModelFormSet" title="django.forms.models.BaseModelFormSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseModelFormSet</span></code></a> ではなく、 <a class="reference internal" href="#django.forms.models.BaseInlineFormSet" title="django.forms.models.BaseInlineFormSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseInlineFormSet</span></code></a> をサブクラス化します。</p>
<p>例えば、 <code class="docutils literal notranslate"><span class="pre">clean()</span></code> をオーバーライドするとします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseInlineFormSet</span>


<span class="k">class</span><span class="w"> </span><span class="nc">CustomInlineFormSet</span><span class="p">(</span><span class="n">BaseInlineFormSet</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="c1"># example custom validation across forms in the formset</span>
        <span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forms</span><span class="p">:</span>
            <span class="c1"># your custom formset validation</span>
            <span class="o">...</span>
</pre></div>
</div>
<p><a class="reference internal" href="#model-formsets-overriding-clean"><span class="std std-ref">ModelFormSet の clean() をオーバーライドする</span></a> も参照してください。</p>
<p>そして、インラインフォームセットを作成するときに、オプションの引数 <code class="docutils literal notranslate"><span class="pre">formset</span></code> を渡します:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">inlineformset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">BookFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Author</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span> <span class="n">formset</span><span class="o">=</span><span class="n">CustomInlineFormSet</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mike Royko&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">BookFormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="s-more-than-one-foreign-key-to-the-same-model">
<span id="more-than-one-foreign-key-to-the-same-model"></span><h3>複数の外部キーをひとつのモデルが持っている場合<a class="headerlink" href="#more-than-one-foreign-key-to-the-same-model" title="Link to this heading">¶</a></h3>
<p>同じモデルが 1 つよりも多くの外部キーを持っている場合、 <code class="docutils literal notranslate"><span class="pre">fk_name</span></code> を使い手動で曖昧さを解消しなければなりません。例として、次のモデルについて考えます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Friendship</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">from_friend</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Friend</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;from_friends&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">to_friend</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Friend</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;friends&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">length_in_months</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
</pre></div>
</div>
<p>これを解決するには、 <a class="reference internal" href="../../ref/forms/models.html#django.forms.models.inlineformset_factory" title="django.forms.models.inlineformset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">inlineformset_factory()</span></code></a> に <code class="docutils literal notranslate"><span class="pre">fk_name</span></code> を使用します:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">FriendshipFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">Friend</span><span class="p">,</span> <span class="n">Friendship</span><span class="p">,</span> <span class="n">fk_name</span><span class="o">=</span><span class="s2">&quot;from_friend&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;to_friend&quot;</span><span class="p">,</span> <span class="s2">&quot;length_in_months&quot;</span><span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="s-using-an-inline-formset-in-a-view">
<span id="using-an-inline-formset-in-a-view"></span><h3>ビューでインラインフォームセットを使う<a class="headerlink" href="#using-an-inline-formset-in-a-view" title="Link to this heading">¶</a></h3>
<p>モデルに紐付いたオブジェクトを編集する機能をユーザーに提供するビューを作るには、こうします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">manage_books</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">author_id</span><span class="p">):</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">author_id</span><span class="p">)</span>
    <span class="n">BookInlineFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">BookInlineFormSet</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="c1"># Do something. Should generally end with a redirect. For example:</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">BookInlineFormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;manage_books.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;formset&quot;</span><span class="p">:</span> <span class="n">formset</span><span class="p">})</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">POST</span></code> と <code class="docutils literal notranslate"><span class="pre">GET</span></code> いずれにおいても <code class="docutils literal notranslate"><span class="pre">instance</span></code> を渡していることに注目してください</p>
</section>
<section id="s-specifying-widgets-to-use-in-the-inline-form">
<span id="specifying-widgets-to-use-in-the-inline-form"></span><h3>インラインフォームにウィジェットを指定する<a class="headerlink" href="#specifying-widgets-to-use-in-the-inline-form" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">inlineformset_factory</span></code> は <code class="docutils literal notranslate"><span class="pre">modelformset_factory</span></code> を使っており、多くの引数は <code class="docutils literal notranslate"><span class="pre">modelformset_factory</span></code> に渡されます。これは <code class="docutils literal notranslate"><span class="pre">modelformset_factory</span></code> と同様に、 <code class="docutils literal notranslate"><span class="pre">widgets</span></code> 引数を渡すことができることを意味しています。詳細は、上記 <a class="reference internal" href="#specifying-widgets-to-use-in-the-form-with-widgets">Specifying widgets to use in the form with widgets</a> を参照してください。</p>
</section>
</section>
</section>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../contents.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">モデルからフォームを作成する</a><ul>
<li><a class="reference internal" href="#modelform"><code class="docutils literal notranslate"><span class="pre">ModelForm</span></code></a><ul>
<li><a class="reference internal" href="#field-types">フィールドの型</a></li>
<li><a class="reference internal" href="#a-full-example">完全な具体例</a></li>
<li><a class="reference internal" href="#validation-on-a-modelform"><code class="docutils literal notranslate"><span class="pre">ModelForm</span></code> の検証 (バリデーション)</a><ul>
<li><a class="reference internal" href="#overriding-the-clean-method"><code class="docutils literal notranslate"><span class="pre">clean()</span></code> メソッドをオーバーライドする</a></li>
<li><a class="reference internal" href="#interaction-with-model-validation">モデルバリデーションとのやり取り</a></li>
<li><a class="reference internal" href="#considerations-regarding-model-s-error-messages">モデルの <code class="docutils literal notranslate"><span class="pre">error_messages</span></code> についての注意</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-save-method"><code class="docutils literal notranslate"><span class="pre">save()</span></code> メソッド</a></li>
<li><a class="reference internal" href="#selecting-the-fields-to-use">使うフィールドを選択する</a></li>
<li><a class="reference internal" href="#overriding-the-default-fields">デフォルトのフィールドをオーバライドする</a></li>
<li><a class="reference internal" href="#enabling-localization-of-fields">フィールドのローカライズを有効にする</a></li>
<li><a class="reference internal" href="#form-inheritance">フォームの継承</a></li>
<li><a class="reference internal" href="#providing-initial-values">初期値を指定する</a></li>
<li><a class="reference internal" href="#modelform-factory-function">ModelForm factory 関数</a></li>
</ul>
</li>
<li><a class="reference internal" href="#model-formsets">モデルのフォームセット</a><ul>
<li><a class="reference internal" href="#changing-the-queryset">クエリセットを変更する</a></li>
<li><a class="reference internal" href="#changing-the-form">フォームを変更する</a></li>
<li><a class="reference internal" href="#specifying-widgets-to-use-in-the-form-with-widgets"><code class="docutils literal notranslate"><span class="pre">widgets</span></code> を使って、フォームで使用するウィジェットを指定する</a></li>
<li><a class="reference internal" href="#enabling-localization-for-fields-with-localized-fields"><code class="docutils literal notranslate"><span class="pre">localized_fields</span></code> でフィールドのローカライズを有効にする</a></li>
<li><a class="reference internal" href="#id2">初期値を指定する</a></li>
<li><a class="reference internal" href="#saving-objects-in-the-formset">フォームセット内のオブジェクトを保存する</a></li>
<li><a class="reference internal" href="#limiting-the-number-of-editable-objects">編集可能なオブジェクトの数を制限する</a></li>
<li><a class="reference internal" href="#preventing-new-objects-creation">新しいオブジェクトの作成を防ぐ</a></li>
<li><a class="reference internal" href="#using-a-model-formset-in-a-view">ビューでモデルフォームセットを使う</a></li>
<li><a class="reference internal" href="#overriding-clean-on-a-modelformset"><code class="docutils literal notranslate"><span class="pre">ModelFormSet</span></code> の <code class="docutils literal notranslate"><span class="pre">clean()</span></code> をオーバーライドする</a></li>
<li><a class="reference internal" href="#using-a-custom-queryset">カスタムのクエリセットを使う</a></li>
<li><a class="reference internal" href="#using-the-formset-in-the-template">テンプレートでフォームセットを使う</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inline-formsets">インラインフォームセット</a><ul>
<li><a class="reference internal" href="#overriding-methods-on-an-inlineformset"><code class="docutils literal notranslate"><span class="pre">InlineFormSet</span></code> のメソッドをオーバーライドする</a></li>
<li><a class="reference internal" href="#more-than-one-foreign-key-to-the-same-model">複数の外部キーをひとつのモデルが持っている場合</a></li>
<li><a class="reference internal" href="#using-an-inline-formset-in-a-view">ビューでインラインフォームセットを使う</a></li>
<li><a class="reference internal" href="#specifying-widgets-to-use-in-the-inline-form">インラインフォームにウィジェットを指定する</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="formsets.html"
                          title="前の章へ">フォームセット (Formset)</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="media.html"
                          title="次の章へ">フォームアセット (<code class="docutils literal notranslate"><span class="pre">Media</span></code> クラス)</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/topics/forms/modelforms.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">1月 22, 2025</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="formsets.html" title="フォームセット (Formset)">previous</a>
     |
    <a href="../index.html" title="Django を使う" accesskey="U">up</a>
   |
    <a href="media.html" title="フォームアセット (&lt;code class=&#34;docutils literal notranslate&#34;&gt;&lt;span class=&#34;pre&#34;&gt;Media&lt;/span&gt;&lt;/code&gt; クラス)">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>