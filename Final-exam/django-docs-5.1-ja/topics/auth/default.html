<!DOCTYPE html>

<html lang="ja" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Djangoの認証システムを使用する &#8212; Django 5.1.6.dev20250122212402 ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=34bb78ad" />
    <link rel="stylesheet" type="text/css" href="../../_static/default.css?v=bf4d74af" />
    <script src="../../_static/documentation_options.js?v=d2885b0a"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=4755f45a"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="Djangoにおけるパスワード管理" href="passwords.html" />
    <link rel="prev" title="Django でのユーザー認証" href="index.html" />



 
<script src="../../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);(function($) {
    $(document).ready(function() {
        $(".c-tab-unix").on("click", function() {
            $("section.c-content-unix").show();
            $("section.c-content-win").hide();
            $(".c-tab-unix").prop("checked", true);
        });
        $(".c-tab-win").on("click", function() {
            $("section.c-content-win").show();
            $("section.c-content-unix").hide();
            $(".c-tab-win").prop("checked", true);
        });
    });
})(jQuery);</script>
<link rel="stylesheet" href="../../_static/console-tabs.css">
  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Django 5.1.6.dev20250122212402 ドキュメント</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Table of contents" href="../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../genindex.html">Index</a>  |
        <a title="Module index" href="../../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="index.html" title="Django でのユーザー認証">previous</a>
     |
    <a href="../index.html" title="Django を使う" accesskey="U">up</a>
   |
    <a href="passwords.html" title="Djangoにおけるパスワード管理">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="topics-auth-default">
            
  <section id="s-using-the-django-authentication-system">
<span id="using-the-django-authentication-system"></span><h1>Djangoの認証システムを使用する<a class="headerlink" href="#using-the-django-authentication-system" title="Link to this heading">¶</a></h1>
<p>このドキュメントでは、デフォルト設定でのDjangoの認証システムの使用方法を説明します。この設定は、タスクの適切な範囲を管理することで、最も一般的なプロジェクトのニーズにかなうよう徐々に発展してきました。そして、パスワードや権限の入念な実装を持っています。デフォルトの認証システムからの変更が必要なプロジェクトのために、Djangoは認証システムの広範囲の <a class="reference internal" href="customizing.html"><span class="doc">拡張とカスタマイズ</span></a> をサポートします。</p>
<p>Djangoの認証は、認証 (authentication) 機能と認可 (authorization) 機能の両方を提供しています。そして、一般的に、これらの機能を合わせて認証システムと呼びます。</p>
<section id="s-user-objects">
<span id="s-id1"></span><span id="user-objects"></span><span id="id1"></span><h2><code class="docutils literal notranslate"><span class="pre">User</span></code> オブジェクト<a class="headerlink" href="#user-objects" title="Link to this heading">¶</a></h2>
<p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> オブジェクトは、認証システムの中核です。一般的に、このオブジェクトはあなたのサイトに関係する人々を表し、アクセスを制限すること、ユーザ情報を登録すること、コンテンツを作成者と関連付けることを可能にする際などに利用されます。
Djangoの認証フレームワークにはUserクラスという、ただひとつのクラスのみが存在します。すなわち、 <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.is_superuser" title="django.contrib.auth.models.User.is_superuser"><code class="xref py py-attr docutils literal notranslate"><span class="pre">'superusers'</span></code></a> または admin <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.is_staff" title="django.contrib.auth.models.User.is_staff"><code class="xref py py-attr docutils literal notranslate"><span class="pre">'staff'</span></code></a> ユーザは、Userオブジェクトと異なるクラスではなく、特別な属性セットを持ったUserオブジェクトなのです。</p>
<p>デフォルトのユーザの主要な属性は次のとおりです。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.username" title="django.contrib.auth.models.User.username"><code class="xref py py-attr docutils literal notranslate"><span class="pre">username</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.password" title="django.contrib.auth.models.User.password"><code class="xref py py-attr docutils literal notranslate"><span class="pre">password</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.email" title="django.contrib.auth.models.User.email"><code class="xref py py-attr docutils literal notranslate"><span class="pre">email</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.first_name" title="django.contrib.auth.models.User.first_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">first_name</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.last_name" title="django.contrib.auth.models.User.last_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">last_name</span></code></a></p></li>
</ul>
<p>仕様については <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">完全な</span> <span class="pre">API</span> <span class="pre">ドキュメント</span></code></a> を参照してください。 以下のドキュメントは、よりタスク指向の形式となっています。</p>
<section id="s-creating-users">
<span id="s-topics-auth-creating-users"></span><span id="creating-users"></span><span id="topics-auth-creating-users"></span><h3>ユーザを作成する<a class="headerlink" href="#creating-users" title="Link to this heading">¶</a></h3>
<p>ユーザを作成する最も直接的な方法は、付属の <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.UserManager.create_user" title="django.contrib.auth.models.UserManager.create_user"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_user()</span></code></a> ヘルパー関数を使うことです:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&quot;john&quot;</span><span class="p">,</span> <span class="s2">&quot;lennon@thebeatles.com&quot;</span><span class="p">,</span> <span class="s2">&quot;johnpassword&quot;</span><span class="p">)</span>

<span class="go"># At this point, user is a User object that has already been saved</span>
<span class="go"># to the database. You can continue to change its attributes</span>
<span class="go"># if you want to change other fields.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="s2">&quot;Lennon&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>すでにDjango adminをインストールしている場合は、 <a class="reference internal" href="#auth-admin"><span class="std std-ref">インタラクティブにユーザを作成する</span></a> こともできます。</p>
</section>
<section id="s-creating-superusers">
<span id="s-topics-auth-creating-superusers"></span><span id="creating-superusers"></span><span id="topics-auth-creating-superusers"></span><h3>スーパーユーザを作成する<a class="headerlink" href="#creating-superusers" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../../ref/django-admin.html#django-admin-createsuperuser"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">createsuperuser</span></code></a> コマンドを使ってスーパーユーザーを作成します:</p>
<div class="console-block" id="console-block-0">
<input class="c-tab-unix" id="c-tab-0-unix" type="radio" name="console-0" checked>
<label for="c-tab-0-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-0-win" type="radio" name="console-0">
<label for="c-tab-0-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-0-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>manage.py<span class="w"> </span>createsuperuser<span class="w"> </span>--username<span class="o">=</span>joe<span class="w"> </span>--email<span class="o">=</span>joe@example.com
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-0-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py createsuperuser --username=joe --email=joe@example.com
</pre></div>
</section>
</div>
<p>パスワードを入力するように促されます。入力後、ただちにユーザが作成されます。 <a class="reference internal" href="../../ref/django-admin.html#cmdoption-createsuperuser-username"><code class="xref std std-option docutils literal notranslate"><span class="pre">--username</span></code></a> または <a class="reference internal" href="../../ref/django-admin.html#cmdoption-createsuperuser-email"><code class="xref std std-option docutils literal notranslate"><span class="pre">--email</span></code></a> オプションを使用しなければ、これらの値を入力するように促されます。</p>
</section>
<section id="s-changing-passwords">
<span id="changing-passwords"></span><h3>パスワードを変更する<a class="headerlink" href="#changing-passwords" title="Link to this heading">¶</a></h3>
<p>Djangoはユーザモデルに未加工の (単なるテキストの) パスワードは保存せず、ハッシュ値でのみ保存します (詳細は、<a class="reference internal" href="passwords.html"><span class="doc">パスワードは管理方法に関するドキュメント</span></a> を参照してください)。したがって、ユーザのパスワード属性を直接操作しないでください。これが、ユーザを作成する際にヘルパー関数を使用する理由です。</p>
<p>ユーザのパスワードを変更するには、いくつかのオプションがあります。</p>
<p><a class="reference internal" href="../../ref/django-admin.html#django-admin-changepassword"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">changepassword</span> <span class="pre">*username*</span></code></a> は、コマンドラインからユーザのパスワードを変更する方法を提供します。ユーザのパスワードを変更するよう促されたら、パスワードを 2 回入力してください。2 つのパスワードが一致した場合、新しいパスワードが直ちに有効になります。ユーザを指定しない場合、コマンドは、現在のシステムユーザとユーザ名が一致するユーザのパスワードを変更するよう試みます。</p>
<p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.set_password" title="django.contrib.auth.models.User.set_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_password()</span></code></a> を使用することで、プログラムでパスワードを変更することもできます:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;john&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s2">&quot;new password&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Django admin がインストールされていれば、 <a class="reference internal" href="#auth-admin"><span class="std std-ref">認証システムのadminページ</span></a> にて、ユーザのパスワードを変更することも可能です。</p>
<p>また、Djangoはユーザ自身のパスワードを変更するための <a class="reference internal" href="#built-in-auth-views"><span class="std std-ref">ビュー</span></a> と <a class="reference internal" href="#built-in-auth-forms"><span class="std std-ref">フォーム</span></a> を提供します。</p>
<p>ユーザーのパスワード変更を行う事とそのユーザーのセッションは全てログアウトされます。詳細は <a class="reference internal" href="#session-invalidation-on-password-change"><span class="std std-ref">パスワード変更時にセッションを無効化する</span></a> を参照してください。</p>
</section>
<section id="s-authenticating-users">
<span id="authenticating-users"></span><h3>ユーザを認証する<a class="headerlink" href="#authenticating-users" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.authenticate">
<span class="sig-name descname"><span class="pre">authenticate</span></span>(<em class="sig-param"><span class="n"><span class="pre">request</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">credentials</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/__init__.py#L66"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.authenticate" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.aauthenticate">
<span class="sig-name descname"><span class="pre">aauthenticate</span></span>(<em class="sig-param"><span class="n"><span class="pre">request</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">credentials</span></span></em>)<a class="headerlink" href="#django.contrib.auth.aauthenticate" title="Link to this definition">¶</a></dt>
<dd><p><em>非同期バージョン</em>: <code class="docutils literal notranslate"><span class="pre">aauthenticate()</span></code></p>
<p>認証情報のセットを検証するには <a class="reference internal" href="#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><code class="xref py py-func docutils literal notranslate"><span class="pre">authenticate()</span></code></a> を利用してください。このメソッドは認証情報をキーワード引数として受け取ります。検証する対象はデフォルトでは <code class="docutils literal notranslate"><span class="pre">username</span></code> と <code class="docutils literal notranslate"><span class="pre">password</span></code> であり、その組み合わせを個々の <a class="reference internal" href="customizing.html#authentication-backends"><span class="std std-ref">認証バックエンド</span></a> に対して問い合わせ、認証バックエンドで認証情報が有効とされれば <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> オブジェクトを返します。もしいずれの認証バックエンドでも認証情報が有効と判定されなければ <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.PermissionDenied" title="django.core.exceptions.PermissionDenied"><code class="xref py py-class docutils literal notranslate"><span class="pre">PermissionDenied</span></code></a> が送出され、<code class="docutils literal notranslate"><span class="pre">None</span></code> が返されます。以下は実装例です:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;john&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;secret&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># A backend authenticated the credentials</span>
    <span class="o">...</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># No backend authenticated the credentials</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">request</span></code> はオプションで、<a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> のインスタンスを取ります。このインスタンスは認証バックエンドの <code class="docutils literal notranslate"><span class="pre">authenticate()</span></code> メソッドに渡されます。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>これは認証情報のセットを認証する低レベルな方法です。たとえば、 <a class="reference internal" href="../../ref/middleware.html#django.contrib.auth.middleware.RemoteUserMiddleware" title="django.contrib.auth.middleware.RemoteUserMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteUserMiddleware</span></code></a> で使われています。独自の認証システムを書くのでなければ、おそらくこれを使うことはないでしょう。むしろ、ユーザーにログインする方法を探しているのであれば、 <a class="reference internal" href="#django.contrib.auth.views.LoginView" title="django.contrib.auth.views.LoginView"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoginView</span></code></a> を使ってください。</p>
</div>
<div class="versionchanged">
<span class="title">Changed in Django 5.0:</span> <p><code class="docutils literal notranslate"><span class="pre">aauthenticate()</span></code> 関数が追加されました。</p>
</div>
</dd></dl>

</section>
</section>
<section id="s-permissions-and-authorization">
<span id="s-topic-authorization"></span><span id="permissions-and-authorization"></span><span id="topic-authorization"></span><h2>権限と認可<a class="headerlink" href="#permissions-and-authorization" title="Link to this heading">¶</a></h2>
<p>Django には組み込みのパーミッションシステムがあります。特定のユーザやユーザグループにパーミッションを割り当てる方法を提供します。</p>
<p>これは、Django の admin サイトでも使われていますが、独自のコード内でも自由に使えます。</p>
<p>Django の admin サイトは、次のように権限を使用します。</p>
<ul class="simple">
<li><p>ビューオブジェクトへのアクセスは、そのオブジェクトタイプの &quot;view &quot;または &quot;change&quot; 権限を持つユーザーに限定されます。</p></li>
<li><p>&quot;add&quot; フォームのビューを表示してオブジェクトを追加するためのアクセスは、その種類のオブジェクトに &quot;add&quot; 権限を持つユーザに限定されます。</p></li>
<li><p>変更リストの表示、&quot;change&quot; フォームの表示、オブジェクトの変更へのアクセスは、その種類のオブジェクトに &quot;change&quot; 権限を持つユーザーに限定されます。</p></li>
<li><p>オブジェクトの削除へのアクセスは、その種類のオブジェクトに &quot;delete&quot;権限を持つユーザに限定されます。</p></li>
</ul>
<p>権限はオブジェクトの種類ごとだけでなく、特定のオブジェクトインスタンスごとに設定することもできます。<a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin" title="django.contrib.admin.ModelAdmin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelAdmin</span></code></a> クラスによって提供される <a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_view_permission" title="django.contrib.admin.ModelAdmin.has_view_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_view_permission()</span></code></a>、<a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_add_permission" title="django.contrib.admin.ModelAdmin.has_add_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_add_permission()</span></code></a>、<a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_change_permission" title="django.contrib.admin.ModelAdmin.has_change_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_change_permission()</span></code></a>、および <a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_delete_permission" title="django.contrib.admin.ModelAdmin.has_delete_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_delete_permission()</span></code></a> メソッドを使用することで、同じ種類の異なるオブジェクトインスタンスに対する権限をカスタマイズすることが可能です。</p>
<p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> オブジェクトは 2 つの多対多のフィールド、<code class="docutils literal notranslate"><span class="pre">groups</span></code> および <code class="docutils literal notranslate"><span class="pre">user_permissions</span></code> を持っています。<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> オブジェクトは、他の <a class="reference internal" href="../db/models.html"><span class="doc">Django モデル</span></a> と同様の方法で、関連を持っているオブジェクトにアクセスできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myuser</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">group_list</span><span class="p">])</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">permission_list</span><span class="p">])</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">permission</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">permission</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
<section id="s-default-permissions">
<span id="default-permissions"></span><h3>デフォルトの権限<a class="headerlink" href="#default-permissions" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../../ref/settings.html#std-setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> 設定に <code class="docutils literal notranslate"><span class="pre">django.contrib.auth</span></code> がリストされていると、インストー ルしたアプリケーションで定義された Django モデルごとに、追加、変更、削除、表示 の 4 つのデフォルトパーミッションが作成されます。</p>
<p>これらの権限は <a class="reference internal" href="../../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">migrate</span></code></a> 実行時に作成されます。<a class="reference internal" href="../../ref/settings.html#std-setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> に <code class="docutils literal notranslate"><span class="pre">django.contrib.auth</span></code> を追加後初めての <code class="docutils literal notranslate"><span class="pre">migrate</span></code> を実行した場合は、新たにインストールされるモデルに対してと同様、それまでに作成されたモデルに対してもデフォルトの権限が作成されます。以後 <a class="reference internal" href="../../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">migrate</span></code></a> (この権限を作成する関数は <a class="reference internal" href="../../ref/signals.html#django.db.models.signals.post_migrate" title="django.db.models.signals.post_migrate"><code class="xref py py-data docutils literal notranslate"><span class="pre">post_migrate</span></code></a> シグナルに接続されています)を実行する度作成されるモデルに対してデフォルトの権限が作成されます。</p>
<p><a class="reference internal" href="../../ref/models/options.html#django.db.models.Options.app_label" title="django.db.models.Options.app_label"><code class="xref py py-attr docutils literal notranslate"><span class="pre">app_label</span></code></a> が <code class="docutils literal notranslate"><span class="pre">foo</span></code> のアプリケーションと、<code class="docutils literal notranslate"><span class="pre">Bar</span></code> という名前のモデルがあると想定すると、基本的な権限をテストするには、以下のように使用する必要があります。</p>
<ul class="simple">
<li><p>追加: <code class="docutils literal notranslate"><span class="pre">user.has_perm('foo.add_bar')</span></code></p></li>
<li><p>変更: <code class="docutils literal notranslate"><span class="pre">user.has_perm('foo.change_bar')</span></code></p></li>
<li><p>削除: <code class="docutils literal notranslate"><span class="pre">user.has_perm('foo.delete_bar')</span></code></p></li>
<li><p>表示: <code class="docutils literal notranslate"><span class="pre">user.has_perm('foo.view_bar')</span></code></p></li>
</ul>
<p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.Permission" title="django.contrib.auth.models.Permission"><code class="xref py py-class docutils literal notranslate"><span class="pre">Permission</span></code></a> モデルが直接アクセスされることはほとんどありません。</p>
</section>
<section id="s-groups">
<span id="groups"></span><h3>グループ<a class="headerlink" href="#groups" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.Group" title="django.contrib.auth.models.Group"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.contrib.auth.models.Group</span></code></a> モデルはユーザーを分類する汎用的な方法であるため、対象となるユーザーに権限や、何らかのラベルを適用できます。1つのユーザーは複数のグループに属することが可能です。</p>
<p>グループに属するユーザーは、そのグループに付与された権限を自動的に持ちます。たとえば、<code class="docutils literal notranslate"><span class="pre">Site</span> <span class="pre">editors</span></code> グループが <code class="docutils literal notranslate"><span class="pre">can_edit_home_page</span></code> 権限を持っていた場合、そのグループ内のすべてのユーザーは、その権限を持つことになります。</p>
<p>権限に限らず、グループはユーザーを分類して、ラベルや拡張された機能を与えるために便利な手段です。たとえば、<code class="docutils literal notranslate"><span class="pre">Special</span> <span class="pre">users</span></code> というグループを作成して、そのグループのメンバーに対してサイトのメンバー限定の領域にアクセスする権限を付与したり、メンバー限定のメールを送るコードを書いたりすることも可能です。</p>
</section>
<section id="s-programmatically-creating-permissions">
<span id="programmatically-creating-permissions"></span><h3>プログラムによる権限の作成<a class="headerlink" href="#programmatically-creating-permissions" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="customizing.html#custom-permissions"><span class="std std-ref">カスタム権限</span></a> は、モデルの <code class="docutils literal notranslate"><span class="pre">Meta</span></code> クラス内に定義でき、権限を直接作成することも可能です。たとえば、<code class="docutils literal notranslate"><span class="pre">myapp</span></code> 内の <code class="docutils literal notranslate"><span class="pre">BlogPost</span></code> モデルに対する権限 <code class="docutils literal notranslate"><span class="pre">can_publish</span></code> は、以下のように作成できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">BlogPost</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Permission</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.contenttypes.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ContentType</span>

<span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">BlogPost</span><span class="p">)</span>
<span class="n">permission</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">codename</span><span class="o">=</span><span class="s2">&quot;can_publish&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Can Publish Posts&quot;</span><span class="p">,</span>
    <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>権限はその後、<code class="docutils literal notranslate"><span class="pre">user_permissions</span></code> 属性を介して <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> に割り当てるか、あるいは、<code class="docutils literal notranslate"><span class="pre">permissions</span></code> 属性を介して <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.Group" title="django.contrib.auth.models.Group"><code class="xref py py-class docutils literal notranslate"><span class="pre">Group</span></code></a> に割り当てることができます。</p>
<div class="admonition-proxy-models-need-their-own-content-type admonition">
<p class="admonition-title">プロキシモデルには独自のコンテンツタイプが必要です</p>
<p><a class="reference internal" href="#proxy-models-permissions-topic"><span class="std std-ref">プロキシモデルのパーミッション</span></a> を作成したい場合は、次のように <a class="reference internal" href="../../ref/contrib/contenttypes.html#django.contrib.contenttypes.models.ContentTypeManager.get_for_model" title="django.contrib.contenttypes.models.ContentTypeManager.get_for_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ContentTypeManager.get_for_model()</span></code></a> に <code class="docutils literal notranslate"><span class="pre">for_concrete_model=False</span></code> を渡して、適切な <code class="docutils literal notranslate"><span class="pre">ContentType</span></code> を取得してください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span>
    <span class="n">BlogPostProxy</span><span class="p">,</span> <span class="n">for_concrete_model</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="s-permission-caching">
<span id="permission-caching"></span><h3>権限のキャッシュ<a class="headerlink" href="#permission-caching" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.backends.ModelBackend" title="django.contrib.auth.backends.ModelBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelBackend</span></code></a> は、権限チェックのために最初に取得する必要があるユーザーオブジェクト上の権限をキャッシュします。権限は (たとえば admin 内で) 付与された直後に権限をチェックすることはないため、これは、通常のリクエスト-レスポンスのサイクルでは問題ありません。たとえばテストやビューなどで、権限を付与した直後に権限の確認を行う場合は、最も簡単な解決手段はデータベースからユーザーをm再取得することです。実装例を以下に示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Permission</span><span class="p">,</span> <span class="n">User</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.contenttypes.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_object_or_404</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">BlogPost</span>


<span class="k">def</span><span class="w"> </span><span class="nf">user_gains_perms</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
    <span class="c1"># any permission check will cache the current set of permissions</span>
    <span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">&quot;myapp.change_blogpost&quot;</span><span class="p">)</span>

    <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">BlogPost</span><span class="p">)</span>
    <span class="n">permission</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">codename</span><span class="o">=</span><span class="s2">&quot;change_blogpost&quot;</span><span class="p">,</span>
        <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">permission</span><span class="p">)</span>

    <span class="c1"># Checking the cached permission set</span>
    <span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">&quot;myapp.change_blogpost&quot;</span><span class="p">)</span>  <span class="c1"># False</span>

    <span class="c1"># Request new instance of User</span>
    <span class="c1"># Be aware that user.refresh_from_db() won&#39;t clear the cache.</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>

    <span class="c1"># Permission cache is repopulated from the database</span>
    <span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">&quot;myapp.change_blogpost&quot;</span><span class="p">)</span>  <span class="c1"># True</span>

    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="s-proxy-models">
<span id="s-proxy-models-permissions-topic"></span><span id="proxy-models"></span><span id="proxy-models-permissions-topic"></span><h3>プロキシモデル<a class="headerlink" href="#proxy-models" title="Link to this heading">¶</a></h3>
<p>プロキシモデルは具象モデルと全く同じように動作します。権限は、プロキシモデルの独自のコンテンツタイプを使って作成されます。プロキシモデルは、サブクラスである具象モデルのパーミッションを継承しません。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;can_eat_pizzas&quot;</span><span class="p">,</span> <span class="s2">&quot;Can eat pizzas&quot;</span><span class="p">)]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Student</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;can_deliver_pizzas&quot;</span><span class="p">,</span> <span class="s2">&quot;Can deliver pizzas&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Fetch the content type for the proxy model.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Student</span><span class="p">,</span> <span class="n">for_concrete_model</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">student_permissions</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">codename</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">student_permissions</span><span class="p">]</span>
<span class="go">[&#39;add_student&#39;, &#39;change_student&#39;, &#39;delete_student&#39;, &#39;view_student&#39;,</span>
<span class="go">&#39;can_deliver_pizzas&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">permission</span> <span class="ow">in</span> <span class="n">student_permissions</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">permission</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">&quot;app.add_person&quot;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">&quot;app.can_eat_pizzas&quot;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">has_perms</span><span class="p">((</span><span class="s2">&quot;app.add_student&quot;</span><span class="p">,</span> <span class="s2">&quot;app.can_deliver_pizzas&quot;</span><span class="p">))</span>
<span class="go">True</span>
</pre></div>
</div>
</section>
</section>
<section id="s-authentication-in-web-requests">
<span id="s-auth-web-requests"></span><span id="authentication-in-web-requests"></span><span id="auth-web-requests"></span><h2>Web リクエストにおける認証<a class="headerlink" href="#authentication-in-web-requests" title="Link to this heading">¶</a></h2>
<p>Django は <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">リクエストオブジェクト</span></code></a> に対して認証システムを接続させるのに <a class="reference internal" href="../http/sessions.html"><span class="doc">セッション</span></a> とミドルウェアを利用します。</p>
<p>これらは、現在のユーザーを示すすべてのリクエストに <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.user" title="django.http.HttpRequest.user"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.user</span></code></a> 属性と <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.auser" title="django.http.HttpRequest.auser"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request.auser</span></code></a> 非同期メソッドを提供します。もしユーザーが現在ログインしていない場合、この属性には <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.AnonymousUser" title="django.contrib.auth.models.AnonymousUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnonymousUser</span></code></a> のインスタンスが、ログインしている場合は <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> のインスタンスがセットされます。</p>
<p>両者は、<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.is_authenticated" title="django.contrib.auth.models.User.is_authenticated"><code class="xref py py-attr docutils literal notranslate"><span class="pre">is_authenticated</span></code></a> を用いて次のように識別できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
    <span class="c1"># Do something for authenticated users.</span>
    <span class="o">...</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Do something for anonymous users.</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>非同期ビューでは次のようになります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">auser</span><span class="p">()</span>
<span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
    <span class="c1"># Do something for authenticated users.</span>
    <span class="o">...</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Do something for anonymous users.</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="versionchanged">
<span class="title">Changed in Django 5.0:</span> <p><a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.auser" title="django.http.HttpRequest.auser"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HttpRequest.auser()</span></code></a> メソッドが追加されました。</p>
</div>
<section id="s-how-to-log-a-user-in">
<span id="s-id2"></span><span id="how-to-log-a-user-in"></span><span id="id2"></span><h3>ユーザーをログインさせる方法<a class="headerlink" href="#how-to-log-a-user-in" title="Link to this heading">¶</a></h3>
<p>現在のセッションに接続したい認証ユーザーがいる場合、<a class="reference internal" href="#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">login()</span></code></a> 関数を使用できます。</p>
<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.login">
<span class="sig-name descname"><span class="pre">login</span></span>(<em class="sig-param"><span class="n"><span class="pre">request</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/__init__.py#L102"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.login" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.alogin">
<span class="sig-name descname"><span class="pre">alogin</span></span>(<em class="sig-param"><span class="n"><span class="pre">request</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>)<a class="headerlink" href="#django.contrib.auth.alogin" title="Link to this definition">¶</a></dt>
<dd><p><em>非同期バージョン</em>: <code class="docutils literal notranslate"><span class="pre">alogin()</span></code></p>
<p>ビューからユーザーをログインさせるには、<a class="reference internal" href="#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">login()</span></code></a> を利用します。この関数は <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> オブジェクトと <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> オブジェクトを受け取ります。<a class="reference internal" href="#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">login()</span></code></a> は、Django のセッションフレームワークを利用して、セッション中のユーザー ID を保存します。</p>
<p>匿名セッション中に設定されたデータは、ユーザーがログインした後もセッション内に保持されることに注意してください。</p>
<p>以下の例では、<a class="reference internal" href="#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><code class="xref py py-func docutils literal notranslate"><span class="pre">authenticate()</span></code></a> と <a class="reference internal" href="#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">login()</span></code></a> の2つの関数の使用方法の例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">authenticate</span><span class="p">,</span> <span class="n">login</span>


<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">]</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="c1"># Redirect to a success page.</span>
        <span class="o">...</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Return an &#39;invalid login&#39; error message.</span>
        <span class="o">...</span>
</pre></div>
</div>
<div class="versionchanged">
<span class="title">Changed in Django 5.0:</span> <p><code class="docutils literal notranslate"><span class="pre">alogin()</span></code> 関数が追加されました。</p>
</div>
</dd></dl>

<section id="s-selecting-the-authentication-backend">
<span id="selecting-the-authentication-backend"></span><h4>認証バックエンドの選択<a class="headerlink" href="#selecting-the-authentication-backend" title="Link to this heading">¶</a></h4>
<p>ユーザーがログインするとき、そのユーザーの ID と認証に使用したバックエンドは、ユーザーのセッション内に保存されます。これにより、同じ <a class="reference internal" href="customizing.html#authentication-backends"><span class="std std-ref">認証バックエンド</span></a> が今後のリクエストでユーザーの詳細情報を取得できるようになります。セッション内に保存される認証バックエンドは、以下のように選択されます。</p>
<ol class="arabic simple">
<li><p>オプションの引数 <code class="docutils literal notranslate"><span class="pre">backend</span></code> が与えられている場合は、その値を利用する。</p></li>
<li><p>存在すれば属性 <code class="docutils literal notranslate"><span class="pre">user.backend</span></code> の値を利用する。<a class="reference internal" href="#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><code class="xref py py-func docutils literal notranslate"><span class="pre">authenticate()</span></code></a> は返すユーザーオブジェクトに属性値 <code class="docutils literal notranslate"><span class="pre">user.backend</span></code> を設定するので、これにより、<a class="reference internal" href="#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><code class="xref py py-func docutils literal notranslate"><span class="pre">authenticate()</span></code></a> と <a class="reference internal" href="#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">login()</span></code></a> をペアリングできます。</p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-AUTHENTICATION_BACKENDS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code></a> に設定が1つだけあれば、その <code class="docutils literal notranslate"><span class="pre">backend</span></code> を利用する。</p></li>
<li><p>いずれにも該当しなかった場合、例外が送出される。</p></li>
</ol>
<p>1 もしくは 2 においては、引数 <code class="docutils literal notranslate"><span class="pre">backend</span></code> あるいは属性値 <code class="docutils literal notranslate"><span class="pre">user.backend</span></code> は(<a class="reference internal" href="../../ref/settings.html#std-setting-AUTHENTICATION_BACKENDS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code></a> で定義されているのと同様に)ドット付きのインポート先を示すパスの文字列でなければなりません。</p>
</section>
</section>
<section id="s-how-to-log-a-user-out">
<span id="how-to-log-a-user-out"></span><h3>ユーザーをログアウトさせる方法<a class="headerlink" href="#how-to-log-a-user-out" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.logout">
<span class="sig-name descname"><span class="pre">logout</span></span>(<em class="sig-param"><span class="n"><span class="pre">request</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/__init__.py#L160"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.logout" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.alogout">
<span class="sig-name descname"><span class="pre">alogout</span></span>(<em class="sig-param"><span class="n"><span class="pre">request</span></span></em>)<a class="headerlink" href="#django.contrib.auth.alogout" title="Link to this definition">¶</a></dt>
<dd><p><em>非同期バージョン</em>: <code class="docutils literal notranslate"><span class="pre">alogout()</span></code></p>
<p><a class="reference internal" href="#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.auth.login()</span></code></a> を利用してログインしたユーザーをログアウトさせるためには、<a class="reference internal" href="#django.contrib.auth.logout" title="django.contrib.auth.logout"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.auth.logout()</span></code></a> をビューの中で利用してください。この関数は <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> オブジェクトを受け取り、値を返しません。実装例は下記のようになります:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">logout</span>


<span class="k">def</span><span class="w"> </span><span class="nf">logout_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">logout</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="c1"># Redirect to a success page.</span>
</pre></div>
</div>
<p><a class="reference internal" href="#django.contrib.auth.logout" title="django.contrib.auth.logout"><code class="xref py py-func docutils literal notranslate"><span class="pre">logout()</span></code></a> は対象となるユーザーが最初からログインしていなかった場合でも例外を送出しない事に注意してください。</p>
<p><a class="reference internal" href="#django.contrib.auth.logout" title="django.contrib.auth.logout"><code class="xref py py-func docutils literal notranslate"><span class="pre">logout()</span></code></a> を呼び出すと、現在処理しているリクエストに対応したセッション情報は完全に破棄されます。その時点までに存在している全てのデータが削除されます。これは、別の人物が同じウェブブラウザを利用してログインし、前のユーザーのセッションにアクセスして使用してしまう事態を防ぐためです。ログアウトした直後でも利用できる何らかの情報をセッションに保存したい場合は、<a class="reference internal" href="#django.contrib.auth.logout" title="django.contrib.auth.logout"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.auth.logout()</span></code></a> を呼び出した <em>後</em> に行ってください。</p>
<div class="versionchanged">
<span class="title">Changed in Django 5.0:</span> <p><code class="docutils literal notranslate"><span class="pre">alogout()</span></code> 関数が追加されました。</p>
</div>
</dd></dl>

</section>
<section id="s-limiting-access-to-logged-in-users">
<span id="limiting-access-to-logged-in-users"></span><h3>ログインしているユーザーにアクセスを制限する<a class="headerlink" href="#limiting-access-to-logged-in-users" title="Link to this heading">¶</a></h3>
<section id="s-the-raw-way">
<span id="the-raw-way"></span><h4>原理的な方法<a class="headerlink" href="#the-raw-way" title="Link to this heading">¶</a></h4>
<p>ページに対するアクセスを制限する直接的な方法は <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.is_authenticated" title="django.contrib.auth.models.User.is_authenticated"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.user.is_authenticated</span></code></a> の確認と共にログインページへのリダイレクトを利用する事です:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.conf</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">redirect</span>


<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">settings</span><span class="o">.</span><span class="n">LOGIN_URL</span><span class="si">}</span><span class="s2">?next=</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>もしくはエラーメッセージを出力します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>


<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;myapp/login_error.html&quot;</span><span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
</section>
<section id="s-the-login-required-decorator">
<span id="the-login-required-decorator"></span><h4><code class="docutils literal notranslate"><span class="pre">login_required</span></code> デコレータ<a class="headerlink" href="#the-login-required-decorator" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.decorators.login_required">
<span class="sig-name descname"><span class="pre">login_required</span></span>(<em class="sig-param"><span class="n"><span class="pre">redirect_field_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'next'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">login_url</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/decorators.py#L72"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.decorators.login_required" title="Link to this definition">¶</a></dt>
<dd><p>ショートカットとして、便利な <a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a> デコレータを利用できます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">login_required</span>


<span class="nd">@login_required</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p><a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a> は下記の処理を行います:</p>
<ul class="simple">
<li><p>もしユーザがログインしていなければ、<a class="reference internal" href="../../ref/settings.html#std-setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a> にリダイレクトし、クエリ文字列に現在の絶対パスを渡します。リダイレクト先の例: <code class="docutils literal notranslate"><span class="pre">/accounts/login/?next=/polls/3/</span></code></p></li>
<li><p>もしユーザがログインしていれば、通常通りビューを処理します。ビューのコードの中ではユーザがログインしているかを意識しなくて良いのです。</p></li>
</ul>
<p>デフォルトでは、認証に成功したユーザがリダイレクトされる先のパスは <code class="docutils literal notranslate"><span class="pre">&quot;next&quot;</span></code> という名称のクエリパラメータに格納されています。もし異なるパラメータ名を利用したい場合、<a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a> が <code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code> という省略可能な引数を受け取ります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">login_required</span>


<span class="nd">@login_required</span><span class="p">(</span><span class="n">redirect_field_name</span><span class="o">=</span><span class="s2">&quot;my_redirect_field&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code> に値を持たせた場合、ログインテンプレートもカスタマイズする必要があるでしょう。これは、リダイレクト先のパスを格納しているテンプレートコンテキスト変数が、キーとして (デフォルトの) <code class="docutils literal notranslate"><span class="pre">&quot;next&quot;</span></code> でなく <code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code> の値を使用してしまうためです。</p>
<p><a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a> はまた省略可能な引数として <code class="docutils literal notranslate"><span class="pre">login_url</span></code> を受け取る事ができます。以下の例のように利用します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">login_required</span>


<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s2">&quot;/accounts/login/&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">login_url</span></code> 引数を指定しなかった場合、<a class="reference internal" href="../../ref/settings.html#std-setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a> を設定して、ログイン用ビューを適切に関連付ける必要があることに注意してください。たとえば、デフォルトの設定を利用する場合、下記の行を URLconf に追加します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>

<span class="n">path</span><span class="p">(</span><span class="s2">&quot;accounts/login/&quot;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</pre></div>
</div>
<p><a class="reference internal" href="../../ref/settings.html#std-setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a> は、ビュー関数名と <a class="reference internal" href="../http/urls.html#naming-url-patterns"><span class="std std-ref">命名された URL パターン</span></a> も受け付けます。これにより、設定を更新せずに URLconf 内でログイン用ビューを自由に再マッピングできます。</p>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">login_required</span></code> デコレータはユーザーのフラグ <code class="docutils literal notranslate"><span class="pre">is_active</span></code> をチェック「しません」が、デフォルトの <a class="reference internal" href="../../ref/settings.html#std-setting-AUTHENTICATION_BACKENDS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code></a> は非アクティブなユーザを拒否します。</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<p>もし Django の管理画面向けにカスタムビューを実装している (あるいはビルトインのビューが利用しているのと同じ認可チェックが必要である) 場合は、<a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.views.decorators.staff_member_required" title="django.contrib.admin.views.decorators.staff_member_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.admin.views.decorators.staff_member_required()</span></code></a> デコレータが <code class="docutils literal notranslate"><span class="pre">login_required()</span></code> の代替手段となるかもしれません。</p>
</div>
<div class="versionchanged">
<span class="title">Changed in Django 5.1:</span> <p>非同期ビュー関数のラップをサポートしました。</p>
</div>
</section>
<section id="s-the-loginrequiredmixin-mixin">
<span id="the-loginrequiredmixin-mixin"></span><h4><code class="docutils literal notranslate"><span class="pre">LoginRequiredMixin</span></code> mixin<a class="headerlink" href="#the-loginrequiredmixin-mixin" title="Link to this heading">¶</a></h4>
<p><a class="reference internal" href="../class-based-views/index.html"><span class="doc">クラスベースのビュー</span></a> を使う際、 <code class="docutils literal notranslate"><span class="pre">LoginRequiredMixin</span></code> を使うことで <code class="docutils literal notranslate"><span class="pre">login_required</span></code> と同じ動作をさせることができます。 この mixin は、継承リストの一番左に記述される必要があります。</p>
<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.LoginRequiredMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">LoginRequiredMixin</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/mixins.py#L67"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.mixins.LoginRequiredMixin" title="Link to this definition">¶</a></dt>
<dd><p>ビューがこの mixin を使う場合、認証されていないユーザによるすべてのリクエストは、ログインページにリダイレクトされるか、HTTP 403 Forbidden エラー表示となります。これは、<a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.raise_exception" title="django.contrib.auth.mixins.AccessMixin.raise_exception"><code class="xref py py-attr docutils literal notranslate"><span class="pre">raise_exception</span></code></a> パラメータにて設定します。</p>
<p>次のように <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin" title="django.contrib.auth.mixins.AccessMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">AccessMixin</span></code></a> のパラメータを設定することで、認可されていないユーザの処理をカスタマイズできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.mixins</span><span class="w"> </span><span class="kn">import</span> <span class="n">LoginRequiredMixin</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span>
    <span class="n">login_url</span> <span class="o">=</span> <span class="s2">&quot;/login/&quot;</span>
    <span class="n">redirect_field_name</span> <span class="o">=</span> <span class="s2">&quot;redirect_to&quot;</span>
</pre></div>
</div>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">login_required</span></code> デコレータと同様に、この mixin はユーザの <code class="docutils literal notranslate"><span class="pre">is_active</span></code> フラグをチェックしません。しかし、デフォルトの <a class="reference internal" href="../../ref/settings.html#std-setting-AUTHENTICATION_BACKENDS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code></a> が非アクティブのユーザを拒否します。</p>
</div>
</section>
<section id="s-the-login-not-required-decorator">
<span id="s-disable-login-required-middleware-for-views"></span><span id="the-login-not-required-decorator"></span><span id="disable-login-required-middleware-for-views"></span><h4><code class="docutils literal notranslate"><span class="pre">login_not_required</span></code> デコレータ<a class="headerlink" href="#the-login-not-required-decorator" title="Link to this heading">¶</a></h4>
<div class="versionadded">
<span class="title">New in Django 5.1.</span> </div>
<p><a class="reference internal" href="../../ref/middleware.html#django.contrib.auth.middleware.LoginRequiredMiddleware" title="django.contrib.auth.middleware.LoginRequiredMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoginRequiredMiddleware</span></code></a> をインストールすると、すべてのビューがデフォルトで認証を必要とするようになります。ログインビューなど一部のビューでは、この動作を無効にしなければならないでしょう。</p>
<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.decorators.login_not_required">
<span class="sig-name descname"><span class="pre">login_not_required</span></span>()<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/decorators.py#L89"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.decorators.login_not_required" title="Link to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../../ref/middleware.html#django.contrib.auth.middleware.LoginRequiredMiddleware" title="django.contrib.auth.middleware.LoginRequiredMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoginRequiredMiddleware</span></code></a> がインストールされているときに、このビューへの未認証リクエストを許可します。</p>
</dd></dl>

</section>
<section id="s-limiting-access-to-logged-in-users-that-pass-a-test">
<span id="limiting-access-to-logged-in-users-that-pass-a-test"></span><h4>テストをパスしたログイン済みユーザのアクセスを制限する<a class="headerlink" href="#limiting-access-to-logged-in-users-that-pass-a-test" title="Link to this heading">¶</a></h4>
<p>特定の権限やその他のテストに基づいてアクセスを制限するには、前のセクションで説明したのと基本的に同じことを行います。</p>
<p>直接ビューで <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.user" title="django.http.HttpRequest.user"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.user</span></code></a> に対してテストを実行できます。たとえば、このビューは、ユーザが希望するドメインのメールを持っているかどうかをチェックし、持っていない場合はログインページにリダイレクトします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">redirect</span>


<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;@example.com&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s2">&quot;/login/?next=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.decorators.user_passes_test">
<span class="sig-name descname"><span class="pre">user_passes_test</span></span>(<em class="sig-param"><span class="n"><span class="pre">test_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">login_url</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">redirect_field_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'next'</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/decorators.py#L13"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.decorators.user_passes_test" title="Link to this definition">¶</a></dt>
<dd><p>便利なショートカットとして、 <code class="docutils literal notranslate"><span class="pre">user_passes_test</span></code> デコレータを使えば、呼び出し可能オブジェクトが <code class="docutils literal notranslate"><span class="pre">False</span></code> を返したときにリダイレクトできます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">user_passes_test</span>


<span class="k">def</span><span class="w"> </span><span class="nf">email_check</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;@example.com&quot;</span><span class="p">)</span>


<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">email_check</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p><a class="reference internal" href="#django.contrib.auth.decorators.user_passes_test" title="django.contrib.auth.decorators.user_passes_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">user_passes_test()</span></code></a> は必須引数として <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> オブジェクトを受け取り、そのユーザがページの閲覧を許可されていれば <code class="docutils literal notranslate"><span class="pre">True</span></code> を返す呼び出し可能オブジェクトを受け取ります。この <a class="reference internal" href="#django.contrib.auth.decorators.user_passes_test" title="django.contrib.auth.decorators.user_passes_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">user_passes_test()</span></code></a> は <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> が匿名でないことを自動的にはチェックしないことに注意してください。</p>
<p><a class="reference internal" href="#django.contrib.auth.decorators.user_passes_test" title="django.contrib.auth.decorators.user_passes_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">user_passes_test()</span></code></a> はオプションで2つの引数を取ります:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">login_url</span></code></dt><dd><p>テストに合格しなかったユーザーがリダイレクトされるURLを指定します。これはログインページで、何も指定しなければデフォルトの <a class="reference internal" href="../../ref/settings.html#std-setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a> になります。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code></dt><dd><p>これは <a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a> と同じです。これを <code class="docutils literal notranslate"><span class="pre">None</span></code> に設定すると、URL からこれを削除します。これは、テストに合格しないユーザーを「次のページ」がない非ログインページにリダイレクトする場合に有効かもしれません。</p>
</dd>
</dl>
<p>例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">email_check</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s2">&quot;/login/&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<div class="versionchanged">
<span class="title">Changed in Django 5.1:</span> <p>非同期ビュー関数のラップおよび非同期テストcallableのサポートが追加されました。</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.UserPassesTestMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">UserPassesTestMixin</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/mixins.py#L112"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.mixins.UserPassesTestMixin" title="Link to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../class-based-views/index.html"><span class="doc">クラスベースのビュー</span></a> を使用する場合、 <code class="docutils literal notranslate"><span class="pre">UserPassesTestMixin</span></code> が使えます。</p>
<dl class="py method">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.UserPassesTestMixin.test_func">
<span class="sig-name descname"><span class="pre">test_func</span></span>()<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/mixins.py#L118"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.mixins.UserPassesTestMixin.test_func" title="Link to this definition">¶</a></dt>
<dd><p>実行されるテストを提供するには、クラスの <code class="docutils literal notranslate"><span class="pre">test_func()</span></code> メソッドをオーバーライドする必要があります。さらに、 <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin" title="django.contrib.auth.mixins.AccessMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">AccessMixin</span></code></a> のパラメータを設定することで、未認証ユーザの処理をカスタマイズできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.mixins</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserPassesTestMixin</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyView</span><span class="p">(</span><span class="n">UserPassesTestMixin</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;@example.com&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.UserPassesTestMixin.get_test_func">
<span class="sig-name descname"><span class="pre">get_test_func</span></span>()<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/mixins.py#L125"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.mixins.UserPassesTestMixin.get_test_func" title="Link to this definition">¶</a></dt>
<dd><p>また、<code class="docutils literal notranslate"><span class="pre">get_test_func()</span></code> メソッドをオーバーライドすることで、(<a class="reference internal" href="#django.contrib.auth.mixins.UserPassesTestMixin.test_func" title="django.contrib.auth.mixins.UserPassesTestMixin.test_func"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_func()</span></code></a> の代わりに) 別の名前の関数をチェックに使用できます。</p>
</dd></dl>

<div class="admonition-stacking-userpassestestmixin admonition">
<p class="admonition-title"><code class="docutils literal notranslate"><span class="pre">UserPassesTestMixin</span></code> を重ねる</p>
<p><code class="docutils literal notranslate"><span class="pre">UserPassesTestMixin</span></code> の実装上、継承リストに複数個を重ねることはできません。以下は動作しません:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">TestMixin1</span><span class="p">(</span><span class="n">UserPassesTestMixin</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;@example.com&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">TestMixin2</span><span class="p">(</span><span class="n">UserPassesTestMixin</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;django&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyView</span><span class="p">(</span><span class="n">TestMixin1</span><span class="p">,</span> <span class="n">TestMixin2</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p>もし <code class="docutils literal notranslate"><span class="pre">TestMixin1</span></code> が <code class="docutils literal notranslate"><span class="pre">super()</span></code> を呼び出して、その結果を考慮すると、 <code class="docutils literal notranslate"><span class="pre">TestMixin1</span></code> はスタンドアロンでは動作しなくなります。</p>
</div>
</dd></dl>

</section>
<section id="s-the-permission-required-decorator">
<span id="the-permission-required-decorator"></span><h4><code class="docutils literal notranslate"><span class="pre">permission_required</span></code> デコレータ<a class="headerlink" href="#the-permission-required-decorator" title="Link to this heading">¶</a></h4>
<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.decorators.permission_required">
<span class="sig-name descname"><span class="pre">permission_required</span></span>(<em class="sig-param"><span class="n"><span class="pre">perm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">login_url</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raise_exception</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/decorators.py#L97"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.decorators.permission_required" title="Link to this definition">¶</a></dt>
<dd><p>ユーザーが特定の権限を持っているかどうかを確認するのはよくある作業です。Djangoにはそのためのショートカット、 <a class="reference internal" href="#django.contrib.auth.decorators.permission_required" title="django.contrib.auth.decorators.permission_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">permission_required()</span></code></a> デコレータがあります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">permission_required</span>


<span class="nd">@permission_required</span><span class="p">(</span><span class="s2">&quot;polls.add_choice&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.has_perm" title="django.contrib.auth.models.User.has_perm"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_perm()</span></code></a> メソッドと同じように、パーミッション名は <code class="docutils literal notranslate"><span class="pre">&quot;&lt;app</span> <span class="pre">label&gt;.&lt;permission</span> <span class="pre">codename&gt;&quot;</span></code> という形式を取ります (たとえば、<code class="docutils literal notranslate"><span class="pre">polls</span></code> アプリケーションのモデルに対するパーミッションは <code class="docutils literal notranslate"><span class="pre">polls.add_choice</span></code> となります)。</p>
<p>この場合、ビューにアクセスするためには、ユーザはすべてのパーミッションを持っている必要があります。</p>
<p>また、 <a class="reference internal" href="#django.contrib.auth.decorators.permission_required" title="django.contrib.auth.decorators.permission_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">permission_required()</span></code></a> は省略可能な引数として <code class="docutils literal notranslate"><span class="pre">login_url</span></code> も受け取ることに注意してください:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">permission_required</span>


<span class="nd">@permission_required</span><span class="p">(</span><span class="s2">&quot;polls.add_choice&quot;</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s2">&quot;/loginpage/&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p><a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a> デコレータと同様に、 <code class="docutils literal notranslate"><span class="pre">login_url</span></code> のデフォルトは <a class="reference internal" href="../../ref/settings.html#std-setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a> です。</p>
<p>もし <code class="docutils literal notranslate"><span class="pre">raise_exception</span></code> パラメータが与えられた場合、デコレータは <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.PermissionDenied" title="django.core.exceptions.PermissionDenied"><code class="xref py py-exc docutils literal notranslate"><span class="pre">PermissionDenied</span></code></a> を発生させ、ログインページにリダイレクトする代わりに <a class="reference internal" href="../../ref/views.html#http-forbidden-view"><span class="std std-ref">403 (HTTP Forbidden) ビュー</span></a> を表示します。</p>
<p>もし <code class="docutils literal notranslate"><span class="pre">raise_exception</span></code> を使いたいが、ユーザが最初にログインする機会を与えたい場合は、 <a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a> デコレータを追加してください:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">login_required</span><span class="p">,</span> <span class="n">permission_required</span>


<span class="nd">@login_required</span>
<span class="nd">@permission_required</span><span class="p">(</span><span class="s2">&quot;polls.add_choice&quot;</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p>また、<a class="reference internal" href="#django.contrib.auth.views.LoginView" title="django.contrib.auth.views.LoginView"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoginView</span></code></a> の <code class="docutils literal notranslate"><span class="pre">redirect_authenticated_user=True</span></code> で、ログインしているユーザーが必要なすべての権限を持っていない場合に、リダイレクトループを回避できます。</p>
</dd></dl>

<div class="versionchanged">
<span class="title">Changed in Django 5.1:</span> <p>非同期ビュー関数のラップをサポートしました。</p>
</div>
</section>
<section id="s-the-permissionrequiredmixin-mixin">
<span id="the-permissionrequiredmixin-mixin"></span><h4><code class="docutils literal notranslate"><span class="pre">PermissionRequiredMixin</span></code> ミックスイン<a class="headerlink" href="#the-permissionrequiredmixin-mixin" title="Link to this heading">¶</a></h4>
<p><a class="reference internal" href="../../ref/class-based-views/index.html"><span class="doc">クラスベースのビュー</span></a> にパーミッションチェックを適用するには、 <code class="docutils literal notranslate"><span class="pre">PermissionRequiredMixin</span></code> を使用します:</p>
<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.PermissionRequiredMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">PermissionRequiredMixin</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/mixins.py#L76"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.mixins.PermissionRequiredMixin" title="Link to this definition">¶</a></dt>
<dd><p>このミックスインは <code class="docutils literal notranslate"><span class="pre">permission_required</span></code> デコレータと同様、ビューにアクセスするユーザが与えられたパーミッションをすべて保持しているかどうかをチェックします。パーミッション (またはパーミッションのイテラブル) は <code class="docutils literal notranslate"><span class="pre">permission_required</span></code> パラメータで指定します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.mixins</span><span class="w"> </span><span class="kn">import</span> <span class="n">PermissionRequiredMixin</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyView</span><span class="p">(</span><span class="n">PermissionRequiredMixin</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span>
    <span class="n">permission_required</span> <span class="o">=</span> <span class="s2">&quot;polls.add_choice&quot;</span>
    <span class="c1"># Or multiple of permissions:</span>
    <span class="n">permission_required</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;polls.view_choice&quot;</span><span class="p">,</span> <span class="s2">&quot;polls.change_choice&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>次のように <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin" title="django.contrib.auth.mixins.AccessMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">AccessMixin</span></code></a> のパラメータを指定することで、認可されていないユーザの処理をカスタマイズできます。</p>
<p>これらのメソッドをオーバーライドすることもできます:</p>
<dl class="py method">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.PermissionRequiredMixin.get_permission_required">
<span class="sig-name descname"><span class="pre">get_permission_required</span></span>()<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/mixins.py#L81"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.mixins.PermissionRequiredMixin.get_permission_required" title="Link to this definition">¶</a></dt>
<dd><p>ミックスインが使用するパーミッション名のイテラブルを返します。デフォルトは <code class="docutils literal notranslate"><span class="pre">permission_required</span></code> 属性で、必要に応じてタプルに変換されます。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.PermissionRequiredMixin.has_permission">
<span class="sig-name descname"><span class="pre">has_permission</span></span>()<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/mixins.py#L99"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.mixins.PermissionRequiredMixin.has_permission" title="Link to this definition">¶</a></dt>
<dd><p>現在のユーザがデコレートされたビューを実行する権限を持っているかどうかを真偽値で返します。デフォルトでは、 <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.has_perms" title="django.contrib.auth.models.User.has_perms"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_perms()</span></code></a> を <a class="reference internal" href="#django.contrib.auth.mixins.PermissionRequiredMixin.get_permission_required" title="django.contrib.auth.mixins.PermissionRequiredMixin.get_permission_required"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_permission_required()</span></code></a> によって返されたパーミッションのリストで呼び出した結果を返します。</p>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="s-redirecting-unauthorized-requests-in-class-based-views">
<span id="redirecting-unauthorized-requests-in-class-based-views"></span><h3>クラスベースのビューで、不正なリクエストをリダイレクトする<a class="headerlink" href="#redirecting-unauthorized-requests-in-class-based-views" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../../ref/class-based-views/index.html"><span class="doc">クラスベースのビュー</span></a> におけるアクセス制限の取り扱いを簡単にするために、 <code class="docutils literal notranslate"><span class="pre">AccessMixin</span></code> を使ってアクセスが拒否されたときのビューの動作を指定できます。認証されたユーザーはHTTP 403 Forbiddenレスポンスでアクセスを拒否されます。匿名ユーザーは <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.raise_exception" title="django.contrib.auth.mixins.AccessMixin.raise_exception"><code class="xref py py-attr docutils literal notranslate"><span class="pre">raise_exception</span></code></a> 属性に応じて、ログインページにリダイレクトされるか、HTTP 403 Forbidden レスポンスが表示されます。</p>
<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.AccessMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">AccessMixin</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/mixins.py#L10"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin" title="Link to this definition">¶</a></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.AccessMixin.login_url">
<span class="sig-name descname"><span class="pre">login_url</span></span><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.login_url" title="Link to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.get_login_url" title="django.contrib.auth.mixins.AccessMixin.get_login_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_login_url()</span></code></a> のデフォルトの戻り値。デフォルトは <code class="docutils literal notranslate"><span class="pre">None</span></code> で、この場合 <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.get_login_url" title="django.contrib.auth.mixins.AccessMixin.get_login_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_login_url()</span></code></a> は <a class="reference internal" href="../../ref/settings.html#std-setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a> にフォールバックします。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.AccessMixin.permission_denied_message">
<span class="sig-name descname"><span class="pre">permission_denied_message</span></span><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.permission_denied_message" title="Link to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.get_permission_denied_message" title="django.contrib.auth.mixins.AccessMixin.get_permission_denied_message"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_permission_denied_message()</span></code></a> のデフォルトの戻り値。デフォルトは空文字列です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.AccessMixin.redirect_field_name">
<span class="sig-name descname"><span class="pre">redirect_field_name</span></span><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.redirect_field_name" title="Link to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.get_redirect_field_name" title="django.contrib.auth.mixins.AccessMixin.get_redirect_field_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_redirect_field_name()</span></code></a> のデフォルトの戻り値。デフォルトは <code class="docutils literal notranslate"><span class="pre">&quot;next&quot;</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.AccessMixin.raise_exception">
<span class="sig-name descname"><span class="pre">raise_exception</span></span><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.raise_exception" title="Link to this definition">¶</a></dt>
<dd><p>この属性が <code class="docutils literal notranslate"><span class="pre">True</span></code> に設定されている場合、条件が満たされないと <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.PermissionDenied" title="django.core.exceptions.PermissionDenied"><code class="xref py py-class docutils literal notranslate"><span class="pre">PermissionDenied</span></code></a> 例外が発生します。 <code class="docutils literal notranslate"><span class="pre">False</span></code> (デフォルト) の場合、匿名ユーザはログインページにリダイレクトされます。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.AccessMixin.get_login_url">
<span class="sig-name descname"><span class="pre">get_login_url</span></span>()<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/mixins.py#L21"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.get_login_url" title="Link to this definition">¶</a></dt>
<dd><p>テストにパスしなかったユーザーがリダイレクトされる URL を返します。設定されていれば <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.login_url" title="django.contrib.auth.mixins.AccessMixin.login_url"><code class="xref py py-attr docutils literal notranslate"><span class="pre">login_url</span></code></a> を、設定されていなければ <a class="reference internal" href="../../ref/settings.html#std-setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a> を返します。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.AccessMixin.get_permission_denied_message">
<span class="sig-name descname"><span class="pre">get_permission_denied_message</span></span>()<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/mixins.py#L34"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.get_permission_denied_message" title="Link to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.raise_exception" title="django.contrib.auth.mixins.AccessMixin.raise_exception"><code class="xref py py-attr docutils literal notranslate"><span class="pre">raise_exception</span></code></a> が <code class="docutils literal notranslate"><span class="pre">True</span></code> の場合、このメソッドを使ってエラーハンドラに渡されるエラーメッセージを制御できます。デフォルトでは <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.permission_denied_message" title="django.contrib.auth.mixins.AccessMixin.permission_denied_message"><code class="xref py py-attr docutils literal notranslate"><span class="pre">permission_denied_message</span></code></a> 属性を返します。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.AccessMixin.get_redirect_field_name">
<span class="sig-name descname"><span class="pre">get_redirect_field_name</span></span>()<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/mixins.py#L40"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.get_redirect_field_name" title="Link to this definition">¶</a></dt>
<dd><p>ログインに成功した後にユーザーがリダイレクトされる URL を含むクエリパラメータの名前を返します。これを <code class="docutils literal notranslate"><span class="pre">None</span></code> に設定すると、クエリパラメータは追加されません。デフォルトでは <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.redirect_field_name" title="django.contrib.auth.mixins.AccessMixin.redirect_field_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">redirect_field_name</span></code></a> 属性を返します。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.contrib.auth.mixins.AccessMixin.handle_no_permission">
<span class="sig-name descname"><span class="pre">handle_no_permission</span></span>()<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/mixins.py#L46"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.handle_no_permission" title="Link to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">raise_exception</span></code> の値に応じて、このメソッドは <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.PermissionDenied" title="django.core.exceptions.PermissionDenied"><code class="xref py py-exc docutils literal notranslate"><span class="pre">PermissionDenied</span></code></a> 例外を発生させるか、ユーザを <code class="docutils literal notranslate"><span class="pre">login_url</span></code> にリダイレクトします。オプションとして <code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code> が指定されている場合は、それを含みます。</p>
</dd></dl>

</dd></dl>

<section id="s-session-invalidation-on-password-change">
<span id="s-id3"></span><span id="session-invalidation-on-password-change"></span><span id="id3"></span><h4>パスワード変更時にセッションを無効化する<a class="headerlink" href="#session-invalidation-on-password-change" title="Link to this heading">¶</a></h4>
<p><a class="reference internal" href="../../ref/settings.html#std-setting-AUTH_USER_MODEL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTH_USER_MODEL</span></code></a> が <a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser" title="django.contrib.auth.models.AbstractBaseUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractBaseUser</span></code></a> を継承しているか、独自の <a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash" title="django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_session_auth_hash()</span></code></a> メソッドを実装している場合、認証されたセッションにはこの関数が返すハッシュが含まれます。<a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser" title="django.contrib.auth.models.AbstractBaseUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractBaseUser</span></code></a> の場合、これはパスワードフィールドの HMAC です。Django は各リクエストのセッションのハッシュが、リクエスト中に計算されたハッ シュと一致することを確認します。これにより、ユーザはパスワードを変更することで、全てのセッションをログアウトできます。</p>
<p>Django に含まれるデフォルトのパスワード変更ビュー、 <a class="reference internal" href="#django.contrib.auth.views.PasswordChangeView" title="django.contrib.auth.views.PasswordChangeView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordChangeView</span></code></a> と、 <a class="reference internal" href="index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a> admin の <code class="docutils literal notranslate"><span class="pre">user_change_password</span></code> ビューは、ユーザが自分のパスワードを変更してもログアウトしないように、新しいパスワードハッシュでセッションを更新します。カスタムのパスワード変更ビューがあり、同様の動作をさせたい場合は <a class="reference internal" href="#django.contrib.auth.update_session_auth_hash" title="django.contrib.auth.update_session_auth_hash"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_session_auth_hash()</span></code></a> 関数を使用してください。</p>
<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.update_session_auth_hash">
<span class="sig-name descname"><span class="pre">update_session_auth_hash</span></span>(<em class="sig-param"><span class="n"><span class="pre">request</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/__init__.py#L256"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.update_session_auth_hash" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.aupdate_session_auth_hash">
<span class="sig-name descname"><span class="pre">aupdate_session_auth_hash</span></span>(<em class="sig-param"><span class="n"><span class="pre">request</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user</span></span></em>)<a class="headerlink" href="#django.contrib.auth.aupdate_session_auth_hash" title="Link to this definition">¶</a></dt>
<dd><p><em>非同期バージョン</em>: <code class="docutils literal notranslate"><span class="pre">aupdate_session_auth_hash()</span></code></p>
<p>この関数は現在のリクエストと、新しいセッションハッシュの元になる 更新されたユーザオブジェクトを受け取り、セッションハッシュを適切に更新します。また、盗まれたセッションクッキーが無効になるようにセッションキーをローテートします。</p>
<p>使用例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">update_session_auth_hash</span>


<span class="k">def</span><span class="w"> </span><span class="nf">password_change</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PasswordChangeForm</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">update_session_auth_hash</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
<div class="versionchanged">
<span class="title">Changed in Django 5.0:</span> <p><code class="docutils literal notranslate"><span class="pre">aupdate_session_auth_hash()</span></code> 関数が追加されました。</p>
</div>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash" title="django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_session_auth_hash()</span></code></a> は <a class="reference internal" href="../../ref/settings.html#std-setting-SECRET_KEY"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SECRET_KEY</span></code></a> に基づいているので、サイトを更新して新しいシークレットを使用する場合、既存のセッションが無効にならないようにシークレットキーの値をローテーションする必要があります。詳細は <a class="reference internal" href="../../ref/settings.html#std-setting-SECRET_KEY_FALLBACKS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SECRET_KEY_FALLBACKS</span></code></a> を参照してください。</p>
</div>
</section>
</section>
<section id="s-module-django.contrib.auth.views">
<span id="s-authentication-views"></span><span id="s-built-in-auth-views"></span><span id="module-django.contrib.auth.views"></span><span id="authentication-views"></span><span id="built-in-auth-views"></span><h3>認証ビュー<a class="headerlink" href="#module-django.contrib.auth.views" title="Link to this heading">¶</a></h3>
<p>Django の提供する複数のビューを使って、ログイン、ログアウト、パスワード管理を行うことができます。これらは <a class="reference internal" href="#built-in-auth-forms"><span class="std std-ref">ビルトインの認証フォーム</span></a> を使用しますが、独自のフォームを使用することもできます。</p>
<p>認証ビュー向けのデフォルトのテンプレートはありません。使用したいビューのテンプレートを自分で作成する必要があります。テンプレートのコンテキストは各ビューに記述されているので、<a class="reference internal" href="#all-authentication-views"><span class="std std-ref">すべての認証ビュー</span></a> を参照してください。</p>
<section id="s-using-the-views">
<span id="s-id4"></span><span id="using-the-views"></span><span id="id4"></span><h4>ビューを使用する<a class="headerlink" href="#using-the-views" title="Link to this heading">¶</a></h4>
<p>プロジェクト内でこれらのビューを実装するには、いくつかの方法があります。最も簡単なのは、<code class="docutils literal notranslate"><span class="pre">django.contrib.auth.urls</span></code> で提供される URLconf を自分の URLconf に含めることです。たとえば、次のようにします。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;accounts/&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s2">&quot;django.contrib.auth.urls&quot;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>これには、以下の URL パターンが含まれます。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>accounts/login/ [name=&#39;login&#39;]
accounts/logout/ [name=&#39;logout&#39;]
accounts/password_change/ [name=&#39;password_change&#39;]
accounts/password_change/done/ [name=&#39;password_change_done&#39;]
accounts/password_reset/ [name=&#39;password_reset&#39;]
accounts/password_reset/done/ [name=&#39;password_reset_done&#39;]
accounts/reset/&lt;uidb64&gt;/&lt;token&gt;/ [name=&#39;password_reset_confirm&#39;]
accounts/reset/done/ [name=&#39;password_reset_complete&#39;]
</pre></div>
</div>
<p>これらのビューは、より簡単に参照できる URL 名を提供します. 名前付き URL パターンの詳細については、<a class="reference internal" href="../http/urls.html"><span class="doc">URL のドキュメント</span></a> をご覧ください。</p>
<p>URL をより詳細にコントロールしたい場合は、次のように URLconf 内の特定のビューを指定することもできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;change-password/&quot;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordChangeView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>これらのビューでは、挙動を操作するためのオプショナル引数を使えます。たとえば、ビューが参照するテンプレートの名前を変更したいときは、<code class="docutils literal notranslate"><span class="pre">template_name</span></code> 引数を指定します。引数指定の方法の 1 つは、URLconf 内でキーワード引数を渡すことです。指定した引数はビューに渡されます。たとえば、次のようにします。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span>
        <span class="s2">&quot;change-password/&quot;</span><span class="p">,</span>
        <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordChangeView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s2">&quot;change-password.html&quot;</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>すべてのビューは <a class="reference internal" href="../class-based-views/index.html"><span class="doc">クラスベース</span></a> なので、サブクラス化することで容易にカスタムできます。</p>
</section>
<section id="s-all-authentication-views">
<span id="s-id5"></span><span id="all-authentication-views"></span><span id="id5"></span><h4>すべての認証ビュー<a class="headerlink" href="#all-authentication-views" title="Link to this heading">¶</a></h4>
<p>以下は、<code class="docutils literal notranslate"><span class="pre">django.contrib.auth</span></code> が提供するすべてのビューのリストです。実装の詳細については、 <a class="reference internal" href="#using-the-views"><span class="std std-ref">ビューを使用する</span></a> を参照してください。</p>
<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.views.LoginView">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">LoginView</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/views.py#L66"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.views.LoginView" title="Link to this definition">¶</a></dt>
<dd><p><strong>URL 名:</strong> <code class="docutils literal notranslate"><span class="pre">login</span></code></p>
<p>名前付き URL パターンの使い方は、<a class="reference internal" href="../http/urls.html"><span class="doc">URL のドキュメント</span></a> をご覧ください。</p>
<p><strong>メソッドと属性</strong></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.LoginView.template_name">
<span class="sig-name descname"><span class="pre">template_name</span></span><a class="headerlink" href="#django.contrib.auth.views.LoginView.template_name" title="Link to this definition">¶</a></dt>
<dd><p>ユーザーをログインさせるビューに表示するテンプレートの名前。デフォルトは <code class="file docutils literal notranslate"><span class="pre">registration/login.html</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.LoginView.next_page">
<span class="sig-name descname"><span class="pre">next_page</span></span><a class="headerlink" href="#django.contrib.auth.views.LoginView.next_page" title="Link to this definition">¶</a></dt>
<dd><p>ログイン後にリダイレクトするURL。デフォルトは <a class="reference internal" href="../../ref/settings.html#std-setting-LOGIN_REDIRECT_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGIN_REDIRECT_URL</span></code></a> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.LoginView.redirect_field_name">
<span class="sig-name descname"><span class="pre">redirect_field_name</span></span><a class="headerlink" href="#django.contrib.auth.views.LoginView.redirect_field_name" title="Link to this definition">¶</a></dt>
<dd><p>ログイン後にリダイレクトする URL を含む <code class="docutils literal notranslate"><span class="pre">GET</span></code> フィールドの名前。デフォルトは <code class="docutils literal notranslate"><span class="pre">next</span></code> です。 <code class="docutils literal notranslate"><span class="pre">GET</span></code> パラメータが渡された場合、 <a class="reference internal" href="#django.contrib.auth.views.LoginView.get_default_redirect_url" title="django.contrib.auth.views.LoginView.get_default_redirect_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_default_redirect_url()</span></code></a> URL をオーバーライドします。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.LoginView.authentication_form">
<span class="sig-name descname"><span class="pre">authentication_form</span></span><a class="headerlink" href="#django.contrib.auth.views.LoginView.authentication_form" title="Link to this definition">¶</a></dt>
<dd><p>認証に使用する呼び出し可能オブジェクト (通常はフォームクラス) です。デフォルトは <a class="reference internal" href="#django.contrib.auth.forms.AuthenticationForm" title="django.contrib.auth.forms.AuthenticationForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AuthenticationForm</span></code></a> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.LoginView.extra_context">
<span class="sig-name descname"><span class="pre">extra_context</span></span><a class="headerlink" href="#django.contrib.auth.views.LoginView.extra_context" title="Link to this definition">¶</a></dt>
<dd><p>テンプレートに渡されるデフォルトコンテキストデータに追加されるコンテキストデータの辞書。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.LoginView.redirect_authenticated_user">
<span class="sig-name descname"><span class="pre">redirect_authenticated_user</span></span><a class="headerlink" href="#django.contrib.auth.views.LoginView.redirect_authenticated_user" title="Link to this definition">¶</a></dt>
<dd><p>ログインページにアクセスした認証済みユーザーを、ログインに成功したかのようにリダイレクトするかどうかを制御する真偽値。デフォルトは <code class="docutils literal notranslate"><span class="pre">False</span></code> です。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p><code class="docutils literal notranslate"><span class="pre">redirect_authenticated_user</span></code> を有効にすると、他のウェブサイトは、あなたのウェブサイトの画像ファイルへのリダイレクト URL を要求することで、訪問者があなたのサイトで認証されているかどうかを判断できます。この <a class="reference external" href="https://robinlinus.github.io/socialmedia-leak/">「ソーシャルメディアのフィンガープリンティング」</a> による情報漏洩を避けるには、すべての画像と favicon を別ドメインでホストしてください。</p>
<p><code class="docutils literal notranslate"><span class="pre">redirect_authenticated_user</span></code> を有効にすると、 <a class="reference internal" href="#django.contrib.auth.decorators.permission_required" title="django.contrib.auth.decorators.permission_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">permission_required()</span></code></a> デコレータを使用したときに <code class="docutils literal notranslate"><span class="pre">raise_exception</span></code> パラメータを使用しない限り、リダイレクトループが発生する可能性があります。</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.LoginView.success_url_allowed_hosts">
<span class="sig-name descname"><span class="pre">success_url_allowed_hosts</span></span><a class="headerlink" href="#django.contrib.auth.views.LoginView.success_url_allowed_hosts" title="Link to this definition">¶</a></dt>
<dd><p>ログイン後にリダイレクトしても安全なホストの <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> を、 <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.get_host" title="django.http.HttpRequest.get_host"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request.get_host()</span></code></a> に加えて指定します。デフォルトは空の <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> です。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.contrib.auth.views.LoginView.get_default_redirect_url">
<span class="sig-name descname"><span class="pre">get_default_redirect_url</span></span>()<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/views.py#L91"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.views.LoginView.get_default_redirect_url" title="Link to this definition">¶</a></dt>
<dd><p>ログイン後にリダイレクトするURLを返します。デフォルトの実装では、<a class="reference internal" href="#django.contrib.auth.views.LoginView.next_page" title="django.contrib.auth.views.LoginView.next_page"><code class="xref py py-attr docutils literal notranslate"><span class="pre">next_page</span></code></a> が指定されていれば解決して返し、そうでなければ <a class="reference internal" href="../../ref/settings.html#std-setting-LOGIN_REDIRECT_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGIN_REDIRECT_URL</span></code></a> を返します。</p>
</dd></dl>

<p>以下は <code class="docutils literal notranslate"><span class="pre">LoginView</span></code> の機能です:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GET</span></code> で呼び出すと、同じURLにPOSTするログインフォームを表示します。これについてはもう少し詳しく説明します。</p></li>
<li><p>ユーザが送信した認証情報を使って <code class="docutils literal notranslate"><span class="pre">POST</span></code> 経由で呼び出された場合、ユーザをログインさせようとします。ログインに成功すると、ビューは <code class="docutils literal notranslate"><span class="pre">next</span></code> で指定された URL にリダイレクトします。もし <code class="docutils literal notranslate"><span class="pre">next</span></code> が指定されていない場合、 <a class="reference internal" href="../../ref/settings.html#std-setting-LOGIN_REDIRECT_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_REDIRECT_URL</span></code></a> (デフォルトは <code class="docutils literal notranslate"><span class="pre">/accounts/profile/</span></code>) にリダイレクトします。ログインが成功しなかった場合、ログインフォームを再表示します。</p></li>
</ul>
<p>デフォルトでは <code class="docutils literal notranslate"><span class="pre">registration/login.html</span></code> と呼び出されるログインテンプレートのhtmlを提供するのはあなたの責任です。このテンプレートには以下の4つのテンプレートコンテキスト変数が渡されます:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">form</span></code>: <a class="reference internal" href="#django.contrib.auth.forms.AuthenticationForm" title="django.contrib.auth.forms.AuthenticationForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AuthenticationForm</span></code></a> を表す <a class="reference internal" href="../../ref/forms/api.html#django.forms.Form" title="django.forms.Form"><code class="xref py py-class docutils literal notranslate"><span class="pre">Form</span></code></a> オブジェクトです。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">next</span></code>: ログイン成功後にリダイレクトするURL。これはクエリ文字列を含むこともできます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">site</span></code>: <a class="reference internal" href="../../ref/settings.html#std-setting-SITE_ID"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SITE_ID</span></code></a> 設定に基づく現在の <a class="reference internal" href="../../ref/contrib/sites.html#django.contrib.sites.models.Site" title="django.contrib.sites.models.Site"><code class="xref py py-class docutils literal notranslate"><span class="pre">Site</span></code></a> 。サイトフレームワークがインストールされていない場合、 <a class="reference internal" href="../../ref/contrib/sites.html#django.contrib.sites.requests.RequestSite" title="django.contrib.sites.requests.RequestSite"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestSite</span></code></a> のインスタンスに設定されます。このインスタンスは現在の <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> からサイト名とドメインを派生させます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">site_name</span></code>: <code class="docutils literal notranslate"><span class="pre">site.name</span></code> のエイリアス。サイトフレームワークがインストールされていない場合、 <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.META" title="django.http.HttpRequest.META"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.META['SERVER_NAME']</span></code></a> の値がセットされます。サイトについての詳細は <a class="reference internal" href="../../ref/contrib/sites.html"><span class="doc">&quot;sites&quot; フレームワーク</span></a> を参照してください。</p></li>
</ul>
<p>もしテンプレート <code class="file docutils literal notranslate"><span class="pre">registration/login.html</span></code> を呼び出したくない場合は、URLconfの <code class="docutils literal notranslate"><span class="pre">as_view</span></code> メソッドに追加引数として <code class="docutils literal notranslate"><span class="pre">template_name</span></code> パラメータを渡します。たとえば、この URLconf の行では、代わりに <code class="file docutils literal notranslate"><span class="pre">myapp/login.html</span></code> を使用します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span><span class="p">(</span><span class="s2">&quot;accounts/login/&quot;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s2">&quot;myapp/login.html&quot;</span><span class="p">)),</span>
</pre></div>
</div>
<p>また、ログイン後にリダイレクトする URL を含む <code class="docutils literal notranslate"><span class="pre">GET</span></code> フィールドの名前を指定するには、 <code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code> を使います。このフィールドは、デフォルトでは <code class="docutils literal notranslate"><span class="pre">next</span></code> と命名されます。</p>
<p>以下は <code class="file docutils literal notranslate"><span class="pre">registration/login.html</span></code> テンプレートのサンプルです。これは <code class="docutils literal notranslate"><span class="pre">content</span></code> ブロックを定義した <code class="file docutils literal notranslate"><span class="pre">base.html</span></code> テンプレートがあることを前提としています:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.errors</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your username and password didn&#39;t match. Please try again.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">next</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your account doesn&#39;t have access to this page. To proceed,
    please login with an account that has access.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Please login to see this page.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;login&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.username.label_tag</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.username</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.password.label_tag</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.password</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;login&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;next&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">next</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="c">{# Assumes you set up the password_reset view in your URLconf #}</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;password_reset&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>Lost password?<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>認証をカスタマイズしている場合 (<a class="reference internal" href="customizing.html"><span class="doc">認証をカスタマイズする</span></a> を参照してください)、 <code class="docutils literal notranslate"><span class="pre">authentication_form</span></code> 属性を指定することでカスタム認証フォームを使用できます。このフォームは <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> メソッドで <code class="docutils literal notranslate"><span class="pre">request</span></code> キーワード引数を受け取り、認証されたユーザオブジェクトを返す <code class="docutils literal notranslate"><span class="pre">get_user()</span></code> メソッドを提供しなければなりません (このメソッドはフォームの認証が成功した後にのみ呼び出されます)。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.views.LogoutView">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">LogoutView</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/views.py#L125"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.views.LogoutView" title="Link to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">POST</span></code> リクエストでユーザーをログアウトさせます。</p>
<p><strong>URL 名:</strong> <code class="docutils literal notranslate"><span class="pre">logout</span></code></p>
<p><strong>属性:</strong></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.LogoutView.next_page">
<span class="sig-name descname"><span class="pre">next_page</span></span><a class="headerlink" href="#django.contrib.auth.views.LogoutView.next_page" title="Link to this definition">¶</a></dt>
<dd><p>ログアウト後にリダイレクトするURL。デフォルトは <a class="reference internal" href="../../ref/settings.html#std-setting-LOGOUT_REDIRECT_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOGOUT_REDIRECT_URL</span></code></a> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.LogoutView.template_name">
<span class="sig-name descname"><span class="pre">template_name</span></span><a class="headerlink" href="#django.contrib.auth.views.LogoutView.template_name" title="Link to this definition">¶</a></dt>
<dd><p>ユーザーをログアウトさせた後に表示するテンプレートのフルネーム。デフォルトは <code class="file docutils literal notranslate"><span class="pre">registration/logged_out.html</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.LogoutView.redirect_field_name">
<span class="sig-name descname"><span class="pre">redirect_field_name</span></span><a class="headerlink" href="#django.contrib.auth.views.LogoutView.redirect_field_name" title="Link to this definition">¶</a></dt>
<dd><p>ログアウト後にリダイレクトする URL を含む <code class="docutils literal notranslate"><span class="pre">GET</span></code> フィールドの名前。デフォルトは <code class="docutils literal notranslate"><span class="pre">'next'</span></code> です。 <code class="docutils literal notranslate"><span class="pre">GET</span></code> パラメータが渡された場合、 <a class="reference internal" href="#django.contrib.auth.views.LogoutView.next_page" title="django.contrib.auth.views.LogoutView.next_page"><code class="xref py py-attr docutils literal notranslate"><span class="pre">next_page</span></code></a> URL を上書きします。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.LogoutView.extra_context">
<span class="sig-name descname"><span class="pre">extra_context</span></span><a class="headerlink" href="#django.contrib.auth.views.LogoutView.extra_context" title="Link to this definition">¶</a></dt>
<dd><p>テンプレートに渡されるデフォルトコンテキストデータに追加されるコンテキストデータの辞書。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.LogoutView.success_url_allowed_hosts">
<span class="sig-name descname"><span class="pre">success_url_allowed_hosts</span></span><a class="headerlink" href="#django.contrib.auth.views.LogoutView.success_url_allowed_hosts" title="Link to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.get_host" title="django.http.HttpRequest.get_host"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request.get_host()</span></code></a> に加えて、ログアウト後にリダイレクトしても安全なホストの <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> を指定します。デフォルトは空の <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> です。</p>
</dd></dl>

<p><strong>テンプレート コンテキスト:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">title</span></code>: 文字列 &quot;Logged out&quot;。これはローカライズされています。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">site</span></code>: <a class="reference internal" href="../../ref/settings.html#std-setting-SITE_ID"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SITE_ID</span></code></a> 設定に基づく現在の <a class="reference internal" href="../../ref/contrib/sites.html#django.contrib.sites.models.Site" title="django.contrib.sites.models.Site"><code class="xref py py-class docutils literal notranslate"><span class="pre">Site</span></code></a> 。サイトフレームワークがインストールされていない場合、 <a class="reference internal" href="../../ref/contrib/sites.html#django.contrib.sites.requests.RequestSite" title="django.contrib.sites.requests.RequestSite"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestSite</span></code></a> のインスタンスに設定されます。このインスタンスは現在の <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> からサイト名とドメインを派生させます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">site_name</span></code>: <code class="docutils literal notranslate"><span class="pre">site.name</span></code> のエイリアス。サイトフレームワークがインストールされていない場合、 <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.META" title="django.http.HttpRequest.META"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.META['SERVER_NAME']</span></code></a> の値がセットされます。サイトについての詳細は <a class="reference internal" href="../../ref/contrib/sites.html"><span class="doc">&quot;sites&quot; フレームワーク</span></a> を参照してください。</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.views.logout_then_login">
<span class="sig-name descname"><span class="pre">logout_then_login</span></span>(<em class="sig-param"><span class="n"><span class="pre">request</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">login_url</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/views.py#L172"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.views.logout_then_login" title="Link to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">POST</span></code> リクエストでユーザーをログアウトさせ、ログインページにリダイレクトします。</p>
<p><strong>URL 名:</strong> デフォルトのURLはありません。</p>
<p><strong>オプションの引数:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">login_url</span></code>: リダイレクト先のログインページのURL。省略時のデフォルトは <a class="reference internal" href="../../ref/settings.html#std-setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a> です。</p></li>
</ul>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordChangeView">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">PasswordChangeView</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/views.py#L353"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.views.PasswordChangeView" title="Link to this definition">¶</a></dt>
<dd><p><strong>URL 名:</strong> <code class="docutils literal notranslate"><span class="pre">password_change</span></code></p>
<p>ユーザーがパスワードを変更できるようにします。</p>
<p><strong>属性:</strong></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordChangeView.template_name">
<span class="sig-name descname"><span class="pre">template_name</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordChangeView.template_name" title="Link to this definition">¶</a></dt>
<dd><p>パスワード変更フォームの表示に使用するテンプレートのフルネーム。指定しない場合のデフォルトは <code class="file docutils literal notranslate"><span class="pre">registration/password_change_form.html</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordChangeView.success_url">
<span class="sig-name descname"><span class="pre">success_url</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordChangeView.success_url" title="Link to this definition">¶</a></dt>
<dd><p>パスワード変更成功後にリダイレクトする URL。デフォルトは <code class="docutils literal notranslate"><span class="pre">'password_change_done'</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordChangeView.form_class">
<span class="sig-name descname"><span class="pre">form_class</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordChangeView.form_class" title="Link to this definition">¶</a></dt>
<dd><p>キーワード引数 <code class="docutils literal notranslate"><span class="pre">user</span></code> を受け付けるカスタム &quot;change password&quot; フォームです。このフォームはユーザのパスワードを実際に変更する役割を持ちます。デフォルトは <a class="reference internal" href="#django.contrib.auth.forms.PasswordChangeForm" title="django.contrib.auth.forms.PasswordChangeForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordChangeForm</span></code></a> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordChangeView.extra_context">
<span class="sig-name descname"><span class="pre">extra_context</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordChangeView.extra_context" title="Link to this definition">¶</a></dt>
<dd><p>テンプレートに渡されるデフォルトコンテキストデータに追加されるコンテキストデータの辞書。</p>
</dd></dl>

<p><strong>テンプレート コンテキスト:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">form</span></code>: パスワード変更フォーム (上記の <code class="docutils literal notranslate"><span class="pre">form_class</span></code> を参照)。</p></li>
</ul>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordChangeDoneView">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">PasswordChangeDoneView</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/views.py#L378"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.views.PasswordChangeDoneView" title="Link to this definition">¶</a></dt>
<dd><p><strong>URL 名:</strong> <code class="docutils literal notranslate"><span class="pre">password_change_done</span></code></p>
<p>ユーザーがパスワードを変更した後に表示されるページです。</p>
<p><strong>属性:</strong></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordChangeDoneView.template_name">
<span class="sig-name descname"><span class="pre">template_name</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordChangeDoneView.template_name" title="Link to this definition">¶</a></dt>
<dd><p>使用するテンプレートのフルネーム。指定しない場合のデフォルトは <code class="file docutils literal notranslate"><span class="pre">registration/password_change_done.html</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordChangeDoneView.extra_context">
<span class="sig-name descname"><span class="pre">extra_context</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordChangeDoneView.extra_context" title="Link to this definition">¶</a></dt>
<dd><p>テンプレートに渡されるデフォルトコンテキストデータに追加されるコンテキストデータの辞書。</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetView">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">PasswordResetView</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/views.py#L215"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.views.PasswordResetView" title="Link to this definition">¶</a></dt>
<dd><p><strong>URL 名:</strong> <code class="docutils literal notranslate"><span class="pre">password_reset</span></code></p>
<p>パスワードをリセットするために使われる 1 回限り有効なリンクを生成し、ユーザがパスワードをリセットできるようにします。そのリンクはユーザーが登録したメールアドレスに送信されます。</p>
<p>このビューは、以下の条件が満たされた場合にメールを送信します:</p>
<ul class="simple">
<li><p>入力されたメールアドレスがシステムに存在すること。</p></li>
<li><p>要求されたユーザーがアクティブであること (<code class="docutils literal notranslate"><span class="pre">User.is_active</span></code> が <code class="docutils literal notranslate"><span class="pre">True</span></code> であること)。</p></li>
<li><p>要求されたユーザが使用可能なパスワードを持っていること。LDAP のような外部認証ソースを使用している場合、悪用を防ぐために、使用不可能なパスワード (<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.set_unusable_password" title="django.contrib.auth.models.User.set_unusable_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_unusable_password()</span></code></a> を参照) のフラグが付けられたユーザはパスワードのリセットを要求できません。</p></li>
</ul>
<p>これらの条件のいずれかが満たされ <em>ない</em> 場合、メールは送信されませんが、ユーザーにはエラーメッセージは送信されません。これは、潜在的な攻撃者への情報漏洩を防ぐためです。この場合にエラーメッセージを表示したい場合は、 <a class="reference internal" href="#django.contrib.auth.forms.PasswordResetForm" title="django.contrib.auth.forms.PasswordResetForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetForm</span></code></a> をサブクラス化して、 <code class="docutils literal notranslate"><span class="pre">form_class</span></code> 属性を使用してください。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>メールの送信には余分な時間がかかるため、既存のメールアドレスに対するリセット要求の時間と、存在しないメールアドレスに対するリセット要求の時間の差によって、メールアドレスの列挙タイミング攻撃に対して脆弱になる可能性があることに注意してください。オーバーヘッドを減らすために、 <a class="extlink-pypi reference external" href="https://pypi.org/project/django-mailer/">django-mailer</a> などの、非同期でメールを送信できるサードパーティのパッケージを使うことができます。</p>
</div>
<p><strong>属性:</strong></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetView.template_name">
<span class="sig-name descname"><span class="pre">template_name</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetView.template_name" title="Link to this definition">¶</a></dt>
<dd><p>パスワードリセットフォームの表示に使用するテンプレートのフルネーム。指定しない場合のデフォルトは <code class="file docutils literal notranslate"><span class="pre">registration/password_reset_form.html</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetView.form_class">
<span class="sig-name descname"><span class="pre">form_class</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetView.form_class" title="Link to this definition">¶</a></dt>
<dd><p>パスワードをリセットするためのユーザのメールアドレス入力用のフォーム。デフォルトは <a class="reference internal" href="#django.contrib.auth.forms.PasswordResetForm" title="django.contrib.auth.forms.PasswordResetForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetForm</span></code></a> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetView.email_template_name">
<span class="sig-name descname"><span class="pre">email_template_name</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetView.email_template_name" title="Link to this definition">¶</a></dt>
<dd><p>リセットパスワードのリンクとともに生成されるメールを生成するためのテンプレート名。指定しない場合のデフォルトは <code class="file docutils literal notranslate"><span class="pre">registration/password_reset_email.html</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetView.subject_template_name">
<span class="sig-name descname"><span class="pre">subject_template_name</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetView.subject_template_name" title="Link to this definition">¶</a></dt>
<dd><p>パスワードリセットリンクのメールの件名に使用するテンプレートのフルネーム。指定しない場合のデフォルトは <code class="file docutils literal notranslate"><span class="pre">registration/password_reset_subject.txt</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetView.token_generator">
<span class="sig-name descname"><span class="pre">token_generator</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetView.token_generator" title="Link to this definition">¶</a></dt>
<dd><p>1 回限りのリンクをチェックするためのクラスのインスタンス。デフォルトは <code class="docutils literal notranslate"><span class="pre">default_token_generator</span></code> で、これは <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.tokens.PasswordResetTokenGenerator</span></code> のインスタンスです。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetView.success_url">
<span class="sig-name descname"><span class="pre">success_url</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetView.success_url" title="Link to this definition">¶</a></dt>
<dd><p>パスワードリセットのリクエストに成功した後にリダイレクトする URL。デフォルトは <code class="docutils literal notranslate"><span class="pre">'password_reset_done'</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetView.from_email">
<span class="sig-name descname"><span class="pre">from_email</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetView.from_email" title="Link to this definition">¶</a></dt>
<dd><p>検証済みのメールアドレス。デフォルトでは、Django は <a class="reference internal" href="../../ref/settings.html#std-setting-DEFAULT_FROM_EMAIL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEFAULT_FROM_EMAIL</span></code></a> を使います。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetView.extra_context">
<span class="sig-name descname"><span class="pre">extra_context</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetView.extra_context" title="Link to this definition">¶</a></dt>
<dd><p>テンプレートに渡されるデフォルトコンテキストデータに追加されるコンテキストデータの辞書。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetView.html_email_template_name">
<span class="sig-name descname"><span class="pre">html_email_template_name</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetView.html_email_template_name" title="Link to this definition">¶</a></dt>
<dd><p>パスワードリセットのリンクとともに送信される <em class="mimetype">text/html</em> のマルチパートのメールを生成するためのテンプレートのフルネーム。デフォルトでは、HTML メールは送信されません。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetView.extra_email_context">
<span class="sig-name descname"><span class="pre">extra_email_context</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetView.extra_email_context" title="Link to this definition">¶</a></dt>
<dd><p>メールテンプレートで利用可能なコンテキストデータの辞書。たとえば <code class="docutils literal notranslate"><span class="pre">domain</span></code> のようなデフォルトのテンプレートコンテキストの値を上書きするために使用できます。</p>
</dd></dl>

<p><strong>テンプレート コンテキスト:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">form</span></code>: ユーザのパスワードをリセットするためのフォーム (上述の <code class="docutils literal notranslate"><span class="pre">form_class</span></code> を参照)。</p></li>
</ul>
<p><strong>メールテンプレートのコンテキスト:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">email</span></code>: <code class="docutils literal notranslate"><span class="pre">user.email</span></code> の別名 (エイリアス) です。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code>: 現在の <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> で、<code class="docutils literal notranslate"><span class="pre">email</span></code> フォームフィールドから取得されます。アクティブなユーザ (<code class="docutils literal notranslate"><span class="pre">User.is_active</span> <span class="pre">が</span> <span class="pre">True</span></code>) だけがパスワードをリセットできます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">site_name</span></code>: <code class="docutils literal notranslate"><span class="pre">site.name</span></code> のエイリアス。サイトフレームワークがインストールされていない場合、 <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.META" title="django.http.HttpRequest.META"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.META['SERVER_NAME']</span></code></a> の値がセットされます。サイトについての詳細は <a class="reference internal" href="../../ref/contrib/sites.html"><span class="doc">&quot;sites&quot; フレームワーク</span></a> を参照してください。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">domain</span></code>: <code class="docutils literal notranslate"><span class="pre">site.domain</span></code> の別名 (エイリアス) 。サイトのフレームワークをインストールしていない場合、<code class="docutils literal notranslate"><span class="pre">request.get_host()</span></code> の値がセットされます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">protocol</span></code>: http か https です。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uid</span></code>: Base 64 でエンコードされたユーザのプライマリキー。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">token</span></code>: リセットリンクを検証するためのトークン。</p></li>
</ul>
<p>以下は、サンプルの <code class="docutils literal notranslate"><span class="pre">registration/password_reset_email.html</span></code> (メール本文のテンプレート) です。</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span>Someone asked for password reset for email <span class="cp">{{</span> <span class="nv">email</span> <span class="cp">}}</span>. Follow the link below:
<span class="cp">{{</span> <span class="nv">protocol</span><span class="cp">}}</span>://<span class="cp">{{</span> <span class="nv">domain</span> <span class="cp">}}{%</span> <span class="k">url</span> <span class="s1">&#39;password_reset_confirm&#39;</span> <span class="nv">uidb64</span><span class="o">=</span><span class="nv">uid</span> <span class="nv">token</span><span class="o">=</span><span class="nv">token</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>表題のテンプレートにも同じテンプレートコンテキストが使われます。表題は 1 行のプレーンテキスト文字列の必要があります。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetDoneView">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">PasswordResetDoneView</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/views.py#L250"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.views.PasswordResetDoneView" title="Link to this definition">¶</a></dt>
<dd><p><strong>URL 名:</strong> <code class="docutils literal notranslate"><span class="pre">password_reset_done</span></code></p>
<p>パスワードリセット用のリンクがユーザにメール送信された後に表示されるページです。このビューは、デフォルトで <a class="reference internal" href="#django.contrib.auth.views.PasswordResetView" title="django.contrib.auth.views.PasswordResetView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetView</span></code></a> に明示的な <code class="docutils literal notranslate"><span class="pre">success_url</span></code> URL セットが指定されていないときに呼び出されます。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>提供されたメールアドレスがシステムにない、ユーザーが非アクティブである、もしくは無効なパスワードの場合でも、ユーザはこのページにリダイレクトされますが、メールは送信されません。</p>
</div>
<p><strong>属性:</strong></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetDoneView.template_name">
<span class="sig-name descname"><span class="pre">template_name</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetDoneView.template_name" title="Link to this definition">¶</a></dt>
<dd><p>使用するテンプレートのフルネーム。デフォルトは <code class="file docutils literal notranslate"><span class="pre">registration/password_reset_done.html</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetDoneView.extra_context">
<span class="sig-name descname"><span class="pre">extra_context</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetDoneView.extra_context" title="Link to this definition">¶</a></dt>
<dd><p>テンプレートに渡されるデフォルトコンテキストデータに追加されるコンテキストデータの辞書。</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetConfirmView">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">PasswordResetConfirmView</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/views.py#L256"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.views.PasswordResetConfirmView" title="Link to this definition">¶</a></dt>
<dd><p><strong>URL 名:</strong> <code class="docutils literal notranslate"><span class="pre">password_reset_confirm</span></code></p>
<p>新しいパスワードを入力するためのフォームを提供します。</p>
<p><strong>URL からのキーワード引数:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">uidb64</span></code>: Base 64 でエンコードされたユーザの ID 。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">token</span></code>: パスワードが有効かを確認するためのトークン。</p></li>
</ul>
<p><strong>属性:</strong></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetConfirmView.template_name">
<span class="sig-name descname"><span class="pre">template_name</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetConfirmView.template_name" title="Link to this definition">¶</a></dt>
<dd><p>パスワード確認のビューを表示するためのテンプレートの名前。デフォルト値は <code class="file docutils literal notranslate"><span class="pre">registration/password_reset_confirm.html</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetConfirmView.token_generator">
<span class="sig-name descname"><span class="pre">token_generator</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetConfirmView.token_generator" title="Link to this definition">¶</a></dt>
<dd><p>パスワードをチェックするクラスのインスタンス。デフォルトは <code class="docutils literal notranslate"><span class="pre">default_token_generator</span></code> で、これは <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.tokens.PasswordResetTokenGenerator</span></code> のインスタンスです。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetConfirmView.post_reset_login">
<span class="sig-name descname"><span class="pre">post_reset_login</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetConfirmView.post_reset_login" title="Link to this definition">¶</a></dt>
<dd><p>パスワードリセットに成功した後、ユーザーを自動的に認証するかどうかを示す真偽値。デフォルトは <code class="docutils literal notranslate"><span class="pre">False</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetConfirmView.post_reset_login_backend">
<span class="sig-name descname"><span class="pre">post_reset_login_backend</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetConfirmView.post_reset_login_backend" title="Link to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">post_reset_login</span></code> が <code class="docutils literal notranslate"><span class="pre">True</span></code> の場合にユーザーを認証する際に使用する認証バックエンドへのドット区切りパス。これは <a class="reference internal" href="../../ref/settings.html#std-setting-AUTHENTICATION_BACKENDS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code></a> を複数設定している場合にのみ必要です。デフォルトは <code class="docutils literal notranslate"><span class="pre">None</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetConfirmView.form_class">
<span class="sig-name descname"><span class="pre">form_class</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetConfirmView.form_class" title="Link to this definition">¶</a></dt>
<dd><p>パスワードを設定するためのフォーム。デフォルトは <a class="reference internal" href="#django.contrib.auth.forms.SetPasswordForm" title="django.contrib.auth.forms.SetPasswordForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">SetPasswordForm</span></code></a> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetConfirmView.success_url">
<span class="sig-name descname"><span class="pre">success_url</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetConfirmView.success_url" title="Link to this definition">¶</a></dt>
<dd><p>パスワードリセット完了後にリダイレクトする URL。デフォルトは <code class="docutils literal notranslate"><span class="pre">'password_reset_complete'</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetConfirmView.extra_context">
<span class="sig-name descname"><span class="pre">extra_context</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetConfirmView.extra_context" title="Link to this definition">¶</a></dt>
<dd><p>テンプレートに渡されるデフォルトコンテキストデータに追加されるコンテキストデータの辞書。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetConfirmView.reset_url_token">
<span class="sig-name descname"><span class="pre">reset_url_token</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetConfirmView.reset_url_token" title="Link to this definition">¶</a></dt>
<dd><p>パスワードリセットURLのコンポーネントとして表示されるトークンパラメータ。デフォルトは <code class="docutils literal notranslate"><span class="pre">'set-password'</span></code> です。</p>
</dd></dl>

<p><strong>テンプレート コンテキスト:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">form</span></code>: 新しいユーザーのパスワードを設定するフォーム (上記の <code class="docutils literal notranslate"><span class="pre">form_class</span></code> を参照)。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">validlink</span></code>: 真偽値で、リンク (<code class="docutils literal notranslate"><span class="pre">uidb64</span></code> と <code class="docutils literal notranslate"><span class="pre">token</span></code> の組み合わせ) が有効か、まだ使われていない場合に True となります。</p></li>
</ul>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetCompleteView">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">PasswordResetCompleteView</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/views.py#L343"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.views.PasswordResetCompleteView" title="Link to this definition">¶</a></dt>
<dd><p><strong>URL 名:</strong> <code class="docutils literal notranslate"><span class="pre">password_reset_complete</span></code></p>
<p>パスワードの変更が成功したことをユーザに知らせるためのビューを提供します。</p>
<p><strong>属性:</strong></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetCompleteView.template_name">
<span class="sig-name descname"><span class="pre">template_name</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetCompleteView.template_name" title="Link to this definition">¶</a></dt>
<dd><p>ビューを表示するためのテンプレートのフルネーム。デフォルトは <code class="file docutils literal notranslate"><span class="pre">registration/password_reset_complete.html</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.contrib.auth.views.PasswordResetCompleteView.extra_context">
<span class="sig-name descname"><span class="pre">extra_context</span></span><a class="headerlink" href="#django.contrib.auth.views.PasswordResetCompleteView.extra_context" title="Link to this definition">¶</a></dt>
<dd><p>テンプレートに渡されるデフォルトコンテキストデータに追加されるコンテキストデータの辞書。</p>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="s-helper-functions">
<span id="helper-functions"></span><h3>ヘルパー関数<a class="headerlink" href="#helper-functions" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.views.redirect_to_login">
<span class="sig-name descname"><span class="pre">redirect_to_login</span></span>(<em class="sig-param"><span class="n"><span class="pre">next</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">login_url</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">redirect_field_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'next'</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/views.py#L180"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.views.redirect_to_login" title="Link to this definition">¶</a></dt>
<dd><p>ログインページにリダイレクトし、ログイン成功後にもう 1 つの URL に戻ります。</p>
<p><strong>必須の引数:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">next</span></code>: ログイン成功後のリダイレクト先の URL です。</p></li>
</ul>
<p><strong>オプションの引数:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">login_url</span></code>: リダイレクト先のログインページのURL。省略時のデフォルトは <a class="reference internal" href="../../ref/settings.html#std-setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a> です。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code>: ログイン後のリダイレクト先の URL を含む <code class="docutils literal notranslate"><span class="pre">GET</span></code> フィールドの名前。指定された <code class="docutils literal notranslate"><span class="pre">GET</span></code> パラメータが与えられた場合、<code class="docutils literal notranslate"><span class="pre">next</span></code> をオーバーライドします。</p></li>
</ul>
</dd></dl>

</section>
<section id="s-module-django.contrib.auth.forms">
<span id="s-built-in-forms"></span><span id="s-built-in-auth-forms"></span><span id="module-django.contrib.auth.forms"></span><span id="built-in-forms"></span><span id="built-in-auth-forms"></span><h3>ビルトインのフォーム<a class="headerlink" href="#module-django.contrib.auth.forms" title="Link to this heading">¶</a></h3>
<p>ビルトインのビューを使いたくないけれども、ビューの機能を再利用したいと考えている場合、認証システムが提供しているビルトインのフォームを使うことができます。ビルトインのフォームは <a class="reference internal" href="#module-django.contrib.auth.forms" title="django.contrib.auth.forms"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth.forms</span></code></a> にあります。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>ビルトインの認証フォームは、扱うユーザーモデルについて一定の前提に基づいて設計されています。なので、もし <a class="reference internal" href="customizing.html#auth-custom-user"><span class="std std-ref">独自のユーザーモデル</span></a> を使っている場合は、 認証システムに対して自分自身のフォームを定義する必要がある可能性があります。詳しくは、<a class="reference internal" href="customizing.html#custom-users-and-the-built-in-auth-forms"><span class="std std-ref">独自のユーザーモデルでビルトインの認証フォームを使用する</span></a> を参照してください。</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.forms.AdminPasswordChangeForm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">AdminPasswordChangeForm</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/forms.py#L555"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.forms.AdminPasswordChangeForm" title="Link to this definition">¶</a></dt>
<dd><p>管理インターフェースでユーザーのパスワードを変更するためのフォームで、<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.set_unusable_password" title="django.contrib.auth.models.User.set_unusable_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">unusable</span> <span class="pre">password</span></code></a> を設定する機能も含まれています。これにより、パスワードベースの認証でそのユーザーがログインできないようにブロックすることが可能です。</p>
<p>第 1 引数として <code class="docutils literal notranslate"><span class="pre">user</span></code> を取ります。</p>
<div class="versionchanged">
<span class="title">Changed in Django 5.1:</span> <p>パスワードベースの認証を無効化（または再有効化）するオプションが追加されました。</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.forms.AdminUserCreationForm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">AdminUserCreationForm</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/forms.py#L595"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.forms.AdminUserCreationForm" title="Link to this definition">¶</a></dt>
<dd><div class="versionadded">
<span class="title">New in Django 5.1.1.</span> </div>
<p>新しいユーザーを作成するために管理インターフェースで使用されるフォームで、<a class="reference internal" href="#django.contrib.auth.forms.UserCreationForm" title="django.contrib.auth.forms.UserCreationForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserCreationForm</span></code></a> を継承しています。</p>
<p>このフォームには、デフォルトで有効になっている追加の <code class="docutils literal notranslate"><span class="pre">usable_password</span></code> フィールドが含まれています。<code class="docutils literal notranslate"><span class="pre">usable_password</span></code> が有効な場合、<code class="docutils literal notranslate"><span class="pre">password1</span></code> と <code class="docutils literal notranslate"><span class="pre">password2</span></code> が空でなく一致していることを確認し、<a class="reference internal" href="passwords.html#django.contrib.auth.password_validation.validate_password" title="django.contrib.auth.password_validation.validate_password"><code class="xref py py-func docutils literal notranslate"><span class="pre">validate_password()</span></code></a> を使用してパスワードを検証し、<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.set_password" title="django.contrib.auth.models.User.set_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_password()</span></code></a> でユーザーのパスワードを設定します。<code class="docutils literal notranslate"><span class="pre">usable_password</span></code> が無効な場合、パスワードの検証は行われず、<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.set_unusable_password" title="django.contrib.auth.models.User.set_unusable_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_unusable_password()</span></code></a> を呼び出してパスワードベースの認証を無効にします。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.forms.AuthenticationForm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">AuthenticationForm</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/forms.py#L313"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.forms.AuthenticationForm" title="Link to this definition">¶</a></dt>
<dd><p>ユーザーログインのためのフォームです。</p>
<p>第 1 引数として <code class="docutils literal notranslate"><span class="pre">request</span></code> を取り、サブクラスで使えるようにフォームのインスタンス上に保持されます。</p>
<dl class="py method">
<dt class="sig sig-object py" id="django.contrib.auth.forms.AuthenticationForm.confirm_login_allowed">
<span class="sig-name descname"><span class="pre">confirm_login_allowed</span></span>(<em class="sig-param"><span class="n"><span class="pre">user</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/forms.py#L366"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.forms.AuthenticationForm.confirm_login_allowed" title="Link to this definition">¶</a></dt>
<dd><p>デフォルトでは、<code class="docutils literal notranslate"><span class="pre">AuthenticationForm</span></code> は <code class="docutils literal notranslate"><span class="pre">is_active</span></code> フラグが <code class="docutils literal notranslate"><span class="pre">False</span></code> にセットされたユーザを拒否します。どのユーザがログインできるかを決定する独自のポリシーによって、この挙動をオーバーライドできます。<code class="docutils literal notranslate"><span class="pre">AuthenticationForm</span></code> をサブクラス化した独自のフォームを使って、<code class="docutils literal notranslate"><span class="pre">confirm_login_allowed()</span></code> メソッドを上書きしてください。指定されたユーザがログインできない場合、このメソッドは <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValidationError</span></code></a> を投げます。</p>
<p>たとえば、&quot;active&quot; ステータスにかかわらず全てのユーザにログインを許可するには:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">AuthenticationForm</span>


<span class="k">class</span><span class="w"> </span><span class="nc">AuthenticationFormWithInactiveUsersOkay</span><span class="p">(</span><span class="n">AuthenticationForm</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">confirm_login_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>(この例では、非アクティブのユーザを許可する認証バックエンドの使用も必要となります。たとえば <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.backends.AllowAllUsersModelBackend" title="django.contrib.auth.backends.AllowAllUsersModelBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllowAllUsersModelBackend</span></code></a> などです。)</p>
<p>または、何人かのアクティブユーザのみにログインを許可するには、以下のようにします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PickyAuthenticationForm</span><span class="p">(</span><span class="n">AuthenticationForm</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">confirm_login_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s2">&quot;This account is inactive.&quot;</span><span class="p">),</span>
                <span class="n">code</span><span class="o">=</span><span class="s2">&quot;inactive&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Sorry, accounts starting with &#39;b&#39; aren&#39;t welcome here.&quot;</span><span class="p">),</span>
                <span class="n">code</span><span class="o">=</span><span class="s2">&quot;no_b_users&quot;</span><span class="p">,</span>
            <span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.forms.BaseUserCreationForm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">BaseUserCreationForm</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/forms.py#L221"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.forms.BaseUserCreationForm" title="Link to this definition">¶</a></dt>
<dd><p>新しいユーザを作成するための <a class="reference internal" href="../forms/modelforms.html#django.forms.ModelForm" title="django.forms.ModelForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelForm</span></code></a> です。これは、ユーザ作成フォームをカスタマイズする必要がある場合に推奨される基本クラスです。</p>
<p><code class="docutils literal notranslate"><span class="pre">username</span></code> (ユーザモデルより)、<code class="docutils literal notranslate"><span class="pre">password1</span></code>、<code class="docutils literal notranslate"><span class="pre">password2</span></code> という3つのフィールドがあります。<code class="docutils literal notranslate"><span class="pre">password1</span></code> と <code class="docutils literal notranslate"><span class="pre">password2</span></code> が一致するか確認し、<a class="reference internal" href="passwords.html#django.contrib.auth.password_validation.validate_password" title="django.contrib.auth.password_validation.validate_password"><code class="xref py py-func docutils literal notranslate"><span class="pre">validate_password()</span></code></a> を使ってパスワードを検証します。そして、<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.set_password" title="django.contrib.auth.models.User.set_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_password()</span></code></a> を使ってユーザのパスワードをセットします。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.forms.PasswordChangeForm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">PasswordChangeForm</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/forms.py#L520"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.forms.PasswordChangeForm" title="Link to this definition">¶</a></dt>
<dd><p>ユーザがパスワードを変更できるようにするフォームです。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.forms.PasswordResetForm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">PasswordResetForm</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/forms.py#L394"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.forms.PasswordResetForm" title="Link to this definition">¶</a></dt>
<dd><p>ユーザのパスワードリセットするための 1 回限りのリンクを生成してメール送信するためのフォームです。</p>
<dl class="py method">
<dt class="sig sig-object py" id="django.contrib.auth.forms.PasswordResetForm.send_mail">
<span class="sig-name descname"><span class="pre">send_mail</span></span>(<em class="sig-param"><span class="n"><span class="pre">subject_template_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">email_template_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">from_email</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_email</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">html_email_template_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/forms.py#L401"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.forms.PasswordResetForm.send_mail" title="Link to this definition">¶</a></dt>
<dd><p>引数を使用して <code class="docutils literal notranslate"><span class="pre">EmailMultiAlternatives</span></code> を送信します。このメソッドをオーバーライドして、ユーザーへのメール送信方法をカスタマイズできます。オーバーライドする場合は、メール送信エラーによって発生する可能性のある例外の処理に注意してください。</p>
<dl class="field-list simple">
<dt class="field-odd">パラメータ<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>subject_template_name</strong> -- 表題用のテンプレートです。</p></li>
<li><p><strong>email_template_name</strong> -- メール本文用のテンプレートです。</p></li>
<li><p><strong>context</strong> -- <code class="docutils literal notranslate"><span class="pre">subject_template</span></code>、<code class="docutils literal notranslate"><span class="pre">email_template</span></code>、<code class="docutils literal notranslate"><span class="pre">html_email_template</span></code> (<code class="docutils literal notranslate"><span class="pre">None</span></code> ではない場合のみ) に渡されるコンテキストです。</p></li>
<li><p><strong>from_email</strong> -- 送信者のメールです。</p></li>
<li><p><strong>to_email</strong> -- リクエストしてきたユーザのメールです。</p></li>
<li><p><strong>html_email_template_name</strong> -- HTML 本文用のテンプレートです; デフォルトは <code class="docutils literal notranslate"><span class="pre">None</span></code> で、この場合プレーンテキストのメールが送信されます。</p></li>
</ul>
</dd>
</dl>
<p>デフォルトでは、<code class="docutils literal notranslate"><span class="pre">save()</span></code> は <a class="reference internal" href="#django.contrib.auth.views.PasswordResetView" title="django.contrib.auth.views.PasswordResetView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetView</span></code></a> がメールコンテ キストに渡すのと同じ変数を持つ <code class="docutils literal notranslate"><span class="pre">context</span></code> を返します。</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.forms.SetPasswordForm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">SetPasswordForm</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/forms.py#L497"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.forms.SetPasswordForm" title="Link to this definition">¶</a></dt>
<dd><p>古いパスワードを入力しないでパスワードを変更できるようにするフォームです。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.forms.UserChangeForm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">UserChangeForm</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/forms.py#L283"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.forms.UserChangeForm" title="Link to this definition">¶</a></dt>
<dd><p>ユーザの情報とパーミッションを変更するために admin インターフェイスで使われるフォームです。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.forms.UserCreationForm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">UserCreationForm</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/forms.py#L262"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.forms.UserCreationForm" title="Link to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#django.contrib.auth.forms.BaseUserCreationForm" title="django.contrib.auth.forms.BaseUserCreationForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseUserCreationForm</span></code></a> を継承しています。似たようなユーザ名による混乱を防ぐために、このフォームでは大文字小文字が異なるだけのユーザ名は使用できません。</p>
</dd></dl>

</section>
<section id="s-authentication-data-in-templates">
<span id="authentication-data-in-templates"></span><h3>テンプレート内の認証データ<a class="headerlink" href="#authentication-data-in-templates" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../../ref/templates/api.html#django.template.RequestContext" title="django.template.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> を使うと、現在ログインしているユーザとパーミッションを <a class="reference internal" href="../../ref/templates/api.html"><span class="doc">テンプレート コンテキスト</span></a> 内で使えるようにできます。</p>
<div class="admonition-technicality admonition">
<p class="admonition-title">技術的には</p>
<p>技術的には、これらの変数は <a class="reference internal" href="../../ref/templates/api.html#django.template.RequestContext" title="django.template.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> を使い、<code class="docutils literal notranslate"><span class="pre">'django.contrib.auth.context_processors.auth'</span></code> コンテキストプロセッサを有効にしたときのみ使うことができます。これは、デフォルトで生成される設定ファイル内にあります。より詳しくは <a class="reference internal" href="../../ref/templates/api.html#subclassing-context-requestcontext"><span class="std std-ref">RequestContext のドキュメント</span></a> を参照してください。</p>
</div>
<section id="s-users">
<span id="users"></span><h4>ユーザ<a class="headerlink" href="#users" title="Link to this heading">¶</a></h4>
<p>テンプレート <a class="reference internal" href="../../ref/templates/api.html#django.template.RequestContext" title="django.template.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> をレンダリングするとき、現在ログイン中のユーザ (<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> インスタンスか <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.AnonymousUser" title="django.contrib.auth.models.AnonymousUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnonymousUser</span></code></a> のどちらか) はテンプレート変数 <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">user</span> <span class="pre">}}</span></code> 内に格納されます:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Welcome, <span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span>. Thanks for logging in.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Welcome, new user. Please log in.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">RequestContext</span></code> が使用されていない場合、このテンプレートコンテキスト変数は無効となります。</p>
</section>
<section id="s-permissions">
<span id="permissions"></span><h4>パーミッション<a class="headerlink" href="#permissions" title="Link to this heading">¶</a></h4>
<p>現在ログイン中のユーザのパーミッションは、テンプレート変数 <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">perms</span> <span class="pre">}}</span></code> 内に保持されています。 これは <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.context_processors.PermWrapper</span></code> のインスタンスで、パーミッションをテンプレートで使いやすくするための代替表現です。</p>
<p>真偽値として <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">perms</span> <span class="pre">}}</span></code> の単一属性ルックアップを評価することは <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.has_module_perms" title="django.contrib.auth.models.User.has_module_perms"><code class="xref py py-meth docutils literal notranslate"><span class="pre">User.has_module_perms()</span></code></a> の代替となります。たとえば、ログインしているユーザが <code class="docutils literal notranslate"><span class="pre">foo</span></code> アプリで何らかの権限を持っているかどうかを調べるには次のようにします:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">perms.foo</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>2段階の属性ルックアップを真偽値として評価することは <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.has_perm" title="django.contrib.auth.models.User.has_perm"><code class="xref py py-meth docutils literal notranslate"><span class="pre">User.has_perm()</span></code></a> の代替となります。たとえば、ログインしているユーザが <code class="docutils literal notranslate"><span class="pre">foo.add_vote</span></code> というパーミッションを持っているかどうかを調べるには、次のようにします:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">perms.foo.add_vote</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>以下は、テンプレートで権限をチェックする、より完全な例です:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">perms.foo</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You have permission to do something in the foo app.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">perms.foo.add_vote</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You can vote!<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">perms.foo.add_driving</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You can drive!<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You don&#39;t have permission to do anything in the foo app.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">in</span> <span class="pre">%}</span></code> ステートメントを使ってパーミッションをルックアップすることも可能です。例えば:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="s1">&#39;foo&#39;</span> <span class="k">in</span> <span class="nv">perms</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="s1">&#39;foo.add_vote&#39;</span> <span class="k">in</span> <span class="nv">perms</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>In lookup works, too.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="s-managing-users-in-the-admin">
<span id="s-auth-admin"></span><span id="managing-users-in-the-admin"></span><span id="auth-admin"></span><h2>admin 内でユーザを管理する<a class="headerlink" href="#managing-users-in-the-admin" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">django.contrib.admin</span></code> と <code class="docutils literal notranslate"><span class="pre">django.contrib.auth</span></code> の両方をインストールしていれば、admin でユーザ、グループおよびパーミッションを見たり管理することが簡単にできます。ユーザは通常の Django モデルと同じく作成や削除ができます。グループも作成することができ、パーミッションはユーザやグループにアサインできます。admin でのユーザー編集のログも保管および表示されます。</p>
<section id="s-id6">
<span id="id6"></span><h3>ユーザを作成する<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p>管理インデックスページの「Auth」セクションに「Users」へのリンクが表示されるはずです。「Add user」管理ページは標準の管理ページとは異なり、他のユーザーフィールドを編集する前にユーザー名とパスワードを選択する必要があります。また、このページでは、ユーザー名を選択してパスワードベースの認証を無効にすることもできます。</p>
<p>また、Django の admin サイトを使用してユーザアカウントを作成できるようにするには、ユーザを追加 <em>および</em> 変更する権限をユーザに与える必要があります (つまり &quot;Add user&quot; と &quot;Change user&quot; パーミッション)。あるアカウントにユーザの追加権限のみが与えられ変更権限がない場合、そのアカウントはユーザを追加できません。なぜなら、追加権限によってスーパーユーザを作成することができ、そのスーパーユーザを使って他のユーザーを変更することができてしまうからです。 そのため、Django はちょっとしたセキュリティ対策として、追加と変更の <em>両方</em> の権限を必要とするのです。</p>
<p>ユーザに与えるパーミッション管理の権限については、よく考える必要があります。たとえば非スーパーユーザにユーザ編集の権限を与えてしまうと、結果的に彼らにスーパーユーザと同じ能力を与えることになります。というのも、彼らはユーザ編集の権限によってユーザのパーミッションを昇格させることができるため、彼ら自身のパーミッションも昇格させられるのです！</p>
</section>
<section id="s-id7">
<span id="id7"></span><h3>パスワードを変更する<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p>ユーザーのパスワードは管理画面には表示されません（データベースにもそのままの形では保存されません）が、<a class="reference internal" href="passwords.html"><span class="doc">パスワード保存の詳細</span></a> が表示されます。この情報には、管理者がユーザーのパスワードを変更または解除できるパスワード変更フォームへのリンクも含まれています。</p>
</section>
</section>
</section>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../contents.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">Djangoの認証システムを使用する</a><ul>
<li><a class="reference internal" href="#user-objects"><code class="docutils literal notranslate"><span class="pre">User</span></code> オブジェクト</a><ul>
<li><a class="reference internal" href="#creating-users">ユーザを作成する</a></li>
<li><a class="reference internal" href="#creating-superusers">スーパーユーザを作成する</a></li>
<li><a class="reference internal" href="#changing-passwords">パスワードを変更する</a></li>
<li><a class="reference internal" href="#authenticating-users">ユーザを認証する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#permissions-and-authorization">権限と認可</a><ul>
<li><a class="reference internal" href="#default-permissions">デフォルトの権限</a></li>
<li><a class="reference internal" href="#groups">グループ</a></li>
<li><a class="reference internal" href="#programmatically-creating-permissions">プログラムによる権限の作成</a></li>
<li><a class="reference internal" href="#permission-caching">権限のキャッシュ</a></li>
<li><a class="reference internal" href="#proxy-models">プロキシモデル</a></li>
</ul>
</li>
<li><a class="reference internal" href="#authentication-in-web-requests">Web リクエストにおける認証</a><ul>
<li><a class="reference internal" href="#how-to-log-a-user-in">ユーザーをログインさせる方法</a><ul>
<li><a class="reference internal" href="#selecting-the-authentication-backend">認証バックエンドの選択</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-log-a-user-out">ユーザーをログアウトさせる方法</a></li>
<li><a class="reference internal" href="#limiting-access-to-logged-in-users">ログインしているユーザーにアクセスを制限する</a><ul>
<li><a class="reference internal" href="#the-raw-way">原理的な方法</a></li>
<li><a class="reference internal" href="#the-login-required-decorator"><code class="docutils literal notranslate"><span class="pre">login_required</span></code> デコレータ</a></li>
<li><a class="reference internal" href="#the-loginrequiredmixin-mixin"><code class="docutils literal notranslate"><span class="pre">LoginRequiredMixin</span></code> mixin</a></li>
<li><a class="reference internal" href="#the-login-not-required-decorator"><code class="docutils literal notranslate"><span class="pre">login_not_required</span></code> デコレータ</a></li>
<li><a class="reference internal" href="#limiting-access-to-logged-in-users-that-pass-a-test">テストをパスしたログイン済みユーザのアクセスを制限する</a></li>
<li><a class="reference internal" href="#the-permission-required-decorator"><code class="docutils literal notranslate"><span class="pre">permission_required</span></code> デコレータ</a></li>
<li><a class="reference internal" href="#the-permissionrequiredmixin-mixin"><code class="docutils literal notranslate"><span class="pre">PermissionRequiredMixin</span></code> ミックスイン</a></li>
</ul>
</li>
<li><a class="reference internal" href="#redirecting-unauthorized-requests-in-class-based-views">クラスベースのビューで、不正なリクエストをリダイレクトする</a><ul>
<li><a class="reference internal" href="#session-invalidation-on-password-change">パスワード変更時にセッションを無効化する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-django.contrib.auth.views">認証ビュー</a><ul>
<li><a class="reference internal" href="#using-the-views">ビューを使用する</a></li>
<li><a class="reference internal" href="#all-authentication-views">すべての認証ビュー</a></li>
</ul>
</li>
<li><a class="reference internal" href="#helper-functions">ヘルパー関数</a></li>
<li><a class="reference internal" href="#module-django.contrib.auth.forms">ビルトインのフォーム</a></li>
<li><a class="reference internal" href="#authentication-data-in-templates">テンプレート内の認証データ</a><ul>
<li><a class="reference internal" href="#users">ユーザ</a></li>
<li><a class="reference internal" href="#permissions">パーミッション</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#managing-users-in-the-admin">admin 内でユーザを管理する</a><ul>
<li><a class="reference internal" href="#id6">ユーザを作成する</a></li>
<li><a class="reference internal" href="#id7">パスワードを変更する</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="index.html"
                          title="前の章へ">Django でのユーザー認証</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="passwords.html"
                          title="次の章へ">Djangoにおけるパスワード管理</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/topics/auth/default.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">1月 22, 2025</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="index.html" title="Django でのユーザー認証">previous</a>
     |
    <a href="../index.html" title="Django を使う" accesskey="U">up</a>
   |
    <a href="passwords.html" title="Djangoにおけるパスワード管理">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>