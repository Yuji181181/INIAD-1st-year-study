<!DOCTYPE html>

<html lang="ja" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Djangoにおけるパスワード管理 &#8212; Django 5.1.6.dev20250122212402 ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=34bb78ad" />
    <link rel="stylesheet" type="text/css" href="../../_static/default.css?v=bf4d74af" />
    <script src="../../_static/documentation_options.js?v=d2885b0a"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=4755f45a"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="Django の認証方法のカスタマイズ" href="customizing.html" />
    <link rel="prev" title="Djangoの認証システムを使用する" href="default.html" />



 
<script src="../../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Django 5.1.6.dev20250122212402 ドキュメント</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Table of contents" href="../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../genindex.html">Index</a>  |
        <a title="Module index" href="../../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="default.html" title="Djangoの認証システムを使用する">previous</a>
     |
    <a href="../index.html" title="Django を使う" accesskey="U">up</a>
   |
    <a href="customizing.html" title="Django の認証方法のカスタマイズ">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="topics-auth-passwords">
            
  <section id="s-password-management-in-django">
<span id="password-management-in-django"></span><h1>Djangoにおけるパスワード管理<a class="headerlink" href="#password-management-in-django" title="Link to this heading">¶</a></h1>
<p>パスワード管理は一般的に、不必要に再発明されるべきではないものです。Djangoはユーザーのパスワードを管理するための安全で柔軟なツールセットを提供するよう努めています。このドキュメントでは、Djangoがパスワードを保存する方法、ストレージハッシュの設定方法、およびハッシュされたパスワードを扱ういくつかのユーティリティについて説明します。</p>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<p>ユーザーが強力なパスワードを使ったとしても、攻撃者が通信経路上において盗聴をおこなう可能性があります。パスワード (または他の機密データ) がプレーンな HTTP コネクションで送信されないように、 <a class="reference internal" href="../security.html#security-recommendation-ssl"><span class="std std-ref">HTTPS</span></a> を使用してください。なぜなら、HTTP はパスワードスニッフィングに対して脆弱であるからです。</p>
</div>
<section id="s-how-django-stores-passwords">
<span id="s-auth-password-storage"></span><span id="how-django-stores-passwords"></span><span id="auth-password-storage"></span><h2>Djangoのパスワード保存方法<a class="headerlink" href="#how-django-stores-passwords" title="Link to this heading">¶</a></h2>
<p>DjangoはデフォルトでPBKDF2を利用した、柔軟なパスワード保存システムを提供します。</p>
<p><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> オブジェクトの <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.password" title="django.contrib.auth.models.User.password"><code class="xref py py-attr docutils literal notranslate"><span class="pre">password</span></code></a> 属性は、次のような形式の文字列です。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;algorithm&gt;$&lt;iterations&gt;$&lt;salt&gt;$&lt;hash&gt;
</pre></div>
</div>
<p>これらはユーザーのパスワードを保存するためのコンポーネントで、ハッシュアルゴリズム、アルゴリズムのイテレーション回数（ワークファクター）、ランダムなソルト、そして結果のパスワードハッシュをドル記号($)で区切ったものです。このアルゴリズムは、Djangoが使用できる数多くの一方向ハッシュ、またはパスワード保存アルゴリズム（下記参照）の一つです。イテレーションはハッシュに対してアルゴリズムが実行された回数を表します。ソルトは使用されたランダムシードで、ハッシュは一方向ハッシュ関数の実行結果です。</p>
<p>デフォルトでは、Djangoは <a class="reference external" href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-132.pdf">NIST</a> が推奨するパスワードストレッチングメカニズムである <a class="reference external" href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a> アルゴリズムと SHA256 ハッシュを使用します。これはほとんどのユーザーに十分有効なはずです。非常に安全で、クラックするのに膨大な計算時間を必要とします。</p>
<p>ただし、要件に応じて、異なるアルゴリズムを使用することも、一部のセキュリティ状況に合わせてカスタムアルゴリズムを使用することもできます。繰り返しますが、ほとんどのユーザーはこれを行う必要はありません。よくわからない場合、おそらくそうしないほうが良いです。もしそうする場合は、こちらをお読みください:</p>
<p>Django は <a class="reference internal" href="../../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> 設定を参照して、使用するアルゴリズムを選択します。これは、この Django インストールがサポートしているハッシュアルゴリズムクラスのリストです。</p>
<p>パスワードの保存には、 Django は <a class="reference internal" href="../../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> の最初のハッシャーを使います。別のアルゴリズムで新しいパスワードを保存するには、 <a class="reference internal" href="../../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> にあなたの好きなアルゴリズムを最初に書いてください。</p>
<p>パスワードの検証のために、 Django は保存されたパスワードのアルゴリズム名と一致するハッ シャーをリストの中から探します。保存されたパスワードが <a class="reference internal" href="../../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> にないアルゴリズ ム名を持つ場合、それを検証しようとすると <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> が発生します。</p>
<p>デフォルトでの <a class="reference internal" href="../../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PASSWORD_HASHERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.Argon2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.BCryptSHA256PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.ScryptPasswordHasher&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>これは、Djangoは <a class="reference external" href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a> を使用して全てのパスワードを保存しますが、PBKDF2SHA1、 <a class="reference external" href="https://en.wikipedia.org/wiki/Argon2">argon2</a> 、および <a class="reference external" href="https://en.wikipedia.org/wiki/Bcrypt">bcrypt</a> で保存されたパスワードのチェックもサポートすることを意味しています。</p>
<p>次のいくつかのセクションでは、高度なユーザーがこの設定を変更するための一般的な方法について説明します。</p>
<section id="s-using-argon2-with-django">
<span id="s-argon2-usage"></span><span id="using-argon2-with-django"></span><span id="argon2-usage"></span><h3>Django で Argon2 を使う<a class="headerlink" href="#using-argon2-with-django" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Argon2">Argon2</a> は、次世代ハッシュアルゴリズムを選定するコミュニティ主催のオープンコンペティションである、2015年の <a class="reference external" href="https://www.password-hashing.net/">Password Hashing Competition</a> の優勝者です。カスタムハードウェアで計算しても、通常のCPUで計算するよりも有利にならないように設計されています。Argon2パスワードハッシュのデフォルトのバリアントはArgon2idです。</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Argon2">Argon2</a> はサードパーティのライブラリを必要とするため、 Django のデフォルトではありません。しかし、 Password Hashing Competition パネルでは、 Django がサポートしている他のアルゴリズムではなく、 Argon2 をすぐに使うことを推奨しています。</p>
<p>Argon2idをデフォルトのストレージアルゴリズムとして使用するには、以下のようにします:</p>
<ol class="arabic">
<li><p><a class="extlink-pypi reference external" href="https://pypi.org/project/argon2-cffi/">argon2-cffi</a> パッケージをインストールしてください。 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">django[argon2]</span></code> コマンドでインストールできます。このコマンドは、<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">argon2-cffi</span></code> と同等ですが、Djangoの <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> に記載されているバージョン要件が考慮されます。</p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> を変更して、<code class="docutils literal notranslate"><span class="pre">Argon2PasswordHasher</span></code> を最初にリストアップします。つまり、設定ファイルに下記のように書きます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PASSWORD_HASHERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;django.contrib.auth.hashers.Argon2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.BCryptSHA256PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.ScryptPasswordHasher&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Django に <a class="reference internal" href="#password-upgrades"><span class="std std-ref">パスワードのアップグレード</span></a> をさせる必要がある場合は、このリストにエントリを残すまたは追加してください。</p>
</li>
</ol>
</section>
<section id="s-using-bcrypt-with-django">
<span id="s-bcrypt-usage"></span><span id="using-bcrypt-with-django"></span><span id="bcrypt-usage"></span><h3>Django で <code class="docutils literal notranslate"><span class="pre">bcrypt</span></code> を使う<a class="headerlink" href="#using-bcrypt-with-django" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Bcrypt">Bcrypt</a> は一般的なパスワード保存アルゴリズムで、特にパスワードの長期保存用に設計されています。サードパーティのライブラリを使う必要があるため、 Django がデフォルトで使うものではありませんが、多くの人が使いたいでしょうから、 Django は最小限の労力で bcrypt をサポートしています。</p>
<p>Bcrypt をデフォルトのストレージアルゴリズムとして使用するには、以下のようにします:</p>
<ol class="arabic">
<li><p><a class="extlink-pypi reference external" href="https://pypi.org/project/bcrypt/">bcrypt</a> パッケージをインストールしてください。 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">django[bcrypt]</span></code> コマンドでインストールできます。このコマンドは、<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">bcrypt</span></code> と同等ですが、Djangoの <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> に記載されているバージョン要件が考慮されます。</p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> を変更して、<code class="docutils literal notranslate"><span class="pre">BCryptSHA256PasswordHasher</span></code> を最初にリストアップします。つまり、設定ファイルに下記のように書きます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PASSWORD_HASHERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;django.contrib.auth.hashers.BCryptSHA256PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.Argon2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.ScryptPasswordHasher&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Django に <a class="reference internal" href="#password-upgrades"><span class="std std-ref">パスワードのアップグレード</span></a> をさせる必要がある場合は、このリストにエントリを残すまたは追加してください。</p>
</li>
</ol>
<p>これで Django はデフォルトのストレージアルゴリズムとして Bcrypt を使うようになります。</p>
</section>
<section id="s-using-scrypt-with-django">
<span id="s-scrypt-usage"></span><span id="using-scrypt-with-django"></span><span id="scrypt-usage"></span><h3>Django で <code class="docutils literal notranslate"><span class="pre">scrypt</span></code> を使う<a class="headerlink" href="#using-scrypt-with-django" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Scrypt">scrypt</a> は、ブルートフォース攻撃を減速させるために設定されたイテレーション数を利用するという点で、PBKDF2やbcryptと似ています。しかし、PBKDF2とbcryptは多くのメモリを必要としないため、十分なリソースを持つ攻撃者は、攻撃プロセスを高速化するために大規模な並列攻撃を仕掛けることができます。 <a class="reference external" href="https://en.wikipedia.org/wiki/Scrypt">scrypt</a> は、攻撃者が使用できる並列処理の量を制限するために、他のパスワードベースの鍵導出関数と比較してより多くのメモリを使用するように特別に設計されています。</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Scrypt">scrypt</a> をデフォルトのストレージアルゴリズムとして使用するには、以下のようにします:</p>
<ol class="arabic">
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> を変更して、<code class="docutils literal notranslate"><span class="pre">ScryptPasswordHasher</span></code> を最初にリストアップします。つまり、設定ファイルに下記のように書きます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PASSWORD_HASHERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;django.contrib.auth.hashers.ScryptPasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.Argon2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.BCryptSHA256PasswordHasher&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Django に <a class="reference internal" href="#password-upgrades"><span class="std std-ref">パスワードのアップグレード</span></a> をさせる必要がある場合は、このリストにエントリを残すまたは追加してください。</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">scrypt</span></code> はOpenSSL 1.1+を必要とします。</p>
</div>
</section>
<section id="s-increasing-the-salt-entropy">
<span id="increasing-the-salt-entropy"></span><h3>ソルトのエントロピーを増加させる<a class="headerlink" href="#increasing-the-salt-entropy" title="Link to this heading">¶</a></h3>
<p>ほとんどのパスワードハッシュはレインボーテーブル攻撃から守るために、パスワードハッシュと一緒にソルトを含んでいます。ソルトはランダムな値であり、レインボーテーブルのサイズとコストを増加させます。現在は <code class="docutils literal notranslate"><span class="pre">BasePasswordHasher</span></code> の <code class="docutils literal notranslate"><span class="pre">salt_entropy</span></code> 値で128ビットに設定されています。計算機やストレージのコストが下がれば、この値を上げる必要があります。独自のパスワードハッシュを実装する場合、パスワードハッシュに希望するエントロピーレベルを使用するために、この値を自由に上書きできます。 <code class="docutils literal notranslate"><span class="pre">salt_entropy</span></code> の単位はビットです。</p>
<div class="admonition-implementation-detail admonition">
<p class="admonition-title">実装の詳細</p>
<p>ソルト値が保存されるメカニズムにより、 <code class="docutils literal notranslate"><span class="pre">salt_entropy</span></code> 値は実際には最小値です。たとえば、128という値は実際には131ビットのエントロピーを含むソルトを提供します。</p>
</div>
</section>
<section id="s-increasing-the-work-factor">
<span id="s-increasing-password-algorithm-work-factor"></span><span id="increasing-the-work-factor"></span><span id="increasing-password-algorithm-work-factor"></span><h3>work factor を増やす<a class="headerlink" href="#increasing-the-work-factor" title="Link to this heading">¶</a></h3>
<section id="s-pbkdf2-and-bcrypt">
<span id="pbkdf2-and-bcrypt"></span><h4>PBKDF2 と bcrypt<a class="headerlink" href="#pbkdf2-and-bcrypt" title="Link to this heading">¶</a></h4>
<p>PBKDF2 と bcrypt アルゴリズムは、ハッシュ化に何度もイテレート（ラウンド）します。これは意図的に攻撃者の速度を低下させ、ハッシュ化されたパスワードに対する攻撃を困難にします。しかし、計算能力が上がるにつれて、イテレーションの回数を増やす必要があります。私たちは妥当なデフォルト値を選びました（そして Django のリリー スごとに増やす予定です）が、セキュリティの必要性や利用可能な処理能力に応じて、上げたり下げたりすることもできます。そのためには、適切なアルゴリズムをサブクラス化し、 <code class="docutils literal notranslate"><span class="pre">iterations</span></code> パラメータをオーバーライドします (bcrypt hasher をサブクラス化するときは <code class="docutils literal notranslate"><span class="pre">rounds</span></code> パラメータを使います)。たとえば、デフォルトの PBKDF2 アルゴリズムで使用するイテレーションの回数を増やすには、次のようにします:</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.hashers.PBKDF2PasswordHasher</span></code> のサブクラスを作成します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.hashers</span><span class="w"> </span><span class="kn">import</span> <span class="n">PBKDF2PasswordHasher</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyPBKDF2PasswordHasher</span><span class="p">(</span><span class="n">PBKDF2PasswordHasher</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A subclass of PBKDF2PasswordHasher that uses 100 times more iterations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">iterations</span> <span class="o">=</span> <span class="n">PBKDF2PasswordHasher</span><span class="o">.</span><span class="n">iterations</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
<p>これをプロジェクトのどこかに保存します。たとえば、 <code class="docutils literal notranslate"><span class="pre">myproject/hashers.py</span></code> のようなファイルに保存します。</p>
</li>
<li><p>新しいハッシャーを <a class="reference internal" href="../../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> の最初のエントリーとして追加します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PASSWORD_HASHERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;myproject.hashers.MyPBKDF2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.Argon2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.BCryptSHA256PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.ScryptPasswordHasher&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ol>
<p>これで Django が PBKDF2 を使ってパスワードを保存する際に、より多くのイテレーションを使うようになります。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>bcrypt の <code class="docutils literal notranslate"><span class="pre">rounds</span></code> は対数の work factor で、たとえば 12 ラウンドは <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">**</span> <span class="pre">12</span></code> のイテレーションを意味します。</p>
</div>
</section>
<section id="s-argon2">
<span id="argon2"></span><h4>Argon2<a class="headerlink" href="#argon2" title="Link to this heading">¶</a></h4>
<p>Argon2には、カスタマイズ可能な以下の属性があります:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">time_cost</span></code> はハッシュ内のイテレートする回数をコントロールします。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">memory_cost</span></code> は、ハッシュの計算に必要なメモリのサイズをコントロールします。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parallelism</span></code> はハッシュの計算をいくつのCPUで並列化できるかを制御します。</p></li>
</ol>
<p>これらの属性のデフォルト値は、おそらく問題ないでしょう。パスワード・ハッシュが速すぎたり遅すぎたりすると判断した場合は、以下のように微調整できます:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parallelism</span></code> は、ハッシュを計算するスレッド数を指定します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">memory_cost</span></code> には、余裕を持ったメモリのKiBを選択してください。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time_cost</span></code> を調整し、パスワードのハッシュにかかる時間を測定します。 <code class="docutils literal notranslate"><span class="pre">time_cost</span></code> は、あなたにとって許容できる時間を選んでください。もし <code class="docutils literal notranslate"><span class="pre">time_cost</span></code> に 1 を指定しても許容できないほど遅い場合は、 <code class="docutils literal notranslate"><span class="pre">memory_cost</span></code> を下げてください。</p></li>
</ol>
<div class="admonition-memory-cost-interpretation admonition">
<p class="admonition-title"><code class="docutils literal notranslate"><span class="pre">memory_cost</span></code> の解釈</p>
<p>argon2 コマンドラインユーティリティと他のいくつかのライブラリは、 <code class="docutils literal notranslate"><span class="pre">memory_cost</span></code> パラメータを Django が使う値とは異なる解釈をします。変換は <code class="docutils literal notranslate"><span class="pre">memory_cost</span> <span class="pre">==</span> <span class="pre">2</span> <span class="pre">**</span> <span class="pre">memory_cost_commandline</span></code> で行います。</p>
</div>
</section>
<section id="s-scrypt">
<span id="scrypt"></span><h4><code class="docutils literal notranslate"><span class="pre">scrypt</span></code><a class="headerlink" href="#scrypt" title="Link to this heading">¶</a></h4>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Scrypt">scrypt</a> にはカスタマイズ可能な以下の属性があります:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">work_factor</span></code> はハッシュ内のイテレートする回数をコントロールします。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block_size</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parallelism</span></code> はいくつのスレッドが並列に実行されるかをコントロールします。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxmem</span></code> はハッシュの計算中に使用できるメモリの最大サイズを制限します。デフォルトは <code class="docutils literal notranslate"><span class="pre">0</span></code> で、OpenSSL ライブラリによるデフォルトの制限を意味します。</p></li>
</ol>
<p>私たちは合理的なデフォルト値を選びましたが、セキュリティのニーズや利用可能な処理能力に応じて、調整することもできます。</p>
<div class="admonition-estimating-memory-usage admonition">
<p class="admonition-title">メモリ使用量の見積もり</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Scrypt">scrypt</a> に必要な最小のメモリサイズは以下の通りです:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">work_factor</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">block_size</span> <span class="o">*</span> <span class="mi">64</span>
</pre></div>
</div>
<p>そのため、 <code class="docutils literal notranslate"><span class="pre">work_factor</span></code> や <code class="docutils literal notranslate"><span class="pre">block_size</span></code> の値を変更する際には <code class="docutils literal notranslate"><span class="pre">maxmem</span></code> を調整する必要があるかもしれません。</p>
</div>
</section>
</section>
<section id="s-password-upgrading">
<span id="s-password-upgrades"></span><span id="password-upgrading"></span><span id="password-upgrades"></span><h3>パスワードのアップグレード<a class="headerlink" href="#password-upgrading" title="Link to this heading">¶</a></h3>
<p>ユーザーがログインする際、もしそのパスワードが推奨されるアルゴリズム以外で保存されていた場合、Djangoは自動で推奨されるアルゴリズムへ更新します。つまり、Djangoの古いインストールでも、ユーザーのログイン時に自動的にセキュリティが強化され、新しい（より良い）保存アルゴリズムが開発されるたびに切り替えることができるということです。</p>
<p>ただし、Djangoは  <a class="reference internal" href="../../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> で定義されたアルゴリズムを使用するパスワードしか更新できません。そのため、新しいシステムにアップグレードする際には絶対にこのリストからエントリを「削除」しないでください。そうしないと、定義されてないアルゴリズムを使用するユーザーのパスワードを更新できなくなります。ハッシュされたパスワードは、PBKDF2のイテレーション回数、bcrypt のラウンド数、または argon2 の属性数を増やす (または減らす) と更新されます。</p>
<p>データベース上の全てのパスワードがデフォルトのハッシュアルゴリズムでエンコードされていない場合、デフォルト以外のアルゴリズムでエンコードされたパスワードを持つユーザーと、存在しないユーザー（デフォルトのハッシュアルゴリズムが実行されます）に対するログインリクエストにかかる時間の差に起因する、ユーザー列挙型タイミング攻撃に対して脆弱になる可能性があることに注意してください。 <a class="reference internal" href="#wrapping-password-hashers"><span class="std std-ref">古いパスワードハッシュの更新</span></a> によりこれを軽減できます。</p>
</section>
<section id="s-password-upgrading-without-requiring-a-login">
<span id="s-wrapping-password-hashers"></span><span id="password-upgrading-without-requiring-a-login"></span><span id="wrapping-password-hashers"></span><h3>ログインを必要としないパスワードアップグレード<a class="headerlink" href="#password-upgrading-without-requiring-a-login" title="Link to this heading">¶</a></h3>
<p>既存のデータベースが MD5 のような古くて弱いハッシュを使用している場合、ユーザがログインしたときにハッシュのアップグレードが行われるのを待つのではなく、自分でハッシュをアップグレードしたいと思うかもしれません (ユーザがサイトに戻ってこない場合は、アップグレードが行われないかもしれません)。この場合、「ラップ」パスワードハッシュを使用できます。</p>
<p>この例では、PBKDF2(MD5(password)) を使用するように MD5 ハッシュのコレクションをマイグレーションし、ユーザがログイン時に正しいパスワードを入力したかどうかをチェックするために、対応するパスワードハッシュを追加します。組み込みの <code class="docutils literal notranslate"><span class="pre">User</span></code> モデルを使用しており、プロジェクトには <code class="docutils literal notranslate"><span class="pre">accounts</span></code> アプリがあると仮定します。このパターンをカスタマイズすることで、任意のアルゴリズムやカスタムユーザモデルで動作させることができます。</p>
<p>まず、独自のハッシャーを追加します:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">accounts/hashers.py</span></code></span><a class="headerlink" href="#id4" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.hashers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">PBKDF2PasswordHasher</span><span class="p">,</span>
    <span class="n">MD5PasswordHasher</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PBKDF2WrappedMD5PasswordHasher</span><span class="p">(</span><span class="n">PBKDF2PasswordHasher</span><span class="p">):</span>
    <span class="n">algorithm</span> <span class="o">=</span> <span class="s2">&quot;pbkdf2_wrapped_md5&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encode_md5_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">md5_hash</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">md5_hash</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">iterations</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">md5_hash</span> <span class="o">=</span> <span class="n">MD5PasswordHasher</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">salt</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_md5_hash</span><span class="p">(</span><span class="n">md5_hash</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">iterations</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>データマイグレーションは次のようになります:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">accounts/migrations/0002_migrate_md5_passwords.py</span></code></span><a class="headerlink" href="#id5" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">migrations</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..hashers</span><span class="w"> </span><span class="kn">import</span> <span class="n">PBKDF2WrappedMD5PasswordHasher</span>


<span class="k">def</span><span class="w"> </span><span class="nf">forwards_func</span><span class="p">(</span><span class="n">apps</span><span class="p">,</span> <span class="n">schema_editor</span><span class="p">):</span>
    <span class="n">User</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">,</span> <span class="s2">&quot;User&quot;</span><span class="p">)</span>
    <span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">password__startswith</span><span class="o">=</span><span class="s2">&quot;md5$&quot;</span><span class="p">)</span>
    <span class="n">hasher</span> <span class="o">=</span> <span class="n">PBKDF2WrappedMD5PasswordHasher</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="n">algorithm</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">md5_hash</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">password</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">hasher</span><span class="o">.</span><span class="n">encode_md5_hash</span><span class="p">(</span><span class="n">md5_hash</span><span class="p">,</span> <span class="n">salt</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">])</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Migration</span><span class="p">(</span><span class="n">migrations</span><span class="o">.</span><span class="n">Migration</span><span class="p">):</span>
    <span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;accounts&quot;</span><span class="p">,</span> <span class="s2">&quot;0001_initial&quot;</span><span class="p">),</span>
        <span class="c1"># replace this with the latest migration in contrib.auth</span>
        <span class="p">(</span><span class="s2">&quot;auth&quot;</span><span class="p">,</span> <span class="s2">&quot;####_migration_name&quot;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">migrations</span><span class="o">.</span><span class="n">RunPython</span><span class="p">(</span><span class="n">forwards_func</span><span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
<p>このマイグレーションには、ハードウェアの速度にもよりますが、数千人のユーザーで数分かかることに注意してください。</p>
<p>最後に <a class="reference internal" href="../../ref/settings.html#std-setting-PASSWORD_HASHERS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code></a> 設定を追加します:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">mysite/settings.py</span></code></span><a class="headerlink" href="#id6" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PASSWORD_HASHERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;accounts.hashers.PBKDF2WrappedMD5PasswordHasher&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<p>あなたのサイトが使用している他のハッシャーもこのリストに含めてください。</p>
</section>
<section id="s-included-hashers">
<span id="s-auth-included-hashers"></span><span id="included-hashers"></span><span id="auth-included-hashers"></span><h3>Django に含まれるハッシャー<a class="headerlink" href="#included-hashers" title="Link to this heading">¶</a></h3>
<p>Django に含まれるハッシャーの全リストは以下の通りです:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.Argon2PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.BCryptSHA256PasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.BCryptPasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.ScryptPasswordHasher&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.contrib.auth.hashers.MD5PasswordHasher&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>対応するアルゴリズム名は以下の通りです:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pbkdf2_sha256</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pbkdf2_sha1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">argon2</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bcrypt_sha256</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bcrypt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scrypt</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">md5</span></code></p></li>
</ul>
</section>
<section id="s-writing-your-own-hasher">
<span id="s-write-your-own-password-hasher"></span><span id="writing-your-own-hasher"></span><span id="write-your-own-password-hasher"></span><h3>独自のハッシャーを書く<a class="headerlink" href="#writing-your-own-hasher" title="Link to this heading">¶</a></h3>
<p>イテレーション回数のようなワークファクターを含む独自のパスワードハッシャーを書く場合は、 <code class="docutils literal notranslate"><span class="pre">harden_runtime(self,</span> <span class="pre">password,</span> <span class="pre">encoded)</span></code> メソッドを実装して、 <code class="docutils literal notranslate"><span class="pre">エンコードされた</span></code> パスワードに指定されたワークファクターとハッシャーのデフォルトのワークファクターとの間のランタイムギャップを埋める必要があります。これにより、古いイテレーション数でエンコードされたパスワードを持つユーザーと存在しないユーザー（デフォルトのハッシャーのデフォルトのイテレーション数で実行される）のログイン要求の違いによるユーザー列挙タイミング攻撃を防ぐことができます。</p>
<p>PBKDF2 を例にとると、 <code class="docutils literal notranslate"><span class="pre">encoded</span></code> が 20,000 回のイテレーションを含み、ハッシャーのデフォルトの <code class="docutils literal notranslate"><span class="pre">iterations</span></code> が 30,000 回である場合、このメソッドは <code class="docutils literal notranslate"><span class="pre">password</span></code> を PBKDF2 のさらに 10,000 回のイテレーションに通す必要があります。</p>
<p>もしあなたのハッシャーがワークファクターを持っていない場合は、このメソッドを何もしない操作 (<code class="docutils literal notranslate"><span class="pre">pass</span></code>) として実装してください。</p>
</section>
</section>
<section id="s-module-django.contrib.auth.hashers">
<span id="s-manually-managing-a-user-s-password"></span><span id="module-django.contrib.auth.hashers"></span><span id="manually-managing-a-user-s-password"></span><h2>ユーザーのパスワードを手動で管理する<a class="headerlink" href="#module-django.contrib.auth.hashers" title="Link to this heading">¶</a></h2>
<p><a class="reference internal" href="#module-django.contrib.auth.hashers" title="django.contrib.auth.hashers"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth.hashers</span></code></a> モジュールは、ハッシュ化されたパスワードを作成・検証するための関数群を提供します。これらは <code class="docutils literal notranslate"><span class="pre">User</span></code> モデルとは独立して使用できます。</p>
<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.hashers.check_password">
<span class="sig-name descname"><span class="pre">check_password</span></span>(<em class="sig-param"><span class="n"><span class="pre">password</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoded</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">setter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preferred</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'default'</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/hashers.py#L72"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.hashers.check_password" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.hashers.acheck_password">
<span class="sig-name descname"><span class="pre">acheck_password</span></span>(<em class="sig-param"><span class="n"><span class="pre">password</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoded</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asetter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preferred</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'default'</span></span></em>)<a class="headerlink" href="#django.contrib.auth.hashers.acheck_password" title="Link to this definition">¶</a></dt>
<dd><p><em>非同期バージョン</em>: <code class="docutils literal notranslate"><span class="pre">acheck_password()</span></code></p>
<p>もしプレーンテキストのパスワードとデータベースのハッシュ化されたパスワードを比較して手動でユーザーを認証したい場合は、 <a class="reference internal" href="#django.contrib.auth.hashers.check_password" title="django.contrib.auth.hashers.check_password"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_password()</span></code></a> という便利な関数を使用してください。この関数は2つの必須引数を取ります。チェックするプレーンテキストのパスワードと、照合するデータベースの <code class="docutils literal notranslate"><span class="pre">password</span></code> フィールドの完全な値です。これらが一致すれば <code class="docutils literal notranslate"><span class="pre">True</span></code> を返し、一致しなければ <code class="docutils literal notranslate"><span class="pre">False</span></code> を返します。オプションとして、呼び出し可能な <code class="docutils literal notranslate"><span class="pre">setter</span></code> を渡すことができます。この <code class="docutils literal notranslate"><span class="pre">setter</span></code> はパスワードを受け取り、再生成の必要がある際に呼び出されます。また、デフォルトのハッシュアルゴリズム (<code class="docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code> 設定の最初のエントリ) を使用したくない場合は、 <code class="docutils literal notranslate"><span class="pre">preferred</span></code> を渡せばハッシュアルゴリズムを変更できます。各ハッシャーのアルゴリズム名については <a class="reference internal" href="#auth-included-hashers"><span class="std std-ref">Django に含まれるハッシャー</span></a> を参照してください。</p>
<div class="versionchanged">
<span class="title">Changed in Django 5.0:</span> <p><code class="docutils literal notranslate"><span class="pre">acheck_password()</span></code> メソッドが追加されました。</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.hashers.make_password">
<span class="sig-name descname"><span class="pre">make_password</span></span>(<em class="sig-param"><span class="n"><span class="pre">password</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">salt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hasher</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'default'</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/hashers.py#L94"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.hashers.make_password" title="Link to this definition">¶</a></dt>
<dd><p>このアプリケーションで使用する形式でハッシュ化されたパスワードを作成します。必須引数は1つで、プレーンテキスト(文字列またはバイト)のパスワードです。オプションとして、デフォルトを使用したくない場合に使用するソルトとハッシュアルゴリズムを指定できます (<code class="docutils literal notranslate"><span class="pre">PASSWORD_HASHERS</span></code> 設定の最初のエントリ)。各ハッシャーのアルゴリズム名については <a class="reference internal" href="#auth-included-hashers"><span class="std std-ref">Django に含まれるハッシャー</span></a> を参照してください。password 引数に <code class="docutils literal notranslate"><span class="pre">None</span></code> を指定すると、使用できないパスワードが返されます (<a class="reference internal" href="#django.contrib.auth.hashers.check_password" title="django.contrib.auth.hashers.check_password"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_password()</span></code></a> では決して受け付けられません)。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.hashers.is_password_usable">
<span class="sig-name descname"><span class="pre">is_password_usable</span></span>(<em class="sig-param"><span class="n"><span class="pre">encoded_password</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/hashers.py#L28"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.hashers.is_password_usable" title="Link to this definition">¶</a></dt>
<dd><p>パスワードが <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.set_unusable_password" title="django.contrib.auth.models.User.set_unusable_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">User.set_unusable_password()</span></code></a> の結果の場合は <code class="docutils literal notranslate"><span class="pre">False</span></code> を返します。</p>
</dd></dl>

</section>
<section id="s-module-django.contrib.auth.password_validation">
<span id="s-id3"></span><span id="s-password-validation"></span><span id="module-django.contrib.auth.password_validation"></span><span id="id3"></span><span id="password-validation"></span><h2>パスワードの妥当性検証<a class="headerlink" href="#module-django.contrib.auth.password_validation" title="Link to this heading">¶</a></h2>
<p>ユーザーは、良くないパスワードを選択することがあります。この問題を軽減するために、Djangoはプラガブルなパスワードの妥当性検証を提供しています。複数のパスワードの妥当性検証を同時に設定できます。いくつかのバリデータは Django に含まれていますが、自分で書くこともできます。</p>
<p>各パスワードのバリデータは、ユーザーに要件の説明文を与え、指定されたパスワードの妥当性検証を行い、要件を満たしていない場合はエラーメッセージを返し、オプションでユーザのパスワードが変更されたときに通知するコールバックを定義します。バリデータは、動作を細かく指定するためのオプション設定を持つこともできます。</p>
<p>妥当性検証は <a class="reference internal" href="../../ref/settings.html#std-setting-AUTH_PASSWORD_VALIDATORS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTH_PASSWORD_VALIDATORS</span></code></a> の設定で管理されます。設定のデフォルトは、空のリストになってます。これは、ひとつもバリデータが適用されていないことを意味しています。 <a class="reference internal" href="../../ref/django-admin.html#django-admin-startproject"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">startproject</span></code></a> を使用して作られた新しいプロジェクトでは、バリデータのセットはデフォルトで有効になっています。</p>
<p>デフォルトでは、バリデータはパスワードをリセットまたは変更するフォームと <a class="reference internal" href="../../ref/django-admin.html#django-admin-createsuperuser"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">createsuperuser</span></code></a> と <a class="reference internal" href="../../ref/django-admin.html#django-admin-changepassword"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">changepassword</span></code></a> 管理コマンドで使用されます。たとえば、 <code class="docutils literal notranslate"><span class="pre">User.objects.create_user()</span></code> や <code class="docutils literal notranslate"><span class="pre">create_superuser()</span></code> のようなモデルレベルではバリデータは適用されません。なぜなら、このレベルで Django とやりとりするのはユーザ ではなく開発者であると想定しているからであり、また、モデルのバリデーションがモデル作成の一環として自動的に実行されるわけではないからです。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>パスワードの妥当性検証は多くの脆弱なパスワードの形式が使用されることを防ぎます。しかしながら、パスワードが全てのバリデータを通過するという事実は、強力なパスワードであることを保証するわけではありません。最も先進的なパスワードのバリデータでさえ検出できない、パスワードを弱めうる多くの要素があります。</p>
</div>
<section id="s-enabling-password-validation">
<span id="enabling-password-validation"></span><h3>パスワードの妥当性検証を有効にする<a class="headerlink" href="#enabling-password-validation" title="Link to this heading">¶</a></h3>
<p>パスワードの妥当性検証は <a class="reference internal" href="../../ref/settings.html#std-setting-AUTH_PASSWORD_VALIDATORS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTH_PASSWORD_VALIDATORS</span></code></a> で構成されます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AUTH_PASSWORD_VALIDATORS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;django.contrib.auth.password_validation.MinimumLengthValidator&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;min_length&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;django.contrib.auth.password_validation.CommonPasswordValidator&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;NAME&quot;</span><span class="p">:</span> <span class="s2">&quot;django.contrib.auth.password_validation.NumericPasswordValidator&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
<p>本例では組み込みの4つ全てのバリデータを有効化します。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UserAttributeSimilarityValidator</span></code> は、パスワードとユーザの属性との類似性をチェックします。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MinimumLengthValidator</span></code> は、パスワードが最小の長さを満たしているかをチェックします。このバリデータはカスタムオプションで構成されます。現在の設定では、最小長さは、デフォルトの8文字ではなく、9文字になっています。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CommonPasswordValidator</span></code> は、一般的なパスワードのリストにそのパスワードが入っていないかをチェックします。デフォルトでは、組み込まれた20,000個のパスワードのリストと比較します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NumericPasswordValidator</span></code> は、パスワードが全体的に数値ではないかをチェックします。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">UserAttributeSimilarityValidator</span></code> と <code class="docutils literal notranslate"><span class="pre">CommonPasswordValidator</span></code> については、たとえばこの例ではデフォルトの設定を使用しています。 <code class="docutils literal notranslate"><span class="pre">NumericPasswordValidator</span></code> には設定はありません。</p>
<p>パスワードバリデーションのヘルプテキストとエラーは、常に <a class="reference internal" href="../../ref/settings.html#std-setting-AUTH_PASSWORD_VALIDATORS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTH_PASSWORD_VALIDATORS</span></code></a> に記載されているソート順に返されます。</p>
</section>
<section id="s-included-validators">
<span id="included-validators"></span><h3>Django に含まれるバリデータ<a class="headerlink" href="#included-validators" title="Link to this heading">¶</a></h3>
<p>Django には 4 つのバリデータがあります:</p>
<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.password_validation.MinimumLengthValidator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">MinimumLengthValidator</span></span>(<em class="sig-param"><span class="n"><span class="pre">min_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/password_validation.py#L99"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.password_validation.MinimumLengthValidator" title="Link to this definition">¶</a></dt>
<dd><p>パスワードが最小限の長さであることを検証します。最小の長さは <code class="docutils literal notranslate"><span class="pre">min_length</span></code> パラメータでカスタマイズできます。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.password_validation.UserAttributeSimilarityValidator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">UserAttributeSimilarityValidator</span></span>(<em class="sig-param"><span class="n"><span class="pre">user_attributes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">DEFAULT_USER_ATTRIBUTES</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_similarity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.7</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/password_validation.py#L159"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.password_validation.UserAttributeSimilarityValidator" title="Link to this definition">¶</a></dt>
<dd><p>パスワードがユーザの特定の属性と十分に異なることを検証します。</p>
<p>パラメータ <code class="docutils literal notranslate"><span class="pre">user_attributes</span></code> は、比較するユーザー属性の名前のイテラブルでなければなりません。この引数が指定されない場合、デフォルトが使用されます。<code class="docutils literal notranslate"><span class="pre">'username',</span> <span class="pre">'first_name',</span> <span class="pre">'last_name',</span> <span class="pre">'email'</span></code> です。存在しない属性は無視されます。</p>
<p>パスワードの最大類似度は <code class="docutils literal notranslate"><span class="pre">max_similarity</span></code> パラメータで 0.1 から 1.0 の範囲で指定できます。これは <a class="reference external" href="https://docs.python.org/3/library/difflib.html#difflib.SequenceMatcher.quick_ratio" title="(in Python v3.13)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">difflib.SequenceMatcher.quick_ratio()</span></code></a> の結果と比較されます。0.1の値を指定すると、 <code class="docutils literal notranslate"><span class="pre">user_attributes</span></code> と大幅に異なるパスワード以外は拒否され、1.0の値を指定すると、属性の値と同じパスワードのみが拒否されます。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.password_validation.CommonPasswordValidator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">CommonPasswordValidator</span></span>(<em class="sig-param"><span class="n"><span class="pre">password_list_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">DEFAULT_PASSWORD_LIST_PATH</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/password_validation.py#L217"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.password_validation.CommonPasswordValidator" title="Link to this definition">¶</a></dt>
<dd><p>パスワードが一般的なパスワードでないことを検証します。これはパスワードを小文字に変換し(大文字小文字を区別しない比較を行うため)、 <a class="reference external" href="https://gist.github.com/roycewilliams/226886fd01572964e1431ac8afc999ce">Royce Williams</a> によって作成された20,000の一般的なパスワードのリストと照合します。</p>
<p><code class="docutils literal notranslate"><span class="pre">password_list_path</span></code> には一般的なパスワードのカスタムファイルのパスを指定できます。このファイルには1行につき1つの小文字のパスワードが含まれている必要があり、プレーンテキストまたはgzip圧縮されている必要があります。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="django.contrib.auth.password_validation.NumericPasswordValidator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">NumericPasswordValidator</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/password_validation.py#L253"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.password_validation.NumericPasswordValidator" title="Link to this definition">¶</a></dt>
<dd><p>パスワードが数字のみでないことを確認します。</p>
</dd></dl>

</section>
<section id="s-integrating-validation">
<span id="integrating-validation"></span><h3>バリデーションの統合<a class="headerlink" href="#integrating-validation" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.password_validation</span></code> には、独自のフォームや他のコードから呼び出して パスワード認証を統合できる関数がいくつかあります。これは、たとえばパスワードの設定にカスタムフォームを使ったり、 パスワードの設定を許可する API 呼び出しがある場合に便利です。</p>
<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.password_validation.validate_password">
<span class="sig-name descname"><span class="pre">validate_password</span></span>(<em class="sig-param"><span class="n"><span class="pre">password</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">password_validators</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/password_validation.py#L41"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.password_validation.validate_password" title="Link to this definition">¶</a></dt>
<dd><p>パスワードを検証します。すべてのバリデータがパスワードを有効と判定した場合、 <code class="docutils literal notranslate"><span class="pre">None</span></code> を返します。1つ以上のバリデータがパスワードを拒否した場合、バリデータからのすべてのエラーメッセージと共に <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValidationError</span></code></a> を発生させます。</p>
<p>もし <code class="docutils literal notranslate"><span class="pre">user</span></code> オブジェクトを指定しなかった場合、バリデータによってはバリデーションを実行できず、任意のパスワードを受け取ってしまう可能性があります。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.password_validation.password_changed">
<span class="sig-name descname"><span class="pre">password_changed</span></span>(<em class="sig-param"><span class="n"><span class="pre">password</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">password_validators</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/password_validation.py#L60"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.password_validation.password_changed" title="Link to this definition">¶</a></dt>
<dd><p>パスワードが変更されたことをすべてのバリデータに通知します。これは、パスワードの再利用を防止するバリデータなどで使用します。パスワードの変更に成功したら、これを呼び出さなければなりません。</p>
<p><a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser" title="django.contrib.auth.models.AbstractBaseUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractBaseUser</span></code></a> のサブクラスでは、パスワードフィールドは <a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser.set_password" title="django.contrib.auth.models.AbstractBaseUser.set_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_password()</span></code></a> を呼び出すと &quot;dirty&quot; としてマークされ、ユーザが保存された後に <code class="docutils literal notranslate"><span class="pre">password_changed()</span></code> が呼び出されます。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.password_validation.password_validators_help_texts">
<span class="sig-name descname"><span class="pre">password_validators_help_texts</span></span>(<em class="sig-param"><span class="n"><span class="pre">password_validators</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/password_validation.py#L72"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.password_validation.password_validators_help_texts" title="Link to this definition">¶</a></dt>
<dd><p>すべてのバリデータのヘルプテキストの一覧を返します。これらは、パスワードの条件をユーザに説明するものです。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.password_validation.password_validators_help_text_html">
<span class="sig-name descname"><span class="pre">password_validators_help_text_html</span></span>(<em class="sig-param"><span class="n"><span class="pre">password_validators</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>)<a class="headerlink" href="#django.contrib.auth.password_validation.password_validators_help_text_html" title="Link to this definition">¶</a></dt>
<dd><p>すべてのヘルプテキストを <code class="docutils literal notranslate"><span class="pre">&lt;ul&gt;</span></code> で囲んだ HTML 文字列を返します。これはフォームにパスワードバリデーションを追加する際に便利です。フォームフィールドの <code class="docutils literal notranslate"><span class="pre">help_text</span></code> パラメータに直接出力を渡すことができるからです。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="django.contrib.auth.password_validation.get_password_validators">
<span class="sig-name descname"><span class="pre">get_password_validators</span></span>(<em class="sig-param"><span class="n"><span class="pre">validator_config</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/contrib/auth/password_validation.py#L25"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.contrib.auth.password_validation.get_password_validators" title="Link to this definition">¶</a></dt>
<dd><p>パラメータ <code class="docutils literal notranslate"><span class="pre">validator_config</span></code> に基づいてバリデータオブジェクトのセットを返します。デフォルトでは、すべての関数は <a class="reference internal" href="../../ref/settings.html#std-setting-AUTH_PASSWORD_VALIDATORS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTH_PASSWORD_VALIDATORS</span></code></a> で定義されたバリデータを使用しますが、この関数を別のバリデータセットで呼び出して、その結果を他の関数の <code class="docutils literal notranslate"><span class="pre">password_validators</span></code> パラメータに渡すことで、カスタムバリデータセットを代わりに使用できます。これは、たいていの場面で使用する典型的なバリデータセットがありながら、 特別な場面で独自のバリデータセットが必要になる場合に便利です。常に同じバリデータを使う場合は、この関数を使う必要はありません。 <a class="reference internal" href="../../ref/settings.html#std-setting-AUTH_PASSWORD_VALIDATORS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTH_PASSWORD_VALIDATORS</span></code></a> の設定がデフォルトで使われるからです。</p>
<p><code class="docutils literal notranslate"><span class="pre">validator_config</span></code> の構造は <a class="reference internal" href="../../ref/settings.html#std-setting-AUTH_PASSWORD_VALIDATORS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTH_PASSWORD_VALIDATORS</span></code></a> の構造と同じです。この関数の戻り値は上記の関数の <code class="docutils literal notranslate"><span class="pre">password_validators</span></code> パラメータに渡すことができます。</p>
</dd></dl>

<p>これらの関数にパスワードが渡される場合は、ハッシュ化されたパスワードではなく、常に平文のパスワードでなければならないことに注意してください。</p>
</section>
<section id="s-writing-your-own-validator">
<span id="writing-your-own-validator"></span><h3>独自のバリデータを書く<a class="headerlink" href="#writing-your-own-validator" title="Link to this heading">¶</a></h3>
<p>Django の組み込みバリデータでは不十分な場合、自分でパスワードバリデータ を書くことができます。バリデータはとても小さなインタフェースを持っています。2 つのメソッドを実装しなければなりません:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">validate(self,</span> <span class="pre">password,</span> <span class="pre">user=None)</span></code>: パスワードを検証します。パスワードが有効な場合は <code class="docutils literal notranslate"><span class="pre">None</span></code> を返し、パスワードが無効な場合はエラーメッセージと共に <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValidationError</span></code></a> を発生させます。もし <code class="docutils literal notranslate"><span class="pre">user</span></code> が <code class="docutils literal notranslate"><span class="pre">None</span></code> であった場合、バリデータが実行できないので、 <code class="docutils literal notranslate"><span class="pre">None</span></code> を返してエラーにならないようにしてください。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_help_text()</span></code>: ユーザに要件を説明するためのヘルプテキストを提供します。</p></li>
</ul>
<p>バリデータの <a class="reference internal" href="../../ref/settings.html#std-setting-AUTH_PASSWORD_VALIDATORS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTH_PASSWORD_VALIDATORS</span></code></a> の <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> にあるすべての項目がコンストラクタに渡されます。コンストラクタの引数にはデフォルト値を指定します。</p>
<p>以下は、1つのオプション設定を持つ基本的なバリデータの例です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.core.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext</span> <span class="k">as</span> <span class="n">_</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MinimumLengthValidator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_length</span> <span class="o">=</span> <span class="n">min_length</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_length</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s2">&quot;This password must contain at least </span><span class="si">%(min_length)d</span><span class="s2"> characters.&quot;</span><span class="p">),</span>
                <span class="n">code</span><span class="o">=</span><span class="s2">&quot;password_too_short&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;min_length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_length</span><span class="p">},</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_help_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_</span><span class="p">(</span>
            <span class="s2">&quot;Your password must contain at least </span><span class="si">%(min_length)d</span><span class="s2"> characters.&quot;</span>
            <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;min_length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_length</span><span class="p">}</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>パスワードの変更が成功した後に呼び出される <code class="docutils literal notranslate"><span class="pre">password_changed(password,</span> <span class="pre">user=None</span></code>) を実装することもできます。これはたとえばパスワードの再利用を防ぐために使用できます。しかし、ユーザーの以前のパスワードを保存することにした場合、決して平文で保存してはいけません。</p>
</section>
</section>
</section>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../contents.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">Djangoにおけるパスワード管理</a><ul>
<li><a class="reference internal" href="#how-django-stores-passwords">Djangoのパスワード保存方法</a><ul>
<li><a class="reference internal" href="#using-argon2-with-django">Django で Argon2 を使う</a></li>
<li><a class="reference internal" href="#using-bcrypt-with-django">Django で <code class="docutils literal notranslate"><span class="pre">bcrypt</span></code> を使う</a></li>
<li><a class="reference internal" href="#using-scrypt-with-django">Django で <code class="docutils literal notranslate"><span class="pre">scrypt</span></code> を使う</a></li>
<li><a class="reference internal" href="#increasing-the-salt-entropy">ソルトのエントロピーを増加させる</a></li>
<li><a class="reference internal" href="#increasing-the-work-factor">work factor を増やす</a><ul>
<li><a class="reference internal" href="#pbkdf2-and-bcrypt">PBKDF2 と bcrypt</a></li>
<li><a class="reference internal" href="#argon2">Argon2</a></li>
<li><a class="reference internal" href="#scrypt"><code class="docutils literal notranslate"><span class="pre">scrypt</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#password-upgrading">パスワードのアップグレード</a></li>
<li><a class="reference internal" href="#password-upgrading-without-requiring-a-login">ログインを必要としないパスワードアップグレード</a></li>
<li><a class="reference internal" href="#included-hashers">Django に含まれるハッシャー</a></li>
<li><a class="reference internal" href="#writing-your-own-hasher">独自のハッシャーを書く</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-django.contrib.auth.hashers">ユーザーのパスワードを手動で管理する</a></li>
<li><a class="reference internal" href="#module-django.contrib.auth.password_validation">パスワードの妥当性検証</a><ul>
<li><a class="reference internal" href="#enabling-password-validation">パスワードの妥当性検証を有効にする</a></li>
<li><a class="reference internal" href="#included-validators">Django に含まれるバリデータ</a></li>
<li><a class="reference internal" href="#integrating-validation">バリデーションの統合</a></li>
<li><a class="reference internal" href="#writing-your-own-validator">独自のバリデータを書く</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="default.html"
                          title="前の章へ">Djangoの認証システムを使用する</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="customizing.html"
                          title="次の章へ">Django の認証方法のカスタマイズ</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/topics/auth/passwords.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">1月 22, 2025</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="default.html" title="Djangoの認証システムを使用する">previous</a>
     |
    <a href="../index.html" title="Django を使う" accesskey="U">up</a>
   |
    <a href="customizing.html" title="Django の認証方法のカスタマイズ">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>