<!DOCTYPE html>

<html lang="ja" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>翻訳 &#8212; Django 5.1.6.dev20250122212402 ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=34bb78ad" />
    <link rel="stylesheet" type="text/css" href="../../_static/default.css?v=bf4d74af" />
    <script src="../../_static/documentation_options.js?v=d2885b0a"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=4755f45a"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="表示形式のローカライズ" href="formatting.html" />
    <link rel="prev" title="国際化とローカライズ" href="index.html" />



 
<script src="../../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Django 5.1.6.dev20250122212402 ドキュメント</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Table of contents" href="../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../genindex.html">Index</a>  |
        <a title="Module index" href="../../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="index.html" title="国際化とローカライズ">previous</a>
     |
    <a href="../index.html" title="Django を使う" accesskey="U">up</a>
   |
    <a href="formatting.html" title="表示形式のローカライズ">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="topics-i18n-translation">
            
  <section id="s-translation">
<span id="translation"></span><h1>翻訳<a class="headerlink" href="#translation" title="Link to this heading">¶</a></h1>
<section id="s-overview">
<span id="overview"></span><h2>概要<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Django プロジェクトを翻訳可能にするためには、Python コードやテンプレートに、多少のフックを加筆しなければなりません。このフックは <a class="reference internal" href="index.html#term-translation-string"><span class="xref std std-term">翻訳文字列</span></a> と呼ばれます。翻訳文字列は Django に「このテキストに対する翻訳が有効な場合、このテキストはエンドユーザの言語に翻訳すべきだ」ということを通知します。翻訳可能な文字列をマークすることは開発者の責任です。システムが翻訳できるのは指定された文字列だけなのです。</p>
<p>Django は、翻訳文字列を <a class="reference internal" href="index.html#term-message-file"><span class="xref std std-term">メッセージファイル</span></a> に抽出するユーティリティを提供します。このファイルがあるため、翻訳者が対象の言語において翻訳文字列に対応する文字列を用意することが簡単になります。翻訳者がメッセージファイルの中身を書き終わったら、それをコンパイルしなければなりません。このプロセスは GNU gettext ツー ルキットに依存しています。</p>
<p>これが済めば、 Django はユーザの言語設定に従って、オンザフライでアプリケーションを利用可能な言語に翻訳するようになります。</p>
<p>Django の国際化フックはデフォルトで有効になっており、これは、フレームワークの特定の箇所で i18n に関する小さなオーバーヘッドが発生することを意味します。国際化を使わない場合は、 <a class="reference internal" href="../../ref/settings.html#std-setting-USE_I18N"><code class="xref std std-setting docutils literal notranslate"><span class="pre">USE_I18N</span> <span class="pre">=</span> <span class="pre">False</span></code></a> を設定ファイルに記述してください。そうすれば Django は国際化の部品を読み込まないようにして多少の最適化をします。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>プロジェクトで翻訳機能が有効になっていることを確認してください (最も早いのは、 <a class="reference internal" href="../../ref/settings.html#std-setting-MIDDLEWARE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code></a> が <a class="reference internal" href="../../ref/middleware.html#django.middleware.locale.LocaleMiddleware" title="django.middleware.locale.LocaleMiddleware"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.middleware.locale.LocaleMiddleware</span></code></a> を含むかどうかチェックすることです) 。まだの場合は、<a class="reference internal" href="#how-django-discovers-language-preference"><span class="std std-ref">Django はどうやって言語の優先順位を検出するのか？</span></a> を参照してください。</p>
</div>
</section>
<section id="s-internationalization-in-python-code">
<span id="internationalization-in-python-code"></span><h2>Python コードでの国際化<a class="headerlink" href="#internationalization-in-python-code" title="Link to this heading">¶</a></h2>
<section id="s-standard-translation">
<span id="standard-translation"></span><h3>標準的な翻訳<a class="headerlink" href="#standard-translation" title="Link to this heading">¶</a></h3>
<p>翻訳対象の文字列を関数 <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext" title="django.utils.translation.gettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext()</span></code></a> で指定します。入力の手間を省くため、この関数は短い別名 <code class="docutils literal notranslate"><span class="pre">_</span></code> としてインポートするのが慣例です。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>Python の標準ライブラリ <code class="docutils literal notranslate"><span class="pre">gettext</span></code> モジュールは、グローバルの名前空間に <code class="docutils literal notranslate"><span class="pre">_()</span></code> という名前で <code class="docutils literal notranslate"><span class="pre">gettext()</span></code> をインストールします。 Django ではこの方法に従っていませんが、それは以下の理由からです:</p>
<ol class="arabic simple">
<li><p>特定のファイルのデフォルトの翻訳メソッドとして <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext_lazy" title="django.utils.translation.gettext_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext_lazy()</span></code></a> を使うべき場合もあります。グローバル名前空間に <code class="docutils literal notranslate"><span class="pre">_()</span></code> がないと、開発者はどれが最も適切な翻訳関数かを考えなければなりません。</p></li>
<li><p>アンダースコア文字 (<code class="docutils literal notranslate"><span class="pre">_</span></code>) は、 Python の対話シェルや doctest で書かれたテストの中では「直前の式の値」を表します。そのため、グローバル名前空間に <code class="docutils literal notranslate"><span class="pre">_()</span></code> をインストールすると、干渉して問題を引き起こします。 <code class="docutils literal notranslate"><span class="pre">gettext()</span></code> を <code class="docutils literal notranslate"><span class="pre">_()</span></code> という名前で明示的に import すれば、この問題を回避できます。</p></li>
</ol>
</div>
<div class="admonition-what-functions-may-be-aliased-as admonition">
<p class="admonition-title"><code class="docutils literal notranslate"><span class="pre">_</span></code> として別名をつけられる関数は？</p>
<p>(<a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> で使われる) <code class="docutils literal notranslate"><span class="pre">xgettext</span></code> が動作する方法のせいで、単一の文字列引数を持つ関数のみが <code class="docutils literal notranslate"><span class="pre">_</span></code> として import できます。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext" title="django.utils.translation.gettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext()</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext_lazy" title="django.utils.translation.gettext_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext_lazy()</span></code></a></p></li>
</ul>
</div>
<p>この例では、<code class="docutils literal notranslate"><span class="pre">&quot;Welcome</span> <span class="pre">to</span> <span class="pre">my</span> <span class="pre">site.&quot;</span></code> というテキストが翻訳文字列としてマークされています:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext</span> <span class="k">as</span> <span class="n">_</span>


<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Welcome to my site.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>別名を付けなくても同じコードを書くことができます。次の例は、上の例とまったく同一です:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext</span>


<span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">gettext</span><span class="p">(</span><span class="s2">&quot;Welcome to my site.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>翻訳は、計算済みの値に適用されます。次の例は、上の2つの例とまったく同一です:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Welcome&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;my&quot;</span><span class="p">,</span> <span class="s2">&quot;site.&quot;</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>翻訳は変数にも適用されます。次の例もまた、上の例とまったく同一です:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="s2">&quot;Welcome to my site.&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>(上の 2 つの例のように変数や計算済みの値を使う場合の注意点として、Django の翻訳文字列検出ユーティリティ <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a> はこれらの文字列を検出できません。詳しくは後の <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> の節で説明します。)</p>
<p><code class="docutils literal notranslate"><span class="pre">_()</span></code> や <code class="docutils literal notranslate"><span class="pre">gettext()</span></code> に渡す文字列には、Pyton の標準の名前付き補完構文によるプレースホルダを使えます。例えば:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Today is </span><span class="si">%(month)s</span><span class="s2"> </span><span class="si">%(day)s</span><span class="s2">.&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">m</span><span class="p">,</span> <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">d</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>このテクニックを使うと、言語ごとの翻訳でプレースホルダを並び替えられるようになります。例えば、英語の翻訳文 <code class="docutils literal notranslate"><span class="pre">&quot;Today</span> <span class="pre">is</span> <span class="pre">Nobember,</span> <span class="pre">26.&quot;</span></code> に対して、スペイン語では <code class="docutils literal notranslate"><span class="pre">&quot;Hoy</span> <span class="pre">es</span> <span class="pre">26</span> <span class="pre">de</span> <span class="pre">noviembre.&quot;</span></code> となるように、月と日のプレースホルダの位置を入れ替えることができます。</p>
<p>この理由から、引数が複数ある場合には、固定引数を使った補完 (<code class="docutils literal notranslate"><span class="pre">%s</span></code> や <code class="docutils literal notranslate"><span class="pre">%d</span></code>) ではなく、名前付きの補完 (<code class="docutils literal notranslate"><span class="pre">%(day)s</span></code>) を使ってください。固定引数による補完を使った場合、プレースホルダを正しい順番で翻訳できない場合があります。</p>
<p>文字列抽出は <code class="docutils literal notranslate"><span class="pre">xgettext</span></code> コマンドで行われるため、Django がサポートするのは <code class="docutils literal notranslate"><span class="pre">gettext</span></code> がサポートする構文のみです。特に、Python の <a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#f-strings" title="(in Python v3.13)"><span class="xref std std-ref">f-strings</span></a> はまだ <code class="docutils literal notranslate"><span class="pre">xgettext</span></code> でサポートされておらず、JavaScript テンプレート文字列は <code class="docutils literal notranslate"><span class="pre">gettext</span></code> 0.21+ が必要です。</p>
</section>
<section id="s-comments-for-translators">
<span id="s-translator-comments"></span><span id="comments-for-translators"></span><span id="translator-comments"></span><h3>翻訳者へのコメント<a class="headerlink" href="#comments-for-translators" title="Link to this heading">¶</a></h3>
<p>翻訳可能な文字列についてのヒントを翻訳者に示したい場合、文字列の直前の行で <code class="docutils literal notranslate"><span class="pre">Translators</span></code> キーワードでプレフィックスされたコメントを追加できます。例えば:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Translators: This message appears on the home page only</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">gettext</span><span class="p">(</span><span class="s2">&quot;Welcome to my site.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>コメントは、後に記述された翻訳可能な文章に関連付けられた、結果の <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイル内に表示され、ほとんどの翻訳ツールで表示されます。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>完全を期すために示すと、以下が結果として生成される対応する  <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイルの断片です。</p>
<div class="highlight-po notranslate"><div class="highlight"><pre><span></span><span class="c1">#. Translators: This message appears on the home page only</span>
<span class="c1"># path/to/python/file.py:123</span>
<span class="nv">msgid</span> <span class="s">&quot;Welcome to my site.&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
</div>
<p>これはテンプレート内でも動作します。詳しくは <a class="reference internal" href="#translator-comments-in-templates"><span class="std std-ref">テンプレートにおける翻訳者のためのコメント</span></a> を参照してください。</p>
</section>
<section id="s-marking-strings-as-no-op">
<span id="marking-strings-as-no-op"></span><h3>no-op (何もしない) として文字列をマークする<a class="headerlink" href="#marking-strings-as-no-op" title="Link to this heading">¶</a></h3>
<p>翻訳しない文字列としてマークするためには、<a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext_noop" title="django.utils.translation.gettext_noop"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.gettext_noop()</span></code></a> を使ってください。文字列は、変数より後で翻訳されます。</p>
<p>ソース言語内に保持すべき構成文字列がある場合、これを使ってください。これは、システムやユーザー (たとえばデータベース内の文字列) を介して交換される一方で、最後の時点 (たとえばユーザに文字列が表示されるとき) で翻訳される必要があるからです。</p>
</section>
<section id="s-pluralization">
<span id="pluralization"></span><h3>複数形<a class="headerlink" href="#pluralization" title="Link to this heading">¶</a></h3>
<p>複数形のメッセージを指定するには、関数 <a class="reference internal" href="../../ref/utils.html#django.utils.translation.ngettext" title="django.utils.translation.ngettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.ngettext()</span></code></a> を使ってください。</p>
<p><code class="docutils literal notranslate"><span class="pre">ngettext</span></code> は 3 つの引数を取ります: 単数形の文字列、複数形の文字列、オブジェクトの数です。</p>
<p>この関数は、Django アプリケーションを数と <a class="reference external" href="https://www.gnu.org/software/gettext/manual/gettext.html#Plural-forms">複数形</a> の複雑さが英語で 2 より大きい (その値にかかわらず、単数には 'object'、そして <code class="docutils literal notranslate"><span class="pre">count</span></code> が 1 ではない全ての場合に 'objects' となります。) 言語にローカライズさせる必要がある場合に役立ちます。</p>
<p>例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">ngettext</span>


<span class="k">def</span><span class="w"> </span><span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ngettext</span><span class="p">(</span>
        <span class="s2">&quot;there is </span><span class="si">%(count)d</span><span class="s2"> object&quot;</span><span class="p">,</span>
        <span class="s2">&quot;there are </span><span class="si">%(count)d</span><span class="s2"> objects&quot;</span><span class="p">,</span>
        <span class="n">count</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</pre></div>
</div>
<p>この例では、オブジェクトの数値は <code class="docutils literal notranslate"><span class="pre">count</span></code> 変数として翻訳言語に渡されます。</p>
<p>複数形は、複雑で言語によって異なる動作をすることに注意してください。<code class="docutils literal notranslate"><span class="pre">count</span></code> と 1 の比較は正しいルールではないことがあります。以下のコードは洗練されて見えますが、いくつかの言語に対しては誤った結果を生み出します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">ngettext</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Report</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">Report</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Report</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Report</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name_plural</span>

<span class="n">text</span> <span class="o">=</span> <span class="n">ngettext</span><span class="p">(</span>
    <span class="s2">&quot;There is </span><span class="si">%(count)d</span><span class="s2"> </span><span class="si">%(name)s</span><span class="s2"> available.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;There are </span><span class="si">%(count)d</span><span class="s2"> </span><span class="si">%(name)s</span><span class="s2"> available.&quot;</span><span class="p">,</span>
    <span class="n">count</span><span class="p">,</span>
<span class="p">)</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>
</pre></div>
</div>
<p>あなた自身の単数複数ロジックを実装しないでください。おそらく正しくなりません。このようなケースでは、以下のようなコードを考えてみてください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="n">ngettext</span><span class="p">(</span>
    <span class="s2">&quot;There is </span><span class="si">%(count)d</span><span class="s2"> </span><span class="si">%(name)s</span><span class="s2"> object available.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;There are </span><span class="si">%(count)d</span><span class="s2"> </span><span class="si">%(name)s</span><span class="s2"> objects available.&quot;</span><span class="p">,</span>
    <span class="n">count</span><span class="p">,</span>
<span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
    <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">Report</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note" id="pluralization-var-notes">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">ngettext()</span></code> を使うときは、リテラルで挿入される全ての変数に対して単一の名前を使うようにしてください。以下の例で、2 つの翻訳文字列でどのように <code class="docutils literal notranslate"><span class="pre">name</span></code> Python 変数が使われるかに注意してください。この例は、上述した通りいくつかの言語で間違っている以外に、失敗するでしょう:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="n">ngettext</span><span class="p">(</span>
    <span class="s2">&quot;There is </span><span class="si">%(count)d</span><span class="s2"> </span><span class="si">%(name)s</span><span class="s2"> available.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;There are </span><span class="si">%(count)d</span><span class="s2"> </span><span class="si">%(plural_name)s</span><span class="s2"> available.&quot;</span><span class="p">,</span>
    <span class="n">count</span><span class="p">,</span>
<span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
    <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">Report</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">Report</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span>
    <span class="s2">&quot;plural_name&quot;</span><span class="p">:</span> <span class="n">Report</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name_plural</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span></code></a> を実行すると、以下のエラーが発生するでしょう。</p>
<div class="highlight-pytb notranslate"><div class="highlight"><pre><span></span><span class="x">a format specification for argument &#39;name&#39;, as in &#39;msgstr[0]&#39;, doesn&#39;t exist in &#39;msgid&#39;</span>
</pre></div>
</div>
</div>
</section>
<section id="s-contextual-markers">
<span id="s-id1"></span><span id="contextual-markers"></span><span id="id1"></span><h3>文脈マーカー<a class="headerlink" href="#contextual-markers" title="Link to this heading">¶</a></h3>
<p>単語は複数の意味を持っている場合があります。例えば、英語の <code class="docutils literal notranslate"><span class="pre">&quot;May&quot;</span></code> は、月名と動詞を指します。翻訳者が異なる文脈でこれらの単語を正しく翻訳できるようにするには、<a class="reference internal" href="../../ref/utils.html#django.utils.translation.pgettext" title="django.utils.translation.pgettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.pgettext()</span></code></a> 関数、もしくは文字列が複数形を必要とする場合は  <a class="reference internal" href="../../ref/utils.html#django.utils.translation.npgettext" title="django.utils.translation.npgettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.npgettext()</span></code></a> 関数を使うことができます。両方とも、第 1 変数として文脈文字列を取ります。</p>
<p>結果の <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイルで、文字列は同じ文字列に対する異なる文脈マーカーがあるのと同じ頻度で出現し (コンテキストは <code class="docutils literal notranslate"><span class="pre">msgctxt</span></code> 行に出現します)、これらそれぞれに対して翻訳者が異なる翻訳ができるようにします。</p>
<p>例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">pgettext</span>

<span class="n">month</span> <span class="o">=</span> <span class="n">pgettext</span><span class="p">(</span><span class="s2">&quot;month name&quot;</span><span class="p">,</span> <span class="s2">&quot;May&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>もしくは:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">pgettext_lazy</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyThing</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">pgettext_lazy</span><span class="p">(</span><span class="s2">&quot;help text for MyThing model&quot;</span><span class="p">,</span> <span class="s2">&quot;This is the help text&quot;</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>これは <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイル内に以下のように出現します:</p>
<div class="highlight-po notranslate"><div class="highlight"><pre><span></span><span class="nv">msgctxt</span> <span class="s">&quot;month name&quot;</span>
<span class="nv">msgid</span> <span class="s">&quot;May&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
<p>文脈マーカーは、<a class="reference internal" href="#std-templatetag-translate"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">translate</span></code></a> と <a class="reference internal" href="#std-templatetag-blocktranslate"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">blocktranslate</span></code></a> テンプレートタグによってもサポートされています。</p>
</section>
<section id="s-lazy-translation">
<span id="s-lazy-translations"></span><span id="lazy-translation"></span><span id="lazy-translations"></span><h3>遅延 (Lazy な) 翻訳<a class="headerlink" href="#lazy-translation" title="Link to this heading">¶</a></h3>
<p>Lazy に、つまり遅延的に、値が呼ばれたときではなくアクセスされたときに文字列を翻訳するためには、<a class="reference internal" href="../../ref/utils.html#module-django.utils.translation" title="django.utils.translation: Internationalization support."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.utils.translation</span></code></a> (名前の <code class="docutils literal notranslate"><span class="pre">lazy</span></code> 接尾辞ですぐ分かります) の翻訳関数の lazy バージョンを使ってください、</p>
<p>これらの関数は、Lazy な文字列参照を保持します -- 実際の翻訳ではありません。翻訳自体はテンプレートレンダリング内のように、文字列が文字列コンテキスト内で使われるときに行われます。</p>
<p>これらの関数への呼び出しがモジュールのロード時に実行されるコードパスにある場合は、これは不可欠です。</p>
<p>これは、モデル、フォーム、モデルフォームを定義するときに簡単に発生することができるものです。これは、Django がフィールドを実際にクラスレベルの属性にするように実装するためです。 そのため、以下のような場合は lazy な翻訳を使用してください:</p>
<section id="s-model-fields-and-relationships-verbose-name-and-help-text-option-values">
<span id="model-fields-and-relationships-verbose-name-and-help-text-option-values"></span><h4>モデルフィールドとリレーションシップの <code class="docutils literal notranslate"><span class="pre">verbose_name</span></code> と <code class="docutils literal notranslate"><span class="pre">help_text</span></code> オプションの値<a class="headerlink" href="#model-fields-and-relationships-verbose-name-and-help-text-option-values" title="Link to this heading">¶</a></h4>
<p>例えば、以下のモデルの <em>name</em> フィールドのヘルプテキストを翻訳するためには、以下のようにします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyThing</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;This is the help text&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference internal" href="../../ref/models/options.html#django.db.models.Options.verbose_name" title="django.db.models.Options.verbose_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">verbose_name</span></code></a> オプションを使えば、<a class="reference internal" href="../../ref/models/fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a>、<a class="reference internal" href="../../ref/models/fields.html#django.db.models.ManyToManyField" title="django.db.models.ManyToManyField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManyToManyField</span></code></a> や <a class="reference internal" href="../../ref/models/fields.html#django.db.models.OneToOneField" title="django.db.models.OneToOneField"><code class="xref py py-class docutils literal notranslate"><span class="pre">OneToOneField</span></code></a> リレーションシップの名前を翻訳可能にできます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyThing</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">ThingKind</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;kinds&quot;</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;kind&quot;</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="../../ref/models/options.html#django.db.models.Options.verbose_name" title="django.db.models.Options.verbose_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">verbose_name</span></code></a> と同様に、必要に応じて Django が自動的にタイトルケースに直すので、リレーションシップに対する小文字の冗長な名前テキストを提供する必要があります。</p>
</section>
<section id="s-model-verbose-names-values">
<span id="model-verbose-names-values"></span><h4>モデルの冗長な名前の値<a class="headerlink" href="#model-verbose-names-values" title="Link to this heading">¶</a></h4>
<p>フォールバックの英語中心とモデルのクラス名を見ることによって Django が動作する冗長な名前の純粋な決定に頼るよりも、明示的な <a class="reference internal" href="../../ref/models/options.html#django.db.models.Options.verbose_name" title="django.db.models.Options.verbose_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">verbose_name</span></code></a> と <a class="reference internal" href="../../ref/models/options.html#django.db.models.Options.verbose_name_plural" title="django.db.models.Options.verbose_name_plural"><code class="xref py py-attr docutils literal notranslate"><span class="pre">verbose_name_plural</span></code></a> オプションを指定することが推奨されます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyThing</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span> <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;This is the help text&quot;</span><span class="p">))</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;my thing&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;my things&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="s-model-methods-description-argument-to-the-display-decorator">
<span id="model-methods-description-argument-to-the-display-decorator"></span><h4>モデルメソッド <code class="docutils literal notranslate"><span class="pre">description</span></code> を <code class="docutils literal notranslate"><span class="pre">&#64;display</span></code> デコレーターに渡す。<a class="headerlink" href="#model-methods-description-argument-to-the-display-decorator" title="Link to this heading">¶</a></h4>
<p>モデルメソッドに対しては、<a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.display" title="django.contrib.admin.display"><code class="xref py py-func docutils literal notranslate"><span class="pre">display()</span></code></a> デコレータの <code class="docutils literal notranslate"><span class="pre">short_description</span></code> 引数で Djangoと admin サイトへの翻訳が提供できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyThing</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">ThingKind</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;kinds&quot;</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;kind&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="nd">@admin</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Is it a mouse?&quot;</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_mouse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">MOUSE_TYPE</span>
</pre></div>
</div>
</section>
</section>
<section id="s-working-with-lazy-translation-objects">
<span id="working-with-lazy-translation-objects"></span><h3>遅延 (Lazyな) 翻訳オブジェクトの使用方法<a class="headerlink" href="#working-with-lazy-translation-objects" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">gettext_lazy()</span></code> 呼び出しの結果は、他の Django コード内で文字列 (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> オブジェクト) を使うときはいつでも使うことができますが、気まぐれな Python コードでうまく動作しないかもしれません。例えば、<a class="extlink-pypi reference external" href="https://pypi.org/project/requests/">requests</a> ライブラリが <code class="docutils literal notranslate"><span class="pre">gettext_lazy</span></code> オブジェクトを処理しないので、以下は動作しません:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">gettext_lazy</span><span class="p">(</span><span class="s2">&quot;I </span><span class="se">\u2764</span><span class="s2"> Django&quot;</span><span class="p">)</span>  <span class="c1"># (Unicode :heart:)</span>
<span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;https://example.com/send&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">body</span><span class="p">})</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">gettext_lazy()</span></code> オブジェクトを非 Django コードに渡す前にテキスト文字列にキャストすることで、この問題を防ぐことができます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;https://example.com/send&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">)})</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">gettext_lazy</span></code> という長い名前を使いたくない場合は、次のように <code class="docutils literal notranslate"><span class="pre">_</span></code> (アンダースコア) としてエイリアスできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyThing</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;This is the help text&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>モデルやユーティリティ関数内で文字列に <code class="docutils literal notranslate"><span class="pre">gettext_lazy()</span></code> や <code class="docutils literal notranslate"><span class="pre">ngettext_lazy()</span></code> を使用してマークすることはよく行われます。これらのオブジェクトをコードの他の場所で扱う際には、誤って文字列に変換しないよう注意する必要があります。なぜなら、これらの変換は可能な限り遅延されるべきだからです（正しいロケールが効果を発揮するため）。これには、次に説明するヘルパー関数の使用が必要です。</p>
<section id="s-lazy-translations-and-plural">
<span id="s-lazy-plural-translations"></span><span id="lazy-translations-and-plural"></span><span id="lazy-plural-translations"></span><h4>遅延翻訳と複数形<a class="headerlink" href="#lazy-translations-and-plural" title="Link to this heading">¶</a></h4>
<p>複数の文字列に対して遅延翻訳 (<code class="docutils literal notranslate"><span class="pre">n[p]gettext_lazy</span></code>) を使用する場合、一般的に文字列を定義する時点では <code class="docutils literal notranslate"><span class="pre">number</span></code> 引数を知りません。そのため、 <code class="docutils literal notranslate"><span class="pre">number</span></code> 引数に整数ではなくキー名を渡すことが許可されています。そうすると、文字列の補間時に <code class="docutils literal notranslate"><span class="pre">number</span></code> がそのキーの辞書で検索されます。以下に例を示します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django</span><span class="w"> </span><span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.core.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">ngettext_lazy</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">error_message</span> <span class="o">=</span> <span class="n">ngettext_lazy</span><span class="p">(</span>
        <span class="s2">&quot;You only provided </span><span class="si">%(num)d</span><span class="s2"> argument&quot;</span><span class="p">,</span>
        <span class="s2">&quot;You only provided </span><span class="si">%(num)d</span><span class="s2"> arguments&quot;</span><span class="p">,</span>
        <span class="s2">&quot;num&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ...</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_message</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;num&quot;</span><span class="p">:</span> <span class="n">number</span><span class="p">})</span>
</pre></div>
</div>
<p>文字列の中に名前のないプレースホルダが1つだけ含まれている場合は、 <code class="docutils literal notranslate"><span class="pre">number</span></code> 引数で直接補間できます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">error_message</span> <span class="o">=</span> <span class="n">ngettext_lazy</span><span class="p">(</span>
        <span class="s2">&quot;You provided </span><span class="si">%d</span><span class="s2"> argument&quot;</span><span class="p">,</span>
        <span class="s2">&quot;You provided </span><span class="si">%d</span><span class="s2"> arguments&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ...</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_message</span> <span class="o">%</span> <span class="n">number</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="s-formatting-strings-format-lazy">
<span id="formatting-strings-format-lazy"></span><h4>文字列のフォーマット: <code class="docutils literal notranslate"><span class="pre">format_lazy()</span></code><a class="headerlink" href="#formatting-strings-format-lazy" title="Link to this heading">¶</a></h4>
<p>Python の <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str.format" title="(in Python v3.13)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format()</span></code></a> メソッドは <code class="docutils literal notranslate"><span class="pre">format_string</span></code> や <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str.format" title="(in Python v3.13)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format()</span></code></a> の引数に遅延 (lazy) 翻訳オブジェクトが含まれている場合には動作しません。その代わりに <a class="reference internal" href="../../ref/utils.html#django.utils.text.format_lazy" title="django.utils.text.format_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.text.format_lazy()</span></code></a> を使うことができます。これは結果が文字列に含まれるときだけ <code class="docutils literal notranslate"><span class="pre">str.format()</span></code> メソッドを実行する遅延オブジェクトを作成します。たとえば、次のようになります:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">format_lazy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext_lazy</span>

<span class="o">...</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">gettext_lazy</span><span class="p">(</span><span class="s2">&quot;John Lennon&quot;</span><span class="p">)</span>
<span class="n">instrument</span> <span class="o">=</span> <span class="n">gettext_lazy</span><span class="p">(</span><span class="s2">&quot;guitar&quot;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">format_lazy</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{name}</span><span class="s2">: </span><span class="si">{instrument}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">instrument</span><span class="o">=</span><span class="n">instrument</span><span class="p">)</span>
</pre></div>
</div>
<p>この場合、 <code class="docutils literal notranslate"><span class="pre">result</span></code> 内の遅延翻訳は、 <code class="docutils literal notranslate"><span class="pre">result</span></code> 自体が文字列で使用されるとき（通常はテンプレートのレンダリング時）にだけ文字列に変換されます。</p>
</section>
<section id="s-other-uses-of-lazy-in-delayed-translations">
<span id="other-uses-of-lazy-in-delayed-translations"></span><h4>その他の遅延翻訳の使い方<a class="headerlink" href="#other-uses-of-lazy-in-delayed-translations" title="Link to this heading">¶</a></h4>
<p>翻訳を遅らせたいが、翻訳可能な文字列を別の関数の引数として渡さなければならない場合、この関数を遅延 (Lazy) 呼び出しでラップできます。たとえば次のようにします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.functional</span><span class="w"> </span><span class="kn">import</span> <span class="n">lazy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>


<span class="k">def</span><span class="w"> </span><span class="nf">to_lower</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>


<span class="n">to_lower_lazy</span> <span class="o">=</span> <span class="n">lazy</span><span class="p">(</span><span class="n">to_lower</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
<p>その後、次のようにします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lazy_string</span> <span class="o">=</span> <span class="n">to_lower_lazy</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;My STRING!&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="s-localized-names-of-languages">
<span id="localized-names-of-languages"></span><h3>言語のローカライズされた名前<a class="headerlink" href="#localized-names-of-languages" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="django.utils.translation.get_language_info">
<span class="sig-name descname"><span class="pre">get_language_info</span></span>(<em class="sig-param"><span class="n"><span class="pre">lang_code</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/utils/translation/__init__.py#L269"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.utils.translation.get_language_info" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">get_language_info()</span></code> 関数は、言語について詳細な情報を提供します:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">activate</span><span class="p">,</span> <span class="n">get_language_info</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s2">&quot;fr&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">li</span> <span class="o">=</span> <span class="n">get_language_info</span><span class="p">(</span><span class="s2">&quot;de&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">li</span><span class="p">[</span><span class="s2">&quot;name_local&quot;</span><span class="p">],</span> <span class="n">li</span><span class="p">[</span><span class="s2">&quot;name_translated&quot;</span><span class="p">],</span> <span class="n">li</span><span class="p">[</span><span class="s2">&quot;bidi&quot;</span><span class="p">])</span>
<span class="go">German Deutsch Allemand False</span>
</pre></div>
</div>
<p>ディクショナリの <code class="docutils literal notranslate"><span class="pre">name</span></code>、<code class="docutils literal notranslate"><span class="pre">name_local</span></code>、<code class="docutils literal notranslate"><span class="pre">name_translated</span></code> 属性は、言語の英語名、言語自体、カレントのアクティブ言語をそれぞれ含んでいます。<code class="docutils literal notranslate"><span class="pre">bidi</span></code> 属性は双方向性の言語に対してのみ True です。</p>
<p>言語情報のソースは <code class="docutils literal notranslate"><span class="pre">django.conf.locale</span></code> モジュールです。テンプレートコードでも、この情報に対して同じようにアクセスできます。以下を参照してください。</p>
</section>
</section>
<section id="s-internationalization-in-template-code">
<span id="s-specifying-translation-strings-in-template-code"></span><span id="internationalization-in-template-code"></span><span id="specifying-translation-strings-in-template-code"></span><h2>国際化: テンプレート内<a class="headerlink" href="#internationalization-in-template-code" title="Link to this heading">¶</a></h2>
<p><a class="reference internal" href="../../ref/templates/language.html"><span class="doc">Django テンプレート</span></a> 内での翻訳は 2 つのテンプレートタグと Pthon コードとはやや異なるシンタックスを使います。テンプレートでこれらのタグを使えるようにするには、<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">i18n</span> <span class="pre">%}</span></code> をテンプレートの先頭に対して設置してください。全てのテンプレートタグと同じように、すでに <code class="docutils literal notranslate"><span class="pre">i18n</span></code> をロードしているテンプレートを extend している場合であっても、翻訳を使用する全てのテンプレートでロードする必要があります。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>翻訳された文字列はテンプレートでレンダリングされるときにエスケープされません。これにより、たとえば強調のために HTML を翻訳に含めることができますが、潜在的に危険な文字 (<code class="docutils literal notranslate"><span class="pre">&quot;</span></code> など) も変更されずにレンダリングされます。</p>
</div>
<section id="s-translate-template-tag">
<span id="s-std-templatetag-translate"></span><span id="s-std-templatetag-trans"></span><span id="translate-template-tag"></span><span id="std-templatetag-translate"></span><span id="std-templatetag-trans"></span><h3><code class="docutils literal notranslate"><span class="pre">translate</span></code> テンプレートタグ<a class="headerlink" href="#translate-template-tag" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">translate</span> <span class="pre">%}</span></code> テンプレートタグは、(シングルクオートやダブルクオートで囲まれた) 定数文字列や変数コンテンツを翻訳します:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;This is the title.&quot;</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">translate</span> <span class="nv">myvar</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">noop</span></code> オプションが存在する場合、変数はそのままですが翻訳の対象外となります。将来的に翻訳を必要とするコンテンツを &quot;もみ消している&quot; ときに役立ちます:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;myvar&quot;</span> <span class="nv">noop</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>内部的には、インラインの翻訳は <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext" title="django.utils.translation.gettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext()</span></code></a> 呼び出しを使っています。</p>
<p>テンプレート var (上記の <code class="docutils literal notranslate"><span class="pre">myvar</span></code>) がタグに渡された場合、最初にランタイムで変数から文字列へと解決し、それからメッセージカタログ内でその文字列をルックアップします。</p>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">translate</span> <span class="pre">%}</span></code> 内の文字列でテンプレート変数を混ぜることはできません。翻訳が変数 (プレースホルダ) とともに文字列を必要とする場合は、代わりに <a class="reference internal" href="#std-templatetag-blocktranslate"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code></a> を使ってください。</p>
<p>翻訳された文字列を表示させずに取り出したい場合は、以下の構文が使用できます:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;This is the title&quot;</span> <span class="k">as</span> <span class="nv">the_title</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">the_title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">the_title</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>実際には、テンプレート内の複数の場所で使用できる文字列を取得したり、他のテンプレートタグやフィルタリングするための引数として出力を使用したりする目的でこれを使うことになるでしょう:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;starting point&quot;</span> <span class="k">as</span> <span class="nv">start</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;end point&quot;</span> <span class="k">as</span> <span class="nv">end</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;La Grande Boucle&quot;</span> <span class="k">as</span> <span class="nv">race</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="cp">%}</span><span class="s">Back to &#39;</span><span class="cp">{{</span> <span class="nv">race</span> <span class="cp">}}</span><span class="s">&#39; homepage</span><span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">race</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">stage</span> <span class="k">in</span> <span class="nv">tour_stages</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">cycle</span> <span class="nv">start</span> <span class="nv">end</span> <span class="cp">%}</span>: <span class="cp">{{</span> <span class="nv">stage</span> <span class="cp">}}{%</span> <span class="k">if</span> <span class="nb">forloop</span><span class="nv">.counter</span><span class="o">|</span><span class="nf">divisibleby</span><span class="o">:</span><span class="m">2</span> <span class="cp">%}</span><span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>, <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">translate</span> <span class="pre">%}</span></code> は、<code class="docutils literal notranslate"><span class="pre">context</span></code> キーワードを使う <a class="reference internal" href="#contextual-markers"><span class="std std-ref">文脈マーカー</span></a> もサポートしています:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;May&quot;</span> <span class="nv">context</span> <span class="s2">&quot;month name&quot;</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
<section id="s-blocktranslate-template-tag">
<span id="s-std-templatetag-blocktranslate"></span><span id="s-std-templatetag-blocktrans"></span><span id="blocktranslate-template-tag"></span><span id="std-templatetag-blocktranslate"></span><span id="std-templatetag-blocktrans"></span><h3><code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code> テンプレートタグ<a class="headerlink" href="#blocktranslate-template-tag" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="#std-templatetag-translate"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">translate</span></code></a> タグとは対照的に、 <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code> タグはプレースホルダーを使うことで、リテラルその他の内容からなる複雑な文章を翻訳できます:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="cp">%}</span>This string will have <span class="cp">{{</span> <span class="nv">value</span> <span class="cp">}}</span> inside.<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>オブジェクトの <code class="docutils literal notranslate"><span class="pre">object</span></code> 属性にアクセスしたり、テンプレートフィルタを使ったりといったテンプレート式を翻訳するには、その式を翻訳ブロック内で使うローカル変数に結びつける必要があります。たとえば、次のようにします:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="k">with</span> <span class="nv">amount</span><span class="o">=</span><span class="nv">article.price</span> <span class="cp">%}</span>
That will cost $ <span class="cp">{{</span> <span class="nv">amount</span> <span class="cp">}}</span>.
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="k">with</span> <span class="nv">myvar</span><span class="o">=</span><span class="nv">value</span><span class="o">|</span><span class="nf">filter</span> <span class="cp">%}</span>
This will have <span class="cp">{{</span> <span class="nv">myvar</span> <span class="cp">}}</span> inside.
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>単一の <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code> タグ内で複数の式を使うこともできます:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="k">with</span> <span class="nv">book_t</span><span class="o">=</span><span class="nv">book</span><span class="o">|</span><span class="nf">title</span> <span class="nv">author_t</span><span class="o">=</span><span class="nv">author</span><span class="o">|</span><span class="nf">title</span> <span class="cp">%}</span>
This is <span class="cp">{{</span> <span class="nv">book_t</span> <span class="cp">}}</span> by <span class="cp">{{</span> <span class="nv">author_t</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>次のような、冗長な古い書式もまだサポートされています: <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">with</span> <span class="pre">book|title</span> <span class="pre">as</span> <span class="pre">book_t</span> <span class="pre">and</span> <span class="pre">author|title</span> <span class="pre">as</span> <span class="pre">author_t</span> <span class="pre">%}</span></code></p>
</div>
<p>他のブロックタグ (例えば <a class="reference internal" href="../../ref/templates/builtins.html#std-templatetag-for"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">%}</span></code></a> や <a class="reference internal" href="../../ref/templates/builtins.html#std-templatetag-if"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">%}</span></code></a>) は <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code> タグの中では使えません。</p>
<p>ブロック引数の解決に失敗した場合、 <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code> は <a class="reference internal" href="../../ref/utils.html#django.utils.translation.deactivate_all" title="django.utils.translation.deactivate_all"><code class="xref py py-func docutils literal notranslate"><span class="pre">deactivate_all()</span></code></a> 関数を用いて、現在アクティブな言語を一時的に非アクティブにすることで、デフォルトの言語にフォールバックします。</p>
<p>このタグは複数形にも対応しています。使用するには:</p>
<ul class="simple">
<li><p>カウンタの値を <code class="docutils literal notranslate"><span class="pre">count</span></code> という名前で指定し結び付けます。この値は正しい複数形の選択に使用されます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code> と <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">endblocktranslate</span> <span class="pre">%}</span></code> のタグの中で単数形と複数形を <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">plural</span> <span class="pre">%}</span></code> タグで区切って指定してください。</p></li>
</ul>
<p>例:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="nv">count</span> <span class="nv">counter</span><span class="o">=</span><span class="nv">list</span><span class="o">|</span><span class="nf">length</span> <span class="cp">%}</span>
There is only one <span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span> object.
<span class="cp">{%</span> <span class="k">plural</span> <span class="cp">%}</span>
There are <span class="cp">{{</span> <span class="nv">counter</span> <span class="cp">}}</span> <span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span> objects.
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>より複雑な例:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="k">with</span> <span class="nv">amount</span><span class="o">=</span><span class="nv">article.price</span> <span class="nv">count</span> <span class="nv">years</span><span class="o">=</span><span class="nv">i.length</span> <span class="cp">%}</span>
That will cost $ <span class="cp">{{</span> <span class="nv">amount</span> <span class="cp">}}</span> per year.
<span class="cp">{%</span> <span class="k">plural</span> <span class="cp">%}</span>
That will cost $ <span class="cp">{{</span> <span class="nv">amount</span> <span class="cp">}}</span> per <span class="cp">{{</span> <span class="nv">years</span> <span class="cp">}}</span> years.
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>カウンターの値の追加に複数化機能とローカル変数への値のバインドの両方を使用する場合、 <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code> 構文は内部的に <code class="docutils literal notranslate"><span class="pre">ngettext</span></code> 呼び出しに変換されることに注意してください。つまり、 <a class="reference internal" href="#pluralization-var-notes"><span class="std std-ref">ngettext 変数に関する注意事項</span></a> と同じことに気を付ける必要があります。</p>
<p>URLの逆引きは <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code> 内では行えないので、事前に取得（保存）しておく必要があります:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;path.to.view&#39;</span> <span class="nv">arg</span> <span class="nv">arg2</span> <span class="k">as</span> <span class="nv">the_url</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="cp">%}</span>
This is a URL: <span class="cp">{{</span> <span class="nv">the_url</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>翻訳された文字列を表示させずに取り出したい場合は、以下の構文が使用できます:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="nv">asvar</span> <span class="nv">the_title</span> <span class="cp">%}</span>The title is <span class="cp">{{</span> <span class="nv">title</span> <span class="cp">}}</span>.<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">the_title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">the_title</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>実際には、テンプレート内の複数の場所で使用できる文字列を取得したり、他のテンプレートタグやフィルタリングするための引数として出力を使用したりする目的でこれを使うことになるでしょう:</p>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code> は、<code class="docutils literal notranslate"><span class="pre">context</span></code> キーワードを使う <a class="reference internal" href="#contextual-markers"><span class="std std-ref">文脈マーカー</span></a> もサポートしています:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="k">with</span> <span class="nv">name</span><span class="o">=</span><span class="nv">user.username</span> <span class="nv">context</span> <span class="s2">&quot;greeting&quot;</span> <span class="cp">%}</span>Hi <span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code> タグのもう1つの機能は、<code class="docutils literal notranslate"><span class="pre">trimmed</span></code> オプションです。このオプションは、<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code> タグのコンテンツの先頭と末尾から改行文字を削除し、行の先頭と末尾の空白を置き換え、すべての行を空白文字で区切って1行に結合します。これは、<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code> タグのコンテンツをインデントしても、インデント文字が対応する <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイルのエントリに含まれないようにするのに非常に便利で、翻訳作業が簡単になります。</p>
<p>例えば、次の <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code> タグ:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="nv">trimmed</span> <span class="cp">%}</span>
  First sentence.
  Second paragraph.
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>の出力結果は <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイル内では <code class="docutils literal notranslate"><span class="pre">&quot;First</span> <span class="pre">sentence.</span> <span class="pre">Second</span> <span class="pre">paragraph.&quot;</span></code> となります。対照に、 <code class="docutils literal notranslate"><span class="pre">trimmed</span></code> オプションが指定されていない場合は <code class="docutils literal notranslate"><span class="pre">&quot;\n</span> <span class="pre">First</span> <span class="pre">sentence.\n</span> <span class="pre">Second</span> <span class="pre">paragraph.\n&quot;</span></code> となります。</p>
</section>
<section id="s-string-literals-passed-to-tags-and-filters">
<span id="string-literals-passed-to-tags-and-filters"></span><h3>タグとフィルタに渡される文字列リテラル<a class="headerlink" href="#string-literals-passed-to-tags-and-filters" title="Link to this heading">¶</a></h3>
<p>タグやフィルタの引数として渡された文字列リテラルは、見慣れた <code class="docutils literal notranslate"><span class="pre">_()</span></code> 構文を使って翻訳できます:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">some_tag</span> <span class="kp">_</span><span class="o">(</span><span class="s2">&quot;Page not found&quot;</span><span class="o">)</span> <span class="nv">value</span><span class="o">|</span><span class="nf">yesno</span><span class="o">:</span><span class="kp">_</span><span class="o">(</span><span class="s2">&quot;yes,no&quot;</span><span class="o">)</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>この場合、タグもフィルタも翻訳された文字列を見るので、翻訳を意識する必要はありません。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>この例では、個々の文字列 <code class="docutils literal notranslate"><span class="pre">&quot;yes&quot;</span></code> と <code class="docutils literal notranslate"><span class="pre">&quot;no&quot;</span></code> ではなく、<code class="docutils literal notranslate"><span class="pre">&quot;yes,no&quot;</span></code> という文字列が翻訳基盤に渡されます。翻訳された文字列は、フィルタをパースするコードが引数をどう分割するかを知るために、カンマを含む必要があります。たとえば、ドイツ語の翻訳者は文字列 <code class="docutils literal notranslate"><span class="pre">&quot;yes,no&quot;</span></code> を <code class="docutils literal notranslate"><span class="pre">&quot;ja,nein&quot;</span></code> (カンマはそのまま) と翻訳するでしょう。</p>
</div>
</section>
<section id="s-comments-for-translators-in-templates">
<span id="s-translator-comments-in-templates"></span><span id="comments-for-translators-in-templates"></span><span id="translator-comments-in-templates"></span><h3>テンプレートにおける翻訳者のためのコメント<a class="headerlink" href="#comments-for-translators-in-templates" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="#translator-comments"><span class="std std-ref">Pythonコード</span></a> の場合と同様に、これらの翻訳者向けのメモはコメントを使用して指定できます。<a class="reference internal" href="../../ref/templates/builtins.html#std-templatetag-comment"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">comment</span></code></a> タグを使用する場合がその一例です：</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">comment</span> <span class="cp">%}</span><span class="c">Translators: View verb</span><span class="cp">{%</span> <span class="k">endcomment</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;View&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">comment</span> <span class="cp">%}</span><span class="c">Translators: Short intro blurb</span><span class="cp">{%</span> <span class="k">endcomment</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="cp">%}</span>A multiline translatable
literal.<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>または <a class="reference internal" href="../../ref/templates/language.html#template-comments"><span class="std std-ref">一行コメント構文</span></a> <code class="docutils literal notranslate"><span class="pre">{#</span></code> ... ... <code class="docutils literal notranslate"><span class="pre">#}</span></code> で:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="c">{# Translators: Label of a button that triggers search #}</span>
<span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;Go&quot;</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

<span class="c">{# Translators: This is a text of the base template #}</span>
<span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="cp">%}</span>Ambiguous translatable block of text<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>完全を期すために示すと、以下が結果として生成される対応する  <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイルの断片です。:</p>
<div class="highlight-po notranslate"><div class="highlight"><pre><span></span><span class="c1">#. Translators: View verb</span>
<span class="c1"># path/to/template/file.html:10</span>
<span class="nv">msgid</span> <span class="s">&quot;View&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>

<span class="c1">#. Translators: Short intro blurb</span>
<span class="c1"># path/to/template/file.html:13</span>
<span class="nv">msgid</span> <span class="s">&quot;&quot;</span>
<span class="s">&quot;A multiline translatable&quot;</span>
<span class="s">&quot;literal.&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>

<span class="c1"># ...</span>

<span class="c1">#. Translators: Label of a button that triggers search</span>
<span class="c1"># path/to/template/file.html:100</span>
<span class="nv">msgid</span> <span class="s">&quot;Go&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>

<span class="c1">#. Translators: This is a text of the base template</span>
<span class="c1"># path/to/template/file.html:103</span>
<span class="nv">msgid</span> <span class="s">&quot;Ambiguous translatable block of text&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="s-switching-language-in-templates">
<span id="s-std-templatetag-language"></span><span id="switching-language-in-templates"></span><span id="std-templatetag-language"></span><h3>テンプレートで言語を切り替える<a class="headerlink" href="#switching-language-in-templates" title="Link to this heading">¶</a></h3>
<p>テンプレートの中で言語を選択したい場合、 <code class="docutils literal notranslate"><span class="pre">language</span></code> テンプレートタグが使用できます:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">i18n</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">get_current_language</span> <span class="k">as</span> <span class="nv">LANGUAGE_CODE</span> <span class="cp">%}</span>
<span class="cm">&lt;!-- Current language: </span><span class="cp">{{</span> <span class="nv">LANGUAGE_CODE</span> <span class="cp">}}</span><span class="cm"> --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;Welcome to our page&quot;</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cp">{%</span> <span class="k">language</span> <span class="s1">&#39;en&#39;</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">get_current_language</span> <span class="k">as</span> <span class="nv">LANGUAGE_CODE</span> <span class="cp">%}</span>
    <span class="cm">&lt;!-- Current language: </span><span class="cp">{{</span> <span class="nv">LANGUAGE_CODE</span> <span class="cp">}}</span><span class="cm"> --&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;Welcome to our page&quot;</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endlanguage</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>&quot;Welcome to our page&quot; は、1つめのコードでは現在の言語を使って表示されますが、2つめのコードでは常に英語になります。</p>
</section>
<section id="s-other-tags">
<span id="s-i18n-template-tags"></span><span id="other-tags"></span><span id="i18n-template-tags"></span><h3>その他のタグ<a class="headerlink" href="#other-tags" title="Link to this heading">¶</a></h3>
<p>これらのタグには同時に <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">i18n</span> <span class="pre">%}</span></code> が必要です。</p>
<section id="s-get-available-languages">
<span id="s-std-templatetag-get_available_languages"></span><span id="get-available-languages"></span><span id="std-templatetag-get_available_languages"></span><h4><code class="docutils literal notranslate"><span class="pre">get_available_languages</span></code><a class="headerlink" href="#get-available-languages" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_available_languages</span> <span class="pre">as</span> <span class="pre">LANGUAGES</span> <span class="pre">%}</span></code> はタプルのリストを返します。最初の要素は言語コード <a class="reference internal" href="index.html#term-language-code"><span class="xref std std-term">language code</span></a> で、2番目の要素は言語名 (現在アクティブなロケールに翻訳されたもの) です。</p>
</section>
<section id="s-get-current-language">
<span id="s-std-templatetag-get_current_language"></span><span id="get-current-language"></span><span id="std-templatetag-get_current_language"></span><h4><code class="docutils literal notranslate"><span class="pre">get_current_language</span></code><a class="headerlink" href="#get-current-language" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_current_language</span> <span class="pre">as</span> <span class="pre">LANGUAGE_CODE</span> <span class="pre">%}</span></code> は現在のユーザの優先言語を文字列として返します。たとえば <code class="docutils literal notranslate"><span class="pre">en-us</span></code> です。 <a class="reference internal" href="#how-django-discovers-language-preference"><span class="std std-ref">Django はどうやって言語の優先順位を検出するのか？</span></a> を参照してください。</p>
</section>
<section id="s-get-current-language-bidi">
<span id="s-std-templatetag-get_current_language_bidi"></span><span id="get-current-language-bidi"></span><span id="std-templatetag-get_current_language_bidi"></span><h4><code class="docutils literal notranslate"><span class="pre">get_current_language_bidi</span></code><a class="headerlink" href="#get-current-language-bidi" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_current_language_bidi</span> <span class="pre">as</span> <span class="pre">LANGUAGE_BIDI</span> <span class="pre">%}</span></code> は現在のロケールの文章を書く方向を返します。もし <code class="docutils literal notranslate"><span class="pre">True</span></code> なら、ヘブライ語やアラビア語などの右から左へ書く言語です。もし <code class="docutils literal notranslate"><span class="pre">False</span></code> なら、英語、フランス語、ドイツ語などの左から右へ書く言語です。</p>
</section>
<section id="s-i18n-context-processor">
<span id="s-template-translation-vars"></span><span id="i18n-context-processor"></span><span id="template-translation-vars"></span><h4><code class="docutils literal notranslate"><span class="pre">i18n</span></code> コンテキストプロセッサ<a class="headerlink" href="#i18n-context-processor" title="Link to this heading">¶</a></h4>
<p>もし <a class="reference internal" href="../../ref/templates/api.html#django.template.context_processors.i18n" title="django.template.context_processors.i18n"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.template.context_processors.i18n</span></code></a> コンテキストプロセッサを有効にすると、各 <code class="docutils literal notranslate"><span class="pre">RequestContext</span></code> は上で定義した <code class="docutils literal notranslate"><span class="pre">LANGUAGES</span></code>, <code class="docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code>, <code class="docutils literal notranslate"><span class="pre">LANGUAGE_BIDI</span></code> にアクセスできるようになります。</p>
</section>
<section id="s-get-language-info">
<span id="s-std-templatetag-get_language_info"></span><span id="get-language-info"></span><span id="std-templatetag-get_language_info"></span><h4><code class="docutils literal notranslate"><span class="pre">get_language_info</span></code><a class="headerlink" href="#get-language-info" title="Link to this heading">¶</a></h4>
<p>また、提供されているテンプレートタグとフィルタを使えば、利用可能な言語の情報を取得することもできます。一つの言語に関する情報を取得するには <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_language_info</span> <span class="pre">%}</span></code> タグを使います:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">get_language_info</span> <span class="nv">for</span> <span class="nv">LANGUAGE_CODE</span> <span class="k">as</span> <span class="nv">lang</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">get_language_info</span> <span class="nv">for</span> <span class="s2">&quot;pl&quot;</span> <span class="k">as</span> <span class="nv">lang</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>その後、下記のように情報にアクセスできます:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span>Language code: <span class="cp">{{</span> <span class="nv">lang.code</span> <span class="cp">}}</span><span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
Name of language: <span class="cp">{{</span> <span class="nv">lang.name_local</span> <span class="cp">}}</span><span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
Name in English: <span class="cp">{{</span> <span class="nv">lang.name</span> <span class="cp">}}</span><span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
Bi-directional: <span class="cp">{{</span> <span class="nv">lang.bidi</span> <span class="cp">}}</span>
Name in the active language: <span class="cp">{{</span> <span class="nv">lang.name_translated</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
<section id="s-get-language-info-list">
<span id="s-std-templatetag-get_language_info_list"></span><span id="get-language-info-list"></span><span id="std-templatetag-get_language_info_list"></span><h4><code class="docutils literal notranslate"><span class="pre">get_language_info_list</span></code><a class="headerlink" href="#get-language-info-list" title="Link to this heading">¶</a></h4>
<p>また、<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_language_info_list</span> <span class="pre">%}</span></code> のテンプレートタグを使えば、言語のリスト(例えば <a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGES</span></code></a> で指定されたアクティブな言語)の情報を取得できます。<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_language_info_list</span> <span class="pre">%}</span></code> を使って言語セレクタを表示する方法の例は <a class="reference internal" href="#set-language-redirect-view"><span class="std std-ref">set_language リダイレクトビューのセクション</span></a> を参照してください。</p>
<p><a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGES</span></code></a> 形式のタプルのリストに加え、<code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_language_info_list</span> <span class="pre">%}</span></code> は言語コードのリストをサポートしています。これをビューで実行すると:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;available_languages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="s2">&quot;es&quot;</span><span class="p">,</span> <span class="s2">&quot;fr&quot;</span><span class="p">]}</span>
<span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;mytemplate.html&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>を使用すると、テンプレート内でそれらの言語のリストをイテレートできます:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">get_language_info_list</span> <span class="nv">for</span> <span class="nv">available_languages</span> <span class="k">as</span> <span class="nv">langs</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">lang</span> <span class="k">in</span> <span class="nv">langs</span> <span class="cp">%}</span> ... <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
</section>
<section id="s-template-filters">
<span id="s-std-templatefilter-language_name_translated"></span><span id="s-std-templatefilter-language_bidi"></span><span id="s-std-templatefilter-language_name_local"></span><span id="s-std-templatefilter-language_name"></span><span id="template-filters"></span><span id="std-templatefilter-language_name_translated"></span><span id="std-templatefilter-language_bidi"></span><span id="std-templatefilter-language_name_local"></span><span id="std-templatefilter-language_name"></span><h4>テンプレートフィルタ<a class="headerlink" href="#template-filters" title="Link to this heading">¶</a></h4>
<p>いくつかの便利なフィルタが使えます:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">LANGUAGE_CODE|language_name</span> <span class="pre">}}</span></code> (&quot;German&quot;)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">LANGUAGE_CODE|language_name_local</span> <span class="pre">}}</span></code> (&quot;Deutsch&quot;)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">LANGUAGE_CODE|language_bidi</span> <span class="pre">}}</span></code> (False)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">LANGUAGE_CODE|language_name_translated</span> <span class="pre">}}</span></code> (&quot;německy&quot;, when active language is Czech)</p></li>
</ul>
</section>
</section>
</section>
<section id="s-internationalization-in-javascript-code">
<span id="internationalization-in-javascript-code"></span><h2>国際化: JavaScript コード内<a class="headerlink" href="#internationalization-in-javascript-code" title="Link to this heading">¶</a></h2>
<p>JavaScript に対する翻訳には、いくつか問題があります:</p>
<ul class="simple">
<li><p>JavaScript コードは <code class="docutils literal notranslate"><span class="pre">gettext</span></code> 実行にアクセスできません。</p></li>
<li><p>JavaScript コードは <code class="docutils literal notranslate"><span class="pre">.po</span></code> や <code class="docutils literal notranslate"><span class="pre">.mo</span></code> ファイルにアクセスできません; サーバーによって配布される必要があります。</p></li>
<li><p>JavaScript 用の翻訳カタログはできる限り小さくなければなりません。</p></li>
</ul>
<p>Django には、これらの問題に対する総合的な解決策が用意されています: 翻訳を JavaScript に渡し、<code class="docutils literal notranslate"><span class="pre">gettext</span></code> などを JavaScript 内から呼び出せるようにする方法です。</p>
<p>主な解決策は以下の <code class="docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code> ビューです。これは、<code class="docutils literal notranslate"><span class="pre">gettext</span></code> を擬似的に再現する関数と翻訳文字列の配列で JavaScript コードライブラリを生成します。</p>
<section id="s-module-django.views.i18n">
<span id="s-the-javascriptcatalog-view"></span><span id="module-django.views.i18n"></span><span id="the-javascriptcatalog-view"></span><h3><code class="docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code> ビュー<a class="headerlink" href="#module-django.views.i18n" title="Link to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="django.views.i18n.JavaScriptCatalog">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">JavaScriptCatalog</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/views/i18n.py#L98"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.views.i18n.JavaScriptCatalog" title="Link to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">gettext</span></code> インターフェイスを擬似的に再現する関数と翻訳文字列の配列で、JavaScriptのコードライブラリを生成するビューです。</p>
<p><strong>属性</strong></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.views.i18n.JavaScriptCatalog.domain">
<span class="sig-name descname"><span class="pre">domain</span></span><a class="headerlink" href="#django.views.i18n.JavaScriptCatalog.domain" title="Link to this definition">¶</a></dt>
<dd><p>ビューの出力に追加する文字列を含む翻訳ドメインです。デフォルトは <code class="docutils literal notranslate"><span class="pre">'djangojs'</span></code> です。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.views.i18n.JavaScriptCatalog.packages">
<span class="sig-name descname"><span class="pre">packages</span></span><a class="headerlink" href="#django.views.i18n.JavaScriptCatalog.packages" title="Link to this definition">¶</a></dt>
<dd><p>インストールされたアプリケーション間の <a class="reference internal" href="../../ref/applications.html#django.apps.AppConfig.name" title="django.apps.AppConfig.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">application</span> <span class="pre">names</span></code></a> のリストです。これらのアプリケーションは <code class="docutils literal notranslate"><span class="pre">locale</span></code> ディレクトリを含んでいる必要があります。これらのカタログに加えて  (常に含まれている) <a class="reference internal" href="../../ref/settings.html#std-setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> 内で見つかった全てのカタログは、1 つのカタログに統合されます。デフォルトは <code class="docutils literal notranslate"><span class="pre">None</span></code> で、全ての <a class="reference internal" href="../../ref/settings.html#std-setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> からの利用可能な翻訳は JavaScript の出力に渡されることを意味します。</p>
</dd></dl>

<p><strong>デフォルト値を使った例</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.views.i18n</span><span class="w"> </span><span class="kn">import</span> <span class="n">JavaScriptCatalog</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;jsi18n/&quot;</span><span class="p">,</span> <span class="n">JavaScriptCatalog</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;javascript-catalog&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>独自のパッケージを使った例</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span>
        <span class="s2">&quot;jsi18n/myapp/&quot;</span><span class="p">,</span>
        <span class="n">JavaScriptCatalog</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;your.app.label&quot;</span><span class="p">]),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;javascript-catalog&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>ルートの URLconf が <a class="reference internal" href="#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a>、<code class="docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code> を使っている場合、カタログが正しく生成されるように <code class="docutils literal notranslate"><span class="pre">i18n_patterns()</span></code> によるラップも必要となります。</p>
<p><code class="docutils literal notranslate"><span class="pre">i18n_patterns()</span></code> <strong>を使った例</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.conf.urls.i18n</span><span class="w"> </span><span class="kn">import</span> <span class="n">i18n_patterns</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">i18n_patterns</span><span class="p">(</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;jsi18n/&quot;</span><span class="p">,</span> <span class="n">JavaScriptCatalog</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;javascript-catalog&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<p>翻訳の優先順位は、<code class="docutils literal notranslate"><span class="pre">packages</span></code> 引数で後に現れるパッケージの方が、最初に現れるものよりも高くなります。これは、同じリテラルに対する翻訳が衝突する場合に重要です。</p>
<p>サイト上で複数の <code class="docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code> ビューを使っていてそのうちのいくつかが同じ文字列を定義している場合、最後にロードされたカタログ内の文字列が優先されます。</p>
</section>
<section id="s-using-the-javascript-translation-catalog">
<span id="using-the-javascript-translation-catalog"></span><h3>JavaScript 翻訳カタログを使う<a class="headerlink" href="#using-the-javascript-translation-catalog" title="Link to this heading">¶</a></h3>
<p>カタログを使うには、以下のように動的に生成されたスクリプトを参照してください:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;javascript-catalog&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>これは、reverse URL を使用して、JavaScript カタログビューの URL をルックアップします。カタログがロードされると、JavaScript コードは以下のメソッドを使えるようになります:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gettext</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ngettext</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">interpolate</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_format</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gettext_noop</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pgettext</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">npgettext</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pluralidx</span></code></p></li>
</ul>
<section id="s-gettext">
<span id="gettext"></span><h4><code class="docutils literal notranslate"><span class="pre">gettext</span></code><a class="headerlink" href="#gettext" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">gettext</span></code> 関数は、Python コード内の標準の <code class="docutils literal notranslate"><span class="pre">gettext</span></code> インターフェースと同じように動作します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">document</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gettext</span><span class="p">(</span><span class="s2">&quot;this is to be translated&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="s-ngettext">
<span id="ngettext"></span><h4><code class="docutils literal notranslate"><span class="pre">ngettext</span></code><a class="headerlink" href="#ngettext" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">ngettext</span></code> 関数は単語やフレーズを複数形にするインターフェースを提供します:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">objectCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="c1">// or 0, or 2, or 3, ...</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ngettext</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;literal for the singular case&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;literal for the plural case&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">objectCount</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
<section id="s-interpolate">
<span id="interpolate"></span><h4><code class="docutils literal notranslate"><span class="pre">interpolate</span></code><a class="headerlink" href="#interpolate" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">interpolate</span></code> 関数は表示形式の文字列の動的な記入をサポートします。補完の構文は  Python を模しているので、<code class="docutils literal notranslate"><span class="pre">interpolate</span></code> 関数は位置および名前付きの補完の両方をサポートします。</p>
<ul>
<li><p>位置による補完: <code class="docutils literal notranslate"><span class="pre">obj</span></code> は、表示されるのと同じ順番で要素の値が一致する <code class="docutils literal notranslate"><span class="pre">fmt</span></code> プレースホルダ内で連続的に補完される JavaScript Array オブジェクトを含んでいます。例えば:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">formats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ngettext</span><span class="p">(</span>
<span class="w">  </span><span class="s1">&#39;There is %s object. Remaining: %s&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;There are %s objects. Remaining: %s&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="mf">11</span>
<span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">interpolate</span><span class="p">(</span><span class="nx">formats</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mf">11</span><span class="p">,</span><span class="w"> </span><span class="mf">20</span><span class="p">]);</span>
<span class="c1">// string is &#39;There are 11 objects. Remaining: 20&#39;</span>
</pre></div>
</div>
</li>
<li><p>名前付きの補完: このモードは <code class="docutils literal notranslate"><span class="pre">named</span></code> パラメータを <code class="docutils literal notranslate"><span class="pre">true</span></code> として渡すことで選択されます。<code class="docutils literal notranslate"><span class="pre">obj</span></code> は JavaScript オブジェクトや結合配列を含みます。例えば:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span>
<span class="w">  </span><span class="nx">total</span><span class="o">:</span><span class="w"> </span><span class="mf">50</span>
<span class="p">};</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">formats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ngettext</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;Total: %(total)s, there is %(count)s object&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;there are %(count)s of a total of %(total)s objects&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">data</span><span class="p">.</span><span class="nx">count</span>
<span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">interpolate</span><span class="p">(</span><span class="nx">formats</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
<p>ただし文字列補間は、やり過ぎるべきではありません。これはまだ JavaScript なので、コードは何度も正規表現による置換を行う必要があります。これは Python の文字列補間ほど速くはないので、本当に必要な場合（例えば、<code class="docutils literal notranslate"><span class="pre">ngettext</span></code> と組み合わせて適切な複数形を生成する場合など）に限定してください。</p>
</section>
<section id="s-get-format">
<span id="get-format"></span><h4><code class="docutils literal notranslate"><span class="pre">get_format</span></code><a class="headerlink" href="#get-format" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">get_format</span></code> 関数は設定済みの i18n 表示形式設定にアクセスでき、与えられた設定名に対して表示形式文字列を取り出します:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">get_format</span><span class="p">(</span><span class="s1">&#39;DATE_FORMAT&#39;</span><span class="p">));</span>
<span class="c1">// &#39;N j, Y&#39;</span>
</pre></div>
</div>
<p>以下の設定に対してアクセスします:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-DATE_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATE_FORMAT</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-DATE_INPUT_FORMATS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATE_INPUT_FORMATS</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-DATETIME_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATETIME_FORMAT</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-DATETIME_INPUT_FORMATS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATETIME_INPUT_FORMATS</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-DECIMAL_SEPARATOR"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DECIMAL_SEPARATOR</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-FIRST_DAY_OF_WEEK"><code class="xref std std-setting docutils literal notranslate"><span class="pre">FIRST_DAY_OF_WEEK</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-MONTH_DAY_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MONTH_DAY_FORMAT</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-NUMBER_GROUPING"><code class="xref std std-setting docutils literal notranslate"><span class="pre">NUMBER_GROUPING</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-SHORT_DATE_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SHORT_DATE_FORMAT</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-SHORT_DATETIME_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SHORT_DATETIME_FORMAT</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-THOUSAND_SEPARATOR"><code class="xref std std-setting docutils literal notranslate"><span class="pre">THOUSAND_SEPARATOR</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-TIME_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">TIME_FORMAT</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-TIME_INPUT_FORMATS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">TIME_INPUT_FORMATS</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-YEAR_MONTH_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">YEAR_MONTH_FORMAT</span></code></a></p></li>
</ul>
<p>これは、Python によってレンダリングされる値と一貫性を持った表示形式を保守するために役立ちます。</p>
</section>
<section id="s-gettext-noop">
<span id="gettext-noop"></span><h4><code class="docutils literal notranslate"><span class="pre">gettext_noop</span></code><a class="headerlink" href="#gettext-noop" title="Link to this heading">¶</a></h4>
<p>これは <code class="docutils literal notranslate"><span class="pre">gettext</span></code> 関数をエミュレートしますが、何もせず、渡されたものをそのまま返します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">document</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gettext_noop</span><span class="p">(</span><span class="s2">&quot;this will not be translated&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>これは、将来的に翻訳が必要なコードの部分をもみ消しておくのに役立ちます。</p>
</section>
<section id="s-pgettext">
<span id="pgettext"></span><h4><code class="docutils literal notranslate"><span class="pre">pgettext</span></code><a class="headerlink" href="#pgettext" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">pgettext</span></code> 関数は Python の変数 (<a class="reference internal" href="../../ref/utils.html#django.utils.translation.pgettext" title="django.utils.translation.pgettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">pgettext()</span></code></a>) のように動作し、文脈的に翻訳される単語を提供します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">document</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pgettext</span><span class="p">(</span><span class="s2">&quot;month name&quot;</span><span class="p">,</span> <span class="s2">&quot;May&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="s-npgettext">
<span id="npgettext"></span><h4><code class="docutils literal notranslate"><span class="pre">npgettext</span></code><a class="headerlink" href="#npgettext" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">npgettext</span></code> 関数も Python 変数 (<a class="reference internal" href="../../ref/utils.html#django.utils.translation.npgettext" title="django.utils.translation.npgettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">npgettext()</span></code></a>) のように動作し、<strong>複数形の</strong> 文脈的に翻訳される単語を提供します:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">npgettext</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;party&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">));</span>
<span class="c1">// party</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">npgettext</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;party&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">));</span>
<span class="c1">// parties</span>
</pre></div>
</div>
</section>
<section id="s-pluralidx">
<span id="pluralidx"></span><h4><code class="docutils literal notranslate"><span class="pre">pluralidx</span></code><a class="headerlink" href="#pluralidx" title="Link to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">pluralidx</span></code> 関数は <a class="reference internal" href="../../ref/templates/builtins.html#std-templatefilter-pluralize"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">pluralize</span></code></a> テンプレートフィルタと同じように動作し、与えられた <code class="docutils literal notranslate"><span class="pre">count</span></code> が単語の複数形を使うべきかどうかを決めます:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">pluralidx</span><span class="p">(</span><span class="mf">0</span><span class="p">));</span>
<span class="c1">// true</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">pluralidx</span><span class="p">(</span><span class="mf">1</span><span class="p">));</span>
<span class="c1">// false</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">pluralidx</span><span class="p">(</span><span class="mf">2</span><span class="p">));</span>
<span class="c1">// true</span>
</pre></div>
</div>
<p>最も単純なケースでは、独自の複数形が必要ない場合、これは整数 <code class="docutils literal notranslate"><span class="pre">1</span></code> に対して <code class="docutils literal notranslate"><span class="pre">false</span></code> を返し、他の数に対して <code class="docutils literal notranslate"><span class="pre">true</span></code> を返します。</p>
<p>ただし、複数形は全ての言語でこのようにシンプルではありません。言語が複数形をサポートしていない場合、空の値が渡されます。</p>
<p>加えて、複数形に関して複雑なルールが存在する場合、カタログビューは条件付きの表現をレンダリングします。これは、値を <code class="docutils literal notranslate"><span class="pre">true</span></code> (複数形) と <code class="docutils literal notranslate"><span class="pre">false</span></code> (複数形 <strong>ではない</strong> ) のどちらにするかを評価します。</p>
</section>
</section>
<section id="s-the-jsoncatalog-view">
<span id="the-jsoncatalog-view"></span><h3><code class="docutils literal notranslate"><span class="pre">JSONCatalog</span></code> ビュー<a class="headerlink" href="#the-jsoncatalog-view" title="Link to this heading">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="django.views.i18n.JSONCatalog">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">JSONCatalog</span></span><a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/views/i18n.py#L232"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.views.i18n.JSONCatalog" title="Link to this definition">¶</a></dt>
<dd><p>他のクライアントサイドのライブラリを使って翻訳を扱うためには、<code class="docutils literal notranslate"><span class="pre">JSONCatalog</span></code> を利用するのがいいでしょう。<a class="reference internal" href="#django.views.i18n.JavaScriptCatalog" title="django.views.i18n.JavaScriptCatalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code></a> と似ていますが、JSON のレスポンスを返します。</p>
<p>使える値を知るには、<a class="reference internal" href="#django.views.i18n.JavaScriptCatalog" title="django.views.i18n.JavaScriptCatalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code></a> を参照してください。また、<code class="docutils literal notranslate"><span class="pre">domain</span></code> と <code class="docutils literal notranslate"><span class="pre">packages</span></code> 属性を使用してください。</p>
<p>レスポンスの形式は以下の通りです:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
    &quot;catalog&quot;: {
        # Translations catalog
    },
    &quot;formats&quot;: {
        # Language formats for date, time, etc.
    },
    &quot;plural&quot;: &quot;...&quot;  # Expression for plural forms, or null.
}
</pre></div>
</div>
</dd></dl>

</section>
<section id="s-note-on-performance">
<span id="note-on-performance"></span><h3>実行速度についての覚え書き<a class="headerlink" href="#note-on-performance" title="Link to this heading">¶</a></h3>
<p>たくさんの JavaScript/JSON i18n ビューは全てのリクエストで <code class="docutils literal notranslate"><span class="pre">.mo</span></code> ファイルからカタログを生成します。出力は一定なので、少なくとも与えられたサイトのバージョンに対しては、キャッシュが有力な選択肢となります。</p>
<p>サーバーサイドのキャッシシュは CPU の負担を軽減します。 <a class="reference internal" href="../cache.html#django.views.decorators.cache.cache_page" title="django.views.decorators.cache.cache_page"><code class="xref py py-func docutils literal notranslate"><span class="pre">cache_page()</span></code></a> デコレータを使うと簡単に実装できます。翻訳を変更したときにキャッシュの無効部分をトリガーするには、以下の例にあるようにバージョンに依存したキープレフィックスを使ってください。もしくは、バージョンに依存した URL でビューをマッピングしてください:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.views.decorators.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">cache_page</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.views.i18n</span><span class="w"> </span><span class="kn">import</span> <span class="n">JavaScriptCatalog</span>

<span class="c1"># The value returned by get_version() must change when translations change.</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span>
        <span class="s2">&quot;jsi18n/&quot;</span><span class="p">,</span>
        <span class="n">cache_page</span><span class="p">(</span><span class="mi">86400</span><span class="p">,</span> <span class="n">key_prefix</span><span class="o">=</span><span class="s2">&quot;jsi18n-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">get_version</span><span class="p">())(</span>
            <span class="n">JavaScriptCatalog</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span>
        <span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;javascript-catalog&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>クライアントサイドのキャッシュは帯域を節約し、サイトの読み込みを速くします。ETags (<a class="reference internal" href="../../ref/middleware.html#django.middleware.http.ConditionalGetMiddleware" title="django.middleware.http.ConditionalGetMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConditionalGetMiddleware</span></code></a>) を使っている場合、すでに適用済みです。それ以外の場合は、<a class="reference internal" href="../conditional-view-processing.html#conditional-decorators"><span class="std std-ref">条件付きデコレータ</span></a> を参照してみてください。以下の例では、アプリケーションサーバを再起動するとキャッシュの効力がなくなります:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.views.decorators.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">last_modified</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.views.i18n</span><span class="w"> </span><span class="kn">import</span> <span class="n">JavaScriptCatalog</span>

<span class="n">last_modified_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span>
        <span class="s2">&quot;jsi18n/&quot;</span><span class="p">,</span>
        <span class="n">last_modified</span><span class="p">(</span><span class="k">lambda</span> <span class="n">req</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">last_modified_date</span><span class="p">)(</span>
            <span class="n">JavaScriptCatalog</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span>
        <span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;javascript-catalog&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>デプロイ手順の一環として、JavaScript カタログを事前に生成し、静的ファイルとして提供することもできます。この革新的な手法は、<a class="extlink-pypi reference external" href="https://pypi.org/project/django-statici18n/">django-statici18n</a> によって実装されています。</p>
</section>
</section>
<section id="s-module-django.conf.urls.i18n">
<span id="s-internationalization-in-url-patterns"></span><span id="s-url-internationalization"></span><span id="module-django.conf.urls.i18n"></span><span id="internationalization-in-url-patterns"></span><span id="url-internationalization"></span><h2>国際化: URL パターン内<a class="headerlink" href="#module-django.conf.urls.i18n" title="Link to this heading">¶</a></h2>
<p>Django には、URL パターンを国際化するための 2 つの仕組みが用意されています:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../ref/middleware.html#django.middleware.locale.LocaleMiddleware" title="django.middleware.locale.LocaleMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code></a> が、リクエストされた URL からアクティブにする言語を検出できるようにするため、URL パターンのルートに言語のプレフィックスを追加します。</p></li>
<li><p>URL パターン自体を <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext_lazy" title="django.utils.translation.gettext_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.gettext_lazy()</span></code></a> 関数を通じて翻訳可能にする。</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>この 2 つのうちどちらを使う場合でも、各リクエストに対してアクティブな言語をセットすることが必要となります; 言い換えれば、<a class="reference internal" href="../../ref/settings.html#std-setting-MIDDLEWARE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code></a> 設定内に <a class="reference internal" href="../../ref/middleware.html#django.middleware.locale.LocaleMiddleware" title="django.middleware.locale.LocaleMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.middleware.locale.LocaleMiddleware</span></code></a> を記述しておく必要があります。</p>
</div>
<section id="s-language-prefix-in-url-patterns">
<span id="language-prefix-in-url-patterns"></span><h3>URL パターンにおける言語プレフィックス<a class="headerlink" href="#language-prefix-in-url-patterns" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="django.conf.urls.i18n.i18n_patterns">
<span class="sig-name descname"><span class="pre">i18n_patterns</span></span>(<em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">urls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix_default_language</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/conf/urls/i18n.py#L8"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.conf.urls.i18n.i18n_patterns" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<p>この関数は、ルートの URLconf で使うことができ、Django は自動的に現在アクティブな言語のコードを <a class="reference internal" href="#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a> で定義された全ての URL パターンの先頭に追加します。</p>
<p><code class="docutils literal notranslate"><span class="pre">prefix_default_language</span></code> を <code class="docutils literal notranslate"><span class="pre">False</span></code> にセットすると、デフォルト言語 (<a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a>) からプレフィックスを除去します。これは、現在の URL を変更しないよう既存のサイトに翻訳を追加するとき、役に立ちます。</p>
<p>URL パターンの例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.conf.urls.i18n</span><span class="w"> </span><span class="kn">import</span> <span class="n">i18n_patterns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">about</span><span class="w"> </span><span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">about_views</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">news</span><span class="w"> </span><span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">news_views</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sitemap.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">sitemap</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;sitemap.xml&quot;</span><span class="p">,</span> <span class="n">sitemap</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sitemap-xml&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">news_patterns</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">[</span>
        <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">news_views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">),</span>
        <span class="n">path</span><span class="p">(</span><span class="s2">&quot;category/&lt;slug:slug&gt;/&quot;</span><span class="p">,</span> <span class="n">news_views</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">),</span>
        <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&lt;slug:slug&gt;/&quot;</span><span class="p">,</span> <span class="n">news_views</span><span class="o">.</span><span class="n">details</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;detail&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;news&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">i18n_patterns</span><span class="p">(</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;about/&quot;</span><span class="p">,</span> <span class="n">about_views</span><span class="o">.</span><span class="n">main</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;about&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;news/&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">news_patterns</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;news&quot;</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>これらの URL パターンを定義すると、Django は自動的に <code class="docutils literal notranslate"><span class="pre">i18n_patterns</span></code> 関数で追加された URL パターンに言語プレフィックスを追加します。例:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">reverse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">activate</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;sitemap-xml&quot;</span><span class="p">)</span>
<span class="go">&#39;/sitemap.xml&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;news:index&quot;</span><span class="p">)</span>
<span class="go">&#39;/en/news/&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s2">&quot;nl&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;news:detail&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;slug&quot;</span><span class="p">:</span> <span class="s2">&quot;news-slug&quot;</span><span class="p">})</span>
<span class="go">&#39;/nl/news/news-slug/&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">prefix_default_language=False</span></code> と <code class="docutils literal notranslate"><span class="pre">LANGUAGE_CODE='en'</span></code> を使うと、URL は以下のようになります:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;news:index&quot;</span><span class="p">)</span>
<span class="go">&#39;/news/&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s2">&quot;nl&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;news:index&quot;</span><span class="p">)</span>
<span class="go">&#39;/nl/news/&#39;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p><a class="reference internal" href="#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a> はルートの URLconf のみで使うことができます。インクルードされた URLconf で使うと <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.ImproperlyConfigured" title="django.core.exceptions.ImproperlyConfigured"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImproperlyConfigured</span></code></a> 例外を投げます。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>自動的に追加される言語プレフィックスと重複するようなプレフィックスを持った URL パターンにしないように注意してください。</p>
</div>
</section>
<section id="s-translating-url-patterns">
<span id="s-translating-urlpatterns"></span><span id="translating-url-patterns"></span><span id="translating-urlpatterns"></span><h3>URL パターンを翻訳する<a class="headerlink" href="#translating-url-patterns" title="Link to this heading">¶</a></h3>
<p>URL パターンは、<a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext_lazy" title="django.utils.translation.gettext_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext_lazy()</span></code></a> 関数を使って、翻訳可能にマークすることもできます。例えば:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.conf.urls.i18n</span><span class="w"> </span><span class="kn">import</span> <span class="n">i18n_patterns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">about</span><span class="w"> </span><span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">about_views</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">news</span><span class="w"> </span><span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">news_views</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sitemaps.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">sitemap</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;sitemap.xml&quot;</span><span class="p">,</span> <span class="n">sitemap</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sitemap-xml&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">news_patterns</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">[</span>
        <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">news_views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">),</span>
        <span class="n">path</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;category/&lt;slug:slug&gt;/&quot;</span><span class="p">),</span> <span class="n">news_views</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">),</span>
        <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&lt;slug:slug&gt;/&quot;</span><span class="p">,</span> <span class="n">news_views</span><span class="o">.</span><span class="n">details</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;detail&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;news&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">i18n_patterns</span><span class="p">(</span>
    <span class="n">path</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;about/&quot;</span><span class="p">),</span> <span class="n">about_views</span><span class="o">.</span><span class="n">main</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;about&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;news/&quot;</span><span class="p">),</span> <span class="n">include</span><span class="p">(</span><span class="n">news_patterns</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;news&quot;</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>翻訳を作成した後に、<a class="reference internal" href="../../ref/urlresolvers.html#django.urls.reverse" title="django.urls.reverse"><code class="xref py py-func docutils literal notranslate"><span class="pre">reverse()</span></code></a> 関数はアクティブな言語で URL を返します。例えば:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">reverse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">activate</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;news:category&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;slug&quot;</span><span class="p">:</span> <span class="s2">&quot;recent&quot;</span><span class="p">})</span>
<span class="go">&#39;/en/news/category/recent/&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s2">&quot;nl&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;news:category&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;slug&quot;</span><span class="p">:</span> <span class="s2">&quot;recent&quot;</span><span class="p">})</span>
<span class="go">&#39;/nl/nieuws/categorie/recent/&#39;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>ほとんどの場合、（ <a class="reference internal" href="#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a> を使用して）翻訳されたURLは、言語コードが接頭辞として付けられたパターンのブロック内でのみ使用することが最も良い選択です。不用意に翻訳された URL が翻訳されていない URL パターンと衝突するのを避けるためです。</p>
</div>
</section>
<section id="s-reversing-in-templates">
<span id="s-id2"></span><span id="reversing-in-templates"></span><span id="id2"></span><h3>テンプレート内で逆引きする<a class="headerlink" href="#reversing-in-templates" title="Link to this heading">¶</a></h3>
<p>ローカライズされた URL がテンプレート内でリバースされる場合、常に現在の言語が使用されます。他の言語の URL にリンクを貼るには、<a class="reference internal" href="#std-templatetag-language"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">language</span></code></a> テンプレートタグを使ってください。これは、テンプレートの囲まれた範囲内で、指定された言語を有効化します:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">i18n</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">get_available_languages</span> <span class="k">as</span> <span class="nv">languages</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;View this category in:&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">lang_code</span><span class="o">,</span> <span class="nv">lang_name</span> <span class="k">in</span> <span class="nv">languages</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">language</span> <span class="nv">lang_code</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;category&#39;</span> <span class="nv">slug</span><span class="o">=</span><span class="nv">category.slug</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">lang_name</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endlanguage</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p><a class="reference internal" href="#std-templatetag-language"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">language</span></code></a> タグは引数のみとして言語コードを予期します。</p>
</section>
</section>
<section id="s-localization-how-to-create-language-files">
<span id="s-how-to-create-language-files"></span><span id="localization-how-to-create-language-files"></span><span id="how-to-create-language-files"></span><h2>ローカライズ: 言語ファイルを作成する方法<a class="headerlink" href="#localization-how-to-create-language-files" title="Link to this heading">¶</a></h2>
<p>アプリケーションの文字列リテラルが後の翻訳にためにタグづけされ終わったら、翻訳自体を記述する (もしくは取得する) 必要があります。以下は、その方法です。</p>
<section id="s-message-files">
<span id="message-files"></span><h3>メッセージファイル<a class="headerlink" href="#message-files" title="Link to this heading">¶</a></h3>
<p>最初のステップは、新しい言語に対する <a class="reference internal" href="index.html#term-message-file"><span class="xref std std-term">message file</span></a> を作成することです。メッセージファイルはプレーンテキストファイルで、単一の言語を記述します。このファイルは、全ての翻訳可能な文字列とそれらがどのように与えられた言語で表示されるかを含みます。メッセージファイルは <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイル拡張子を持ちます。</p>
<p>Djangoには <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a> というツールが用意してあり、これらのファイルの作成と保全を自動化します。</p>
<div class="admonition-gettext-utilities admonition">
<p class="admonition-title">Gettext ユーティリティ</p>
<p><code class="docutils literal notranslate"><span class="pre">makemessages</span></code> コマンド (と後述する <code class="docutils literal notranslate"><span class="pre">compilemessages</span></code>) は、GNU gettext ツールセットからのコマンドを使用します: <code class="docutils literal notranslate"><span class="pre">xgettext</span></code>、<code class="docutils literal notranslate"><span class="pre">msgfmt</span></code>、<code class="docutils literal notranslate"><span class="pre">msgmerge</span></code>、<code class="docutils literal notranslate"><span class="pre">msguniq</span></code> です。</p>
<p>サポートされている <code class="docutils literal notranslate"><span class="pre">gettext</span></code> ユーティリティの最小バージョンは 0.15 です。</p>
</div>
<p>メッセージファイルを作成または更新するには、以下のコマンドを実行してください:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>django-admin<span class="w"> </span>makemessages<span class="w"> </span>-l<span class="w"> </span>de
</pre></div>
</div>
<p>...ここでの <code class="docutils literal notranslate"><span class="pre">de</span></code> は作成したいメッセージファイルに対するロケール名 <a class="reference internal" href="index.html#term-locale-name"><span class="xref std std-term">locale name</span></a> です。例えば、ブラジル系のポルトガル語に対する <code class="docutils literal notranslate"><span class="pre">pt_BR</span></code>、オーストリア系のドイツ語に対する <code class="docutils literal notranslate"><span class="pre">de_AT</span></code>、インドネシアに対する <code class="docutils literal notranslate"><span class="pre">id</span></code> などです。</p>
<p>スクリプトは、2 つの場所のうち 1 つから実行する必要があります:</p>
<ul class="simple">
<li><p>Django プロジェクトのルートディレクトリ (<code class="docutils literal notranslate"><span class="pre">manage.py</span></code> を含むところ)。</p></li>
<li><p>Django アプリケーションのルートディレクトリ。</p></li>
</ul>
<p>スクリプトは、プロジェクトのソースツリーもしくはアプリケーションのソースツリーを通じて実行され、翻訳用にマークされた全ての文字列 (<a class="reference internal" href="#how-django-discovers-translations"><span class="std std-ref">Djangoはどうやって翻訳を見つけるのか？</span></a> を参照して <a class="reference internal" href="../../ref/settings.html#std-setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> を正しく設定してください) を抽出します。ディレクトリ <code class="docutils literal notranslate"><span class="pre">locale/LANG/LC_MESSAGES</span></code> にメッセージファイルを作成 (もしくは更新) します。<code class="docutils literal notranslate"><span class="pre">de</span></code> の例では、ファイルは <code class="docutils literal notranslate"><span class="pre">locale/de/LC_MESSAGES/django.po</span></code> となります。</p>
<p>プロジェクトのルートディレクトリから <code class="docutils literal notranslate"><span class="pre">makemessages</span></code> を実行したとき、抽出された文字列は自動的に適切なメッセージファイルへと分配されます。つまり、<code class="docutils literal notranslate"><span class="pre">locale</span></code> ディレクトリを含むアプリケーションのファイルから抽出された文字列は、そのディレクトリ下のメッセージファイルに格納されます。<code class="docutils literal notranslate"><span class="pre">locale</span></code> ディレクトリがないアプリケーションのファイルから抽出された文字列は、<a class="reference internal" href="../../ref/settings.html#std-setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> 内に最初にリストアップされたディレクトリ下にあるメッセージファイルか、もしくは <a class="reference internal" href="../../ref/settings.html#std-setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> が空の場合はエラーを生成します。</p>
<p>デフォルトでは <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a> は <code class="docutils literal notranslate"><span class="pre">.html</span></code> 、 <code class="docutils literal notranslate"><span class="pre">.txt</span></code> または <code class="docutils literal notranslate"><span class="pre">py</span></code> のファイル拡張子を持つファイルを全て検査します。このデフォルトの動作をオーバーライドしたい場合は、 <a class="reference internal" href="../../ref/django-admin.html#cmdoption-makemessages-extension"><code class="xref std std-option docutils literal notranslate"><span class="pre">--extension</span></code></a> か <code class="docutils literal notranslate"><span class="pre">-e</span></code> オプションを使って検査するファイル拡張子を指定します:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>django-admin<span class="w"> </span>makemessages<span class="w"> </span>-l<span class="w"> </span>de<span class="w"> </span>-e<span class="w"> </span>txt
</pre></div>
</div>
<p>複数の拡張子をカンマで区切るか、<code class="docutils literal notranslate"><span class="pre">-e</span></code> または <code class="docutils literal notranslate"><span class="pre">--extension</span></code> を複数回使用してください:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>django-admin<span class="w"> </span>makemessages<span class="w"> </span>-l<span class="w"> </span>de<span class="w"> </span>-e<span class="w"> </span>html,txt<span class="w"> </span>-e<span class="w"> </span>xml
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p><a class="reference internal" href="#creating-message-files-from-js-code"><span class="std std-ref">JavaScript のソースコードからメッセージファイルを作成する</span></a> とき、 <code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">js</span></code> <strong>ではなく</strong> 、特別な <code class="docutils literal notranslate"><span class="pre">djangojs</span></code> ドメインを使用する必要があります。</p>
</div>
<div class="admonition-using-jinja2-templates admonition">
<p class="admonition-title">Jinja2 テンプレートを使う？</p>
<p><a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> はJinja2テンプレートの構文を理解しません。Jinja2テンプレートを含むプロジェクトから文字列を抽出するには、代わりに <a class="reference external" href="https://babel.pocoo.org/en/latest/">Babel</a> の <a class="reference external" href="https://babel.pocoo.org/en/latest/messages.html#message-extraction">Message Extracting</a> を使ってください。</p>
<p>以下は <code class="docutils literal notranslate"><span class="pre">babel.cfg</span></code> 設定ファイルの例です:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extraction from Python source files</span>
<span class="k">[python: **.py]</span>

<span class="c1"># Extraction from Jinja2 templates</span>
<span class="k">[jinja2: **.jinja]</span>
<span class="na">extensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">jinja2.ext.with_</span>
</pre></div>
</div>
<p>使用しているすべての拡張機能をリストアップしてください！そうしないと、Babel はこれらの拡張機能によって定義されたタグを認識せず、それらを含む Jinja2 テンプレートを完全に無視します。</p>
<p>Babel は <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> と似たような機能を提供し、一般的に置き換えることができ、 <code class="docutils literal notranslate"><span class="pre">gettext</span></code> に依存しません。より詳しい情報は <a class="reference external" href="https://babel.pocoo.org/en/latest/messages.html">メッセージカタログの操作</a> に関するドキュメントを参照してください。</p>
</div>
<div class="admonition-no-gettext admonition">
<p class="admonition-title">gettext がない？</p>
<p><code class="docutils literal notranslate"><span class="pre">gettext</span></code> ユーティリティがインストールされていない場合、 <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> は空のファイルを作成します。そのような場合は、 <code class="docutils literal notranslate"><span class="pre">gettext</span></code> ユーティリティをインストールするか、英語のメッセージファイル (<code class="docutils literal notranslate"><span class="pre">locale/ja/LC_MESSAGES/django.po</span></code>) があれば、それをコピーして、空の翻訳ファイルから始めてください。</p>
</div>
<div class="admonition-working-on-windows admonition">
<p class="admonition-title">Windows で動作する？</p>
<p>あなたが Windows を使っていて、<a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> が動作するように GNU gettext ユーティリティをインストールする必要がある場合は、<a class="reference internal" href="#gettext-on-windows"><span class="std std-ref">Windows での gettext</span></a> で詳しい情報を参照してください。</p>
</div>
<p>各 <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイルは、翻訳保守者の連絡先情報などのわずかなメタデータを含みますが、大部分は <strong>メッセージ</strong> のリストです。これは、特定の言語に対する、翻訳文字列と実際の翻訳済みテキストのマッピングです。</p>
<p>例えば以下のように、Django アプリケーションが <code class="docutils literal notranslate"><span class="pre">&quot;Welcome</span> <span class="pre">to</span> <span class="pre">my</span> <span class="pre">site.&quot;</span></code> に対する翻訳文字列を含んでいる場合、:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Welcome to my site.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>...それから <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a> は <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイルを生成し、そのファイルは以下のようなスニペットを含みます -- メッセージ:</p>
<div class="highlight-po notranslate"><div class="highlight"><pre><span></span><span class="kd">#: path/to/python/module.py:23</span>
<span class="nv">msgid</span> <span class="s">&quot;Welcome to my site.&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
<p>簡単に説明すると:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">msgid</span></code> は翻訳文字列で、ソース内に存在します。変更しないでください。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msgstr</span></code> はあなたが言語に対応する翻訳を記述する場所です。これは空の状態から始まるので、変更するのはあなたの役割です。翻訳をクオートで囲むようにしてください。</p></li>
<li><p>利便性のため、各メッセージは、<code class="docutils literal notranslate"><span class="pre">#</span></code> でプレフィックスされ <code class="docutils literal notranslate"><span class="pre">msgid</span></code> 行の直前に位置するコメント行の形式の中に、翻訳文字列がどこから拾い集められたかを示すファイル名と行数を含みます。</p></li>
</ul>
<p>長いメッセージは特殊なケースです。そこでは、<code class="docutils literal notranslate"><span class="pre">msgstr</span></code> (もしくは <code class="docutils literal notranslate"><span class="pre">msgid</span></code>) 直後の最初の文字列は空の文字列です。それからコンテンツ自身が行ごとに 1 つの文字列として次の数行にわたって記述されます。これらの文字列は直接連結されます。文字列内で最後のスペースを忘れないでください; さもなくば、空白スペースなしで接合されることになります！</p>
<div class="admonition-mind-your-charset admonition">
<p class="admonition-title">文字コードを気にしてください</p>
<p><code class="docutils literal notranslate"><span class="pre">gettext</span></code> ツールが内部的に動作する方法および非 ASCII ソースの文字列を Django のコアとあなたのアプリケーション内で許容するために、 <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイルに対するエンコーディングとして UTF-8 ( <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイルが生成される際のデフォルトです) を <strong>使わなければなりません</strong>。これは、全員が同じエンコーディングを使用することを意味し、Django が <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイルを処理する際に重要となります。</p>
</div>
<div class="admonition-fuzzy-entries admonition">
<p class="admonition-title">Fuzzy（あいまいな）エントリー</p>
<p><a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> は翻訳が以前に翻訳された文字列から推測される場合などに、あいまい (fuzzy) としてマークされた翻訳エントリーを生成することがあります。デフォルトでは、あいまいなエントリは <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">compilemessages</span></code></a> によって処理されません。</p>
</div>
<p>新しい翻訳文字列に対して全てのコードとテンプレートを再検査して <strong>全ての</strong> 言語に対する全てのメッセージファイルを更新するには、以下を実行してください:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>django-admin<span class="w"> </span>makemessages<span class="w"> </span>-a
</pre></div>
</div>
</section>
<section id="s-compiling-message-files">
<span id="compiling-message-files"></span><h3>メッセージファイルをコンパイルする<a class="headerlink" href="#compiling-message-files" title="Link to this heading">¶</a></h3>
<p>メッセージファイルを作成した後 -- そして変更を加えたときそれぞれで -- <code class="docutils literal notranslate"><span class="pre">gettext</span></code> による使用のために、より効率的な形式にコンパイルする必要があります。<a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span></code></a> ユーティリティを利用してください。</p>
<p>このツールは、全ての有効な <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイルを通じて動作し、<code class="docutils literal notranslate"><span class="pre">.mo</span></code> ファイルを生成します。これは <code class="docutils literal notranslate"><span class="pre">gettext</span></code> による使用のために最適化されたバイナリファイルです。<a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a> を実行した同じディレクトリで、以下のように <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span></code></a> を実行してください:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>django-admin<span class="w"> </span>compilemessages
</pre></div>
</div>
<p>これで終わりです。翻訳は使う準備ができました。</p>
<div class="admonition-working-on-windows admonition">
<p class="admonition-title">Windows で動作する？</p>
<p>あなたが Windows を使っていて、<a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span></code></a> が動作するように GNU gettext ユーティリティをインストールする必要がある場合は、<a class="reference internal" href="#gettext-on-windows"><span class="std std-ref">Windows での gettext</span></a> で詳しい情報を参照してください。</p>
</div>
<div class="admonition-po-files-encoding-and-bom-usage admonition">
<p class="admonition-title"><code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイル: エンコーディングと BOM の使用</p>
<p>Django は、UTF-8 でエンコードされ BOM (Byte Order Mark) を持たない <code class="docutils literal notranslate"><span class="pre">.po</span></code> ファイルのみをサポートします。そのため、テキストエディタがデフォルトでこれらのマークをファイルの最初に追加した場合、再構成する必要があります。</p>
</div>
</section>
<section id="s-troubleshooting-gettext-incorrectly-detects-python-format-in-strings-with-percent-signs">
<span id="troubleshooting-gettext-incorrectly-detects-python-format-in-strings-with-percent-signs"></span><h3>トラブルシューティング: <code class="docutils literal notranslate"><span class="pre">gettext()</span></code> がパーセント文字を伴う文字列内で <code class="docutils literal notranslate"><span class="pre">python-format</span></code> を誤って見つけてしまう<a class="headerlink" href="#troubleshooting-gettext-incorrectly-detects-python-format-in-strings-with-percent-signs" title="Link to this heading">¶</a></h3>
<p>例えば、パーセント記号に続いて空白と <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#old-string-formatting" title="(in Python v3.13)"><span class="xref std std-ref">文字列変換タイプ</span></a> がある文字列（例: <code class="docutils literal notranslate"><span class="pre">_(&quot;10%</span> <span class="pre">interest&quot;)</span></code>）などに、<a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext" title="django.utils.translation.gettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext()</span></code></a> は誤って <code class="docutils literal notranslate"><span class="pre">python-format</span></code> で文字列をフラグ付けすることがあります。</p>
<p>誤ってフラグが立てられた文字列でメッセージファイルをコンパイルしようとすると、<code class="docutils literal notranslate"><span class="pre">number</span> <span class="pre">of</span> <span class="pre">format</span> <span class="pre">specifications</span> <span class="pre">in</span> <span class="pre">'msgid'</span> <span class="pre">and</span> <span class="pre">'msgstr'</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">match</span></code> もしくは <code class="docutils literal notranslate"><span class="pre">'msgstr'</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">a</span> <span class="pre">valid</span> <span class="pre">Python</span> <span class="pre">format</span> <span class="pre">string,</span> <span class="pre">unlike</span> <span class="pre">'msgid'</span></code>. といったエラーが発生します。</p>
<p>これを解決するには、パーセント文字を 2 つ重ねてエスケープします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext</span> <span class="k">as</span> <span class="n">_</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;10</span><span class="si">%%</span><span class="s2"> interest&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>もしくは <code class="docutils literal notranslate"><span class="pre">no-python-format</span></code> を使ってパーセント文字がリテラルとして扱われるようにします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># xgettext:no-python-format</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;10</span><span class="si">% i</span><span class="s2">nterest&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="s-creating-message-files-from-javascript-source-code">
<span id="s-creating-message-files-from-js-code"></span><span id="creating-message-files-from-javascript-source-code"></span><span id="creating-message-files-from-js-code"></span><h3>JavaScript ソースコードからメッセージファイルを作成する<a class="headerlink" href="#creating-message-files-from-javascript-source-code" title="Link to this heading">¶</a></h3>
<p>他の Django メッセージファイルと同じ方法で (<a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a> ツールを使って) 作成や更新を行います。唯一の違いは、<code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">djangojs</span></code> パラメータを提供することによって、gettext 用語がドメインであること (このケースでは <code class="docutils literal notranslate"><span class="pre">djangojs</span></code> ドメイン) を、以下のように明示的に指定する必要があることです:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>django-admin<span class="w"> </span>makemessages<span class="w"> </span>-d<span class="w"> </span>djangojs<span class="w"> </span>-l<span class="w"> </span>de
</pre></div>
</div>
<p>これは、ドイツ語に対して JavaScript 用のメッセージファイルを作成または更新します。メッセージファイルの更新後、通常の Django ファイルと同様の方法で <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span></code></a> を実行してください。</p>
</section>
<section id="s-gettext-on-windows">
<span id="s-id3"></span><span id="gettext-on-windows"></span><span id="id3"></span><h3>Windows での <code class="docutils literal notranslate"><span class="pre">gettext</span></code><a class="headerlink" href="#gettext-on-windows" title="Link to this heading">¶</a></h3>
<p>これはメッセージ ID を抽出したり、メッセージファイル(<code class="docutils literal notranslate"><span class="pre">.po</span></code>)をコンパイルしたい人だけが必要です。翻訳作業そのものは既存のこの種類のファイルを編集することになりますが、独自のメッセージファイルを作成したい場合や、変更したメッセージファイルをテストしたりコンパイルしたりしたい場合は、 <a class="reference external" href="https://mlocati.github.io/articles/gettext-iconv-windows.html">コンパイル済みのバイナリインストーラ</a> をダウンロードしてください。</p>
<p><code class="docutils literal notranslate"><span class="pre">xgettext</span> <span class="pre">--version</span></code> コマンドが正しく動作する限り、他の場所で入手した <code class="docutils literal notranslate"><span class="pre">gettext</span></code> バイナリを使うこともできます。Windows のコマンドプロンプトでコマンド <code class="docutils literal notranslate"><span class="pre">xgettext</span> <span class="pre">--version</span></code> を入力すると、ポップアップウィンドウに &quot;<code class="docutils literal notranslate"><span class="pre">xgettext.exe</span></code> has generated errors and will be closed by Windows&quot; と表示される場合は、 <code class="docutils literal notranslate"><span class="pre">gettext</span></code> パッケージを使って Django の翻訳ユーティリティを使おうとしないでください。</p>
</section>
<section id="s-customizing-the-makemessages-command">
<span id="s-customizing-makemessages"></span><span id="customizing-the-makemessages-command"></span><span id="customizing-makemessages"></span><h3><code class="docutils literal notranslate"><span class="pre">makemessages</span></code> コマンドをカスタマイズする<a class="headerlink" href="#customizing-the-makemessages-command" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">xgettext</span></code> に追加のパラメータを渡したい場合、独自の <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> コマンドを作成して、その <code class="docutils literal notranslate"><span class="pre">xgettext_options</span></code> 属性をオーバーライドする必要があります:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.core.management.commands</span><span class="w"> </span><span class="kn">import</span> <span class="n">makemessages</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Command</span><span class="p">(</span><span class="n">makemessages</span><span class="o">.</span><span class="n">Command</span><span class="p">):</span>
    <span class="n">xgettext_options</span> <span class="o">=</span> <span class="n">makemessages</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">xgettext_options</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;--keyword=mytrans&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>もっと柔軟に使う必要があるとき場合には、<a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> コマンドに新しい引数を追加することもできます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.core.management.commands</span><span class="w"> </span><span class="kn">import</span> <span class="n">makemessages</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Command</span><span class="p">(</span><span class="n">makemessages</span><span class="o">.</span><span class="n">Command</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s2">&quot;--extra-keyword&quot;</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;xgettext_keywords&quot;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">xgettext_keywords</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;xgettext_keywords&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xgettext_keywords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xgettext_options</span> <span class="o">=</span> <span class="n">makemessages</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">xgettext_options</span><span class="p">[:]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="s2">&quot;--keyword=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">kwd</span> <span class="k">for</span> <span class="n">kwd</span> <span class="ow">in</span> <span class="n">xgettext_keywords</span>
            <span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="s-miscellaneous">
<span id="miscellaneous"></span><h2>その他<a class="headerlink" href="#miscellaneous" title="Link to this heading">¶</a></h2>
<section id="s-the-set-language-redirect-view">
<span id="s-set-language-redirect-view"></span><span id="the-set-language-redirect-view"></span><span id="set-language-redirect-view"></span><h3><code class="docutils literal notranslate"><span class="pre">set_language</span></code> リダイレクトビュー<a class="headerlink" href="#the-set-language-redirect-view" title="Link to this heading">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="django.views.i18n.set_language">
<span class="sig-name descname"><span class="pre">set_language</span></span>(<em class="sig-param"><span class="n"><span class="pre">request</span></span></em>)<a class="reference external" href="https://github.com/django/django/blob/stable/5.1.x/django/views/i18n.py#L30"><span class="viewcode-link"><span class="pre">[ソース]</span></span></a><a class="headerlink" href="#django.views.i18n.set_language" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<p>利便性のために、 Django にはビュー <a class="reference internal" href="#django.views.i18n.set_language" title="django.views.i18n.set_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.views.i18n.set_language()</span></code></a> が付属しており、 ユーザの言語設定を行い、指定された URL にリダイレクトします。デフォルトでは前のページに戻ります。</p>
<p>URLconfに以下の行を追加して、このビューを有効にします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span><span class="p">(</span><span class="s2">&quot;i18n/&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s2">&quot;django.conf.urls.i18n&quot;</span><span class="p">)),</span>
</pre></div>
</div>
<p>(この例では <code class="docutils literal notranslate"><span class="pre">/i18n/setlang/</span></code> でビューを利用できるようにしていることに注意してください)。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>上記の URL を <a class="reference internal" href="#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a> 内に含めないようにしてください。正しく動作するためには、それ自身が言語に依存せず独立している必要があります。</p>
</div>
<p>このビューは <code class="docutils literal notranslate"><span class="pre">POST</span></code> メソッドで呼び出され、 <code class="docutils literal notranslate"><span class="pre">language</span></code> パラメータがリクエストに設定されることを想定しています。セッションサポートが有効な場合、ビューは言語選択をユーザのセッションに保存します。また、デフォルトでは <code class="docutils literal notranslate"><span class="pre">django_language</span></code> という名前のクッキーにも言語選択を保存します。(この名前は <a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_COOKIE_NAME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_NAME</span></code></a> 設定で変更できます)。</p>
<p>言語選択を設定した後、Django は <code class="docutils literal notranslate"><span class="pre">POST</span></code> または <code class="docutils literal notranslate"><span class="pre">GET</span></code> データの <code class="docutils literal notranslate"><span class="pre">next</span></code> パラメータを探します。もしそれが見つかり、 Django が安全な URL (つまり、別のホストを指しておらず、安全なスキームを使っている) と判断した場合、その URL へのリダイレクトが実行されます。そうでない場合、 Django はリクエストの性質に応じて、 <code class="docutils literal notranslate"><span class="pre">Referer</span></code> ヘッダの URL にリダイレクトしたり、ヘッダが設定されていない場合は <code class="docutils literal notranslate"><span class="pre">/</span></code> にリダイレクトしたりします:</p>
<ul class="simple">
<li><p>リクエストが(<code class="docutils literal notranslate"><span class="pre">Accept</span></code> HTTPヘッダに基づいて)HTMLコンテンツを受け入れる場合、フォールバックは常に実行されます。</p></li>
<li><p>リクエストがHTMLを受け付けない場合、 <code class="docutils literal notranslate"><span class="pre">next</span></code> パラメータが指定されている場合のみフォールバックが実行されます。そうでない場合はステータスコード 204 (No Content) が返されます。</p></li>
</ul>
<p>以下はHTMLテンプレートコードの例です:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">i18n</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;set_language&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;next&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">redirect_to</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">select</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;language&quot;</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">get_current_language</span> <span class="k">as</span> <span class="nv">LANGUAGE_CODE</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">get_available_languages</span> <span class="k">as</span> <span class="nv">LANGUAGES</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">get_language_info_list</span> <span class="nv">for</span> <span class="nv">LANGUAGES</span> <span class="k">as</span> <span class="nv">languages</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">language</span> <span class="k">in</span> <span class="nv">languages</span> <span class="cp">%}</span>
            <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">language.code</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">language.code</span> <span class="o">==</span> <span class="nv">LANGUAGE_CODE</span> <span class="cp">%}</span> <span class="na">selected</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&gt;</span>
                <span class="cp">{{</span> <span class="nv">language.name_local</span> <span class="cp">}}</span> (<span class="cp">{{</span> <span class="nv">language.code</span> <span class="cp">}}</span>)
            <span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Go&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>この例では、 Django は <code class="docutils literal notranslate"><span class="pre">redirect_to</span></code> コンテキスト変数で、ユーザがリダイレクトされるページの URL を調べます。</p>
</section>
<section id="s-explicitly-setting-the-active-language">
<span id="s-id4"></span><span id="explicitly-setting-the-active-language"></span><span id="id4"></span><h3>明示的にアクティブな言語をセットする<a class="headerlink" href="#explicitly-setting-the-active-language" title="Link to this heading">¶</a></h3>
<p>明示的に、現在のセッションに対して、アクティブな言語をセットしたくなるかもしれません。例えば、他のシステムを活用すれば、ユーザの言語設定を取得できます。<a class="reference internal" href="../../ref/utils.html#django.utils.translation.activate" title="django.utils.translation.activate"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.activate()</span></code></a> はすでに紹介済みですね。これは現在のスレッドに対してのみ適用されます。セッション全体の言語をクッキーに恒久的に保持するには、レスポンスに <a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_COOKIE_NAME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_NAME</span></code></a> クッキーを設定します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.conf</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">translation</span>

<span class="n">user_language</span> <span class="o">=</span> <span class="s2">&quot;fr&quot;</span>
<span class="n">translation</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">user_language</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_COOKIE_NAME</span><span class="p">,</span> <span class="n">user_language</span><span class="p">)</span>
</pre></div>
</div>
<p>通常、両方を使う必要があるでしょう: <a class="reference internal" href="../../ref/utils.html#django.utils.translation.activate" title="django.utils.translation.activate"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.activate()</span></code></a> はこのスレッドに対して言語を変更します。そして、クッキーをセットするとこの設定が将来のリクエストに恒久的に反映されます。</p>
</section>
<section id="s-using-translations-outside-views-and-templates">
<span id="using-translations-outside-views-and-templates"></span><h3>ビューやテンプレートの外で翻訳を使う<a class="headerlink" href="#using-translations-outside-views-and-templates" title="Link to this heading">¶</a></h3>
<p>Django はビューやテンプレートで使うための豊富な国際化ツールセットを提供していますが、Django 固有のコードに使い方を限定しているわけではありません。Django の翻訳システムを使えば、任意のテキストを Django がサポートしている任意の言語に翻訳できます (もちろん、適切な翻訳カタログが存在する場合に限ります)。翻訳カタログを読み込んで有効にし、テキストを好きな言語に翻訳することも可能ですが、元の言語に戻すことを忘れないでください。翻訳カタログの有効化はスレッド単位で行われ、そのような変更は同じスレッドで実行されているコードに影響するからです。</p>
<p>例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">translation</span>


<span class="k">def</span><span class="w"> </span><span class="nf">welcome_translated</span><span class="p">(</span><span class="n">language</span><span class="p">):</span>
    <span class="n">cur_language</span> <span class="o">=</span> <span class="n">translation</span><span class="o">.</span><span class="n">get_language</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">translation</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">translation</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="s2">&quot;welcome&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">translation</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">cur_language</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</pre></div>
</div>
<p>この関数を <code class="docutils literal notranslate"><span class="pre">'de'</span></code> という値で呼び出すと、 <a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a> やミドルウェアで設定されている言語に関係なく、 <code class="docutils literal notranslate"><span class="pre">&quot;Willkommen&quot;</span></code> が返されます。</p>
<p>特に注目すべき関数は、現在のスレッドで使われている言語を返す <a class="reference internal" href="../../ref/utils.html#django.utils.translation.get_language" title="django.utils.translation.get_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.get_language()</span></code></a> 、現在のスレッドの翻訳カタログを有効にする <a class="reference internal" href="../../ref/utils.html#django.utils.translation.activate" title="django.utils.translation.activate"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.activate()</span></code></a> 、与えられた言語が Django でサポートされているかどうかをチェックする <a class="reference internal" href="../../ref/utils.html#django.utils.translation.check_for_language" title="django.utils.translation.check_for_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.check_for_language()</span></code></a> です。</p>
<p>より簡潔なコードを書くために、コンテキストマネージャ <a class="reference internal" href="../../ref/utils.html#django.utils.translation.override" title="django.utils.translation.override"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.override()</span></code></a> も用意されています、これは実行時に現在の言語を保存し、終了時にそれを復元します。これを使うと、上の例は次のようになります:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">translation</span>


<span class="k">def</span><span class="w"> </span><span class="nf">welcome_translated</span><span class="p">(</span><span class="n">language</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="n">language</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">translation</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="s2">&quot;welcome&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="s-language-cookie">
<span id="language-cookie"></span><h3>言語クッキー<a class="headerlink" href="#language-cookie" title="Link to this heading">¶</a></h3>
<p>言語クッキーのオプションを調整するには、多くの設定が使用できます:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_COOKIE_NAME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_NAME</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_COOKIE_AGE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_AGE</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_COOKIE_DOMAIN"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_DOMAIN</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_COOKIE_HTTPONLY"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_HTTPONLY</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_COOKIE_PATH"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_PATH</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_COOKIE_SAMESITE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_SAMESITE</span></code></a></p></li>
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_COOKIE_SECURE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_SECURE</span></code></a></p></li>
</ul>
</section>
</section>
<section id="s-implementation-notes">
<span id="implementation-notes"></span><h2>実装時のためのノート<a class="headerlink" href="#implementation-notes" title="Link to this heading">¶</a></h2>
<section id="s-specialties-of-django-translation">
<span id="s-specialties-of-django-i18n"></span><span id="specialties-of-django-translation"></span><span id="specialties-of-django-i18n"></span><h3>Djangoの翻訳の特徴<a class="headerlink" href="#specialties-of-django-translation" title="Link to this heading">¶</a></h3>
<p>Django の翻訳システムは Python に付属している標準の <code class="docutils literal notranslate"><span class="pre">gettext</span></code> モジュールを使います。 <code class="docutils literal notranslate"><span class="pre">gettext</span></code> を知っていれば、Django が翻訳を行う方法について、以下のような特徴があることに気づくかもしれません:</p>
<ul class="simple">
<li><p>文字列ドメインは <code class="docutils literal notranslate"><span class="pre">django</span></code> または <code class="docutils literal notranslate"><span class="pre">djangojs</span></code> です。この文字列ドメインは、共通のメッセージファイルライブラリ (通常は <code class="docutils literal notranslate"><span class="pre">/usr/share/locale/</span></code>) にデータを保存する異なるプログラムを区別するために使用されます。 <code class="docutils literal notranslate"><span class="pre">django</span></code> ドメインは Python とテンプレートの翻訳文字列に使われ、グローバル翻訳カタログに読み込まれます。 <code class="docutils literal notranslate"><span class="pre">djangojs</span></code> ドメインはできるだけ小さくなるように、 JavaScript の翻訳カタログにだけ使われます。</p></li>
<li><p>Django は <code class="docutils literal notranslate"><span class="pre">xgettext</span></code> だけを使っているわけではありません。これは <code class="docutils literal notranslate"><span class="pre">xgettext</span></code> と <code class="docutils literal notranslate"><span class="pre">msgfmt</span></code> を Python でラップしたものです。これは主に利便性のためです。</p></li>
</ul>
</section>
<section id="s-how-django-discovers-language-preference">
<span id="s-id5"></span><span id="how-django-discovers-language-preference"></span><span id="id5"></span><h3>Django はどうやって言語の優先順位を検出するのか？<a class="headerlink" href="#how-django-discovers-language-preference" title="Link to this heading">¶</a></h3>
<p>翻訳を準備したら、あるいは Django に付属している翻訳を使いたい場合は、アプリの設定で翻訳を有効にする必要があります。</p>
<p>Djangoは、インストール全体、特定のユーザー、またはその両方に対して、使用する言語を決定する非常に柔軟なモデルを持っています。</p>
<p>インストール全体の優先言語を設定するには、 <a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a> を設定してください。Django はこの言語をデフォルトの翻訳として使います。ロケールミドルウェアが採用するメソッド (下記参照) を使って、より適切な翻訳が見つからなかった場合の最終的な翻訳です。</p>
<p>Django を母国語で動かしたいだけなら、 <a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a> を設定し、対応する <a class="reference internal" href="index.html#term-message-file"><span class="xref std std-term">メッセージファイル</span></a> とそのコンパイルバージョン (<code class="docutils literal notranslate"><span class="pre">.mo</span></code>) が存在することを確認するだけです。</p>
<p>各ユーザに好きな言語を指定させたい場合は、 <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> を使用する必要があります。ロケール ミドルウェア <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> はリクエストのデータに基づいて言語を選択できるようにします。これは各ユーザのためにコンテンツをカスタマイズします。</p>
<p><code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> を使うには、<code class="docutils literal notranslate"><span class="pre">django.middleware.locale.LocaleMiddleware'</span></code> を <a class="reference internal" href="../../ref/settings.html#std-setting-MIDDLEWARE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code></a> 設定に追加します。ミドルウェアの順番は重要なので、以下のガイドラインに従ってください:</p>
<ul class="simple">
<li><p>最初にインストールされるミドルウェアの1つであることを確認してください。</p></li>
<li><p>なぜなら <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> はセッションデータを利用するからです。また、 <code class="docutils literal notranslate"><span class="pre">CommonMiddleware</span></code> はリクエストされたURLを解決するために有効な言語を必要とするので、 <code class="docutils literal notranslate"><span class="pre">CommonMiddleware</span></code> の前に来る必要があります。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CacheMiddleware</span></code> を使用する場合は、その後ろに <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> を記述してください。</p></li>
</ul>
<p>たとえば、<a class="reference internal" href="../../ref/settings.html#std-setting-MIDDLEWARE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code></a> は次のようになります:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;django.contrib.sessions.middleware.SessionMiddleware&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.middleware.locale.LocaleMiddleware&quot;</span><span class="p">,</span>
    <span class="s2">&quot;django.middleware.common.CommonMiddleware&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>(ミドルウェアについては <a class="reference internal" href="../http/middleware.html"><span class="doc">ミドルウェアのドキュメント</span></a> を参照してください)。</p>
<p><code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> は以下のアルゴリズムに従ってユーザーの言語設定を決定しようとします:</p>
<ul>
<li><p>最初に、リクエストされたURLの言語プレフィックスを探します。 これはルートの URLconf で <code class="docutils literal notranslate"><span class="pre">i18n_patterns</span></code> 関数を使用している場合にだけ実行されます。言語プレフィックスとURLパターンの国際化方法についての詳細は <a class="reference internal" href="#url-internationalization"><span class="std std-ref">国際化: URL パターン内</span></a> を参照してください。</p></li>
<li><p>それに失敗すれば、クッキーを探します。</p>
<p>使用されるクッキーの名前は <a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_COOKIE_NAME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_NAME</span></code></a> 設定によって設定されます。(デフォルトの名前は <code class="docutils literal notranslate"><span class="pre">django_language</span></code> です)。</p>
</li>
<li><p>それに失敗した場合は <code class="docutils literal notranslate"><span class="pre">Accept-Language</span></code> HTTPヘッダを調べます。このヘッダはブラウザから送られ、サーバにどの言語を優先するのかを伝えます。Django は、翻訳可能な言語が見つかるまで、ヘッダの各言語を試します。</p></li>
<li><p>それに失敗すると、グローバルな <a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a> 設定を使用します。</p></li>
</ul>
<p id="locale-middleware-notes">メモ:</p>
<ul>
<li><p>これらの場所では、言語設定は標準の <a class="reference internal" href="index.html#term-language-code"><span class="xref std std-term">言語コード</span></a> 文字列で指定します。たとえば、ブラジルポルトガル語は <code class="docutils literal notranslate"><span class="pre">pt-br</span></code> です。</p></li>
<li><p>ベース言語が利用可能で、指定されたサブ言語が利用できない場合、 Django はベース言語を使います。たとえば、ユーザが <code class="docutils literal notranslate"><span class="pre">de-at</span></code> (オーストリアのドイツ語) を指定したが、 Django には <code class="docutils literal notranslate"><span class="pre">de</span></code> しかない場合、 Django は <code class="docutils literal notranslate"><span class="pre">de</span></code> を使います。</p></li>
<li><p>選択できるのは <a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGES</span></code></a> 設定にリストされている言語だけです。言語選択を提供されている言語のサブセットに制限したい場合(アプリケーションがすべての言語を提供していないため)、 <a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGES</span></code></a> に言語のリストを設定します。たとえば、次のようにします：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;de&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;German&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;English&quot;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>この例では、自動選択できる言語をドイツ語と英語（および <code class="docutils literal notranslate"><span class="pre">de-ch</span></code> や <code class="docutils literal notranslate"><span class="pre">en-us</span></code> のようなサブ言語）に制限しています。</p>
</li>
<li><p>前の箇所で説明したように、カスタムの <a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGES</span></code></a> 設定を定義すれば、言語名を翻訳文字列としてマークできます。ただし、循環インポートを避けるために、 <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext" title="django.utils.translation.gettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext()</span></code></a> の代わりに <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext_lazy" title="django.utils.translation.gettext_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext_lazy()</span></code></a> を使ってください。</p>
<p>以下はサンプルの設定ファイルです:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.translation</span><span class="w"> </span><span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;de&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;German&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;English&quot;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> がユーザの設定を決定すると、その設定を <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> の <code class="docutils literal notranslate"><span class="pre">request.LANGUAGE_CODE</span></code> として利用できるようにします。この値はビューのコードで自由に読み込むことができます。以下に例を示します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponse</span>


<span class="k">def</span><span class="w"> </span><span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">LANGUAGE_CODE</span> <span class="o">==</span> <span class="s2">&quot;de-at&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;You prefer to read Austrian German.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;You prefer to read another language.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>静的な(ミドルウェアを使わない)翻訳では、言語は <code class="docutils literal notranslate"><span class="pre">settings.LANGUAGE_CODE</span></code> にあり、動的な(ミドルウェアを使った)翻訳では <code class="docutils literal notranslate"><span class="pre">request.LANGUAGE_CODE</span></code> にあることに注意してください。</p>
</section>
<section id="s-how-django-discovers-translations">
<span id="s-id6"></span><span id="how-django-discovers-translations"></span><span id="id6"></span><h3>Djangoはどうやって翻訳を見つけるのか？<a class="headerlink" href="#how-django-discovers-translations" title="Link to this heading">¶</a></h3>
<p>実行時に、 Django はリテラルと翻訳の統合カタログをメモリ内に構築します。これを実現するために、コンパイルされた <a class="reference internal" href="index.html#term-message-file"><span class="xref std std-term">メッセージファイル</span></a> (<code class="docutils literal notranslate"><span class="pre">.mo</span></code>) を読み込むために異なるファイルパスを調べる順序と、同じリテラルに対して複数の翻訳がある場合の優先順位について、以下のアルゴリズムに従って翻訳を探します:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="../../ref/settings.html#std-setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> に列挙されているディレクトリが最も優先され、最初に記述されているものが後に記述されているものよりも優先されます。</p></li>
<li><p>次に、 <a class="reference internal" href="../../ref/settings.html#std-setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> に列挙されている各インストール済みアプリの <code class="docutils literal notranslate"><span class="pre">locale</span></code> ディレクトリを探し、存在すればそれを使用します。 このとき、最初に指定されたものが後に指定されたものよりも優先されます。</p></li>
<li><p>最後に、 <a class="extlink-source reference external" href="https://github.com/django/django/blob/main/django/conf/locale">django/conf/locale</a> にある Django が提供する基本翻訳がフォールバックとして使われます。</p></li>
</ol>
<div class="admonition seealso">
<p class="admonition-title">参考</p>
<p>JavaScriptアセットに含まれるリテラルの翻訳は同じようなアルゴリズムで検索されますが、同じではありません。詳細は <a class="reference internal" href="#django.views.i18n.JavaScriptCatalog" title="django.views.i18n.JavaScriptCatalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code></a> を参照してください。</p>
<p>また、 <a class="reference internal" href="../../ref/settings.html#std-setting-FORMAT_MODULE_PATH"><code class="xref std std-setting docutils literal notranslate"><span class="pre">FORMAT_MODULE_PATH</span></code></a> を設定すれば、 <a class="reference internal" href="formatting.html#custom-format-files"><span class="std std-ref">カスタムフォーマットファイル</span></a> を <a class="reference internal" href="../../ref/settings.html#std-setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> ディレクトリに置くこともできます。</p>
</div>
<p>すべての場合において、翻訳を含むディレクトリの名前は <a class="reference internal" href="index.html#term-locale-name"><span class="xref std std-term">locale name</span></a> 表記で指定します。例えば <code class="docutils literal notranslate"><span class="pre">de</span></code>、<code class="docutils literal notranslate"><span class="pre">pt_BR</span></code>、<code class="docutils literal notranslate"><span class="pre">es_AR</span></code> などです。地域言語バリアントの未翻訳の文字列は一般言語の翻訳を使用します。たとえば、未翻訳の <code class="docutils literal notranslate"><span class="pre">pt_BR</span></code> 文字列は <code class="docutils literal notranslate"><span class="pre">pt</span></code> の翻訳を使用します。</p>
<p>こうすることで、独自の翻訳を含むアプリケーションを書くことができ、プロジェクトでベースとなる翻訳を上書きできます。あるいは、いくつかのアプリから大きなプロジェクトを作り、すべての翻訳を、作成中のプロジェクトに特化した1つの大きな共通メッセージファイルにまとめることもできます。選択肢はあなたの自由です。</p>
<p>メッセージ・ファイルのリポジトリはすべて同じ構造になっています。それらは下記のようなものです:</p>
<ul class="simple">
<li><p>設定ファイルの <a class="reference internal" href="../../ref/settings.html#std-setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> にリストされているすべてのパスは、<code class="docutils literal notranslate"><span class="pre">&lt;language&gt;/LC_MESSAGES/django.(po|mo)</span></code> で検索されます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$APPPATH/locale/&lt;language&gt;/LC_MESSAGES/django.(po|mo)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$PYTHONPATH/django/conf/locale/&lt;language&gt;/LC_MESSAGES/django.(po|mo)</span></code></p></li>
</ul>
<p>メッセージファイルを作成するには <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a> ツールを使用します。また、 <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span></code></a> を使って、 <code class="docutils literal notranslate"><span class="pre">gettext</span></code> が使用するバイナリファイル <code class="docutils literal notranslate"><span class="pre">.mo</span></code> を作成します。</p>
<p>また、 <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span> <span class="pre">--settings=path.to.settings</span></code></a> を実行すると、コンパイラが <a class="reference internal" href="../../ref/settings.html#std-setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> 設定にあるすべてのディレクトリを処理するようになります。</p>
</section>
<section id="s-using-a-non-english-base-language">
<span id="using-a-non-english-base-language"></span><h3>英語以外の言語をベース言語として使う<a class="headerlink" href="#using-a-non-english-base-language" title="Link to this heading">¶</a></h3>
<p>Django は、翻訳可能なプロジェクト内の元の文字列は英語で書かれているという一般的な前提に立っています。他の言語を選ぶこともできますが、ある制限に注意する必要があります:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gettext</span></code> はオリジナルのメッセージに対して2つの複数形しか提供しないので、もしベース言語の複数形のルールが英語と異なる場合は、すべての複数形を含むようにベース言語の翻訳も提供する必要があります。</p></li>
<li><p>英語のバージョンが有効になっていて、英語の文字列がない場合、フォールバック言語はプロジェクトの <a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a> ではなく、オリジナルの文字列になります。たとえば、<a class="reference internal" href="../../ref/settings.html#std-setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a> がスペイン語に設定されていて、元の文字列がロシア語で書かれているサイトを訪れた英語のユーザは、スペイン語ではなくロシア語のテキストを見ることになります。</p></li>
</ul>
</section>
</section>
</section>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../contents.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">翻訳</a><ul>
<li><a class="reference internal" href="#overview">概要</a></li>
<li><a class="reference internal" href="#internationalization-in-python-code">Python コードでの国際化</a><ul>
<li><a class="reference internal" href="#standard-translation">標準的な翻訳</a></li>
<li><a class="reference internal" href="#comments-for-translators">翻訳者へのコメント</a></li>
<li><a class="reference internal" href="#marking-strings-as-no-op">no-op (何もしない) として文字列をマークする</a></li>
<li><a class="reference internal" href="#pluralization">複数形</a></li>
<li><a class="reference internal" href="#contextual-markers">文脈マーカー</a></li>
<li><a class="reference internal" href="#lazy-translation">遅延 (Lazy な) 翻訳</a><ul>
<li><a class="reference internal" href="#model-fields-and-relationships-verbose-name-and-help-text-option-values">モデルフィールドとリレーションシップの <code class="docutils literal notranslate"><span class="pre">verbose_name</span></code> と <code class="docutils literal notranslate"><span class="pre">help_text</span></code> オプションの値</a></li>
<li><a class="reference internal" href="#model-verbose-names-values">モデルの冗長な名前の値</a></li>
<li><a class="reference internal" href="#model-methods-description-argument-to-the-display-decorator">モデルメソッド <code class="docutils literal notranslate"><span class="pre">description</span></code> を <code class="docutils literal notranslate"><span class="pre">&#64;display</span></code> デコレーターに渡す。</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-lazy-translation-objects">遅延 (Lazyな) 翻訳オブジェクトの使用方法</a><ul>
<li><a class="reference internal" href="#lazy-translations-and-plural">遅延翻訳と複数形</a></li>
<li><a class="reference internal" href="#formatting-strings-format-lazy">文字列のフォーマット: <code class="docutils literal notranslate"><span class="pre">format_lazy()</span></code></a></li>
<li><a class="reference internal" href="#other-uses-of-lazy-in-delayed-translations">その他の遅延翻訳の使い方</a></li>
</ul>
</li>
<li><a class="reference internal" href="#localized-names-of-languages">言語のローカライズされた名前</a></li>
</ul>
</li>
<li><a class="reference internal" href="#internationalization-in-template-code">国際化: テンプレート内</a><ul>
<li><a class="reference internal" href="#translate-template-tag"><code class="docutils literal notranslate"><span class="pre">translate</span></code> テンプレートタグ</a></li>
<li><a class="reference internal" href="#blocktranslate-template-tag"><code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code> テンプレートタグ</a></li>
<li><a class="reference internal" href="#string-literals-passed-to-tags-and-filters">タグとフィルタに渡される文字列リテラル</a></li>
<li><a class="reference internal" href="#comments-for-translators-in-templates">テンプレートにおける翻訳者のためのコメント</a></li>
<li><a class="reference internal" href="#switching-language-in-templates">テンプレートで言語を切り替える</a></li>
<li><a class="reference internal" href="#other-tags">その他のタグ</a><ul>
<li><a class="reference internal" href="#get-available-languages"><code class="docutils literal notranslate"><span class="pre">get_available_languages</span></code></a></li>
<li><a class="reference internal" href="#get-current-language"><code class="docutils literal notranslate"><span class="pre">get_current_language</span></code></a></li>
<li><a class="reference internal" href="#get-current-language-bidi"><code class="docutils literal notranslate"><span class="pre">get_current_language_bidi</span></code></a></li>
<li><a class="reference internal" href="#i18n-context-processor"><code class="docutils literal notranslate"><span class="pre">i18n</span></code> コンテキストプロセッサ</a></li>
<li><a class="reference internal" href="#get-language-info"><code class="docutils literal notranslate"><span class="pre">get_language_info</span></code></a></li>
<li><a class="reference internal" href="#get-language-info-list"><code class="docutils literal notranslate"><span class="pre">get_language_info_list</span></code></a></li>
<li><a class="reference internal" href="#template-filters">テンプレートフィルタ</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#internationalization-in-javascript-code">国際化: JavaScript コード内</a><ul>
<li><a class="reference internal" href="#module-django.views.i18n"><code class="docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code> ビュー</a></li>
<li><a class="reference internal" href="#using-the-javascript-translation-catalog">JavaScript 翻訳カタログを使う</a><ul>
<li><a class="reference internal" href="#gettext"><code class="docutils literal notranslate"><span class="pre">gettext</span></code></a></li>
<li><a class="reference internal" href="#ngettext"><code class="docutils literal notranslate"><span class="pre">ngettext</span></code></a></li>
<li><a class="reference internal" href="#interpolate"><code class="docutils literal notranslate"><span class="pre">interpolate</span></code></a></li>
<li><a class="reference internal" href="#get-format"><code class="docutils literal notranslate"><span class="pre">get_format</span></code></a></li>
<li><a class="reference internal" href="#gettext-noop"><code class="docutils literal notranslate"><span class="pre">gettext_noop</span></code></a></li>
<li><a class="reference internal" href="#pgettext"><code class="docutils literal notranslate"><span class="pre">pgettext</span></code></a></li>
<li><a class="reference internal" href="#npgettext"><code class="docutils literal notranslate"><span class="pre">npgettext</span></code></a></li>
<li><a class="reference internal" href="#pluralidx"><code class="docutils literal notranslate"><span class="pre">pluralidx</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-jsoncatalog-view"><code class="docutils literal notranslate"><span class="pre">JSONCatalog</span></code> ビュー</a></li>
<li><a class="reference internal" href="#note-on-performance">実行速度についての覚え書き</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-django.conf.urls.i18n">国際化: URL パターン内</a><ul>
<li><a class="reference internal" href="#language-prefix-in-url-patterns">URL パターンにおける言語プレフィックス</a></li>
<li><a class="reference internal" href="#translating-url-patterns">URL パターンを翻訳する</a></li>
<li><a class="reference internal" href="#reversing-in-templates">テンプレート内で逆引きする</a></li>
</ul>
</li>
<li><a class="reference internal" href="#localization-how-to-create-language-files">ローカライズ: 言語ファイルを作成する方法</a><ul>
<li><a class="reference internal" href="#message-files">メッセージファイル</a></li>
<li><a class="reference internal" href="#compiling-message-files">メッセージファイルをコンパイルする</a></li>
<li><a class="reference internal" href="#troubleshooting-gettext-incorrectly-detects-python-format-in-strings-with-percent-signs">トラブルシューティング: <code class="docutils literal notranslate"><span class="pre">gettext()</span></code> がパーセント文字を伴う文字列内で <code class="docutils literal notranslate"><span class="pre">python-format</span></code> を誤って見つけてしまう</a></li>
<li><a class="reference internal" href="#creating-message-files-from-javascript-source-code">JavaScript ソースコードからメッセージファイルを作成する</a></li>
<li><a class="reference internal" href="#gettext-on-windows">Windows での <code class="docutils literal notranslate"><span class="pre">gettext</span></code></a></li>
<li><a class="reference internal" href="#customizing-the-makemessages-command"><code class="docutils literal notranslate"><span class="pre">makemessages</span></code> コマンドをカスタマイズする</a></li>
</ul>
</li>
<li><a class="reference internal" href="#miscellaneous">その他</a><ul>
<li><a class="reference internal" href="#the-set-language-redirect-view"><code class="docutils literal notranslate"><span class="pre">set_language</span></code> リダイレクトビュー</a></li>
<li><a class="reference internal" href="#explicitly-setting-the-active-language">明示的にアクティブな言語をセットする</a></li>
<li><a class="reference internal" href="#using-translations-outside-views-and-templates">ビューやテンプレートの外で翻訳を使う</a></li>
<li><a class="reference internal" href="#language-cookie">言語クッキー</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-notes">実装時のためのノート</a><ul>
<li><a class="reference internal" href="#specialties-of-django-translation">Djangoの翻訳の特徴</a></li>
<li><a class="reference internal" href="#how-django-discovers-language-preference">Django はどうやって言語の優先順位を検出するのか？</a></li>
<li><a class="reference internal" href="#how-django-discovers-translations">Djangoはどうやって翻訳を見つけるのか？</a></li>
<li><a class="reference internal" href="#using-a-non-english-base-language">英語以外の言語をベース言語として使う</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="index.html"
                          title="前の章へ">国際化とローカライズ</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="formatting.html"
                          title="次の章へ">表示形式のローカライズ</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/topics/i18n/translation.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">1月 22, 2025</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="index.html" title="国際化とローカライズ">previous</a>
     |
    <a href="../index.html" title="Django を使う" accesskey="U">up</a>
   |
    <a href="formatting.html" title="表示形式のローカライズ">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>