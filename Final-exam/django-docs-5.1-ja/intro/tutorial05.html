<!DOCTYPE html>

<html lang="ja" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>はじめての Django アプリ作成、その 5 &#8212; Django 5.1.6.dev20250122212402 ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=34bb78ad" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css?v=bf4d74af" />
    <script src="../_static/documentation_options.js?v=d2885b0a"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=4755f45a"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="はじめての Django アプリ作成、その 6" href="tutorial06.html" />
    <link rel="prev" title="はじめての Django アプリ作成、その 4" href="tutorial04.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);(function($) {
    $(document).ready(function() {
        $(".c-tab-unix").on("click", function() {
            $("section.c-content-unix").show();
            $("section.c-content-win").hide();
            $(".c-tab-unix").prop("checked", true);
        });
        $(".c-tab-win").on("click", function() {
            $("section.c-content-win").show();
            $("section.c-content-unix").hide();
            $(".c-tab-win").prop("checked", true);
        });
    });
})(jQuery);</script>
<link rel="stylesheet" href="../_static/console-tabs.css">
  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 5.1.6.dev20250122212402 ドキュメント</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="tutorial04.html" title="はじめての Django アプリ作成、その 4">previous</a>
     |
    <a href="index.html" title="さぁ始めましょう" accesskey="U">up</a>
   |
    <a href="tutorial06.html" title="はじめての Django アプリ作成、その 6">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="intro-tutorial05">
            
  <section id="s-writing-your-first-django-app-part-5">
<span id="writing-your-first-django-app-part-5"></span><h1>はじめての Django アプリ作成、その 5<a class="headerlink" href="#writing-your-first-django-app-part-5" title="Link to this heading">¶</a></h1>
<p>このチュートリアルは <a class="reference internal" href="tutorial04.html"><span class="doc">チュートリアル 4</span></a> の続きです。Web 投票アプリケーションが完成したので、今度は自動テストを作ってみましょう。</p>
<div class="admonition-where-to-get-help admonition">
<p class="admonition-title">困ったときは:</p>
<p>このチュートリアルの実行に問題がある場合は、FAQ の <a class="reference internal" href="../faq/help.html"><span class="doc">Getting Help</span></a> セクションに進んでください。</p>
</div>
<section id="s-introducing-automated-testing">
<span id="introducing-automated-testing"></span><h2>自動テストの導入<a class="headerlink" href="#introducing-automated-testing" title="Link to this heading">¶</a></h2>
<section id="s-what-are-automated-tests">
<span id="what-are-automated-tests"></span><h3>自動テストとは何ですか？<a class="headerlink" href="#what-are-automated-tests" title="Link to this heading">¶</a></h3>
<p>テストは、コードの動作をチェックするルーチンです。</p>
<p>テストは異なるレベルで実行されます。あるテストは、小さな機能に対して行われるもの (<em>ある特定のモデルのメソッドは期待通りの値を返すか？</em>) かもしれませんし、別のテストは、ソフトウェア全体の動作に対して行われるもの (<em>サイト上でのユーザの一連の入力に対して、期待通りの結果が表示されるか？</em>) かもしれません。こうしたテストは、前に <a class="reference internal" href="tutorial02.html"><span class="doc">チュートリアル その2</span></a> で <a class="reference internal" href="../ref/django-admin.html#django-admin-shell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">shell</span></code></a> を用いてメソッドの動作を確かめたことや、実際にアプリケーションを実行して値を入力して結果がどうなるのかを確かめるといったことと、何も違いはありません。</p>
<p><em>自動</em> テストが他と異なる点は、テスト作業がシステムによって実行されることです。一度テストセットを作成すると、それからはアプリに変更を加えるたびに、あなたの意図した通りにコードが動作するか確認できます。手動でテストする時間がかかることはありません。</p>
</section>
<section id="s-why-you-need-to-create-tests">
<span id="why-you-need-to-create-tests"></span><h3>なぜテストを作成する必要があるのか<a class="headerlink" href="#why-you-need-to-create-tests" title="Link to this heading">¶</a></h3>
<p>どうしてテストを作るのか？また、なぜ今なのか？</p>
<p>もしかしたら、 Python や Django を学ぶのに手一杯で、さらに別のことを学ぶのは大変で不必要なことだと思われるかもしれません。だって投票アプリケーションはきちんと動いているし、わざわざ自動テストを導入したところでアプリケーションがより良くなるわけではないのだから。もし Django プログラミングを学ぶ目的がこの投票アプリケーションを作ることだけならば、確かに自動テストの導入は必要ないと思います。しかし、そうではないなら、今こそ自動テストについて学ぶ絶好の機会です。</p>
<section id="s-tests-will-save-you-time">
<span id="tests-will-save-you-time"></span><h4>テストはあなたの時間を節約します<a class="headerlink" href="#tests-will-save-you-time" title="Link to this heading">¶</a></h4>
<p>ある程度の段階までは、「動作しているように見えることを確認する」だけでも十分なテストになります。しかし、より高度なアプリケーションでは、コンポーネント間に複雑な相互作用が数多く存在するかもしれません。</p>
<p>これらのコンポーネントの一部に変更を加えると、アプリケーションが予想外の振る舞いをするかもしれません。「動作しているように見える」ことを確認するために、20種類ものテストデータを使ってコードの機能を検証し、何も壊れていないことを確認する必要があるかもしれません。これは良い時間の使い方ではありません。</p>
<p>これは自動テストなら数秒で終わるのですから、なおさらです。何か問題が発生した場合も、テストは予期しない挙動を引き起こしているコードを特定するのに役立ちます。</p>
<p>テストを書くという行為は、特にプログラムが適切に動くと分かっているときには、生産的でも創造的でもないつまらないことのように思われるかもしれません。</p>
<p>しかしテストを書くことは、何時間もかけてアプリケーションの動作を確認したり、新しく発生した問題の原因を探したりすることよりもずっとやりがいのあることなのです。</p>
</section>
<section id="s-tests-don-t-just-identify-problems-they-prevent-them">
<span id="tests-don-t-just-identify-problems-they-prevent-them"></span><h4>またテストは問題点を検出するのみならず、問題が発生するのを防ぐこともできます。<a class="headerlink" href="#tests-don-t-just-identify-problems-they-prevent-them" title="Link to this heading">¶</a></h4>
<p>テストを単に開発の負の面と考えることは誤りです。</p>
<p>テストなくしては、アプリケーションの目的や意図した動作というものが曖昧になってしまうことがあります。自分自身で書いたコードであっても、時にはそのコードがすることを正確に理解するのに時間がかかってしまうことがあります。</p>
<p>テストはこの状況を大きく変え、いわばコードを内側から照らし出してくれます。そして、何か間違ったことをしてしまった時には、<em>自分自身では間違っていると気づかなかった場合でさえ</em>、間違いが起きた場所にスポットライトを当ててくれるのです。</p>
</section>
<section id="s-tests-make-your-code-more-attractive">
<span id="tests-make-your-code-more-attractive"></span><h4>テストは、コードをより魅力的にします<a class="headerlink" href="#tests-make-your-code-more-attractive" title="Link to this heading">¶</a></h4>
<p>たとえあなたが輝かしいソフトウェアを作ったとしても、テストがないというそれだけの理由で、多くの開発者は見ることさえしてくれないでしょう。テストのないソフトは信用されないのです。Django を開発した Jacob Kaplan-Moss は次の言葉を残しています。「テストのないコードは、デザインとして壊れている。」</p>
<p>あなたのソフトウェアを他の開発者が真剣に見てもらうというのも、テストを書くべきもう一つの理由です。</p>
</section>
<section id="s-tests-help-teams-work-together">
<span id="tests-help-teams-work-together"></span><h4>テストを書くことはチームで共同作業を行う上で役に立ちます。<a class="headerlink" href="#tests-help-teams-work-together" title="Link to this heading">¶</a></h4>
<p>これまでの点は、1人の開発者でアプリケーションをメンテナンスしているという観点から書きました。しかし、複雑なアプリケーションはチームでメンテナンスされるようになるものです。テストは、あなたが書いたコードを他人がうっかり壊してしまうことから守ってくれます (そして、他の人が書いたコードをあなたが壊してしまうことからも)。Django のプログラマとして生きてゆくつもりなら、良いテストを絶対に書かなければなりません！</p>
</section>
</section>
</section>
<section id="s-basic-testing-strategies">
<span id="basic-testing-strategies"></span><h2>基本的なテスト方針<a class="headerlink" href="#basic-testing-strategies" title="Link to this heading">¶</a></h2>
<p>テストを書くためのアプローチには、さまざまなものがあります。</p>
<p>一部のプログラマーは「テスト駆動開発 <a class="reference external" href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven development</a> 」と呼ばれる手法を採用しています。これは、実際にコードを書く前にテストを記述するというものです。直感に反するように思えるかもしれませんが、実際にはほとんどの人が同じようなことを実践しています。つまり、問題を説明し、その後それを解決するためのコードを作成するのです。テスト駆動開発は、この問題をPythonのテストケースとして形式化したものです。</p>
<p>テストの初心者の多くは、先にコードを書いてから、その後でテストが必要だと考えるものです。おそらく、もっと早くからいくつかテストを書いておいた方が良いですが、テストを始めるのに遅すぎるということはありません。</p>
<p>どこからテストを書き始めるべきか、把握が難しい場合もあります。もしすでに数千行の Python コードがあったとしたら、テストすべき場所を選ぶのは簡単ではないかもしれません。そのような場合には、次に新しい機能の追加やバグの修正を行う時に、最初のテストを書いてみると役に立つでしょう。</p>
<p>それでは早速始めてみましょう。</p>
</section>
<section id="s-writing-our-first-test">
<span id="writing-our-first-test"></span><h2>初めてのテスト作成<a class="headerlink" href="#writing-our-first-test" title="Link to this heading">¶</a></h2>
<section id="s-we-identify-a-bug">
<span id="we-identify-a-bug"></span><h3>バグを見つけたとき<a class="headerlink" href="#we-identify-a-bug" title="Link to this heading">¶</a></h3>
<p>運よく、 <code class="docutils literal notranslate"><span class="pre">polls</span></code> のアプリケーションにはすぐに修正可能な小さなバグがありました。<code class="docutils literal notranslate"><span class="pre">Question.was_published_recently()</span></code> のメソッドは <code class="docutils literal notranslate"><span class="pre">Question</span></code> が昨日以降に作成された場合に <code class="docutils literal notranslate"><span class="pre">True</span></code> を返すのですが(適切な動作)、 <code class="docutils literal notranslate"><span class="pre">Question</span></code> の <code class="docutils literal notranslate"><span class="pre">pub_date</span></code> が未来の日付になっている場合にも <code class="docutils literal notranslate"><span class="pre">True</span></code> を返してしまいます(不適切な動作)。</p>
<p>未来の日付の質問のメソッドをチェックするには、 <a class="reference internal" href="../ref/django-admin.html#django-admin-shell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">shell</span></code></a> を使用してバグを確認してください。</p>
<div class="console-block" id="console-block-0">
<input class="c-tab-unix" id="c-tab-0-unix" type="radio" name="console-0" checked>
<label for="c-tab-0-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-0-win" type="radio" name="console-0">
<label for="c-tab-0-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-0-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>manage.py<span class="w"> </span>shell
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-0-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py shell
</pre></div>
</section>
</div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">timezone</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">polls.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Question</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># create a Question instance with pub_date 30 days in the future</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">future_question</span> <span class="o">=</span> <span class="n">Question</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># was it published recently?</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">future_question</span><span class="o">.</span><span class="n">was_published_recently</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>将来のことは「最近（recent）」ではないため、これは明らかに間違いです。</p>
</section>
<section id="s-create-a-test-to-expose-the-bug">
<span id="create-a-test-to-expose-the-bug"></span><h3>バグをあぶり出すためにテストを作成する<a class="headerlink" href="#create-a-test-to-expose-the-bug" title="Link to this heading">¶</a></h3>
<p>問題をテストするために <a class="reference internal" href="../ref/django-admin.html#django-admin-shell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">shell</span></code></a> でたった今したことこそ、自動テストでしたいことです。そこで、今やったことを自動テストに変換してみましょう。</p>
<p>アプリケーションのテストを書く場所は、慣習として、アプリケーションの <code class="docutils literal notranslate"><span class="pre">tests.py</span></code> ファイル内ということになっています。テストシステムが <code class="docutils literal notranslate"><span class="pre">test</span></code> で始まる名前のファイルの中から、自動的にテストを見つけてくれます。</p>
<p><code class="docutils literal notranslate"><span class="pre">polls</span></code> アプリケーションの <code class="docutils literal notranslate"><span class="pre">tests.py</span></code> ファイルに次のコードを書きます。</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/tests.py</span></code></span><a class="headerlink" href="#id1" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">django.test</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">timezone</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Question</span>


<span class="k">class</span><span class="w"> </span><span class="nc">QuestionModelTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_was_published_recently_with_future_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        was_published_recently() returns False for questions whose pub_date</span>
<span class="sd">        is in the future.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">future_question</span> <span class="o">=</span> <span class="n">Question</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">future_question</span><span class="o">.</span><span class="n">was_published_recently</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>ここでは、未来の日付の <code class="docutils literal notranslate"><span class="pre">pub_date</span></code> を持つ <code class="docutils literal notranslate"><span class="pre">Question</span></code> のインスタンスを生成するメソッドを持つ <a class="reference internal" href="../topics/testing/tools.html#django.test.TestCase" title="django.test.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.test.TestCase</span></code></a> を継承したサブクラスを作っています。それから、<code class="docutils literal notranslate"><span class="pre">was_published_recently()</span></code> の出力をチェックしています。これは False になるはずです。</p>
</section>
<section id="s-running-tests">
<span id="running-tests"></span><h3>テストの実行<a class="headerlink" href="#running-tests" title="Link to this heading">¶</a></h3>
<p>ターミナルから、次のコマンドでテストが実行できます。</p>
<div class="console-block" id="console-block-1">
<input class="c-tab-unix" id="c-tab-1-unix" type="radio" name="console-1" checked>
<label for="c-tab-1-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-1-win" type="radio" name="console-1">
<label for="c-tab-1-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-1-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>manage.py<span class="w"> </span><span class="nb">test</span><span class="w"> </span>polls
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-1-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py test polls
</pre></div>
</section>
</div>
<p>すると、次のような結果になるでしょう。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Creating<span class="w"> </span><span class="nb">test</span><span class="w"> </span>database<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">alias</span><span class="w"> </span><span class="s1">&#39;default&#39;</span>...
System<span class="w"> </span>check<span class="w"> </span>identified<span class="w"> </span>no<span class="w"> </span>issues<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="w"> </span>silenced<span class="o">)</span>.
<span class="nv">F</span>
<span class="o">======================================================================</span>
FAIL:<span class="w"> </span>test_was_published_recently_with_future_question<span class="w"> </span><span class="o">(</span>polls.tests.QuestionModelTests<span class="o">)</span>
----------------------------------------------------------------------
Traceback<span class="w"> </span><span class="o">(</span>most<span class="w"> </span>recent<span class="w"> </span>call<span class="w"> </span>last<span class="o">)</span>:
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/path/to/djangotutorial/polls/tests.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">16</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>test_was_published_recently_with_future_question
<span class="w">    </span>self.assertIs<span class="o">(</span>future_question.was_published_recently<span class="o">()</span>,<span class="w"> </span>False<span class="o">)</span>
AssertionError:<span class="w"> </span>True<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>False

----------------------------------------------------------------------
Ran<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span>.001s

FAILED<span class="w"> </span><span class="o">(</span><span class="nv">failures</span><span class="o">=</span><span class="m">1</span><span class="o">)</span>
Destroying<span class="w"> </span><span class="nb">test</span><span class="w"> </span>database<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">alias</span><span class="w"> </span><span class="s1">&#39;default&#39;</span>...
</pre></div>
</div>
<div class="admonition-different-error admonition">
<p class="admonition-title">エラーが違う？</p>
<p>代わりにここで <code class="docutils literal notranslate"><span class="pre">NameError</span></code> を取得している場合、<a class="reference internal" href="tutorial02.html#tutorial02-import-timezone"><span class="std std-ref">Part 2</span></a> のステップを見逃している可能性があります。そのステップでは、<code class="docutils literal notranslate"><span class="pre">polls/models.py</span></code> に <code class="docutils literal notranslate"><span class="pre">datetime</span></code> と <code class="docutils literal notranslate"><span class="pre">timezone</span></code> のインポートを追加しました。そのセクションからインポートを複製し、テストを再度実行してください。</p>
</div>
<p>ここでは以下のようなことが起こりました。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">test</span> <span class="pre">polls</span></code> は、<code class="docutils literal notranslate"><span class="pre">polls</span></code> アプリケーション内にあるテストを探します</p></li>
<li><p><a class="reference internal" href="../topics/testing/tools.html#django.test.TestCase" title="django.test.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.test.TestCase</span></code></a> クラスのサブクラスを発見します</p></li>
<li><p>テストのための特別なデータベースを作成します</p></li>
<li><p>テスト用のメソッドとして、<code class="docutils literal notranslate"><span class="pre">test</span></code> で始まるメソッドを探します</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test_was_published_recently_with_future_question</span></code> の中で、<code class="docutils literal notranslate"><span class="pre">pub_date</span></code> フィールドに今日から30日後の日付を持つ <code class="docutils literal notranslate"><span class="pre">Question</span></code> インスタンスが作成されます</p></li>
<li><p>そして最後に、 <code class="docutils literal notranslate"><span class="pre">assertIs()</span></code> メソッドを使うことで、本当に返してほしいのは <code class="docutils literal notranslate"><span class="pre">False</span></code> だったにもかかわらず、 <code class="docutils literal notranslate"><span class="pre">was_published_recently()</span></code> が <code class="docutils literal notranslate"><span class="pre">True</span></code> を返していることを発見します</p></li>
</ul>
<p>テストは私たちにテストの失敗を教えてくれるだけでなく、失敗が起こったコードの行数まで教えてくれています。</p>
</section>
<section id="s-fixing-the-bug">
<span id="fixing-the-bug"></span><h3>バグを修正する<a class="headerlink" href="#fixing-the-bug" title="Link to this heading">¶</a></h3>
<p>私たちはすでに問題の原因を知っています。それは、<code class="docutils literal notranslate"><span class="pre">Question.was_published_recently()</span></code> は <code class="docutils literal notranslate"><span class="pre">pub_date</span></code> が未来の日付だった場合には <code class="docutils literal notranslate"><span class="pre">False</span></code> を返さなければならない、ということです。<code class="docutils literal notranslate"><span class="pre">models.py</span></code> にあるメソッドを修正して、日付が過去だった場合にのみ <code class="docutils literal notranslate"><span class="pre">True</span></code> を返すようにしましょう。</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/models.py</span></code></span><a class="headerlink" href="#id2" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">was_published_recently</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">now</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">&lt;=</span> <span class="n">now</span>
</pre></div>
</div>
</div>
<p>そして、もう一度テストを実行します。</p>
<div class="highlight-pytb notranslate"><div class="highlight"><pre><span></span><span class="x">Creating test database for alias &#39;default&#39;...</span>
<span class="x">System check identified no issues (0 silenced).</span>
<span class="x">.</span>
<span class="x">----------------------------------------------------------------------</span>
<span class="x">Ran 1 test in 0.001s</span>

<span class="x">OK</span>
<span class="x">Destroying test database for alias &#39;default&#39;...</span>
</pre></div>
</div>
<p>バグを発見した後、私たちはそのバグをあぶり出してくれるようなテストを書いて、コード内のバグを直したので、テストは無事にパスされました。</p>
<p>このアプリケーションでは将来、たくさんの他のバグが生じるかもしれませんが、このバグがうっかり入ってしまうことは二度とありません。単にテストを実行するだけで、すぐに警告を受けられるからです。アプリケーションのこの小さな部分が、安全に、そして永遠にピン留めされたと考えて差し支えありません。</p>
</section>
<section id="s-more-comprehensive-tests">
<span id="more-comprehensive-tests"></span><h3>より包括的なテスト<a class="headerlink" href="#more-comprehensive-tests" title="Link to this heading">¶</a></h3>
<p>この段階で、<code class="docutils literal notranslate"><span class="pre">was_published_recently()</span></code> メソッドをさらにピン留めしておけます。実際、一つのバグを直したことでほかのバグを作り出すなんてしたくありませんよね。</p>
<p>このメソッドの振る舞いをより包括的にテストするために、同じクラスにさらに2つのテストを追加しましょう。</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/tests.py</span></code></span><a class="headerlink" href="#id3" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_was_published_recently_with_old_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    was_published_recently() returns False for questions whose pub_date</span>
<span class="sd">    is older than 1 day.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">old_question</span> <span class="o">=</span> <span class="n">Question</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">old_question</span><span class="o">.</span><span class="n">was_published_recently</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_was_published_recently_with_recent_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    was_published_recently() returns True for questions whose pub_date</span>
<span class="sd">    is within the last day.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="mi">59</span><span class="p">)</span>
    <span class="n">recent_question</span> <span class="o">=</span> <span class="n">Question</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">recent_question</span><span class="o">.</span><span class="n">was_published_recently</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>これで、<code class="docutils literal notranslate"><span class="pre">Question.was_published_recently()</span></code> が過去、現在、そして未来の質問に対して意味のある値を返すことを確認する3つのテストが揃いました。</p>
<p>先述したように <code class="docutils literal notranslate"><span class="pre">polls</span></code> は簡単なアプリケーションですが、メソッドに対してテストを書いたおかげで、将来このアプリケーションがどんなに複雑になっても、あるいは他のどんなコードと相互作用するようになっても、メソッドが期待どおりに動作することを保証できるようになったのです。</p>
</section>
</section>
<section id="s-test-a-view">
<span id="test-a-view"></span><h2>ビューをテストする<a class="headerlink" href="#test-a-view" title="Link to this heading">¶</a></h2>
<p>この投票アプリケーションは、まだ質問をちゃんと見分けることができません。<code class="docutils literal notranslate"><span class="pre">pub_date</span></code> フィールドが未来の日付になっている質問を含め、どんな質問でも公開してしまいます。この点を改善するべきでしょう。<code class="docutils literal notranslate"><span class="pre">pub_date</span></code> を未来に設定するということは、その Question がその日付になった時に公開され、それまでは表示されないことを意味するはずです。</p>
<section id="s-a-test-for-a-view">
<span id="a-test-for-a-view"></span><h3>ビューに対するテスト<a class="headerlink" href="#a-test-for-a-view" title="Link to this heading">¶</a></h3>
<p>上でバグを修正した時には、初めにテストを書いてからコードを修正しました。実は、テスト駆動開発の簡単な例だったわけです。しかし、テストとコードを書く順番はどちらでも構いません。</p>
<p>初めのテストでは、コード内部の細かい動作に焦点を当てましたが、このテストでは、ユーザが Web ブラウザを通して経験する動作をチェックしましょう。</p>
<p>初めに何かを修正する前に、使用できるツールについて見ておきましょう。</p>
</section>
<section id="s-the-django-test-client">
<span id="the-django-test-client"></span><h3>Django テストクライアント<a class="headerlink" href="#the-django-test-client" title="Link to this heading">¶</a></h3>
<p>Django は、ビューレベルでのユーザとのインタラクションをシミュレートすることができる <a class="reference internal" href="../topics/testing/tools.html#django.test.Client" title="django.test.Client"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client</span></code></a> を用意しています。これを <code class="docutils literal notranslate"><span class="pre">tests.py</span></code> の中や <a class="reference internal" href="../ref/django-admin.html#django-admin-shell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">shell</span></code></a> でも使うことができます。</p>
<p>もう一度 <a class="reference internal" href="../ref/django-admin.html#django-admin-shell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">shell</span></code></a> からはじめましょう。ここでテストクライアントを使う場合には、<code class="docutils literal notranslate"><span class="pre">tests.py</span></code> では必要がない2つの準備が必要になります。まず最初にしなければならないのは、<a class="reference internal" href="../ref/django-admin.html#django-admin-shell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">shell</span></code></a> の上でテスト環境をセットアップすることです。</p>
<div class="console-block" id="console-block-2">
<input class="c-tab-unix" id="c-tab-2-unix" type="radio" name="console-2" checked>
<label for="c-tab-2-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-2-win" type="radio" name="console-2">
<label for="c-tab-2-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-2-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>manage.py<span class="w"> </span>shell
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-2-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py shell
</pre></div>
</section>
</div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.test.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup_test_environment</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">setup_test_environment</span><span class="p">()</span>
</pre></div>
</div>
<p><a class="reference internal" href="../topics/testing/advanced.html#django.test.utils.setup_test_environment" title="django.test.utils.setup_test_environment"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setup_test_environment()</span></code></a> は、テンプレートのレンダラーをインストールします。 これによって、今までは調査できなかった、レスポンス上のいくつかの属性（たとえば <code class="docutils literal notranslate"><span class="pre">response.context</span></code> ）を調査できるようになります。 注意点として、このメソッドはテスト用データベースを作成しないので、これに続く命令は既存のデータベースに対して実行されます。あなたの作成した question によってはアウトプットが多少異なるかもしれません。また <code class="docutils literal notranslate"><span class="pre">settings.py</span></code> の <code class="docutils literal notranslate"><span class="pre">TIME_ZONE</span></code> が正しくない場合は、予期しない結果になるでしょう。設定が正しいかどうか自信がなければ、次に進む前に TIME_ZONE を確認してください。</p>
<p>つぎに、テストクライアントのクラスをインポートする必要があります (後に取り上げる <code class="docutils literal notranslate"><span class="pre">tests.py</span></code> の中では、 <a class="reference internal" href="../topics/testing/tools.html#django.test.TestCase" title="django.test.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.test.TestCase</span></code></a> クラス自体がクライアントを持っているため、インポートは不要です)。</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.test</span><span class="w"> </span><span class="kn">import</span> <span class="n">Client</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># create an instance of the client for our use</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
</pre></div>
</div>
<p>さて、これでクライアントに仕事を頼む準備ができました。</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># get a response from &#39;/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="go">Not Found: /</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># we should expect a 404 from that address; if you instead see an</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># &quot;Invalid HTTP_HOST header&quot; error and a 400 response, you probably</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># omitted the setup_test_environment() call described earlier.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
<span class="go">404</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># on the other hand we should expect to find something at &#39;/polls/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># we&#39;ll use &#39;reverse()&#39; rather than a hardcoded URL</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">reverse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;polls:index&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
<span class="go">200</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">content</span>
<span class="go">b&#39;\n    &lt;ul&gt;\n    \n        &lt;li&gt;&lt;a href=&quot;/polls/1/&quot;&gt;What&amp;#x27;s up?&lt;/a&gt;&lt;/li&gt;\n    \n    &lt;/ul&gt;\n\n&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;latest_question_list&quot;</span><span class="p">]</span>
<span class="go">&lt;QuerySet [&lt;Question: What&#39;s up?&gt;]&gt;</span>
</pre></div>
</div>
</section>
<section id="s-improving-our-view">
<span id="improving-our-view"></span><h3>ビューを改良する<a class="headerlink" href="#improving-our-view" title="Link to this heading">¶</a></h3>
<p>現在の投票のリストは、まだ公開されていない (つまり <code class="docutils literal notranslate"><span class="pre">pub_date</span></code> の日付が未来になっている) 投票が表示される状態になっています。これを直しましょう。</p>
<p><a class="reference internal" href="tutorial04.html"><span class="doc">Tutorial 4</span></a> では、以下のような <a class="reference internal" href="../ref/class-based-views/generic-display.html#django.views.generic.list.ListView" title="django.views.generic.list.ListView"><code class="xref py py-class docutils literal notranslate"><span class="pre">ListView</span></code></a>: をベースにしたクラスベースビューを導入しました。</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/views.py</span></code></span><a class="headerlink" href="#id4" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">IndexView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;polls/index.html&quot;</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s2">&quot;latest_question_list&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the last five published questions.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-pub_date&quot;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">get_queryset()</span></code> メソッドを修正して、日付を <code class="docutils literal notranslate"><span class="pre">timezone.now()</span></code> と比較してチェックする必要があります。まず、インポート文を追加します:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/views.py</span></code></span><a class="headerlink" href="#id5" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">timezone</span>
</pre></div>
</div>
</div>
<p>そして、次のように <code class="docutils literal notranslate"><span class="pre">get_queryset</span></code> メソッドを修正します。</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/views.py</span></code></span><a class="headerlink" href="#id6" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the last five published questions (not including those set to be</span>
<span class="sd">    published in the future).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__lte</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-pub_date&quot;</span><span class="p">)[</span>
        <span class="p">:</span><span class="mi">5</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Question.objects.filter(pub_date__lte=timezone.now())</span></code> returns a queryset
containing <code class="docutils literal notranslate"><span class="pre">Question</span></code>s whose <code class="docutils literal notranslate"><span class="pre">pub_date</span></code> is less than or equal to - that
is, earlier than or equal to - <code class="docutils literal notranslate"><span class="pre">timezone.now()</span></code>.</p>
</section>
<section id="s-testing-our-new-view">
<span id="testing-our-new-view"></span><h3>新しいビューをテストする<a class="headerlink" href="#testing-our-new-view" title="Link to this heading">¶</a></h3>
<p>それでは、これで期待通りの満足のいく動作をしてくれるかどうか確かめましょう。まず、 <code class="docutils literal notranslate"><span class="pre">runserver</span></code> を実行して、ブラウザでサイトを読み込みます。過去と未来、それぞれの日付を持つ <code class="docutils literal notranslate"><span class="pre">Question</span></code> を作成し、すでに公開されている質問だけがリストに表示されるかどうかを確認します。あなたはまさか、<em>この通りにちゃんと動作しているか、プロジェクトにわずかでも変更を加えるたびに毎回手動で</em> 確認したいなどとは思わないですよね？ それなら、今回も上の <a class="reference internal" href="../ref/django-admin.html#django-admin-shell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">shell</span></code></a> のセッションに基づいてテストを作りましょう。</p>
<p>まず、<code class="docutils literal notranslate"><span class="pre">polls/tests.py</span></code> に次の行を追加します。</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/tests.py</span></code></span><a class="headerlink" href="#id7" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">reverse</span>
</pre></div>
</div>
</div>
<p>そして、question を簡単に作れるようにするショートカット関数と、新しいテストクラスを作ります。</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/tests.py</span></code></span><a class="headerlink" href="#id8" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="p">,</span> <span class="n">days</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a question with the given `question_text` and published the</span>
<span class="sd">    given number of `days` offset to now (negative for questions published</span>
<span class="sd">    in the past, positive for questions that have yet to be published).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="n">question_text</span><span class="p">,</span> <span class="n">pub_date</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">QuestionIndexViewTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_no_questions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If no questions exist, an appropriate message is displayed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;polls:index&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;No polls are available.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerySetEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;latest_question_list&quot;</span><span class="p">],</span> <span class="p">[])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_past_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Questions with a pub_date in the past are displayed on the</span>
<span class="sd">        index page.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">question</span> <span class="o">=</span> <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s2">&quot;Past question.&quot;</span><span class="p">,</span> <span class="n">days</span><span class="o">=-</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;polls:index&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerySetEqual</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;latest_question_list&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="n">question</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_future_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Questions with a pub_date in the future aren&#39;t displayed on</span>
<span class="sd">        the index page.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s2">&quot;Future question.&quot;</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;polls:index&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;No polls are available.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerySetEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;latest_question_list&quot;</span><span class="p">],</span> <span class="p">[])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_future_question_and_past_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Even if both past and future questions exist, only past questions</span>
<span class="sd">        are displayed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">question</span> <span class="o">=</span> <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s2">&quot;Past question.&quot;</span><span class="p">,</span> <span class="n">days</span><span class="o">=-</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s2">&quot;Future question.&quot;</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;polls:index&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerySetEqual</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;latest_question_list&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="n">question</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_two_past_questions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The questions index page may display multiple questions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">question1</span> <span class="o">=</span> <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s2">&quot;Past question 1.&quot;</span><span class="p">,</span> <span class="n">days</span><span class="o">=-</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">question2</span> <span class="o">=</span> <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s2">&quot;Past question 2.&quot;</span><span class="p">,</span> <span class="n">days</span><span class="o">=-</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;polls:index&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerySetEqual</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;latest_question_list&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="n">question2</span><span class="p">,</span> <span class="n">question1</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<p>これらのコードを詳しく見ていきましょう。</p>
<p>まず、question のショートカット関数 <code class="docutils literal notranslate"><span class="pre">create_question</span></code> です。この関数によって、 question 作成処理のコード重複をなくしています。</p>
<p><code class="docutils literal notranslate"><span class="pre">test_index_view_with_no_questions</span></code> は question を1つも作りませんが、 &quot;No polls are available.&quot; というメッセージが表示されていることをチェックし、<code class="docutils literal notranslate"><span class="pre">latest_question_list</span></code> が空になっているか確認しています。 <a class="reference internal" href="../topics/testing/tools.html#django.test.TestCase" title="django.test.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.test.TestCase</span></code></a> クラスが追加のアサーションメソッドを提供していることに注意してください。この例では、 <a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase.assertContains" title="django.test.SimpleTestCase.assertContains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertContains()</span></code></a> と <a class="reference internal" href="../topics/testing/tools.html#django.test.TransactionTestCase.assertQuerySetEqual" title="django.test.TransactionTestCase.assertQuerySetEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertQuerySetEqual()</span></code></a> を使用しています。</p>
<p><code class="docutils literal notranslate"><span class="pre">test_index_view_with_a_past_question</span></code> では、question を作成し、その question がリストに現れるかどうかを検証しています。</p>
<p><code class="docutils literal notranslate"><span class="pre">test_index_view_with_a_future_question</span></code> では、<code class="docutils literal notranslate"><span class="pre">pub_date</span></code> が未来の日付の質問を作っています。データベースは各テストメソッドごとにリセットされるので、この時にはデータベースには最初の質問は残っていません。そのため、index ページにはquestion は1つもありません。</p>
<p>以下のテストメソッドも同様です。実際のところ、私たちはテストを用いて、管理者の入力とサイトでのユーザの体験についてのストーリを語り、システムの各状態とそこでの新しい変化のそれぞれに対して、期待通りの結果が公開されているかどうかをチェックしているのです。</p>
</section>
<section id="s-testing-the-detailview">
<span id="testing-the-detailview"></span><h3><code class="docutils literal notranslate"><span class="pre">DetailView</span></code> のテスト<a class="headerlink" href="#testing-the-detailview" title="Link to this heading">¶</a></h3>
<p>とても上手くいっていますね。しかし、未来の質問は <em>index</em> に表示されないものの、正しいURL を知っていたり推測したりしたユーザは、まだページに到達できてしまいます。そのため、同じような制約を <code class="docutils literal notranslate"><span class="pre">DetailView</span></code> にも追加する必要があります。</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/views.py</span></code></span><a class="headerlink" href="#id9" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DetailView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Excludes any questions that aren&#39;t published yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__lte</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>そして、 <code class="docutils literal notranslate"><span class="pre">pub_date</span></code> が過去のものである <code class="docutils literal notranslate"><span class="pre">Question</span></code> は表示でき、未来のものである <code class="docutils literal notranslate"><span class="pre">pub_date</span></code> は表示できないことを確認するために、いくつかのテストを追加しなければなりません:</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/tests.py</span></code></span><a class="headerlink" href="#id10" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">QuestionDetailViewTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_future_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The detail view of a question with a pub_date in the future</span>
<span class="sd">        returns a 404 not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">future_question</span> <span class="o">=</span> <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s2">&quot;Future question.&quot;</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;polls:detail&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">future_question</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">404</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_past_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The detail view of a question with a pub_date in the past</span>
<span class="sd">        displays the question&#39;s text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">past_question</span> <span class="o">=</span> <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s2">&quot;Past Question.&quot;</span><span class="p">,</span> <span class="n">days</span><span class="o">=-</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;polls:detail&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">past_question</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">past_question</span><span class="o">.</span><span class="n">question_text</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="s-ideas-for-more-tests">
<span id="ideas-for-more-tests"></span><h3>さらなるテストについて考える<a class="headerlink" href="#ideas-for-more-tests" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ResultsView</span></code> にも同じように <code class="docutils literal notranslate"><span class="pre">get_queryset</span></code> メソッドを追加して、新しいテストクラスも作らなければならないようです。しかしこれは、今作ったばかりのものとそっくりになるでしょう。実際、テストは重複だらけになるはずです。</p>
<p>テストを追加することによって、同じように他の方法でアプリを改善できるでしょう。例えば、<code class="docutils literal notranslate"><span class="pre">Choices</span></code> を一つも持たない馬鹿げた <code class="docutils literal notranslate"><span class="pre">Questions</span></code> が公開可能になっています。このような <code class="docutils literal notranslate"><span class="pre">Questions</span></code> を排除するようビューでチェックできます。 <code class="docutils literal notranslate"><span class="pre">Choices</span></code> がない <code class="docutils literal notranslate"><span class="pre">Question</span></code> を作成し、それが公開されないことをテストし、同じようにして、<code class="docutils literal notranslate"><span class="pre">Choices</span></code> <em>がある</em> <code class="docutils literal notranslate"><span class="pre">Question</span></code> を作成し、それが公開 <em>される</em> ことをテストすることになるでしょう。</p>
<p>もしかすると管理者としてログインしているユーザーは、一般の訪問者と違い、 まだ公開されていない <code class="docutils literal notranslate"><span class="pre">Questions</span></code> を見ることができるようにした方がいいかもしれません。また繰り返しになりますが、この問題を解決するためにソフトウェアにどんなコードが追加されべきであったとしても、そのコードにはテストが伴うべきです。テストを先に書いてからそのテストを通るコードを書くのか、あるいはコードの中で先にロジックを試してからテストを書いてそれを検証するのか、いずれにしてもです。</p>
<p>ある時点で、書いたテストが限界に達しているように見え、テストが膨らみすぎてコードが苦しくなってしまうのではないかという疑問が浮かんでくるでしょう。こうなった場合にはどうすれば良いのでしょうか？</p>
</section>
</section>
<section id="s-when-testing-more-is-better">
<span id="when-testing-more-is-better"></span><h2>テストにおいて、多いことはいいことだ<a class="headerlink" href="#when-testing-more-is-better" title="Link to this heading">¶</a></h2>
<p>私たちのテストは、手がつけられないほど成長してしまっているように見えるかもしれません。この割合で行けば、テストコードがアプリケーションのコードよりもすぐに大きくなってしまうでしょう。そして繰り返しは、残りの私たちのコードのエレガントな簡潔さに比べて、美しくありません。</p>
<p><strong>構いません</strong>。 テストコードが大きくなるのに任せましょう。たいていの場合、あなたはテストを一回書いたら、そのことを忘れて大丈夫です。プログラムを開発し続ける限りずっと、そのテストは便利に機能し続けます。</p>
<p>時には、テストのアップデートが必要になることがあります。たとえば、 <code class="docutils literal notranslate"><span class="pre">Choices</span></code> を持つ <code class="docutils literal notranslate"><span class="pre">Questions</span></code> だけを公開するようにビューを修正したとします。この場合、既存のテストの多くは失敗します。この失敗によって、 <em>最新の状態に対応するために、どのテストを修正する必要があるのか</em> が正確にわかります。そのため、ある程度、テストはテスト自身をチェックする助けになります。</p>
<p>最悪の場合、開発を続けていくにつれて、あるテストが今では冗長なものになっていることに気づいてしまうかもしれません。これも問題ではありません。テストにおいては、冗長であることは <em>良い</em> ことなのです。</p>
<p>きちんと考えてテストを整理していれば、テストが手に負えなくなることはありません。経験上、良いルールとして次のようなものが挙げられます。</p>
<ul class="simple">
<li><p>モデルやビューごとに <code class="docutils literal notranslate"><span class="pre">TestClass</span></code> を分割する</p></li>
<li><p>テストしたい条件の集まりのそれぞれに対して、異なるテストメソッドを作る</p></li>
<li><p>テストメソッドの名前は、その機能を説明するようなものにする</p></li>
</ul>
</section>
<section id="s-further-testing">
<span id="further-testing"></span><h2>さらなるテスト<a class="headerlink" href="#further-testing" title="Link to this heading">¶</a></h2>
<p>このチュートリアルでは、テストの基本の一部を紹介しました。この他にもあなたにできることはまだまだたくさんありますし、いろいろと賢いことを実現するに使えるとても便利なツールが数多く用意されています。</p>
<p>たとえば、ここでのテストでは、モデルの内部ロジックと、ビューの情報の公開の仕方をカバーしましたが、ブラウザが HTML を実際にどのようにレンダリングのするのかをテストする <a class="reference external" href="https://www.selenium.dev/">Selenium</a> のような &quot;in-browser&quot; のフレームワークを使うこともできます。これらのツールは、Django が生成したコードの振る舞いだけでなく、たとえば、 JavaScript の振る舞いも確認できます。テストがブラウザを起動してサイトとインタラクションしているのを見るのはとても面白いですよ。まるで本物の人間がブラウザを操作しているかのように見えるんです！ Django には、Selenium のようなツールとの連携を容易にしてくれる <a class="reference internal" href="../topics/testing/tools.html#django.test.LiveServerTestCase" title="django.test.LiveServerTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">LiveServerTestCase</span></code></a> が用意されています。</p>
<p>複雑なアプリケーションを開発する時には、継続的インテグレーション (<a class="reference external" href="https://en.wikipedia.org/wiki/Continuous_integration">continuous integration</a>) のために、コミットの度に自動的にテストを実行するといいかもしれませんね。継続的インテグレーションを行えば、品質管理それ自体が、少なくとも部分的には自動化できます。</p>
<p>アプリケーションのテストされていない部分を発見するには、コードカバレッジをチェックするのが良いやり方です。これはまた、壊れやすいコードや使用されていないデッドコードの発見にも役に立ちます。テストできないコード片がある場合、ふつうは、そのコードはリファクタリングするか削除する必要があることを意味します。カバレッジはデッドコードの識別に役に立つでしょう。詳細は <a class="reference internal" href="../topics/testing/advanced.html#topics-testing-code-coverage"><span class="std std-ref">coverage.py との統合</span></a>  を参照してください。</p>
<p><a class="reference internal" href="../topics/testing/index.html"><span class="doc">Django におけるテスト</span></a> には、テストに関する包括的な情報がまとめられています。</p>
</section>
<section id="s-what-s-next">
<span id="what-s-next"></span><h2>次は何をしましょうか？<a class="headerlink" href="#what-s-next" title="Link to this heading">¶</a></h2>
<p>テストの詳細は、<a class="reference internal" href="../topics/testing/index.html"><span class="doc">Djagnoにおけるテスト</span></a> を参照してください。</p>
<p>テストやビューを使いこなせるようになったら、 <a class="reference internal" href="tutorial06.html"><span class="doc">チュートリアルその6</span></a> に進んで、静的ファイルの管理について学びましょう。</p>
</section>
</section>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">はじめての Django アプリ作成、その 5</a><ul>
<li><a class="reference internal" href="#introducing-automated-testing">自動テストの導入</a><ul>
<li><a class="reference internal" href="#what-are-automated-tests">自動テストとは何ですか？</a></li>
<li><a class="reference internal" href="#why-you-need-to-create-tests">なぜテストを作成する必要があるのか</a><ul>
<li><a class="reference internal" href="#tests-will-save-you-time">テストはあなたの時間を節約します</a></li>
<li><a class="reference internal" href="#tests-don-t-just-identify-problems-they-prevent-them">またテストは問題点を検出するのみならず、問題が発生するのを防ぐこともできます。</a></li>
<li><a class="reference internal" href="#tests-make-your-code-more-attractive">テストは、コードをより魅力的にします</a></li>
<li><a class="reference internal" href="#tests-help-teams-work-together">テストを書くことはチームで共同作業を行う上で役に立ちます。</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#basic-testing-strategies">基本的なテスト方針</a></li>
<li><a class="reference internal" href="#writing-our-first-test">初めてのテスト作成</a><ul>
<li><a class="reference internal" href="#we-identify-a-bug">バグを見つけたとき</a></li>
<li><a class="reference internal" href="#create-a-test-to-expose-the-bug">バグをあぶり出すためにテストを作成する</a></li>
<li><a class="reference internal" href="#running-tests">テストの実行</a></li>
<li><a class="reference internal" href="#fixing-the-bug">バグを修正する</a></li>
<li><a class="reference internal" href="#more-comprehensive-tests">より包括的なテスト</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-a-view">ビューをテストする</a><ul>
<li><a class="reference internal" href="#a-test-for-a-view">ビューに対するテスト</a></li>
<li><a class="reference internal" href="#the-django-test-client">Django テストクライアント</a></li>
<li><a class="reference internal" href="#improving-our-view">ビューを改良する</a></li>
<li><a class="reference internal" href="#testing-our-new-view">新しいビューをテストする</a></li>
<li><a class="reference internal" href="#testing-the-detailview"><code class="docutils literal notranslate"><span class="pre">DetailView</span></code> のテスト</a></li>
<li><a class="reference internal" href="#ideas-for-more-tests">さらなるテストについて考える</a></li>
</ul>
</li>
<li><a class="reference internal" href="#when-testing-more-is-better">テストにおいて、多いことはいいことだ</a></li>
<li><a class="reference internal" href="#further-testing">さらなるテスト</a></li>
<li><a class="reference internal" href="#what-s-next">次は何をしましょうか？</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="tutorial04.html"
                          title="前の章へ">はじめての Django アプリ作成、その 4</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="tutorial06.html"
                          title="次の章へ">はじめての Django アプリ作成、その 6</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/intro/tutorial05.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">1月 22, 2025</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="tutorial04.html" title="はじめての Django アプリ作成、その 4">previous</a>
     |
    <a href="index.html" title="さぁ始めましょう" accesskey="U">up</a>
   |
    <a href="tutorial06.html" title="はじめての Django アプリ作成、その 6">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>