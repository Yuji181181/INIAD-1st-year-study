<!DOCTYPE html>

<html lang="ja" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>はじめての Django アプリ作成、その 7 &#8212; Django 5.1.6.dev20250122212402 ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=34bb78ad" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css?v=bf4d74af" />
    <script src="../_static/documentation_options.js?v=d2885b0a"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=4755f45a"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="はじめての Django アプリ作成、その 8" href="tutorial08.html" />
    <link rel="prev" title="はじめての Django アプリ作成、その 6" href="tutorial06.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);(function($) {
    $(document).ready(function() {
        $(".c-tab-unix").on("click", function() {
            $("section.c-content-unix").show();
            $("section.c-content-win").hide();
            $(".c-tab-unix").prop("checked", true);
        });
        $(".c-tab-win").on("click", function() {
            $("section.c-content-win").show();
            $("section.c-content-unix").hide();
            $(".c-tab-win").prop("checked", true);
        });
    });
})(jQuery);</script>
<link rel="stylesheet" href="../_static/console-tabs.css">
  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 5.1.6.dev20250122212402 ドキュメント</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="tutorial06.html" title="はじめての Django アプリ作成、その 6">previous</a>
     |
    <a href="index.html" title="さぁ始めましょう" accesskey="U">up</a>
   |
    <a href="tutorial08.html" title="はじめての Django アプリ作成、その 8">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="intro-tutorial07">
            
  <section id="s-writing-your-first-django-app-part-7">
<span id="writing-your-first-django-app-part-7"></span><h1>はじめての Django アプリ作成、その 7<a class="headerlink" href="#writing-your-first-django-app-part-7" title="Link to this heading">¶</a></h1>
<p>このチュートリアルは <a class="reference internal" href="tutorial06.html"><span class="doc">チュートリアル その6</span></a> の続きです。ここでは、引き続き Web 投票アプリケーションの開発を続け、 <a class="reference internal" href="tutorial02.html"><span class="doc">チュートリアル その2</span></a> で少し触れた、Django が 自動生成する管理サイトのカスタマイズに焦点を当てます。</p>
<div class="admonition-where-to-get-help admonition">
<p class="admonition-title">困ったときは:</p>
<p>このチュートリアルの実行に問題がある場合は、FAQ の <a class="reference internal" href="../faq/help.html"><span class="doc">Getting Help</span></a> セクションに進んでください。</p>
</div>
<section id="s-customize-the-admin-form">
<span id="customize-the-admin-form"></span><h2>admin フォームのカスタマイズ<a class="headerlink" href="#customize-the-admin-form" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">admin.site.register(Question)</span></code> の呼び出しによって <code class="docutils literal notranslate"><span class="pre">Question</span></code> モデルを登録したことで、Django はデフォルトの形式でオブジェクトを表示できました。 admin フォームの表示方法や操作の仕方をデフォルトから変更したいこともよくあります。それには、オブジェクトを登録する時にオプションを指定します。</p>
<p>ためしに、編集フォームでのフィールドの並び順を並べ替えてみましょう。 <code class="docutils literal notranslate"><span class="pre">admin.site.register(Question)</span></code> の行を以下のように置き換えてみてください。</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/admin.py</span></code></span><a class="headerlink" href="#id1" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">admin</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Question</span>


<span class="k">class</span><span class="w"> </span><span class="nc">QuestionAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pub_date&quot;</span><span class="p">,</span> <span class="s2">&quot;question_text&quot;</span><span class="p">]</span>


<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Question</span><span class="p">,</span> <span class="n">QuestionAdmin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>このように、モデルの admin のオプションを変更したいときには、モデルごとに admin クラスを作成して、 <code class="docutils literal notranslate"><span class="pre">admin.site.register()</span></code> の 2 番目の引数に渡すと いうパターンに従ってください。</p>
<p>上の例では、「Publication date」フィールドの表示位置を「Question」フィールドよりも前に変更しています:</p>
<img alt="フィールドの並び順が変更されました" src="../_images/admin07.png" />
<p>二つしかフィールドがないので、あまりぱっとした変化ではありませんね。しかし admin フォームで数十ものフィールドを操作するような場合には、直感的なフィー ルドの並び順というものはユーザビリティ上重要な要素です。</p>
<p>また、数十ものフィールドがある場合、フォームを複数のフィールドセットに分割したいこともあるでしょう。</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/admin.py</span></code></span><a class="headerlink" href="#id2" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">admin</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Question</span>


<span class="k">class</span><span class="w"> </span><span class="nc">QuestionAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">fieldsets</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;question_text&quot;</span><span class="p">]}),</span>
        <span class="p">(</span><span class="s2">&quot;Date information&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pub_date&quot;</span><span class="p">]}),</span>
    <span class="p">]</span>


<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Question</span><span class="p">,</span> <span class="n">QuestionAdmin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.fieldsets" title="django.contrib.admin.ModelAdmin.fieldsets"><code class="xref py py-attr docutils literal notranslate"><span class="pre">fieldsets</span></code></a> の各タプルの先頭の要素はフィールドセットのタイトルです。 フォームは以下のように表示されます。</p>
<img alt="フォームにフィールドセットが追加されました" src="../_images/admin08t.png" />
</section>
<section id="s-adding-related-objects">
<span id="adding-related-objects"></span><h2>リレーション先オブジェクトの追加<a class="headerlink" href="#adding-related-objects" title="Link to this heading">¶</a></h2>
<p>OK、 Question の管理ページはできました。しかし <code class="docutils literal notranslate"><span class="pre">Question</span></code> は複数の <code class="docutils literal notranslate"><span class="pre">Choice</span></code> を持つのに、管理ページには表示されていませんね。</p>
<p>現状はそうですが、表示はできます。</p>
<p>この問題を解決するには2つの方法があります。1つ目は、 <code class="docutils literal notranslate"><span class="pre">Question</span></code> と同じようにadminに <code class="docutils literal notranslate"><span class="pre">Choice</span></code> を登録する方法です:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/admin.py</span></code></span><a class="headerlink" href="#id3" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">admin</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Choice</span><span class="p">,</span> <span class="n">Question</span>

<span class="c1"># ...</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Choice</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>これで、 Django の管理サイト上で「Choice」 を選べます。「Choice の追加」フォーム は以下のようになります。</p>
<img alt="adminページを選択" src="../_images/admin09.png" />
<p>このフォームでは「Question」フィールドは選択ボックスで、データベース上の全ての質問を選択できます。Django は <a class="reference internal" href="../ref/models/fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a> を表示する時には <code class="docutils literal notranslate"><span class="pre">&lt;select&gt;</span></code> ボックスを使わねばならないということを知っているのです。今の時点では、 Question はデータベース上に一つしかないはずですね。</p>
<p>Question フィールドの隣に「別の質問を追加 (Add nother question)」リンクがあるのに注意してください。 <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> の関係にあるオブジェクトなら、何もしなくてもこのリンクが表示されます。「もう一つ追加」をクリックすると、「別の質問を追加 (Add another  question)」というポップアップウィンドウを表示します。このウィンドウで Question を追加して「保存」を押すと、 Django は Question をデータベースに保存して、もとの 「Choice の追加(Add choice)」フォームに選択済みの項目として動的に追加します。</p>
<p>しかし、この方法は <code class="docutils literal notranslate"><span class="pre">Choice</span></code> オブジェクトをシステムに追加するには効率的ではありません。 <code class="docutils literal notranslate"><span class="pre">Question</span></code> オブジェクトを追加する時に Choice をひと揃い追加できた方が便利ですよね。そうしてみましょう。</p>
<p><code class="docutils literal notranslate"><span class="pre">Choice</span></code> モデルに対する <code class="docutils literal notranslate"><span class="pre">register()</span></code> を削除して、 <code class="docutils literal notranslate"><span class="pre">Question</span></code> の登録する部分を以下のように書き換えてください。</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/admin.py</span></code></span><a class="headerlink" href="#id4" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">admin</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Choice</span><span class="p">,</span> <span class="n">Question</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ChoiceInline</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">StackedInline</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Choice</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="mi">3</span>


<span class="k">class</span><span class="w"> </span><span class="nc">QuestionAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">fieldsets</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;question_text&quot;</span><span class="p">]}),</span>
        <span class="p">(</span><span class="s2">&quot;Date information&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;pub_date&quot;</span><span class="p">],</span> <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;collapse&quot;</span><span class="p">]}),</span>
    <span class="p">]</span>
    <span class="n">inlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ChoiceInline</span><span class="p">]</span>


<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Question</span><span class="p">,</span> <span class="n">QuestionAdmin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>この行は Django に対して、「<code class="docutils literal notranslate"><span class="pre">Choice</span></code> オブジェクトは <code class="docutils literal notranslate"><span class="pre">Question</span></code> の管理ページから編集する。デフォルトでは、 3 つの <code class="docutils literal notranslate"><span class="pre">Choice</span></code> を表示するのに十分なフィールドを用意すること」と指示しています。</p>
<p>「questionを追加 (Add question)」ページを読み込んで、どのように見えるか確かめてみましょう。</p>
<img alt="質問追加ページで選択肢が表示されるようになりました" src="../_images/admin10t.png" />
<p>変わった点をみてみましょう。リレーション相手である <code class="docutils literal notranslate"><span class="pre">Choice</span></code> を表示するために 3 つのスロットがあります (<code class="docutils literal notranslate"><span class="pre">extra</span></code> に指定した数ですね)。また、作成済みのオブジェクトを「編集する」ページに行けば、いつでも 3 つ余分のスロットが表示されるはずです。</p>
<p>現在の3つのスロットの最後に「別の選択肢を追加」というリンクがあります。 これをクリックすると新しいスロットが追加されます。追加されたスロットを削除したい場合は、追加されたスロットの右上にある×をクリックしてください。この画像は追加されたスロットを示しています:</p>
<img alt="動的に追加されるスロット" src="../_images/admin14t.png" />
<p>さて、このコードにはちょっと問題があります。というのも、 <code class="docutils literal notranslate"><span class="pre">Choice</span></code> オブジェク トを入力するためのフィールドを全部表示しようとすると、相当な広さのスクリーンが必要だからです。このため、 Django にはテーブルを使ってインラインでリレーション相手のオブジェクトを表示する方法があります。以下のように、 <code class="docutils literal notranslate"><span class="pre">ChoiceInline</span></code> の宣言を変更してください。</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/admin.py</span></code></span><a class="headerlink" href="#id5" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ChoiceInline</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">TabularInline</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">StackedInline</span></code> に代わって <code class="docutils literal notranslate"><span class="pre">TabularInline</span></code> を使うと、 リレーション相手のオブジェクトはコンパクトなテーブル形式で表示されます:</p>
<img alt="質問追加ページで、よりコンパクトな選択肢を追加しました" src="../_images/admin11t.png" />
<p>追加の &quot;Delete?&quot; カラムがあることに注意してください。このカラムは、 &quot;Added Another Choice&quot; ボタンで追加された行や、すでに保存された行を削除するためにあります。</p>
</section>
<section id="s-customize-the-admin-change-list">
<span id="customize-the-admin-change-list"></span><h2>管理サイトのチェンジリストページをカスタマイズする<a class="headerlink" href="#customize-the-admin-change-list" title="Link to this heading">¶</a></h2>
<p>さあ、これで Question の管理ページはだいぶよくなってきました。今度は「チェンジリスト」ページをすこしいじりましょう。チェンジリスト (change list) は、システム上の全ての Question を表示するページです。</p>
<p>現時点では以下のように表示されています。</p>
<img alt="投票の変更一覧ページ" src="../_images/admin04t.png" />
<p>デフォルトでは、Django は各オブジェクトの <code class="docutils literal notranslate"><span class="pre">str()</span></code> を表示します。しかし、個々のフィールドを表示できた方が便利なこともあります。そのためには、 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.list_display" title="django.contrib.admin.ModelAdmin.list_display"><code class="xref py py-attr docutils literal notranslate"><span class="pre">list_display</span></code></a> 管理オプションを使います。これは、オブジェクトのチェンジリストページで表示するフィールド名のリストをカラムとして表示するものです:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/admin.py</span></code></span><a class="headerlink" href="#id6" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">QuestionAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;question_text&quot;</span><span class="p">,</span> <span class="s2">&quot;pub_date&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>念のため、 <a class="reference internal" href="tutorial02.html"><span class="doc">チュートリアル その2</span></a> の <code class="docutils literal notranslate"><span class="pre">was_published_recently()</span></code> メソッドも含めましょう。</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/admin.py</span></code></span><a class="headerlink" href="#id7" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">QuestionAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;question_text&quot;</span><span class="p">,</span> <span class="s2">&quot;pub_date&quot;</span><span class="p">,</span> <span class="s2">&quot;was_published_recently&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>これで、Question のチェンジリストのページは以下のようになります:</p>
<img alt="更新された Polls の変更一覧ページ" src="../_images/admin12t.png" />
<p>カラムのヘッダをクリックすると、カラムの値に応じてエントリを並べ換えできます。ただし <code class="docutils literal notranslate"><span class="pre">was_published_recently</span></code> ヘッダは例外であり、これはメソッドの戻り値を使った並べ換えをサポートしていないからです。 <code class="docutils literal notranslate"><span class="pre">was_published_recently</span></code> のカラムヘッダは、デフォルトではメソッド名 (アンダースコアを空白に置き換えたもの) になっていることに注目してください。また、各行は戻り値の文字列表現となっています。</p>
<p>次のように、<a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.display" title="django.contrib.admin.display"><code class="xref py py-func docutils literal notranslate"><span class="pre">display()</span></code></a> デコレーターをそのメソッドに使用することで改善できます（<a class="reference internal" href="tutorial02.html"><span class="doc">チュートリアル2</span></a> で作成された <code class="file docutils literal notranslate"><span class="pre">polls/models.py</span></code> ファイルを拡張します）。</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">polls/models.py</span></code></span><a class="headerlink" href="#id8" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">admin</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Question</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="nd">@admin</span><span class="o">.</span><span class="n">display</span><span class="p">(</span>
        <span class="n">boolean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ordering</span><span class="o">=</span><span class="s2">&quot;pub_date&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Published recently?&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">was_published_recently</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">now</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">&lt;=</span> <span class="n">now</span>
</pre></div>
</div>
</div>
<p>デコレータで設定できるプロパティに関する詳しい情報は、<a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.list_display" title="django.contrib.admin.ModelAdmin.list_display"><code class="xref py py-attr docutils literal notranslate"><span class="pre">list_display</span></code></a> を参照してください。</p>
<p><code class="file docutils literal notranslate"><span class="pre">polls/admin.py</span></code> ファイルをもう一度編集して、<code class="docutils literal notranslate"><span class="pre">Question</span></code> のチェンジリストのページに <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.list_filter" title="django.contrib.admin.ModelAdmin.list_filter"><code class="xref py py-attr docutils literal notranslate"><span class="pre">list_filter</span></code></a> を追加して、さらに改良しましょう。それには、<code class="docutils literal notranslate"><span class="pre">QuestionAdmin</span></code> に次に行を追加します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">list_filter</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pub_date&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>これで、「フィルタ (Filter)」サイドバーができ、チェンジリストを <code class="docutils literal notranslate"><span class="pre">pub_date</span></code> フィールドの値に従ってフィルタできるようになります。</p>
<img alt="更新された Polls の変更一覧ページ" src="../_images/admin13t.png" />
<p>フィルタの種類は、フィルタ対象のフィールドの種類に応じて変化します。<code class="docutils literal notranslate"><span class="pre">pub_date</span></code> は <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a> なので、Django はこのフィールドにふさわしいフィルタオプションが、「すべての期間 (&quot;Any date&quot;)」「今日 (&quot;Today&quot;)」「今週 (&quot;Past 7 days&quot;)」「今月 (&quot;This month&quot;)」であることを知っているのです。</p>
<p>いい感じに体裁が整ってきました。今度は検索機能を追加してみましょう。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;question_text&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>これでチェンジリストの上部に検索ボックスが表示されます。ユーザが検索語を入力すると、 Django は <code class="docutils literal notranslate"><span class="pre">question_text</span></code> フィールドを検索します。フィールドはいくらでも使えますが、舞台裏では <code class="docutils literal notranslate"><span class="pre">LIKE</span></code> クエリを使うのでデータベースに過剰な負荷をかけないために常識的な範囲にしましょう。</p>
<p>さて、ここでお知らせしたいこととして、チェンジリストには最初からページ分割機能があります。デフォルトではページあたり 100 個の要素を表示します。<a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.list_per_page" title="django.contrib.admin.ModelAdmin.list_per_page"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ページ分割</span></code></a>、<a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.search_fields" title="django.contrib.admin.ModelAdmin.search_fields"><code class="xref py py-attr docutils literal notranslate"><span class="pre">検索ボックス</span></code></a>、<a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.list_filter" title="django.contrib.admin.ModelAdmin.list_filter"><code class="xref py py-attr docutils literal notranslate"><span class="pre">フィルタ</span></code></a>、<a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.date_hierarchy" title="django.contrib.admin.ModelAdmin.date_hierarchy"><code class="xref py py-attr docutils literal notranslate"><span class="pre">日付による階層化</span></code></a>、<a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.list_display" title="django.contrib.admin.ModelAdmin.list_display"><code class="xref py py-attr docutils literal notranslate"><span class="pre">カラムヘッダを使った並び替え</span></code></a> の機能は、すべて協調して思いのままに動作します。</p>
</section>
<section id="s-customize-the-admin-look-and-feel">
<span id="customize-the-admin-look-and-feel"></span><h2>管理サイトのルック &amp; フィールをカスタマイズする<a class="headerlink" href="#customize-the-admin-look-and-feel" title="Link to this heading">¶</a></h2>
<p>管理サイトの上部には「Django 管理サイト (Django adminstration)」と表示されていますが、これはいささか滑稽ですね。これは単なるプレースホルダテキストにすぎません。</p>
<p>ただし、Djangoのテンプレートシステムを使用して変更できます。 Django admin はDjango自体を利用しており、そのインターフェースはDjango独自のテンプレートシステムを使用しています。</p>
<section id="s-customizing-your-project-s-templates">
<span id="s-ref-customizing-your-projects-templates"></span><span id="customizing-your-project-s-templates"></span><span id="ref-customizing-your-projects-templates"></span><h3><em>プロジェクト</em> テンプレートをカスタムする。<a class="headerlink" href="#customizing-your-project-s-templates" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">djangotutorial</span></code> ディレクトリ内に <code class="docutils literal notranslate"><span class="pre">templates</span></code> ディレクトリを作成してください。テンプレートは、Djangoがアクセスできる任意の場所に配置できます（Djangoはサーバーが実行されているユーザーとして動作します）。しかし、プロジェクト内にテンプレートを配置するのが良い慣習とされています。</p>
<p>設定ファイル (<code class="file docutils literal notranslate"><span class="pre">mysite/settings.py</span></code>) を開いて、<a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">TEMPLATES</span></code></a> 設定オプションの中に、次のように <a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES-DIRS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DIRS</span></code></a> オプションを追加します。</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">mysite/settings.py</span></code></span><a class="headerlink" href="#id9" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;BACKEND&quot;</span><span class="p">:</span> <span class="s2">&quot;django.template.backends.django.DjangoTemplates&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DIRS&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s2">&quot;templates&quot;</span><span class="p">],</span>
        <span class="s2">&quot;APP_DIRS&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;context_processors&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;django.template.context_processors.debug&quot;</span><span class="p">,</span>
                <span class="s2">&quot;django.template.context_processors.request&quot;</span><span class="p">,</span>
                <span class="s2">&quot;django.contrib.auth.context_processors.auth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;django.contrib.messages.context_processors.messages&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<p><a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES-DIRS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DIRS</span></code></a> は、Django がテンプレートを読み込む時にチェックする、ファイルシステム上のディレクトリのリストです。サーチパスのようなものです。</p>
<div class="admonition-organizing-templates admonition">
<p class="admonition-title">テンプレートの構成</p>
<p>static ファイルと同じように、すべてのテンプレートを1つの大きな templates ディレクトリにまとめることも <em>可能</em> ではあります。しかし、特定のアプリケーションと結びつくテンプレートは、プロジェクトのテンプレートディレクトリ (<code class="docutils literal notranslate"><span class="pre">templates</span></code>) ではなく、それぞれのアプリケーションのテンプレートディレクトリ (<code class="docutils literal notranslate"><span class="pre">polls/templates</span></code> など) に置くべきです。 <em>なぜ</em> そうするのかについては <a class="reference internal" href="reusable-apps.html"><span class="doc">再利用可能アプリのチュートリアル</span></a> で詳しく説明します。</p>
</div>
<p>さて、<code class="docutils literal notranslate"><span class="pre">templates</span></code> の中に <code class="docutils literal notranslate"><span class="pre">admin</span></code> という名前のディレクトリを作りましょう。Django 自体のソースコード内にある、デフォルトの Django admin テンプレートディレクトリ (<a class="extlink-source reference external" href="https://github.com/django/django/blob/main/django/contrib/admin/templates">django/contrib/admin/templates</a>) を探して、 <code class="docutils literal notranslate"><span class="pre">admin/base_site.html</span></code> というテンプレートを、新しく作ったディレクトリにコピーします。</p>
<div class="admonition-where-are-the-django-source-files admonition">
<p class="admonition-title">Django のソースファイルの場所はどこ？</p>
<p>Django のソースファイルがシステム中のどこにあるのか分からない場合は、以下のコマンドを実行してください。</p>
<div class="console-block" id="console-block-0">
<input class="c-tab-unix" id="c-tab-0-unix" type="radio" name="console-0" checked>
<label for="c-tab-0-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-0-win" type="radio" name="console-0">
<label for="c-tab-0-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-0-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import django; print(django.__path__)&quot;</span>
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-0-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py -c <span class="s2">&quot;import django; print(django.__path__)&quot;</span>
</pre></div>
</section>
</div>
</div>
<p>そして、ファイルを編集して <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">site_header|default:_('Django</span> <span class="pre">administration')</span> <span class="pre">}}</span></code> を置き換えます。(中括弧を含む)に自分のサイト名を入れてください。最終的には、次のようなコードのセクションになるはずです:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">branding</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;site-name&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;admin:index&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>Polls Administration<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_anonymous</span> <span class="cp">%}</span>
  <span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;admin/color_theme_toggle.html&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>このようなアプローチを今使ったのは、テンプレートをオーバーライドする方法を示すためです。実際のプロジェクトで今行ったのと同じカスタマイズを行いたい場合には、 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.site_header" title="django.contrib.admin.AdminSite.site_header"><code class="xref py py-attr docutils literal notranslate"><span class="pre">django.contrib.admin.AdminSite.site_header</span></code></a> 属性を使えば、もっと簡単に設定できます。</p>
<p>このテンプレートファイルは <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">branding</span> <span class="pre">%}</span></code> や <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">title</span> <span class="pre">}}</span></code> のようなテキストを多く含んでいます。 <code class="docutils literal notranslate"><span class="pre">{%</span></code> と <code class="docutils literal notranslate"><span class="pre">{{</span></code> のタグは Django のテンプレート言語の一部です。 <a class="reference internal" href="tutorial03.html"><span class="doc">チュートリアル その3</span></a> で見たように、Djangoが <code class="docutils literal notranslate"><span class="pre">admin/base_site.html</span></code> をレンダリングする時に、このテンプレート言語が評価され、最終的なHTMLページが生成されます。</p>
<p>Django のデフォルトのadminテンプレートはすべてオーバーライドできることに注意してください。テンプレートを上書きするには、<code class="docutils literal notranslate"><span class="pre">base_site.html</span></code> で行ったのと同じことをしてください -- デフォルトのディレクトリからカスタムディレクトリにコピーして変更してください。</p>
</section>
<section id="s-customizing-your-application-s-templates">
<span id="customizing-your-application-s-templates"></span><h3><em>アプリケーション用の</em> テンプレートをカスタマイズする<a class="headerlink" href="#customizing-your-application-s-templates" title="Link to this heading">¶</a></h3>
<p>するどい読者はこう質問されるでしょう:  <a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES-DIRS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DIRS</span></code></a>   はデフォルトで空っぽなのに、 Django はなぜデフォルトの admin テンプレートを見つけることができたのだろう? その答えは <a class="reference internal" href="../ref/settings.html#std-setting-TEMPLATES-APP_DIRS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">APP_DIRS</span></code></a> が <code class="docutils literal notranslate"><span class="pre">True</span></code> に設定されているため、 Django は自動的に各アプリケーションのパッケージのサブディレクトリからフォールバックとして <code class="docutils literal notranslate"><span class="pre">templates/</span></code> を探すからです (<code class="docutils literal notranslate"><span class="pre">django.contrib.admin</span></code> は一つのアプリケーションだということを忘れないでください)。</p>
<p>投票アプリケーションはそれほど複雑ではないので、カスタムの admin テンプレートは必要ないでしょう。しかしアプリケーションがさらに凝ったものに成長し、何か機能を実現するために標準の admin テンプレートを変更する必要が出てきた場合、 <em>アプリケーションの</em> テンプレートを編集するほうが、 <em>プロジェクト</em> のテンプレートを編集するより賢い選択になるでしょう。そうすれば、投票アプリケーションを他のどの新しいプロジェクトにも追加でき、投票アプリケーションが（自分自身に必要な）カスタムテンプレートを確実に見つけることができます。</p>
<p>Django のテンプレートの検索方法に関する詳しい情報は、<a class="reference internal" href="../topics/templates.html#template-loading"><span class="std std-ref">テンプレート読み込み ドキュメント</span></a> を参照してください。</p>
</section>
</section>
<section id="s-customize-the-admin-index-page">
<span id="customize-the-admin-index-page"></span><h2>admin index ページをカスタムする<a class="headerlink" href="#customize-the-admin-index-page" title="Link to this heading">¶</a></h2>
<p>近い話題として、 Django の admin index ページのルックアンドフィールをカスタマイズもできます。</p>
<p>デフォルトでは、 admin アプリケーションで登録された <a class="reference internal" href="../ref/settings.html#std-setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> のすべてのアプリケーションが、アルファベット順に表示されます。レイアウトを大きく変更したい場合もあるでしょう。なんといっても、index ページは admin の中でおそらく最も重要なページなので、使いやすいほうがいいですからね。</p>
<p>カスタマイズ対象のテンプレートは <code class="docutils literal notranslate"><span class="pre">admin/index.html</span></code> です。 (前セクションで <code class="docutils literal notranslate"><span class="pre">admin/base_site.html</span></code> にしたことと同じことをしてください。つまり、デフォルトのディレクトリからコピーして、カスタムテンプレートのディレクトリに配置してください)。編集してみると <code class="docutils literal notranslate"><span class="pre">app_list</span></code> というテンプレート変数が使われているのがわかるでしょう。この変数にはインストールされた全 Django アプリが含まれています。これを使う代わりに、各オブジェクトの admin ページヘのリンクをハードコードし、好きなようにカスタマイズできます。</p>
<p>管理画面に満足したら、 <a class="reference internal" href="tutorial08.html"><span class="doc">このチュートリアルのパート8</span></a> を読み、サードパーティ製パッケージの使い方を学んでください。</p>
</section>
</section>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">はじめての Django アプリ作成、その 7</a><ul>
<li><a class="reference internal" href="#customize-the-admin-form">admin フォームのカスタマイズ</a></li>
<li><a class="reference internal" href="#adding-related-objects">リレーション先オブジェクトの追加</a></li>
<li><a class="reference internal" href="#customize-the-admin-change-list">管理サイトのチェンジリストページをカスタマイズする</a></li>
<li><a class="reference internal" href="#customize-the-admin-look-and-feel">管理サイトのルック &amp; フィールをカスタマイズする</a><ul>
<li><a class="reference internal" href="#customizing-your-project-s-templates"><em>プロジェクト</em> テンプレートをカスタムする。</a></li>
<li><a class="reference internal" href="#customizing-your-application-s-templates"><em>アプリケーション用の</em> テンプレートをカスタマイズする</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customize-the-admin-index-page">admin index ページをカスタムする</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="tutorial06.html"
                          title="前の章へ">はじめての Django アプリ作成、その 6</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="tutorial08.html"
                          title="次の章へ">はじめての Django アプリ作成、その 8</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/intro/tutorial07.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">1月 22, 2025</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="tutorial06.html" title="はじめての Django アプリ作成、その 6">previous</a>
     |
    <a href="index.html" title="さぁ始めましょう" accesskey="U">up</a>
   |
    <a href="tutorial08.html" title="はじめての Django アプリ作成、その 8">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>