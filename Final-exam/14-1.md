# トランザクションとロック

## トランザクションとは

- データベースを変更する一連のまとまった操作

- トランザクション内のすべての操作が成功して全体の変更を確定させる

## DB Browser for SQLiteでトランザクションを行う

### トランザクションの開始
- SQLコマンドのbeginを使う (SQL実行タブを開いたら自動的にじょっ攻されている)

- updateコマンドでデータを変更 -> データ変更を取り消したくなったらrollbackコマンドで取り消し (rollback;)

- 現在のデータを閲覧するにはselectコマンド 

### ロック
- ほかのユーザがトランザクション中にデータベースを変更すると、rollbackコマンドを用いたときにそのユーザの変更も取り消されてしまい、元のデータには戻せない可能性がある。

- ロックを行うと、トランザクション中にほかのユーザによる変更が禁止される

### ロックを行う
- DB Browser for SQLiteウィンドウを二つ開き、片方のウィンドウでトランザクションを開始する (beginコマンド必要)

- この状態でselectやinsert, delete, updateなどを行うとロックがかかる

- ロックがかかってもデータの表示はできる

- トランザクションを開始したウィンドウで end transaction; を実行すると、もう片方でも変更ができるようになる


## データベースのインデックス

### インデックス (索引)

- 関係データベースで、テーブルに対してインデックスを作成できる

- インデックスをつける対象はカラム (列)

- 複数列からなるインデックスの作成も可能

### インデックスの有無の比較

- インデックスがないと、テーブル全体を線形探索する必要がある。計算量はO(n)

- インデックスがあれば、効率的な探索ができる。計算量はO(log n)

- データベースサイズが大きくなるデメリットはある

### SQLによるインデックスの作成

- CREATE INDEX *インデックス名* ON *テーブル名(列名)*;

#### 例：studentテーブルのname列にインデックスを作成

##### インデックス名をstu_name_indexとする場合

- CREATE INDEX stu_name_index ON syudent(name);

- 生成後は SELECT * FROM student WHERE name = …; のようなクエリの計算量が改善

## 重要キーワード

- ロギング
- トランザクション
- コミット、ロールバック
- ロック
- インデックス
- SQL:

    - begin;
    - rollback;
    - end transaction;
    - CREATE (UNIQUE) INDEX *index-name* ON *table-name*(*column-name*);